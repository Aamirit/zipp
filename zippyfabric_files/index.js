const funnelJson = {"funnelData":{"referenceId":"43b42697-2041-4ff5-8033-ecea21e1caee","campaign":"10","salt":"ef8e03d0-37a4-11ee-981f-41e2d5b1807d","headTrackingCode":null,"bodyTrackingCode":null,"title":"ZippyFabric","addOns":[{"keyName":"Purchase_Event_FB","keyValue":"2"},{"keyName":"LISTRAK_CART_UPDATE","keyValue":"false"},{"keyName":"EXTERNAL_TRACK_REQ","keyValue":"true"},{"keyName":"SEND_USER_DATA","keyValue":"false"},{"keyName":"TRIPLE_WHALE_REQ","keyValue":"false"},{"keyName":"AD_BEACON_REQ","keyValue":"false"}],"providers":[{"id":4,"name":"TikTok","keyValue":"CGV9I9JC77U2PK6FO2KG"}],"pages":[{"referenceId":"2355988a-139f-454d-8a9e-57c44ad4fd48","splitReferenceId":null,"splitEnabled":false,"isMembershipRequired":false,"title":"Shopify Cart","urlSlug":null,"externalURL":null,"pageView":[{"referenceId":"ddba4a74-8c2e-43ad-a610-33f00792a490","templateTypeId":26,"pageType":26}],"pageProducts":[],"pagebillingCycles":[],"pageVariants":[]},{"referenceId":"4bf5513d-3465-4247-a32c-82fcd14d744e","splitReferenceId":null,"splitEnabled":false,"isMembershipRequired":false,"title":"Checkout Page","urlSlug":null,"externalURL":null,"pageView":[{"referenceId":"fcefb90a-4ed5-436c-9d97-a06da56b1675","templateTypeId":4,"pageType":4}],"pageProducts":[],"pagebillingCycles":[],"pageVariants":[]},{"referenceId":"b302b325-ca7d-45f8-b604-7792583b5182","splitReferenceId":null,"splitEnabled":false,"isMembershipRequired":false,"title":"Thank You Page","urlSlug":"thank_you","externalURL":null,"pageView":[{"referenceId":"3f8c0689-f608-4c5e-a15a-210c20a80459","templateTypeId":5,"pageType":5}],"pageProducts":[],"pagebillingCycles":[],"pageVariants":[]}],"disableBadge":false,"name":"ZippyFabric","whitelabelId":10,"affiliateId":null,"isMenuEnabled":false},"elements":[{"elementId":"fkt-button-4e9-4a0-9f0","href":null,"status":null,"pageViewReferenceId":"3f8c0689-f608-4c5e-a15a-210c20a80459","linkDetails":[],"products":[]},{"elementId":"fkt-link-af3-e94-859","href":null,"status":null,"pageViewReferenceId":"fcefb90a-4ed5-436c-9d97-a06da56b1675","linkDetails":[{"targetPageReferenceId":"b302b325-ca7d-45f8-b604-7792583b5182","targetPageViewReferenceId":"3f8c0689-f608-4c5e-a15a-210c20a80459","products":[],"urlSlug":"thank_you","billingCycleIds":[],"isAllProducts":false,"pageVariants":null,"countryStates":null}],"products":[]}],"isFunnel":true,"faviconUrl":"","logoUrl":"https://assets.checkoutchamp.com/assets.funnelkonnekt.com/Funnel/assets/logo/43b42697-2041-4ff5-8033-ecea21e1caee/Screenshot_1-removebg-preview_x300.png"};const campaignJson = {"selectedCampaign":{"campaignId":10,"dateCreated":"2023-09-15 13:15:51","campaignName":"ZippyFabricIT","campaignType":"ECOMMERCE","currency":"USD","requireQA":0,"listSalesEntry":0,"captureOnShipment":0,"requireTOS":0,"eSignature":0,"campaignTOS":null,"preauthOnly":0,"enableFraudPlugin":0,"insureShipId":0,"insureShipBillerId":null,"insureShipLoadBalancerId":null,"defaultShipProfileId":null,"externalCampaignId":null,"qaPercent":0,"campaignCategoryId":3,"pinlessDebitRoute":0,"prPercent":0,"codOrders":0,"blockPrepaid":0,"blockDebit":0,"blockMastercard":0,"blockVisa":0,"disableExternalPayments":0,"disableRecycleBilling":0,"singleTransaction":0,"bundleFulfillment":0,"blockChargebackBlacklist":0,"couponMax":1,"visible":1,"isLocked":0,"taxServiceId":null,"autoTax":0,"upsellWindow":null,"maxBundleHours":96,"reOrderDays":null,"currencySymbol":"$","currencyNumber":"840","defaultCouponCode":null,"singleTxnGateways":["Apcopay","Braintree","Cardstream","Celerispay","CheckoutV2","Corvia","Fluid Pay","Gala Technology","maverick","MiCamp","NMI","NomuPay","Oonex","Pay Positive","PayCom","Payfirma","PayPal Commerce","PaysafeDirect","Poynt","Revolv3","StripeV2","Swipen","VantivV2","Whitelabel Payments","WithReach","Worldpay"],"shopPayUrl":"https://b120e5-2.myshopify.com","products":[{"campaignProductId":300,"productName":"Sedia a dondolo (con cuscino)","productType":"OFFER","price":"24.99","shippingPrice":"0.00","compareAtPrice":"199.00","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"24.99","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":211,"clientProductId":null,"baseProductName":"Sedia a dondolo (con cuscino)","productSku":null,"productDescription":"Rilassatevi su questa sedia a dondolo da esterno in un accogliente portico come sedia da veranda o da patio, oppure godetevi ore di conversazione su questa moderna sedia a dondolo insieme alla vostra famiglia in salotto.\n\nLa sedia Rocker ha una struttura in acciaio robusta e durevole; i telai principali della sedia sono verniciati a polvere per combattere lacqua, i raggi UV e la ruggine. Le basi inferiori ricurve hanno una finitura a venatura di legno, in grado di dare il calore del legno senza bisogno di manutenzione. Il tessuto in poliestere filato dei cuscini è resistente alle macchie, allacqua e ai raggi UV, per mantenere il vostro set di mobili da giardino intatto stagione dopo stagione.\n\nQuesta poltrona a dondolo è dotata di un cuscino imbottito, che si può piegare in questo dondolo che ama la schiena e si modella per adattarsi al vostro corpo, la plastica sulla slitta inferiore può proteggere i pavimenti e ridurre il rumore.\n\nPreparatevi a sonnecchiare allinterno o allesterno. Questa sedia, che presto diventerà la vostra nuova sedia a dondolo preferita per il patio o il soggiorno, va oltre laspetto elegante e sostiene il vostro corpo con un comfort da sogno.\n\nROCKING LISCIO\nLa sedia stabile consente di dondolare dolcemente avanti e indietro per unesperienza rilassante. Per guardare la TV in veranda o in salotto.\n\nCUSCINO IMBOTTITO E SOVRADIMENSIONATO\nQuesta sedia a dondolo è imbottita e sagomata per adattarsi al corpo. La schiena si rilassa quando ci si accascia sul dondolo.\n\nDONDOLO CONFORTEVOLE\nIl dondolo, che si adatta al vostro corpo, è in grado di proteggere il pavimento e di ridurre il rumore, grazie alla plastica della slitta inferiore.\n\nDESIGN ERGONOMICO\nCon unaltezza della seduta di 30 pollici, questo dondolo da esterno vi farà venire voglia di trascorrere lintera giornata nel vostro patio.\n\nRidefinite la vostra vita allaperto!\nGrand Patio Indoor &amp; Outdoor, sedia a dondolo Royal, cuscino imbottito reclinabile. Per portico, giardino, patio, cortile.\n\nSpecifiche：\n\nColore: grigio\n\nDimensioni del prodotto: 40″P x 38″L x 34″H\n\nPeso dellarticolo: 37 libbre\n\nLimite di peso: 400 libbre\n\nMateriale: Acciaio, poliestere\n\nModello: Solido\n\nTipo di finitura: Spazzolato\n\nTipo di stanza: Soggiorno, Giardino Patio\n\nMateriale del telaio: Legno\n\nCaratteristiche speciali: Ergonomico, durevole, a dondolo, resistente alle macchie, resistente ai raggi UV, antiabrasione, resistente allumidità, resistente allo sbiadimento, resistente allacqua, disponibilità di cuscini, reclinabile\n\n\n\nLA NOSTRA GARANZIA\nSpedizione assicurata in tutto il mondo: Ogni ordine include dettagli di tracciamento in tempo reale e copertura assicurativa nellimprobabile caso in cui un pacco venga perso o rubato durante il trasporto.Garanzia di rimborso: Se i vostri articoli arrivano danneggiati o diventano difettosi entro 30 giorni di normale utilizzo, saremo lieti di emettere una sostituzione o un rimborso.Assistenza clienti 24/7: Abbiamo un team di rappresentanti in carne e ossa pronti ad aiutarvi e a rispondere a qualsiasi domanda entro 24 ore, 7 giorni alla settimana.Acquisti sicuri e protetti: Utilizziamo una crittografia sicura SSL allavanguardia per proteggere al 100% le vostre informazioni personali e finanziarie.\n\nRESTITUZIONE E GARANZIA\n\n\n\nPagamento sicuro al 100% con crittografia SSL.\n\n\nSe non siete soddisfatti al 100%, fatecelo sapere e provvederemo a sistemare le cose.\n\n\n\n\n","productCost":null,"shippingCost":null,"weight":null,"msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8560153821523","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/sedia-a-dondolo-con-cuscino-879573.webp","stockQuantity":"0","productTags":"Kopy,best,rocking 0","variantDetailId":1203,"externalVariantDetailId":"47180571181395","isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[],"memberPricing":[],"combinations":[]},{"campaignProductId":301,"productName":"Orso a grandezza naturale SuperTeddy","productType":"OFFER","price":"24.99","shippingPrice":"0.00","compareAtPrice":"49.99","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"24.99","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":212,"clientProductId":null,"baseProductName":"Orso a grandezza naturale SuperTeddy","productSku":null,"productDescription":"Orsacchiotti e abbracci 7 piedi più grandi del vero\nSiete seduti? Perché stiamo per cambiare per sempre il vostro modo di pensare agli orsacchiotti. Gli orsetti Teddy &amp; Hugs di 7 piedi sono forse gli orsetti più grandi del mondo. Qualcuno che ami ha aspettato una vita per avere un orsacchiotto come questo... e tu sei la persona che realizzerà questo sogno! (Abbiamo già detto che sono alti 3 metri e mezzo?).\n\nInformazioni sugli orsetti Teddy &amp; Hugs\n- ENORME orsacchiotto più grande della vita di 7 piedi (84 pollici)- Pelliccia morbida e coccolosa- Corpi grandi e paffuti perfetti per gli abbracci degli orsi- Sorrisi sciocchi, facce adorabili e piedi enormi con impronte di zampe\n","productCost":null,"shippingCost":null,"weight":"0.000","msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8560153952595","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/files/superteddy-life-sized-bear-848192_jpg_80-min.jpg","stockQuantity":"0","productTags":"Kopy","variantDetailId":1204,"externalVariantDetailId":"47180571279699","isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[],"memberPricing":[],"combinations":[]},{"campaignProductId":317,"productName":"Specchio di cortesia Hello Kitty","productType":"OFFER","price":"24.99","shippingPrice":"0.00","compareAtPrice":"199.95","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"24.99","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":226,"clientProductId":null,"baseProductName":"Specchio di cortesia Hello Kitty","productSku":null,"productDescription":"","productCost":null,"shippingCost":null,"weight":"0.000","msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8565280899411","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/files/9298da27aeaf20d1bc53b5b8a71a51bf_d0fd6d3e-70f6-4024-980c-dce2330c81cb.jpg","stockQuantity":"0","productTags":"Kopy","variantDetailId":1261,"externalVariantDetailId":"47200888095059","isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[],"memberPricing":[],"combinations":[]},{"campaignProductId":318,"productName":"Sedia Papasan doppia","productType":"OFFER","price":"0.00","shippingPrice":"0.00","compareAtPrice":"100.00","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"0.00","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":227,"clientProductId":null,"baseProductName":"Sedia Papasan doppia","productSku":null,"productDescription":"Sono pronta per una lunga notte di lettura sulla mia comoda poltrona!\n\nAccoccolatevi sulla nostra poltrona Papasan doppia!\nDoppia seduta, doppio stile! La nostra nuova Double Papasan Chair è laggiunta perfetta di ispirazione rétro al vostro salotto o allarea esterna coperta.\nSplendidamente realizzato a mano in Indonesia con rattan curvato, le sue curve sono state realizzate da abili artigiani che da anni producono il nostro papasan. La base è un pezzo separato che consente di regolare facilmente langolo di seduta.\nCon un cuscino imbottito in 100% lino, questo pezzo versatile porta un tocco di lusso e un sacco di comfort nella vita di tutti i giorni. Provate il massimo del comfort e del relax con questo cuscino morbido e invitante, perfetto per rilassarsi. Inoltre, grazie al suo tessuto impermeabile, è facile da mantenere e pulire sia per gli interni che per gli esterni.\n\nPreparatevi a sonnecchiare allinterno o allesterno. Presto diventerà la vostra nuova seduta preferita in salotto. Sia che vogliate creare un accogliente angolo lettura o che abbiate semplicemente bisogno di un posto comodo per rilassarvi, la nostra sedia Papasan doppia è la scelta perfetta.\n\nSpecifiche:\n\nRealizzato a mano in rattan curvato e con rilegatura a buccia di rattan con finitura naturale.    Include base e ciotola.    Da utilizzare con i cuscini della sedia Papasan doppia, venduti separatamente.    Disponibile nelle finiture Espresso e Naturale.    Spolverare con un panno asciutto e privo di pelucchi.\n\n\nDimensioni:\n\nIngombro: 65 L x 45,27 P x 29,5 H, 34,87 lbs.\n\nVasca: 65 L x 45,27 P x 16,5 H.\n\nBase: 50 L x 27,5 P x 13 H.\n\nLimite di peso: 600 libbre.\n\n\nIstruzioni per la cura:\nPer mantenere un aspetto favoloso del vostro poly rattan, passatelo regolarmente con un panno umido, mentre per rimuovere i segni di abrasione basta pulire con olio di eucalipto e un panno asciutto.\n","productCost":null,"shippingCost":null,"weight":null,"msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8565585019219","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/files/b10808d8-d002-4662-a528-f2f6ae2d3807.jpg","stockQuantity":"0","productTags":"Kopy","variantDetailId":null,"externalVariantDetailId":null,"isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[{"title":"Naturale / Con cuscino","productSku":null,"price":"39.99","shippingPrice":null,"compareAtPrice":"100.00","variantDetailId":1262,"externalVariantDetailId":"47202028683603","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore","variantName2":"Cuscino","variantName3":null,"variantOptionName1":"Naturale","variantOptionName2":"Con cuscino","variantOptionName3":null,"variantOptionSequence1":1,"variantOptionSequence2":1,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/files/51417afe-d9ba-4608-912a-31ed442e33ae.jpg"},{"title":"Naturale / Senza cuscino","productSku":null,"price":"24.99","shippingPrice":null,"compareAtPrice":"59.99","variantDetailId":1263,"externalVariantDetailId":"47202028716371","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore","variantName2":"Cuscino","variantName3":null,"variantOptionName1":"Naturale","variantOptionName2":"Senza cuscino","variantOptionName3":null,"variantOptionSequence1":1,"variantOptionSequence2":2,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/files/b10808d8-d002-4662-a528-f2f6ae2d3807.jpg"},{"title":"Espresso / Con cuscino","productSku":null,"price":"39.99","shippingPrice":null,"compareAtPrice":"100.00","variantDetailId":1264,"externalVariantDetailId":"47202028749139","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore","variantName2":"Cuscino","variantName3":null,"variantOptionName1":"Espresso","variantOptionName2":"Con cuscino","variantOptionName3":null,"variantOptionSequence1":2,"variantOptionSequence2":1,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/files/638acbe9-636b-4c8f-81be-68d082b130c9.jpg"},{"title":"Espresso / Senza cuscino","productSku":null,"price":"24.99","shippingPrice":null,"compareAtPrice":"59.00","variantDetailId":1265,"externalVariantDetailId":"47202028781907","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore","variantName2":"Cuscino","variantName3":null,"variantOptionName1":"Espresso","variantOptionName2":"Senza cuscino","variantOptionName3":null,"variantOptionSequence1":2,"variantOptionSequence2":2,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/files/785922d5-b88d-48bf-bad6-f0660d79a3a8.jpg"}],"memberPricing":[],"combinations":[]},{"campaignProductId":320,"productName":"Hollywood Premiere Vanity Mirror","productType":"OFFER","price":"24.99","shippingPrice":"0.00","compareAtPrice":"99.00","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"24.99","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":228,"clientProductId":null,"baseProductName":"Hollywood Premiere Vanity Mirror","productSku":null,"productDescription":"VENDITA PRIMAVERA 50% DI SCONTO\nIl nostro specchio per vanità rappresenta la classica esperienza di vanità - il design Hollywood Glam che offre unilluminazione perfetta e uniforme e una chiarezza superiore del riflesso dello specchio. Dotato di 15 prese di luce per unilluminazione brillante, con interruttore dimmer e comode prese di corrente e USB. Lo specchio è racchiuso in un robusto corpo in alluminio che può essere facilmente montato a parete con la ferramenta di montaggio preinstallata o su una scrivania con la base inclusa!\n\nOpzione Bluetooth:\nLo specchio da toilette è dotato di altoparlanti Bluetooth wireless con pulsanti sensibili al tocco e schermo LED retroilluminato integrato nello specchio per controllare laccoppiamento Bluetooth e la regolazione del volume. Può anche consentire di controllare la temperatura corrente per assicurarsi di non avere un crollo del trucco.\nCaratteristiche:\n✅ Lampadine a globo LED smerigliate (bianco freddo) incluse.✅ Interruttore dimmer✅ 2 porte USB✅ 2 prese di corrente✅ Compatibile solo con lampadine da 24 V o inferiori✅ Viti e ancoraggi a muro inclusi✅ Montaggio minimo richiesto✅ Pannello di controllo sensibile al tocco per regolare il volume, cambiare la modalità di visualizzazione dei LED e altro ancora.\n \nOLTRE 100.000 ORDINI SPEDITI NEL 2023 E IN CORSO DI EVASIONE. PRENDETE IL VOSTRO PRIMA DI ESAURIRE LE SCORTE!","productCost":null,"shippingCost":null,"weight":"0.000","msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8566688514387","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/647995b0807e0695159042_w803h620_07cced40-0f4c-4920-98b3-a2fb3ce49be0.webp","stockQuantity":"0","productTags":"Kopy","variantDetailId":1266,"externalVariantDetailId":"47206453412179","isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[],"memberPricing":[],"combinations":[]},{"campaignProductId":321,"productName":"SPECCHIO ONDULATO A LED CONTROLLATO","productType":"OFFER","price":"29.98","shippingPrice":"0.00","compareAtPrice":"99.99","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"29.98","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":229,"clientProductId":null,"baseProductName":"SPECCHIO ONDULATO A LED CONTROLLATO","productSku":null,"productDescription":"INTRODUZIONE DELLO SPECCHIO ONDULATO A LED CONTROLLATO\nElevare lesperienza di riflessione\nSperimentate il futuro della tecnologia degli specchi con il nostro modernissimo Wavy Mirror LED Controlled. Questo specchio innovativo non è solo una superficie riflettente, ma un portale verso un mondo di atmosfera e stile personalizzati. Sia che vi stiate preparando per la giornata, che vi stiate rilassando per la notte o che vogliate semplicemente migliorare latmosfera del vostro spazio, questo specchio è il vostro compagno ideale.\n\nCaratteristiche principali:\n\nDesign elegante e moderno: Lo specchio Wavy vanta un design contemporaneo che si adatta perfettamente a qualsiasi arredamento. I suoi bordi ondulati e senza cornice aggiungono un tocco di eleganza a qualsiasi ambiente, rendendolo un pezzo forte della vostra casa.   \nPersonalizzazione dellilluminazione a LED: Migliorate la vostra esperienza con lo specchio grazie allilluminazione LED personalizzabile. Basta premere un pulsante per regolare la luminosità, la temperatura del colore e scegliere tra una serie di effetti luminosi dinamici per creare latmosfera perfetta.   \n\nControllo intelligente: Controllate il vostro specchio con facilità utilizzando il telecomando in dotazione o tramite una comoda app per smartphone. Impostate timer, create preimpostazioni e sincronizzatelo con il vostro ecosistema smart home per integrarlo senza problemi nella vostra routine quotidiana.\n\n    Superficie riflettente di alta qualità: Lo specchio stesso offre un riflesso cristallino che lo rende perfetto per la pulizia, lapplicazione del trucco o semplicemente per controllare il proprio abbigliamento. Il vetro di alta qualità garantisce longevità e resistenza.   \nEfficienza energetica: La nostra tecnologia LED non è solo versatile ma anche efficiente dal punto di vista energetico, consentendo di risparmiare sulla bolletta elettrica e di godere di effetti di luce straordinari.  \n\n  Facile installazione: Installare lo specchio ondulato è un gioco da ragazzi. Può essere montato a parete in orizzontale o in verticale e tutta la ferramenta necessaria è inclusa.\n\n    Dimensioni multiple: Scegliete tra una gamma di dimensioni che si adattano al vostro spazio, dalle opzioni compatte per una vanità personale agli specchi più grandi per il soggiorno o il bagno.\n\n\nTrasformare lo spazio:\nIl Wavy Mirror LED Controlled non è solo uno specchio: è unaggiunta trasformativa alla vostra casa. Utilizzatelo per creare un ambiente intimo e accogliente per un bagno rilassante, per impostare lilluminazione perfetta per la vostra routine di trucco o per trasformare il vostro salotto in un centro di intrattenimento con effetti di luce dinamici.Dite addio agli specchi ordinari e abbracciate il futuro con il Wavy Mirror LED Controlled. Elevate la vostra esperienza di riflessione e rendete straordinario ogni momento.\n\n\nDIMENSIONI\n\n\n\n\n\n\n\n\n\nIn generale\nW 36.6 x H 71.7\n\n\nSpessore\n3.9\n\n\nPeso\n62.5 lbs\n\n\n\n\n\n\n\nOrdinate il vostro oggi e immergetevi in un mondo di illuminazione e stile personalizzato.\nMateriali e caratteristiche:\n\nTelaio in resina acrilica opalescente formata sotto vuoto\n\nSpecchio durevole, ecologico e privo di rame, di colore bianco super.\n\nTelecomando LED incluso - (x2) batterie AAA necessarie\n\nSistema di illuminazione a LED, luce accesa in 7 colori (telecomando LED incluso)\n\nCavo di 2 metri con interruttore on/off\n\nSolo per uso interno\n\nProdotto completamente assemblato\n\n","productCost":null,"shippingCost":null,"weight":null,"msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8566667673939","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/ettore-sottsass-ultrafragola-mirror-lifestyle.jpg","stockQuantity":"0","productTags":"Kopy","variantDetailId":1267,"externalVariantDetailId":"47206384894291","isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[],"memberPricing":[],"combinations":[]},{"campaignProductId":322,"productName":"COLLANA INCISA CON BOX ROSA VERA","productType":"OFFER","price":"0.00","shippingPrice":"0.00","compareAtPrice":"44.99","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"0.00","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":230,"clientProductId":null,"baseProductName":"COLLANA INCISA CON BOX ROSA VERA","productSku":null,"productDescription":null,"productCost":null,"shippingCost":null,"weight":null,"msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8566996533587","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/22_750x_1dec96a3-37f9-4ba5-b736-4e608a39c1dc_1.png","stockQuantity":"0","productTags":"Collana con nome,Collana con cuore,Collana regalo,Collana con iniziale,Kopy,Collana personalizzata,Collana con incisione","variantDetailId":null,"externalVariantDetailId":null,"isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[{"title":"Rossa / Oro 18ct","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1268,"externalVariantDetailId":"47208692023635","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Rossa","variantOptionName2":"Oro 18ct","variantOptionName3":null,"variantOptionSequence1":1,"variantOptionSequence2":1,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":""},{"title":"Rossa / Argento S925","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1269,"externalVariantDetailId":"47208692056403","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Rossa","variantOptionName2":"Argento S925","variantOptionName3":null,"variantOptionSequence1":1,"variantOptionSequence2":2,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/0751f2e8-0f8a-44fc-aba4-abe252bf27eb_750x_7f330a4a-a9ac-4bbb-842b-fb49ec67676f.webp"},{"title":"Rossa / Oro Rosa 18ct","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1270,"externalVariantDetailId":"47208692089171","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Rossa","variantOptionName2":"Oro Rosa 18ct","variantOptionName3":null,"variantOptionSequence1":1,"variantOptionSequence2":3,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/b2fdb1a5-143d-474d-aa21-4b01b0841bee_750x_3eef76c0-23fa-4315-bde8-1a1c302529d4.webp"},{"title":"Azzurra / Oro 18ct","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1271,"externalVariantDetailId":"47208692121939","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Azzurra","variantOptionName2":"Oro 18ct","variantOptionName3":null,"variantOptionSequence1":2,"variantOptionSequence2":1,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/6114be5c-90fb-49a1-9a30-086e0104e456_750x_a9cfdb63-db1b-4bcd-a43f-3d3d79c77257.webp"},{"title":"Azzurra / Argento S925","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1272,"externalVariantDetailId":"47208692154707","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Azzurra","variantOptionName2":"Argento S925","variantOptionName3":null,"variantOptionSequence1":2,"variantOptionSequence2":2,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/b7eb8d27-2908-4de0-b2fa-d54ed3d295be_750x_e605163b-9484-44f0-8c56-f4fb86093444.webp"},{"title":"Azzurra / Oro Rosa 18ct","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1273,"externalVariantDetailId":"47208692187475","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Azzurra","variantOptionName2":"Oro Rosa 18ct","variantOptionName3":null,"variantOptionSequence1":2,"variantOptionSequence2":3,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/bd30769b-8a63-49c6-8109-f0f58578e221_750x_9c238d82-6d96-4416-98a3-638cae584418.webp"},{"title":"Rosa / Oro 18ct","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1274,"externalVariantDetailId":"47208692220243","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Rosa","variantOptionName2":"Oro 18ct","variantOptionName3":null,"variantOptionSequence1":3,"variantOptionSequence2":1,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/3f7f12bc-42a2-4cd1-890c-58c525b75eca_750x_9ddbf9be-5e7a-4602-a452-830a5561eae1.webp"},{"title":"Rosa / Argento S925","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1275,"externalVariantDetailId":"47208692253011","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Rosa","variantOptionName2":"Argento S925","variantOptionName3":null,"variantOptionSequence1":3,"variantOptionSequence2":2,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/e9c36a04-04e7-43fb-b9f9-a1b8b97a3354_750x_1cb235f3-34cc-4b1f-9588-44da800a73a8.webp"},{"title":"Rosa / Oro Rosa 18ct","productSku":null,"price":"17.94","shippingPrice":null,"compareAtPrice":"44.99","variantDetailId":1276,"externalVariantDetailId":"47208692285779","isOutOfStock":0,"weight":null,"productQty":null,"billDelay":null,"variantName1":"Colore Rosa","variantName2":"Colore Collana","variantName3":null,"variantOptionName1":"Rosa","variantOptionName2":"Oro Rosa 18ct","variantOptionName3":null,"variantOptionSequence1":3,"variantOptionSequence2":3,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/db1442ed-43ed-4379-8f88-a6d2a7d52cfb_750x_9a1def80-b6f4-4d04-8517-2bbac1289d1b.webp"}],"memberPricing":[],"combinations":[]},{"campaignProductId":323,"productName":"Calzino pantofolaio Fuzzy Legs","productType":"OFFER","price":"0.00","shippingPrice":"0.00","compareAtPrice":"49.99","billerId":6,"billerName":"CookGadgetsDiscount","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"0.00","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":231,"clientProductId":null,"baseProductName":"Calzino pantofolaio Fuzzy Legs","productSku":null,"productDescription":null,"productCost":null,"shippingCost":null,"weight":null,"msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"productCategoryId":"7","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8568029938003","imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/3_11e6c93a-6596-476e-b742-ae32b46c9bcb.png","stockQuantity":"0","productTags":"Kopy","variantDetailId":null,"externalVariantDetailId":null,"isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"variants":[{"title":"Grigio","productSku":"SW1319-01-Grey","price":"24.99","shippingPrice":null,"compareAtPrice":"49.99","variantDetailId":1277,"externalVariantDetailId":"47212450021715","isOutOfStock":0,"weight":"0.000","productQty":null,"billDelay":null,"variantName1":"Colore","variantName2":null,"variantName3":null,"variantOptionName1":"Grigio","variantOptionName2":null,"variantOptionName3":null,"variantOptionSequence1":1,"variantOptionSequence2":null,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/3_11e6c93a-6596-476e-b742-ae32b46c9bcb.png"},{"title":"Marrone","productSku":"COMF1363-001-Brown","price":"24.99","shippingPrice":null,"compareAtPrice":"49.99","variantDetailId":1278,"externalVariantDetailId":"47212450054483","isOutOfStock":0,"weight":"0.000","productQty":null,"billDelay":null,"variantName1":"Colore","variantName2":null,"variantName3":null,"variantOptionName1":"Marrone","variantOptionName2":null,"variantOptionName3":null,"variantOptionSequence1":2,"variantOptionSequence2":null,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/ScreenShot2023-08-08at3.39.57PM.png"},{"title":"Rosa","productSku":"SW1319-03-Pink","price":"24.99","shippingPrice":null,"compareAtPrice":"49.99","variantDetailId":1279,"externalVariantDetailId":"47212450087251","isOutOfStock":0,"weight":"0.000","productQty":null,"billDelay":null,"variantName1":"Colore","variantName2":null,"variantName3":null,"variantOptionName1":"Rosa","variantOptionName2":null,"variantOptionName3":null,"variantOptionSequence1":3,"variantOptionSequence2":null,"variantOptionSequence3":null,"stockQuantity":0,"imageUrl":"https://cdn.shopify.com/s/files/1/0778/5762/0307/products/ScreenShot2023-09-14at9.16.38AM.png"}],"memberPricing":[],"combinations":[]}],"countries":[{"countryName":"Italy","countryCode":"IT","continent":"EU","currencyCode":"EUR"}],"currencies":[{"currencyCode":"USD","symbolAlign":"LEFT","includeShipping":0,"isComma":0,"decimals":2,"rounding":null,"currencyFee":"0.00","sendToGateway":1,"currencySymbol":"$","currencyNumber":"840","currencyName":"US Dollar"},{"currencyCode":"EUR","symbolAlign":"LEFT","includeShipping":0,"isComma":0,"decimals":2,"rounding":0,"currencyFee":"0.00","sendToGateway":0,"currencySymbol":"€","currencyNumber":"978","currencyName":"Euro"}],"taxes":[],"coupons":[],"shipProfiles":[],"zones":[],"blacklist":null}};/**FUNNELDATA**/
const ccProductSectionsOnPage = $(".fk-product-section").length;
ccProductSectionsOnPage && disableInteractions(null, true, true);
const percentage = "%";
const zeroPercentage = "0%";
const allowedCardNetworks = ["AMEX", "DISCOVER", "INTERAC", "JCB", "MASTERCARD", "VISA"];
const prepaidGateways = ["SKRILL","CENTROBILL","QUICKPAY","CCBILL", "WITHREACH_PAYPAL"];
const pagBrasilGateways = ["BOLETO", "PIX"];
const stripeAlternateGateways = ["BANCONTACT", "IDEAL", "GIROPAY", "SEPA_DEBIT", "SOFORT", "P24"];
const multiPayRebillGateways = ["AFTERPAY","SEZZLE","KLARNA","AFFIRM"];
const allowedFraudPixelPages = [1, 2, 3, 4, 5, 17, 18, 21, 33, 34];
const gPayGatewayFieldsForOthers = {"stripe":[{"args":{"name":"googlePayStripePublishableKey","paramName":"stripe:publishableKey","addOnName":"STRIPE_KEY","keyName":{"name":"googlePayStripePublishableKey","value":"STRIPE_KEY"},"action":"STRIPE_KEY_UPDATE","placeholder":"Publishable Key","formGroupClassName":"googlepay-form-group-margin-bottom","tooltipContent":{"content":"Publishable Key received from Stripe","placement":"right","id":"stripeConstantsPublishableKeyId"}}}]};
const gPayGatewayWithOtherFields = ["stripe"];
const todayDate = new Date();
const todayDateLong = todayDate.getTime() + todayDate.getMilliseconds();
const userRef = Math.floor(Math.random() * Math.random() * todayDateLong);
const tokenType = "MembershipBearer";
const cookieData = {};
const scrollCardsSlotSize = 30;
const fkCheckboxAndRadioProductIdHashMap = {};
const checkoutChampWhiteLabelId = "10";
const ccUpsellPageFFLProducts = {};
/*
Fields supported to authenticate a card transaction.
PAN_ONLY: This authentication method is associated with payment cards stored on file with the user's Google Account. Returned payment data includes personal account number (PAN) with the expiration month and the expiration year.
CRYPTOGRAM_3DS: This authentication method is associated with cards stored as Android device tokens. Returned payment data includes a 3-D Secure (3DS) cryptogram generated on the device.
*/
const allowedCardAuthMethods = ["PAN_ONLY", "CRYPTOGRAM_3DS"];
const baseCardPaymentMethod = {
    type: 'CARD',       /*Other options - 'PAYPAL - https://developer.paypal.com/docs/archive/checkout/how-to/googlepay-integration/ */
    parameters: {
      allowedAuthMethods: allowedCardAuthMethods,
      allowedCardNetworks: allowedCardNetworks,
      assuranceDetailsRequired: false
    }
};
const baseRequest = {
    apiVersion: 2,
    apiVersionMinor: 0
};
const browserData = {
    acceptHeader: 'application/json',
    userAgent: navigator.userAgent,
    language: navigator.language,
    timezone: (new Date()).getTimezoneOffset().toString(),
    colorDepth: screen.colorDepth,
    screen: {
        height: screen.height.toString(),
        width: screen.width.toString()
    },
    javaScriptEnabled: true,
    javaEnabled: navigator.javaEnabled()
};
const urlParams = new URLSearchParams(getCurrentWindowLocation().search);
const ship = ["shipFirstName", "shipLastName", "shipAddress1", "shipAddress2", "shipCity", "shipCountry", "shipState", "shipPostalCode", "shipFullName"];
const ccBillingFields = ["firstName", "lastName", "address1", "address2", "city", "country", "state", "postalCode", "fullName"];
const memberFields = ["emailAddress", "phoneNumber", "address1", "address2", "city", "state", "country", "postalCode"];
const ccDynamicProductSection = document.querySelector(".cc-dynamic-product-section");
"use strict";function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg)})})}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result)},function(error){return invoke("throw",error,resolve,reject)})}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(undefined===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator["return"]&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;){if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next}return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,function(){return this}),define(Gp,"toString",function(){return"[object Generator]"}),exports.keys=function(object){var keys=[];for(var key in object){keys.push(key)}return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this){"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)}},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},"catch":function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel}},exports}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var cellFormat=[];var ccProductId;var variantSelectFlag=0;var checkedElement;setShoppingCartSpinner();var isVisited=true;var isVisitedOnScroll=true;var isVisitedOnLoad=true;var isStickyBar=true;var isVisitedStickyOnLoad=true;var captureLeadInterval;var ccIsVisitedOnScrollUp=true;var ccScrollOffset=0;var products=[];var fkCart={};var rebillCart={};var customCart={};var altValues=[];var orderId;var result=true;var surveySectionCount=1;var progressBar=[];var decrementSectionCount=0;var parentSection="";var cartProduct=[];var defaultCountryCode="US";var appliedCouponCode=[];var address1FieldAutComplete;var shipAddress1FieldAutComplete;var maskShellCssAdded=false;var lisTrakCapturedEmail="";var lisTrakCartUpdated=false;/*Google Pay fields starts*/var googlePaymentsClient=null;var googlePaymentDataRequest;var shippingCostIncluded=false;var shippingCostApplePayIncluded=false;var campaignBaseCurrencySymbol;var staticCurrencyValues=[];var fkMenuList=[];var fkConfiguredProductCol=null;var fkCollectionData=[];var fkProductCollection=[];var scrolledCardsCount=30;var fkCollectionSize=0;var fkCollectionLoader=false;var vatTaxRate=1;var globalOrderData;var isVatOnOrder;var ccSkipStaticCurrencyConversion=false;if(document.cookie){var cookies=document.cookie.split(";");cookies.forEach(function(d){var cookieName=d.split("=")[0].trim();var cookieVal=d.split("=")[1].trim();if(cookieVal){cookieData[cookieName]=cookieVal}})}hidePaymentTemplateButtons();var cardPaymentMethod;/*Google Pay fields ends*/var finishProcessing=false;function checkDomainForRoute(){if(getCurrentWindowLocation().hostname.indexOf("funnelkonnekt.com")>0){return true}if(getCurrentWindowLocation().hostname.indexOf("thisisatestsiteonly.com")>0){return true}return false}//get parameters from the URL query string
if(urlParams.has("couponCode")){sessionStorage.setItem("couponCode",urlParams.get("couponCode"))}if(urlParams.has("paypalAccept")&&urlParams.get("paypalAccept")==="1"&&(urlParams.has("token")&&urlParams.has("PayerID")||urlParams.has("ba_token"))||urlParams.has("finalizeTransaction")&&urlParams.get("finalizeTransaction")==="1"&&urlParams.has("orderId")){finishProcessing=true}//support for products and variants from Shopify
//https://yourcheckoutpage.com/?products=productId:qty;productId:qty;...
//example:  https://yourcheckoutpage.com/?products=32.47:1;159:2;6:1
else if(urlParams.has("products")){var orderData=JSON.parse(sessionStorage.getItem("orderData"));var ccPageReferrer=document.referrer||"";var ccPageOrigin=window&&window.location&&window.location.origin;if(orderData&&(orderData.orderStatus==="COMPLETE"||orderData.orderStatus==="PENDING")&&ccPageReferrer&&!ccPageReferrer.startsWith(ccPageOrigin)){//clear orderId, orderData, session, requestUr, totals, leadParams, taxParams, shipParams
sessionStorage.removeItem("orderId");sessionStorage.removeItem("orderData");sessionStorage.removeItem("sessionId");sessionStorage.removeItem("requestUri");sessionStorage.removeItem("totals");sessionStorage.removeItem("leadParams");sessionStorage.removeItem("taxParams");sessionStorage.removeItem("shipParams")}fkCart={};rebillCart={};customCart={};var urlProducts=urlParams.get("products").split(";");var urlProductsLength=urlProducts.length;for(var _i=0;_i<urlProductsLength;_i++){var product=urlProducts[_i];var _productData=product.split(":");var deliveryData=_productData[0].split("|");var cartKey=Object.keys(fkCart).length.toString()+"~"+deliveryData[0];ccProductId=urlProductsLength==1?deliveryData[0]:null;fkCart[cartKey]=_productData[1];if(deliveryData.length>1&&deliveryData[1].length>0){rebillCart[cartKey]=deliveryData[1]}if(deliveryData.length>2&&deliveryData[2].length>0){deliveryData[1]=_productData[1];var len=Object.keys(customCart).length;customCart[len]=deliveryData.join("|").replace(/~/g,":")}}sessionStorage.setItem("fkCart",JSON.stringify(fkCart));sessionStorage.removeItem("rebillCart");if(Object.keys(rebillCart).length>0)sessionStorage.setItem("rebillCart",JSON.stringify(rebillCart));if(Object.keys(customCart).length>0)sessionStorage.setItem("customCart",JSON.stringify(customCart))}//support for products from WooCommerce
else if(urlParams.has("productId")){fkCart={};var urlProduct=urlParams.get("productId");var urlProductQty=urlParams.has("qty")?urlParams.get("qty"):1;fkCart[urlProduct]=urlProductQty;sessionStorage.setItem("fkCart",JSON.stringify(fkCart));ccProductId=urlProduct}if(urlParams.has("cartId")){sessionStorage.setItem("cartId",urlParams.get("cartId"))}fetchPageData();vatTaxRate=getTaxRate().vatTaxRate;if(ccProductId&&([2,4].includes(pageData.pageTypeId)&&ccDynamicProductSection||pageData.pageTypeId===34)){fkCart={};sessionStorage.setItem("fkCart",JSON.stringify(fkCart));sessionStorage.setItem("currentItem",ccProductId)}//Confirm PayPal
if(urlParams.has("paypalAccept")&&urlParams.get("paypalAccept")==="1"&&(urlParams.has("token")&&urlParams.has("PayerID")||urlParams.has("ba_token"))){var _token=urlParams.get("token");var payerID=urlParams.get("PayerID");var baToken=urlParams.get("ba_token");var funnelData=sessionStorage.getItem("funnelData");if(funnelData&&(!(_token===null||payerID===null)||!(baToken===null))){addOverlayEffectScripts();showOverlayEffect();confirmPaypal(_token,payerID,baToken)}}if(urlParams.has("errorMsg")){alert("Error Processing Payment: "+urlParams.get("errorMsg"))}//Check if the session already available
if(!sessionStorage.length){localStorage.setItem("getSessionStorageapp.checkoutchamp.com",Date.now())}if(!urlParams.has("PayerID")&&!urlParams.has("ba_token")){sessionStorage.removeItem("paySource");sessionStorage.removeItem("paypalSuccessRoute")}window.addEventListener("storage",function(event){if(event.key==="getSessionStorageapp.checkoutchamp.com"){localStorage.setItem("sessionStorageapp.checkoutchamp.com",JSON.stringify(sessionStorage));localStorage.removeItem("sessionStorageapp.checkoutchamp.com")}else if(event.key==="sessionStorageapp.checkoutchamp.com"&&!sessionStorage.length){var eventData=JSON.parse(event.newValue);for(var key in eventData){sessionStorage.setItem(key,eventData[key])}}});window.addEventListener("openSectionTimer",function(event){getCurrentWindowLocation().hash=event.detail;$(event.detail).slideDown("slow");smoothScrolling(null)},{once:true});$("[onclick^='goToStep2'], [onclick^='slide'], .fk-2step-link").on("mouseup",function(){setTimeout(function(){return hideCheckBoxSection()},100)});function hideCheckBoxSection(){$("input[type='checkbox']").each(function(){var openCheckboxSectionValue=$(this).attr("opencheckboxsection");if(openCheckboxSectionValue){if($(this).closest(".bump-div-class").length===0){this.checked&&$("#"+openCheckboxSectionValue).hide()}else{this.checked===false&&$("#"+openCheckboxSectionValue).hide()}}})}function hidePaymentTemplateButtons(){document.querySelectorAll(".btnGoogle1, .btnGoogle2").forEach(function(gPayButton){var btnWidth=$(gPayButton.parentNode).css("width");gPayButton.style.display="none";gPayButton.parentNode.style.width=btnWidth})}function showVariantImage(prodSection,prodImage,prodValue,prodPrice,prodShipPrice,selectedVariant){if(prodSection&&!prodSection.closest(".fk-product-variant-select")){var currentItem=sessionStorage.getItem("currentItem");var sectionClassList=prodSection.classList;var isChangeProdSection=sectionClassList.contains("cc-dynamic-change-product")||sectionClassList.contains("cc-change-product-section");if(currentItem&&(!ccDynamicProductSection||sectionClassList.contains("cc-dynamic-product-section"))&&!isChangeProdSection){prodValue=currentItem.split(".")[0]}var variantValues=[];var productVariantRadios=prodSection.querySelectorAll("input[class='variant-radio']:checked");var productVariants=prodSection.querySelectorAll("select[name='variant1'], select[name='variant2'], select[name='variant3'], select[name='productVariant']");if(productVariants.length>0){productVariants&&productVariants.forEach(function(variantName){var selOption=$(variantName).find(":selected").text();var variantVal=variantName[0]&&variantName[0].value;if(variantVal!=="null"){variantValues.push(selOption.replace("  - OUT-OF-STOCK","").replace(/ /g,""))}})}if(productVariantRadios.length>0){var productVariantRadiosLength=productVariantRadios.length;for(var _i2=0;_i2<productVariantRadiosLength;_i2++){var productVariantRadio=productVariantRadios[_i2];if(productVariantRadio.parentElement.offsetHeight>0){var selOption=productVariantRadio.parentElement.innerText;variantValues.push(selOption.replace(/ /g,""))}}}if(variantValues.length>0){var isProductNameSelectorExists=prodSection.querySelectorAll("select[name='productVariant']")[0];var variantId=null;if(isProductNameSelectorExists){variantId=$(isProductNameSelectorExists).val()}pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){if(product.campaignProductId==prodValue){product.variants.forEach(function(variant){var imagePath=variant.imageUrl!==""?variant.imageUrl:product.imageUrl;var isIncluded=false;if(variantId){isIncluded=Number(variantId)===variant.variantDetailId}else{var variantProductTitle=[],_i3=1;while(_i3){if(!variant.hasOwnProperty("variantName"+_i3))break;var optionValue=variant["variantOptionName"+_i3];optionValue&&variantProductTitle.push(optionValue.replace(/ /g,""));_i3++}isIncluded=!variantValues.some(function(ele){return!variantProductTitle.includes(ele)})}if(isIncluded&&imagePath!==""&&prodImage){prodImage.setAttribute("src",imagePath);prodImage.setAttribute("data-src",imagePath)}var variantPrice=parseFloat(variant.price||0);var variantShipPrice=variant.shippingPrice;var productPrice=parseFloat(product.cycle1_price||0);var currency=pageData.selectedCampaign.currencySymbol;if(prodPrice&&isIncluded){prodPrice.innerHTML=variant.price!==null&&!product.isEditable&&!product.isVariantBundle?ccFormatCurrency(getItemPrice(null,variantPrice,1,null),currency):ccFormatCurrency(getItemPrice(null,productPrice,1,null),currency)}if(variantShipPrice!==""&&prodShipPrice&&isIncluded){prodShipPrice.innerHTML=variantShipPrice!==null&&!product.isVariantBundle?ccFormatCurrency(variantShipPrice,currency):ccFormatCurrency(product.cycle1_shipPrice,currency)}})}})}}}window.onpageshow=function(event){if(event.persisted){window.location.reload()}};var validPhoneNumberFlag="";var phFormatByCountry=getAddOnKeyValue(findAddOn("PH_FORMAT_BY_COUNTRY"));var validPages=pageData.pageTypeId!==17&&pageData.pageTypeId!==18&&pageData.pageTypeId!==34?true:false;var prodStockVerify=getAddOnKeyValue(findAddOn("PROD_STOCK_VERIFY"));var verifyStock=prodStockVerify==="true"&&validPages?true:false;function callWindowLoad(){sessionStorage.removeItem("previousCurrencySymbol");sessionStorage.removeItem("previousExchangeRate");if(pageData&&pageData.pageTypeId===9){sessionStorage.setItem("fkCart",JSON.stringify({}));var sessionLoginOrder=sessionStorage.getItem("loginOrder");sessionLoginOrder=sessionLoginOrder&&sessionLoginOrder!=="undefined"&&sessionLoginOrder!=="null"&&JSON.parse(sessionLoginOrder);updateMap(sessionLoginOrder)}if(pageData&&[13,17,18,34].includes(pageData.pageTypeId)){$("select[name=quantity]").each(function(){var optionsAsString="";for(var i=1;i<100;i++){optionsAsString+="<option value='"+i+"'>"+i+"</option>"}$(this).empty();$(this).append(optionsAsString);$(this).val(1)});var _currentItem=sessionStorage.getItem("currentItem");var currentQty=sessionStorage.getItem("currentProductQty");var currentNextBillDate=sessionStorage.getItem("currentNextBillDate");var billingIntervalDays=sessionStorage.getItem("billingIntervalDays");var currentPrice=sessionStorage.getItem("currentPrice");if(_currentItem&&pageData.pageTypeId!=18&&pageData.pageTypeId!=17){var orderItems=getOrderItems();var quantityValue=orderItems[_currentItem]?orderItems[_currentItem]:currentQty?currentQty:1;if(quantityValue){$("select[name='quantity'],input[name='quantity']").each(function(){$(this).val(quantityValue)})}if(currentNextBillDate){$("input[name='nextBillDate']").each(function(){$(this).val(currentNextBillDate)})}if(billingIntervalDays){$("input[name='frequency']").each(function(){$(this).val(billingIntervalDays)})}if(currentPrice){$("input[name='price']").each(function(){$(this).val(currentPrice)})}}}if($("select[name=currency]").length){$("select[name=currency]").first().on("change",function(){setPriceAndCurrency(this.value)})}$("a").css({"cursor":"pointer"});loadYoutubeThumbnails();$("input[name=emailAddress]").each(function(){$(this).attr({inputmode:"email"})});$("input[name=postalCode], input[name=shipPostalCode]").each(function(){var checkText=$(this).attr("type")==="text";if(checkText){$(this).removeAttr("pattern inputmode")}var checkNumber=$(this).attr("type")==="numeric";if(checkNumber){$(this).attr({pattern:"[0-9-]*",inputmode:"numeric"})}});$(".fk-product-checkbox-button-parent, .fk-product-radio-button-parent, .fk-form-radio-button-parent").on("click",function(){if(this.classList.contains("fk-product-checkbox-button-parent")){var checkInput=$(this).find("input[type=checkbox]");checkInput&&checkInput.length>0&&checkInput[0].click()}else if(this.classList.contains("fk-product-radio-button-parent")||this.classList.contains("fk-form-radio-button-parent")){var radInput=$(this).find("input[type=radio]");radInput&&radInput.length>0&&radInput[0].click()}});var header=document.getElementsByClassName("cartPanelHeader")[0];if(header){var headerHeight=$(header).css("height");$(header).css({"position":"fixed","top":"0px","width":"100%",boxShadow:"0 3px 5px -1px #0003, 0 6px 10px 0 #00000024, 0 1px 18px 0 #0000001f",zIndex:"10000"});$("body").css({marginTop:headerHeight})}var slideAttributes=document.querySelectorAll("button, a, input[type='checkbox'], input[type='radio']");var imageElements=document.querySelectorAll("img");slideAttributes.forEach(function(element){var surveySectionElement=$(element).closest("section.fk-section");if(element.attributes.openid){var hideLinkID="#"+element.attributes.openid.value;$(hideLinkID).hide()}if(element.tagName=="A"&&element.title=="Product Images"){imageElements.forEach(function(img){var prodSection=$(img).closest("section.fk-product-section");var prodSectionValue=prodSection&&$(prodSection).attr("value");var productCardContainerObj=$(img).closest(".fk-product-card-container");var productCardContainerElementExists=productCardContainerObj.length;if(prodSectionValue||productCardContainerElementExists){$(element).attr("offer",prodSectionValue);$(element).attr("action","route");element.style.display="block";element.style.cursor="pointer";productCardContainerElementExists?$(productCardContainerObj).wrap(element):$(img).wrap(element)}})}if(element.attributes.opensurveysection){var nonSurveySectionID="#"+element.attributes.opensurveysection.value;if(nonSurveySectionID.length>1&&$(nonSurveySectionID)&&!$(nonSurveySectionID).is(":hidden")){$(nonSurveySectionID).hide();if($(nonSurveySectionID)[0]&&$(nonSurveySectionID)[0].className==="fk-section"){if(parentSection===""||surveySectionElement.length>0&&parentSection!==surveySectionElement[0].id){surveySectionCount++}parentSection=surveySectionElement.length>0&&surveySectionElement[0].id}}}if(element.attributes.openCheckBoxSection&&element.attributes.openCheckBoxSection.value!=""){var attrType=element.attributes.type;if(attrType&&attrType.nodeValue=="radio"){var openCheckBoxSectionValue=element.attributes.openCheckBoxSection.value;if(openCheckBoxSectionValue){var checkedValue=element.checked;if(checkedValue){$("#"+openCheckBoxSectionValue).slideDown()}else{$("#"+openCheckBoxSectionValue).hide()}}}else{var shippingSectionID="#"+element.attributes.openCheckBoxSection.value;if($(shippingSectionID)&&!$(shippingSectionID).is(":hidden")){$(shippingSectionID).hide()}}}if(element.classList.contains("fk-hide-on-load")){var classes=element.classList;classes.forEach(function(e){if(e&&(e.substring(0,5)==="delay"||e.includes("fk-animation-delay")))element.classList.remove(e)});var minutesDelayAttribute=element.attributes["data-minutesdelay"]&&element.attributes["data-minutesdelay"].value;var secondsDelayAttribute=element.attributes["data-secondsdelay"]&&element.attributes["data-secondsdelay"].value;var delayValue=parseInt(parseInt(minutesDelayAttribute===""||isNaN(minutesDelayAttribute)?0:parseInt(minutesDelayAttribute))*60)+parseInt(parseInt(secondsDelayAttribute==="")||isNaN(secondsDelayAttribute)?0:secondsDelayAttribute);if(minutesDelayAttribute!==undefined||secondsDelayAttribute!==undefined){$("#"+element.attributes["id"].value).css("animation-delay",delayValue+"s")}};});var surveyOptions=null;if(document.forms["survey-form-radio"]){surveyOptions=document.forms["survey-form-radio"].getElementsByTagName("input")}var surveyOptionsLength=surveyOptions&&surveyOptions.length;for(var _i4=0;_i4<surveyOptionsLength;_i4++){var element=surveyOptions[_i4];var surveySectionElement=$(element).closest("section.fk-section");if(element.attributes.opensurveysection){var nonSurveySectionID="#"+element.attributes.opensurveysection.value;if(nonSurveySectionID.length>1&&$(nonSurveySectionID)&&!$(nonSurveySectionID).is(":hidden")){$(nonSurveySectionID).hide();if($(nonSurveySectionID)[0]&&$(nonSurveySectionID)[0].className==="fk-section"){if(parentSection===""||surveySectionElement.length>0&&parentSection!==surveySectionElement[0].id){surveySectionCount++}parentSection=surveySectionElement.length>0&&surveySectionElement[0].id}}}}decrementSectionCount=surveySectionCount;progressBar=document.getElementById("progressbar");if(progressBar){progressBar.style.width=zeroPercentage;progressBar.innerHTML=zeroPercentage}if(cellFormat.length>0||pageData.pageTypeId===9){displayPrices()}var dynamicOrdersRow=document.querySelector("tr[id='fk-dynamic-orders-row']");if(dynamicOrdersRow){displayOrdersTable()}var dynamicShipmentsRow=document.querySelector("tr[id='fk-dynamic-shipments-row']");if(dynamicShipmentsRow){displayShipmentsTable()}var dynamicPurchasesRow=document.querySelector("tr[id='fk-dynamic-purchases-row']");if(dynamicPurchasesRow){displayPurchasesTable()}var surveyInputs=$("input[name*='fk-survey-radio']");stopEventPropogationForInputs(surveyInputs,"surveyInputs");var productInputs=document.getElementsByName("product");stopEventPropogationForInputs(productInputs,"productInputs");var orderBumpInputs=document.getElementsByName("orderBump");if(orderBumpInputs){var orderBumpInputsLength=orderBumpInputs.length;for(var _i5=0;_i5<orderBumpInputsLength;_i5++){var input=orderBumpInputs[_i5];if(input.type==="checkbox"){var orderBumpParent=$("#"+input.id).closest(".bump-div-class");adjustVariantOrderBump(orderBumpParent,input.checked);displayPrices()}}}var affirmButtons=document.querySelectorAll(".affirmButton");var affirmButtonsLength=affirmButtons.length;if(affirmButtonsLength>0){for(var _i6=0;_i6<affirmButtonsLength;_i6++){var affirmButton=affirmButtons[_i6];affirmButton.onclick=function(event){sessionStorage.setItem("paySource","AFFIRM");callMethod(event)}}var affirm_api_key=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="AFFIRM_API_KEY"});var affirmScript=_affirm_config={public_api_key:affirm_api_key[0]&&affirm_api_key[0].keyValue,/* Affirm Public API Key */script:"https://cdn1.affirm.com/js/v2/affirm.js"};(function(l,g,m,e,a,f,b){var d,c=l[m]||{},h=document.createElement(f),n=document.getElementsByTagName(f)[0],k=function k(a,b,c){return function(){a[b]._.push([c,arguments])}};c[e]=k(c,e,"set");d=c[e];c[a]={};c[a]._=[];d._=[];c[a][b]=k(c,a,b);a=0;for(b="set add save post open empty reset on off trigger ready setProduct".split(" ");a<b.length;a++){d[b[a]]=k(c,e,b[a])}a=0;for(b=["get","token","url","items"];a<b.length;a++){d[b[a]]=function(){}}h.async=!0;h.src=g[f];n.parentNode.insertBefore(h,n);delete g[f];d(g);l[m]=c})(window,_affirm_config,"affirm","checkout","ui","script","ready");$("head").append(affirmScript)}var klarnaButtons=document.querySelectorAll(".klarnaButton");var klarnaButtonsLength=klarnaButtons.length;for(var _i7=0;_i7<klarnaButtonsLength;_i7++){var klarnaButton=klarnaButtons[_i7];klarnaButton.onclick=function(event){sessionStorage.setItem("paySource","KLARNA");callMethod(event)}}var sezzleButtons=document.querySelectorAll(".sezzleButton");var sezzleButtonsLength=sezzleButtons.length;for(var _i8=0;_i8<sezzleButtonsLength;_i8++){var sezzleButton=sezzleButtons[_i8];sezzleButton.onclick=function(event){sessionStorage.setItem("paySource","SEZZLE");callMethod(event)}}var afterpayButtons=document.querySelectorAll(".afterpayButton");var afterpayButtonsLength=afterpayButtons.length;if(afterpayButtonsLength>0){for(var _i9=0;_i9<afterpayButtonsLength;_i9++){var afterpayButton=afterpayButtons[_i9];afterpayButton.onclick=function(event){sessionStorage.setItem("paySource","AFTERPAY");callMethod(event)}}var afterpayScript="<script src=\"https://js.afterpay.com/afterpay-1.x.js\" data-analytics-enabled async></script>";$("head").append(afterpayScript)}var bancontactButtons=document.querySelectorAll(".bancontactButton");var bancontactButtonsLength=bancontactButtons.length;for(var _i10=0;_i10<bancontactButtonsLength;_i10++){var bancontactButton=bancontactButtons[_i10];bancontactButton.onclick=function(event){sessionStorage.setItem("paySource","BANCONTACT");callMethod(event)}}var idealButtons=document.querySelectorAll(".idealButton");var idealButtonsLength=idealButtons.length;for(var _i11=0;_i11<idealButtonsLength;_i11++){var idealButton=idealButtons[_i11];idealButton.onclick=function(event){sessionStorage.setItem("paySource","IDEAL");callMethod(event)}}var giropayButtons=document.querySelectorAll(".giropayButton");var giropayButtonsLength=giropayButtons.length;for(var _i12=0;_i12<giropayButtonsLength;_i12++){var giropayButton=giropayButtons[_i12];giropayButton.onclick=function(event){sessionStorage.setItem("paySource","GIROPAY");callMethod(event)}}var sofortButtons=document.querySelectorAll(".sofortButton");var sofortButtonsLength=sofortButtons.length;for(var _i13=0;_i13<sofortButtonsLength;_i13++){var sofortButton=sofortButtons[_i13];sofortButton.onclick=function(event){sessionStorage.setItem("paySource","SOFORT");callMethod(event)}}var p24Buttons=document.querySelectorAll(".p24Button");var p24ButtonsLength=p24Buttons.length;for(var _i14=0;_i14<p24ButtonsLength;_i14++){var p24Button=p24Buttons[_i14];p24Button.onclick=function(event){sessionStorage.setItem("paySource","P24");callMethod(event)}}var sepaButtons=document.querySelectorAll(".sepaButton");var sepaButtonsLength=sepaButtons.length;for(var _i15=0;_i15<sepaButtonsLength;_i15++){var sepaButton=sepaButtons[_i15];sepaButton.onclick=function(event){sessionStorage.setItem("paySource","SEPA_DEBIT");callMethod(event)}}var boletoButtons=document.querySelectorAll(".boletoButton");var boletoButtonsLength=boletoButtons.length;for(var _i16=0;_i16<boletoButtonsLength;_i16++){var boletoButton=boletoButtons[_i16];boletoButton.onclick=function(event){sessionStorage.setItem("paySource","BOLETO");callMethod(event)}}var pixButtons=document.querySelectorAll(".pixButton");var pixButtonsLength=pixButtons.length;for(var _i17=0;_i17<pixButtonsLength;_i17++){var pixButton=pixButtons[_i17];pixButton.onclick=function(event){sessionStorage.setItem("paySource","PIX");callMethod(event)}}var shopPayButtons=document.querySelectorAll(".shopPayButton");var shopPayButtonsLength=shopPayButtons.length;for(var _i18=0;_i18<shopPayButtonsLength;_i18++){var shopPayButton=shopPayButtons[_i18];shopPayButton.onclick=function(event){sessionStorage.setItem("paySource","SHOPPAY");callMethod(event)}}var bitPayButtons=document.querySelectorAll(".bitPayButton");var bitPayButtonsLength=bitPayButtons.length;for(var _i19=0;_i19<bitPayButtonsLength;_i19++){var bitPayButton=bitPayButtons[_i19];bitPayButton.onclick=function(event){sessionStorage.setItem("paySource","BITPAY");callMethod(event)}}var paypalButtons=document.querySelectorAll(".btnPayPal, .btnPayPal2");var paypalButtonsLength=paypalButtons.length;for(var _i20=0;_i20<paypalButtonsLength;_i20++){var paypalButton=paypalButtons[_i20];paypalButton.onclick=function(event){var source=getAddOnKeyValue(findAddOn("PayPal_WithReach"))==="true"?"WITHREACH_PAYPAL":"PAYPAL";sessionStorage.setItem("paySource",source);callMethod(event)}}var codButtons=document.querySelectorAll(".cod-button");var codButtonsLength=codButtons.length;for(var _i21=0;_i21<codButtonsLength;_i21++){var codButton=codButtons[_i21];codButton.onclick=function(event){sessionStorage.setItem("paySource","COD");callMethod(event)}}var setUpMasking=function setUpMasking(input,name,example){input.classList.add("fkmasked");input.removeAttribute("maxlength");input.dataset.validDataExample=example;input.addEventListener("keyup",function(e){handleMaskedInputChange(e)});window.addEventListener("keyup",function(e){e.target.name===name&&handleMaskedInputChange(e)})};var cardDateInput=document.getElementsByName("cardDate")[0];if(cardDateInput){cardDateInput.dataset.pattern="(1[0-2]|0[1-9])";setUpMasking(cardDateInput,"cardDate","11/18")}var placeHolderMasked=function placeHolderMasked(input,attributeName){var placeHolder=input.getAttribute(attributeName);var alphabetsRegex=new RegExp("[a-z]","i");if(placeHolder){return!alphabetsRegex.test(placeHolder)}else{return false}};var phoneNumberInput=document.getElementsByName("phoneNumber")[0];if(phoneNumberInput){try{if(phFormatByCountry==="true"){phoneNumberInput.removeAttribute("format");$("head").append("<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css'>");$("head").append("<script src='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js'></script>");$("head").append("<script src='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/12.1.5/js/utils.js'></script>");phoneNumberInput.classList.add("intelPhoneInput");$("<span id='error-msg' class='hide floatRight'></span>").insertAfter("[name='phoneNumber']");var intlPhoneNumberInput=document.getElementsByClassName("intelPhoneInput")[0];if(intlPhoneNumberInput){var _orderData=JSON.parse(sessionStorage.getItem("orderData"));var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var customerCountry=customerOrders?customerOrders.country:"";var orderCountry=_orderData?_orderData.shipCountry:"";$("head").append("<style> #error-msg{color:red;} .floatRight{float: right; } .hide{ display:none; } .intelPhoneInput{ width:100% !important;padding-left: 100px !important; } .iti{width:100% !important;}</style>");var shipCountry=document.getElementsByName("shipCountry")[0];var billCountry=document.getElementsByName("country")[0];var _input=document.querySelector(".intelPhoneInput");var errorMsg=document.querySelector("#error-msg");$.when($.getScript("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"),$.getScript("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/12.1.5/js/utils.js"),$.Deferred(function(deferred){$(deferred.resolve)})).done(function(){var errorMap=["Invalid number","Invalid country code","Invalid number","Invalid number","Invalid number","Invalid number","Invalid number"];// init plugin
var iti=window.intlTelInput(_input,{hiddenInput:"full_phone",formatOnDisplay:true,separateDialCode:true,autoPlaceholder:"aggressive",initialCountry:customerCountry||orderCountry||defaultCountryCode,preferredCountries:["us","ca"],utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js"// just for formatting/placeholders etc
});_input.addEventListener("countrychange",function(e){_input.value="";maskingPhoneNumber()});maskingPhoneNumber();function maskingPhoneNumber(){if(placeHolderMasked(_input,"placeholder")){setUpMasking(_input,"phoneNumber",_input.getAttribute("placeholder"))}}billCountry?billCountry.addEventListener("change",function(){iti.setCountry(this.value)}):"";shipCountry?shipCountry.addEventListener("change",function(){iti.setCountry(this.value)}):"";var reset=function reset(){validPhoneNumberFlag="";_input.classList.remove("error");errorMsg.innerHTML="";errorMsg.classList.add("hide");$(".intelPhoneInput").css("outline","1px solid transparent")};function validateNumber(){reset();var placeholder=_input.getAttribute("placeholder").replace(/[\(\)\-\s]/g,"");placeholder=placeholder.replace(/\D/g,"");var phLength=placeholder.length;var valueLength=_input.value.replace(/[\(\)\-\s]/g,"").length;function errorDisplay(){validPhoneNumberFlag="false";_input.classList.add("error");var errorCode=iti.getValidationError();errorMsg.classList.remove("hide");$(".intelPhoneInput").css("outline","1px solid red");if(errorMsg){errorMsg.innerHTML=errorMap[errorCode]?errorMap[errorCode]:"Please correct the number"}}if(_input.value.trim()){if(iti.isValidNumber()){if(valueLength&&phLength&&phLength>=4&&valueLength!==phLength){errorDisplay()}else{validPhoneNumberFlag="true";$(".intelPhoneInput").css("outline","1px solid transparent")}}else{errorDisplay()}}}validateNumber();// on blur: validate
_input.addEventListener("blur",validateNumber);// on keyup / change flag: reset
_input.addEventListener("change",reset);_input.addEventListener("keyup",reset)})}}else{var format=phoneNumberInput.getAttribute("format");var attributeToMask=format?"format":"placeholder";if(placeHolderMasked(phoneNumberInput,attributeToMask)){phoneNumberInput.dataset.pattern="^(\\+\\d{1,2}\\s?)?1?\\-?\\.?\\s?\\(?\\d{3}\\)?[\\s.-]?\\d{3}[\\s.-]?\\d{4}$";setUpMasking(phoneNumberInput,"phoneNumber",format||phoneNumberInput.getAttribute("placeholder"))}else{phoneNumberInput.addEventListener("keyup",function(){phoneNumberInput.value=phoneNumberInput.value.replace(/[^0-9+-\/()]/g,"").replace(",","").replace("/","")})}}}catch(err){console.log(err)}}var cardNumberInput=document.getElementsByName("cardNumber")[0];function formatCardNumber(e,userDefinedPlaceholder){var value=e.target.value;value=value.replace(/\D/g,"");var maxLength,inputPattern,format;if(value==""){format=userDefinedPlaceholder.length>0?userDefinedPlaceholder:"";setInputAttributes("",format,"")}else if(/^3[47]\d{0,13}$/.test(value)){setInputAttributes(17,"1111 111111 11111","\\d{4}?[\\s.-]?\\d{6}?[\\s.-]?\\d{5}")}else if(/^3(?:0[0-5]|[68]\d)\d{0,11}$/gm.test(value)){setInputAttributes(16,"1111 111111 1111","\\d{4}?[\\s.-]?\\d{6}?[\\s.-]?\\d{4}")}else if(/^\d{0,16}$/.test(value)){setInputAttributes(19,"1111 1111 1111 1111","\\d{4}?[\\s.-]?\\d{4}?[\\s.-]?\\d{4}?[\\s.-]?\\d{4}")}function setInputAttributes(maxLength,format,inputPattern){e.target.setAttribute("placeholder",format);e.target.dataset.pattern=inputPattern;format!=""?setUpMasking(cardNumberInput,"cardNumber",format):"";e.target.setAttribute("maxlength",maxLength)}}if(cardNumberInput&&placeHolderMasked(cardNumberInput,"placeholder")){cardNumberInput.dataset.pattern="\\d{4}?[\\s.-]?\\d{4}?[\\s.-]?\\d{4}?[\\s.-]?\\d{4}";setUpMasking(cardNumberInput,"cardNumber",cardNumberInput.getAttribute("placeholder"))}else if(cardNumberInput){var userDefinedPlaceholder=cardNumberInput.getAttribute("placeholder");cardNumberInput.addEventListener("input",function(){return formatCardNumber(event,userDefinedPlaceholder)})}var currentItem=sessionStorage.getItem("currentItem");var prodValueLength=currentItem&&currentItem.split(".").length||0;if(prodValueLength<2){var variantRadioTiles=document.querySelectorAll(".variant-parent-div");var variantRadioTilesLength=variantRadioTiles.length;for(var _i22=0;_i22<variantRadioTilesLength;_i22++){var variantRadioTile=variantRadioTiles[_i22];var variantFirstChild=variantRadioTile&&variantRadioTile.firstElementChild;if(variantFirstChild&&variantFirstChild.firstElementChild){variantFirstChild.firstElementChild.checked=true;if(variantFirstChild.offsetHeight>0){selectRadioTiles(variantFirstChild,"from-on-load")}}}}showVariantImageOnProductSection();autoLoadInputs();if(pageData.pageTypeId===4||pageData.pageTypeId==="Checkout"){initInputAutoLoad()}if(pageData.funnelData.isMenuEnabled){getMenuList()}if((pageData.pageTypeId===18||pageData.pageTypeId===17)&&$(".fk-product-row").first().find(".fk-product-col").length){invokeCollectionApi(getCurrentCollectionId(),false,true).then(function(){$(".fk-hide-on-load").css("visibility","visible");replaceTokens();var collectionName=sessionStorage.getItem("ccCollectionName");collectionName&&$(".cc-collection-name-label").html(collectionName)})}else{$(".fk-hide-on-load").css("visibility","visible");pageData.pageTypeId!==34&&replaceTokens()}paymentOptionElementDisplayHandler();hideCollapsibleListBodyOnLoad();// Menu list functionality
$("ul.dropdown-menu [data-toggle='dropdown']").on("click",function(event){event.preventDefault();event.stopPropagation();$(this).siblings().toggleClass("show");if(!$(this).next().hasClass("show")){$(this).parents(".dropdown-menu").first().find(".show").removeClass("show")}$(this).parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown",function(e){$(".dropdown-submenu .show").removeClass("show")})});$(".overlay").on("click",function(){$(".overlay").removeClass("active")});$(".side-nav-list-item, .side-nav-list-item-child").on("click",function(e){e.stopPropagation();$(this).find("ul").first().toggleClass("show");$(this).toggleClass("active")})}function loadCCPayPalFraudNetScripts(){if(getAddOnKeyValue(findAddOn("PayPal_WithReach"))==="true")return;var sessionPaypalClientMetadataId=sessionStorage.getItem("paypalClientMetadataId");if(sessionPaypalClientMetadataId||pageData.pageTypeId!==4){return}var paypalFraudnetEnabled=getAddOnKeyValue(findAddOn("PayPal_Fraudnet"))==="1";var paypalMerchantId=getAddOnKeyValue(findAddOn("PayPal_Merchant"));if(paypalFraudnetEnabled&&paypalMerchantId){var paypalSandbox=document.URL.includes("dev-funnels");var sessionId=sessionStorage.getItem("sessionId");sessionId=sessionId&&JSON.parse(sessionId);sessionId=sessionId&&sessionId.message&&sessionId.message.sessionId;if(sessionId){var scriptAttrs=[{key:"type",value:"application/json"},{key:"fncls",value:"fnparams-dede7cc5-15fd-4c75-a9f4-36c430ee3a99"}];var scriptContent="{ 'f': '"+sessionId+"', 's': '"+paypalMerchantId+"_"+"checkout-page"+"', 'sandbox': "+paypalSandbox+" }";loadScript("",null,null,"",null,scriptAttrs,scriptContent);var loadingScriptAttrs=[{key:"type",value:"text/javascript"},{key:"async",value:true}];loadScript("https://c.paypal.com/da/r/fb.js",null,null,"",null,loadingScriptAttrs);$("body").append("<input type='text' name='paypalClientMetadataId' value='"+sessionId+"' readonly hidden />")}}}function toggleSideMenuItems(e){$("#sideNavMenu").toggleClass("active");$(".sidenav-menu-overlay").toggleClass("active");$(".collapse.in").toggleClass("in");$("#sideNavMenu a[aria-expanded=true]").attr("aria-expanded","false")}var price=0;function getCurrentCollectionId(){var pageCollectionId,pageCollectionName;pageCollectionId=sessionStorage.getItem("collectonId");pageCollectionName=sessionStorage.getItem("ccCollectionName");sessionStorage.removeItem("collectonId");if(!pageCollectionId){var menuListLength=fkMenuList.length;var pageViewRefId=pageData&&pageData.pageViewReferenceId;for(var _i23=0;_i23<menuListLength;_i23++){var _item=fkMenuList[_i23];if(_item.linkType==="collection"){pageCollectionId=_item.link;pageCollectionName=_item.name;if(pageViewRefId&&pageViewRefId===_item.pageLink){pageCollectionId=_item.link;pageCollectionName=_item.name;break}}}}pageCollectionName&&sessionStorage.setItem("ccCollectionName",pageCollectionName);return pageCollectionId&&parseInt(pageCollectionId)}function getTargetPageData(targetPageViewRefId){try{if(!(targetPageViewRefId&&pageData&&pageData.funnelData&&pageData.funnelData.pages&&pageData.funnelData.pages.length)){return}var targetPageData=pageData.funnelData.pages.filter(function(page){var pageViewReferenceId=page&&page.pageView&&page.pageView[0]&&page.pageView[0].referenceId;return pageViewReferenceId===targetPageViewRefId})[0];return targetPageData}catch(error){console.log(error)}}function logPageAnalyticsOnNavigation(currentPageType,targetPageType){var pageSubmitNavigationMap={1:[2,4],21:[2,4],17:[2,4,33],18:[2,4,33],33:[2,4],34:[2,4,33]};var targetPageCollection=pageSubmitNavigationMap[currentPageType];if(targetPageCollection&&targetPageCollection.length&&targetPageCollection.includes(targetPageType)){registerClick(1)}}function routeMenuItem(e,attributes){if(!attributes){return}var sidebar=document.getElementById("sideNavMenu");if(sidebar&&sidebar.classList.contains("active")){toggleSideMenuItems()}e&&e.preventDefault()&&e.stopImmediatePropagation();var linkType=attributes.linktype&&attributes.linktype.value;var linkValue=attributes.link&&attributes.link.value;var urlSlug=attributes&&attributes.urlslug&&attributes.urlslug.value;var url="";switch(linkType){case"collection":var pageId=pageData&&pageData.pageTypeId;var targetPageViewRefId=attributes.pagelink&&attributes.pagelink.value;var currentPageViewRefId=pageData&&pageData.pageViewReferenceId;var collectionName=attributes.collectionname&&attributes.collectionname.value;collectionName&&sessionStorage.setItem("ccCollectionName",collectionName);if(currentPageViewRefId!==targetPageViewRefId){url=urlSlug||targetPageViewRefId&&targetPageViewRefId+".html";sessionStorage.setItem("collectonId",linkValue);window.open(url,"_self");return}collectionName&&$(".cc-collection-name-label").html(collectionName);invokeCollectionApi(parseInt(linkValue),true);break;case"product":url=urlSlug||attributes.pagelink&&attributes.pagelink.value&&attributes.pagelink.value+".html";window.open(url,"_self");sessionStorage.setItem("currentItem",linkValue);break;case"page":var targetPageViewRefIdPage=attributes.link&&attributes.link.value;var targetPageData=getTargetPageData(targetPageViewRefIdPage);if(targetPageData){var currentPage=pageData&&pageData.pageTypeId;var targetPageId=targetPageData&&targetPageData.pageView&&targetPageData.pageView[0]&&targetPageData.pageView[0].templateTypeId;logPageAnalyticsOnNavigation(currentPage,targetPageId)}url=urlSlug||targetPageViewRefIdPage&&targetPageViewRefIdPage+".html";window.open(url,"_self");break;case"url":var targetUrl=attributes.link&&attributes.link.value;targetUrl&&window.open(targetUrl,"_self");break;}}function generateSideNavMenuItems(menuItems){var menuDropDownImage="<svg width='36' height='36' viewBox='0 0 36 36' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M9.115 12L18 20.87L26.885 12L29 14.115L18 25.115L7 14.115L9.115 12Z' fill='#161C0D'></path></svg>";$("body").append("<div class='sidenav-menu-overlay'></div>");$("body").append("<style>#sideNavMenu { width: 250px; position: fixed; left: -250px; height: 100vh; z-index: 999; background: #D7DBDA; color: #161c0d; transition: all 0.3s; overflow-y: scroll;}#sideNavMenu.active { left: 0; display: none; }.list-unstyled-child { padding-left: 36px; list-style: none;}.side-nav-list-item { background-color: #D7DBDA; border-bottom: 1px solid #575C5B;} .side-nav-list-item.active { background-color: #A3A8A8;} .sidenav-menu-overlay { display: none; position: fixed; top: 0px; left: 0px; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.7); z-index: 998; opacity: 0; transition: all 0.5s ease-in-out;}.sidenav-menu-overlay.active { display: none; opacity: 1;}#sideNavMenu .sidenav-menu-header { padding: 20px 16px; background: #6d7fcc;}#sideNavMenu ul p { color: #fff; padding: 10px;}#sideNavMenu ul .side-nav-list-item a { padding: 20px 16px; font-size: 1.1em; color: #161C0D; display: block; text-decoration: none;}#sideNavMenu ul .side-nav-list-item.active>a, #sidenav a[aria-expanded='true'] { color: #161c0d; text-decoration: none;}#sideNavMenu .side-nav-list-item ul side-nav-list-item-child { margin-bottom: 12px;}#sideNavMenu .side-nav-list-item .list-unstyled > .side-nav-list-item-child > a { padding: 0px 16px 12px 32px; text-decoration: none;}#sideNavMenu .side-nav-list-item .list-unstyled-child > .side-nav-list-item-child > a { padding: 0px 16px 12px; text-decoration: none;}#sideNavMenu ul .side-nav-list-item svg {transform: rotate(0deg); width: 1.5rem; float: right;transition: all .4s cubic-bezier(.16,.87,.5,1);}#sideNavMenu ul .side-nav-list-item.active > a > svg, #sideNavMenu ul .side-nav-list-item-child.active > a > svg {transform: rotate(180deg); transition: all .4s cubic-bezier(.16,.87,.5,1);}a[data-toggle='collapse'] { position: relative;} @media (max-width: 768px) { .sidenav-menu-overlay.active { display: block } #sideNavMenu.active { display: block }}</style>");$("body").prepend("<nav id='sideNavMenu'><ul class='list-unstyled components side-nav-menu-container'></ul></nav>");var menuItemsTemplateString=[];menuItems&&menuItems.length>0&&menuItems.map(function(item,index){var menuAttrs="link='"+item.link+"' linktype='"+item.linkType+"' menuname='"+item.name+"' pagelink='"+item.pageLink+"' urlslug='"+(item.urlSlug?item.urlSlug:"")+"' collectionname='"+item.name+"'";switch(item.depth){case 0:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item'> <a data-toggle='collapse' aria-expanded='false'><span>"+item.name+"</span>"+menuDropDownImage+"</a> <ul class='list-unstyled collapse' id='dropDownMenu"+index+"'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item'> <a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>")}else{menuItemsTemplateString.push("<li class='side-nav-list-item'> <a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>");menuItemsTemplateString.push("</ul></li>")}break;default:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false'><span>"+item.name+"</span>"+menuDropDownImage+"</a><ul id='dropDownMenu"+index+"' aria-labelledby='dropdownMenu"+index+"' class='collapse list-unstyled-child'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>")}else if(menuItems[index+1]&&menuItems[index+1].depth<item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>");var delta=item.depth-menuItems[index+1].depth;for(var _i24=0;_i24<delta;_i24++){menuItemsTemplateString.push("</ul></li>")}}else{menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>");menuItemsTemplateString.push("</ul></li>")}break;}});$(".side-nav-menu-container").prepend(menuItemsTemplateString.join(""))}function generateMenuItemsTemplate(menuItems){var menuContainerElement=$(".fk-menu-container");menuContainerElement.append("<nav class='navbar navbar-expand-md navbar-light py-3' style='padding: 0 !important;'><style>.dropdown-item { width: auto;}.dropdown-submenu { position: relative;}.dropdown-submenu>a:after { border-top: 0.3em solid transparent; border-right: 0; border-bottom: 0.3em solid transparent; border-left: 0.3em solid; float: right; margin-top: 0.4em;}.dropdown-submenu>.dropdown-menu { top: 0; left: 100%; margin-top: 0px; margin-left: 0px;}@media (min-width: 991px) { .dropdown-menu { box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }}</style><div class='container'> <div id='navbarContent' class='collapse navbar-collapse'> <ul class='navbar-nav mr-auto fk-menu-list-parent'></ul> </div> </div></nav>");var menuElement=menuContainerElement.find(".fk-menu").first();var listElementId=menuElement.attr("id")||"";var listElementClasses="";if(menuElement.attr("data-selector")==="true"){listElementClasses=menuElement.attr("class");listElementClasses=listElementClasses?listElementClasses.replaceAll(/\sfk-hide-on-load/ig,""):""}var menuItemsTemplateString=[];var nestedNavItemsStyle="style='border: none !important; color: black !important; box-shadow: none !important; background-color: transparent !important; padding: 0.25rem 1.5rem !important'";menuItems&&menuItems.length>0&&menuItems.map(function(item,index){var menuAttrs="link='"+item.link+"' linktype='"+item.linkType+"' menuname='"+item.name+"' pagelink='"+item.pageLink+"' urlslug='"+(item.urlSlug?item.urlSlug:"")+"' collectionname='"+item.name+"'";switch(item.depth){case 0:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li id='dropdownMenu"+index+"' class='nav-item dropdown'><a data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' id='"+listElementId+"' class='nav-link dropdown-toggle "+listElementClasses+"'>"+item.name+"</a><ul aria-labelledby='dropdownMenu"+index+"' class='dropdown-menu border-0 shadow' data-toggle='dropdown'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li class='nav-item'><a id='"+listElementId+"' class='nav-link "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'>"+item.name+"</a></li>")}else{menuItemsTemplateString.push("<li class='nav-item'><a id='"+listElementId+"' class='nav-link "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'>"+item.name+"</a></li>");menuItemsTemplateString.push("</ul></li>")}break;default:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li id='dropdownMenu"+index+"' class='dropdown-submenu'><a data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' id='"+listElementId+"' role='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' class='dropdown-item dropdown-toggle "+listElementClasses+"' "+nestedNavItemsStyle+">"+item.name+"</a><ul aria-labelledby='dropdownMenu"+index+"' class='dropdown-menu border-0 shadow'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li><a id='"+listElementId+"' class='dropdown-item "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'"+nestedNavItemsStyle+">"+item.name+"</a></li>")}else if(menuItems[index+1]&&menuItems[index+1].depth<item.depth){menuItemsTemplateString.push("<li><a id='"+listElementId+"' class='dropdown-item "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'"+nestedNavItemsStyle+">"+item.name+"</a></li>");var delta=item.depth-menuItems[index+1].depth;for(var _i25=0;_i25<delta;_i25++){menuItemsTemplateString.push("</ul></li>")}}else{menuItemsTemplateString.push("<li><a id='"+listElementId+"' class='dropdown-item "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'"+nestedNavItemsStyle+">"+item.name+"</a></li>");menuItemsTemplateString.push("</ul></li>")}break;}});$(".fk-menu-list-parent").append(menuItemsTemplateString.join(""));menuElement.remove()}function getMenuList(){$.ajax({async:false,type:"GET",beforeSend:function beforeSend(xhr){xhr.setRequestHeader("Cache-Control","no-cache");xhr.setRequestHeader("X-Source",pageData.funnelReferenceId)},url:checkDomainForRoute()?window.location.origin+"/"+pageData.funnelReferenceId+"/menuJson.json":window.location.origin+"/menuJson.json",success:function success(result){var response="";if(isJSON(result)){response=JSON.parse(result)}else{response=result}if(response){var menuItems=response.MenuData&&JSON.parse(response.MenuData);menuItems=menuItems&&menuItems.length>0&&menuItems.filter(function(items){return items.menuType==="main_menu"})||[];generateMenuItemsTemplate(menuItems);generateSideNavMenuItems(menuItems);fkMenuList=_toConsumableArray(menuItems)}},error:function error(xhr){return xhr.status}})}function sortByFeatured(productCollection){fkProductCollection=_toConsumableArray(productCollection)}function sortByPrice(productCollection,highToLow){fkProductCollection=productCollection.sort(function(productA,productB){var productAPrice=productA&&productA.cycle1_price?parseFloat(productA.cycle1_price):0;var productBPrice=productB&&productB.cycle1_price?parseFloat(productB.cycle1_price):0;return highToLow?productBPrice-productAPrice:productAPrice-productBPrice})}function sortByName(productCollection,aToZ){var regEx=/[a-z]/;fkProductCollection=productCollection.sort(function(productA,productB){var productACharCode=productA&&productA.productName?productA.productName.toLowerCase().charCodeAt(0):122;var productBCharCode=productB&&productB.productName?productB.productName.toLowerCase().charCodeAt(0):122;return aToZ?productACharCode-productBCharCode:productBCharCode-productACharCode})}function sortCollectionOrder(sortValue){var productCollection=fkCollectionData&&fkCollectionData.length?_toConsumableArray(fkCollectionData):[];if(!productCollection||!productCollection.length){return}switch(sortValue){case"featured":sortByFeatured(productCollection);break;case"priceHighToLow":sortByPrice(productCollection,true);break;case"priceLowToHigh":sortByPrice(productCollection);break;case"nameAToZ":sortByName(productCollection,true);break;case"nameZToA":sortByName(productCollection);}}function loadSortOptions(){var selectOptionString="";var selectOption={"featured":"Featured","priceHighToLow":"Price: High to Low","priceLowToHigh":"Price: Low to High","nameAToZ":"Name: A to Z","nameZToA":"Name: Z to A"};for(var key in selectOption){selectOptionString+="<option value='"+key+"'>"+selectOption[key]+"</option>"}$("select[name=\"sortOrder\"]").each(function(){$(this).empty();$(this).append(selectOptionString);$(this).val("featured");$(this).change(function(){var selectedValue=$(this).val();selectedValue&&sortCollectionOrder(selectedValue);fkProductCollection.length&&initializeProductRow(fkProductCollection);sessionStorage.setItem("productSortOrder",selectedValue)})})}function showCenteredMessageInsideContainer(message,id){return"<div id='"+id+"' style='position: absolute;top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 18px; font-weight: 500;'>"+message+"</div>"}function invokeCollectionApi(_x,_x2,_x3){return _invokeCollectionApi.apply(this,arguments)}function _invokeCollectionApi(){_invokeCollectionApi=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(id,menuClicked,onPageLoad){var productColNode,campaignId,_response5,productListWithStoreFront,productList,product,sortOrder;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(id){_context2.next=4;break}console.error("Invalid collection id");return _context2.abrupt("return");case 4:if(onPageLoad&&!fkConfiguredProductCol){productColNode=$(".fk-product-col").first();fkConfiguredProductCol=productColNode.length?productColNode.clone(true):fkConfiguredProductCol}campaignId=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.campaignId;_context2.next=8;return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Collection/live/"+id,"");case 8:_response5=_context2.sent;if(!(_response5&&_response5.result==="SUCCESS")){_context2.next=15;break}productListWithStoreFront=_response5.message&&_response5.message.data&&_response5.message.data[campaignId]&&_response5.message.data[campaignId].products&&_response5.message.data[campaignId].products.filter(function(product){return product.storefront===1});productList=[];if(_response5.message.queryArgs&&_response5.message.queryArgs.campaignProductId&&productListWithStoreFront&&productListWithStoreFront.length){(function(){var productOrder=_response5.message.queryArgs.campaignProductId.split(",").map(function(x){return parseInt(x)});var productsLength=productOrder.length;var _loop25=function _loop25(_i122){product=productListWithStoreFront.find(function(x){return x.campaignProductId===productOrder[_i122]});if(product){productList.push(product)}};for(var _i122=0;_i122<productsLength;_i122++){_loop25(_i122)}})()}else{productList=productListWithStoreFront}if(productList&&productList.length){fkCollectionData=_toConsumableArray(productList);fkProductCollection=_toConsumableArray(productList);sortOrder=sessionStorage.getItem("productSortOrder");if(sortOrder&&sortOrder!=="featured"){sortCollectionOrder(sortOrder);$("select[name=\"sortOrder\"]").val(sortOrder)}initializeProductRow(fkProductCollection,menuClicked,onPageLoad)}else{$(".fk-product-row").append(showCenteredMessageInsideContainer("No products on this page","fkEmptyCollection"))}return _context2.abrupt("return");case 15:console.error(_response5.message);_context2.next=22;break;case 18:_context2.prev=18;_context2.t0=_context2["catch"](0);$(".fk-hide-on-load").css("visibility","visible");console.log(_context2.t0);case 22:case"end":return _context2.stop();}}},_callee2,null,[[0,18]])}));return _invokeCollectionApi.apply(this,arguments)}function getTextNodes(element){var n,a=[],walk=document.createTreeWalker(element[0],NodeFilter.SHOW_TEXT,null,false);while(n=walk.nextNode()){a.push(n)}return a}function updateProductTileToken(tokenItem,productCol){var textNodeCollection=getTextNodes(productCol);textNodeCollection.forEach(function(textNode){var content=textNode.textContent;var remSubstring=content&&content.match(/{{(.*?)}}/g);if(remSubstring&&remSubstring.length>0){for(var _i26=0;_i26<remSubstring.length;_i26++){var trimmedString=remSubstring[_i26].trim().replace(/(?:^(?:&nbsp;)+)|(?:(?:&nbsp;)+$)/g,"");token=trimmedString;trimmedString=trimmedString.split("{{")[1].split("}}")[0];var formattedValue="";if(tokenItem&&(tokenItem[trimmedString]||trimmedString==="stockQuantity")){formattedValue=tokenItem[trimmedString];if(trimmedString==="stockQuantity"&&!formattedValue){formattedValue="0"}if(formattedValue){if(trimmedString==="cycle1_price"){if(parseFloat(formattedValue).toFixed(2)==="0.00"){var variants=tokenItem.variants;if(variants&&variants.length>0&&!tokenItem.isVariantBundle&&!tokenItem.isEditable){(function(){var lowVarPrice=parseFloat(variants[0].price);var mulVariantPrices=false;variants.forEach(function(variant){var variantMemberPrice=getMemberPrice(variant).price;var currentVarPrice=variantMemberPrice?parseFloat(variantMemberPrice):parseFloat(variant.price);if(lowVarPrice&&lowVarPrice!==currentVarPrice){mulVariantPrices=true;lowVarPrice=lowVarPrice>currentVarPrice?currentVarPrice:lowVarPrice}});formattedValue=mulVariantPrices===true?lowVarPrice.toFixed(2)+"+":lowVarPrice.toFixed(2)})()}}else{tokenItem=getMemberPrice(tokenItem)?getMemberPrice(tokenItem):tokenItem;formattedValue=tokenItem[trimmedString];formattedValue=typeof formattedValue==="number"?formattedValue.toFixed(2):formattedValue}formattedValue=(parseFloat(formattedValue)*vatTaxRate).toFixed(2)}formattedValue=typeof formattedValue==="string"?formattedValue.replaceAll("\n","<br>"):formattedValue;if(trimmedString.match(/price/gi)){formattedValue=pageData.selectedCampaign.currencySymbol+formattedValue}textNode.textContent=content.replace(token,formattedValue);content=textNode.textContent}}else{textNode.textContent=content.replace(token,"");content=textNode.textContent}}}})}function initializeProductRow(collection,newMenuClicked,onPageLoad){fkCollectionSize=collection.length;var productRowCardsCount=sessionStorage.getItem("productRowCardsCount");if(productRowCardsCount&&productRowCardsCount!=="0"){scrolledCardsCount=parseInt(productRowCardsCount)}if(newMenuClicked){scrolledCardsCount=scrollCardsSlotSize;sessionStorage.setItem("productRowCardsCount",scrollCardsSlotSize)}var productRowNode=$(".fk-product-row").first();if(fkCollectionSize&&productRowNode.find(".fk-product-col").length){productRowNode.empty();if($(".fk-product-row").first().attr("lazyload")==="1"){populateProductRow(collection.slice(0,scrolledCardsCount),fkConfiguredProductCol)}else{populateProductRow(collection,fkConfiguredProductCol)}$(".fk-product-col").css("visibility","visible")}}function populateProductRow(collection,productTile){var productRow=$(".fk-product-row");var tile=productTile||$(".fk-product-col").first();tile.find("button").attr("disabled",false);tile.find("a").css("pointer-events","auto");if(productRow.length){collection.forEach(function(itemColl,index){var _pageData$selectedCam;var item=(_pageData$selectedCam=pageData.selectedCampaign.products.find(function(data){return data.campaignProductId===parseInt(itemColl.campaignProductId)}))!==null&&_pageData$selectedCam!==void 0?_pageData$selectedCam:itemColl;var productCol=tile.clone(true);var addToCartBtn=productCol.find("[action=addToCart]")[0];if(addToCartBtn){addToCartBtn.dataset.id=addToCartBtn.dataset.id+"_prodCol"+index}var routeActionBtn=productCol.find("[action=route][onclick='route(event)']")[0];if(routeActionBtn){routeActionBtn.dataset.id=routeActionBtn.dataset.id+"_prodCol"+index;routeActionBtn.setAttribute("offer",item.campaignProductId)}productCol.find(".fk-product-section").attr("value",item.campaignProductId);productCol.find("img").attr("src",item.imageUrl);productCol.find("a").attr("offer",item.campaignProductId);updateProductTileToken(item,productCol);productRow.append(productCol)})}}function initInputAutoLoad(){var is_customer_known=cookieData["access_token"];var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));if(customerOrders){autoLoadInputs(customerOrders[0])}else if(is_customer_known){autoLoadInputFromCustomerOrder()}}function stopEventPropogationForInputs(inputsList,inputType){if(inputsList){var inputsListLength=inputsList.length;for(var _i27=0;_i27<inputsListLength;_i27++){var input=inputsList[_i27];if(input.type==="checkbox"||input.type==="radio")if(inputType==="surveyInputs")input.addEventListener("click",function(e){e.stopPropagation()});else input.addEventListener("click",function(e){e.stopPropagation();displayPrices()})}}}function ccRoundingPrice(value){if(![2,3,4,5].includes(pageData.pageTypeId)){return value}var itemTotalPrice=value;var currencyFee=Number(pageData.selectedCampaign.ccCurrencyFee);if(currencyFee){itemTotalPrice=itemTotalPrice*(1+currencyFee/100)}var ccCurrencyDecimals=pageData.selectedCampaign.ccCurrencyDecimals;var currencyRounding=pageData.selectedCampaign.ccCurrencyRounding||null;if((ccCurrencyDecimals===0||ccCurrencyDecimals)&&currencyRounding&&itemTotalPrice){var _price=itemTotalPrice.toString().split(".");if(_price[1]&&Number(_price[1])>Number(currencyRounding)){itemTotalPrice=(Number(_price[0])+1).toString()+"."+currencyRounding}else{itemTotalPrice=_price[0]+"."+currencyRounding}}return parseFloat(itemTotalPrice)}function ccFormatCurrency(value,symbol,useValueDecimalCount){if(![2,3,4,5].includes(pageData.pageTypeId)){return(symbol||pageData.selectedCampaign.currencySymbol||"$")+value}var rValue=value&&value.toString()||"0";if(rValue){var splitValues=rValue.split(".");var ccCurrencyDecimals=pageData.selectedCampaign.ccCurrencyDecimals;var decimals=useValueDecimalCount?splitValues[1]?splitValues[1].length:0:ccCurrencyDecimals===0||ccCurrencyDecimals?ccCurrencyDecimals:2;if(decimals==0||decimals){rValue=decimals===0?splitValues[0]:splitValues[0]+"."+((splitValues[1]||"00")+"0000000000").substring(0,decimals)}if(pageData.selectedCampaign.ccCurrencyComma){rValue=rValue.replace(".",",")}var symbolAlign=pageData.selectedCampaign.ccCurrencySymbolAlign||"";var currencySymbol=pageData.selectedCampaign.currencySymbol||"$";switch(symbolAlign.toUpperCase()){case"RIGHT":rValue=rValue+currencySymbol;break;case"RIGHT_SPACE":rValue=rValue+"&nbsp;"+currencySymbol;break;case"LEFT_SPACE":rValue=currencySymbol+"&nbsp;"+rValue;break;default:rValue=currencySymbol+rValue;}}return rValue}function ccSetCurrencyRules(currency){var currencyObj=fetchCurrentCurrencyObj(currency)||{};pageData.selectedCampaign.ccCurrencyDecimals=currencyObj.decimals;pageData.selectedCampaign.ccCurrencyFee=currencyObj.currencyFee;pageData.selectedCampaign.ccCurrencyComma=currencyObj.isComma;pageData.selectedCampaign.ccCurrencyRounding=currencyObj.rounding;pageData.selectedCampaign.ccCurrencySymbolAlign=currencyObj.symbolAlign;pageData.selectedCampaign.ccCurrencySendToGateway=currencyObj.sendToGateway;var currentCurrencySymbol=currency===pageData.selectedCampaign.currency?campaignBaseCurrencySymbol||"$":currencyObj["currencySymbol"];pageData.selectedCampaign.currencySymbol=currentCurrencySymbol;showVariantImageOnProductSection()}function ccUpdateTokenSpanValues(){var exchangeRate=Number(sessionStorage.getItem("exchangeRate"))||1;var currencyCode=returnCurrencyCode();var baseCurrency=!currencyCode||currencyCode===pageData.selectedCampaign.currency;$("[data-cc-price]").each(function(){var ccPrice=$(this).attr("data-cc-price");var price=ccPrice&&parseFloat(ccPrice.includes(",")?ccPrice.replaceAll(",",""):ccPrice);if($(this).children().length===0&&(price||price==0)){var priceType=$(this).attr("data-cc-price-type")||"";var _productId=pageData.cartData&&$(this).attr("data-cc-prod-id");var useTax=[2,3,4].includes(pageData.pageTypeId);if(priceType.includes("cycle1_price")||priceType.includes("compareAtPrice")||priceType==="true"){$(this).html(ccFormatCurrency(getItemPrice(_productId,price,1,!useTax)))}else{if(baseCurrency&&$(this).attr("data-cc-check-decimal")==="true"){$(this).html(ccFormatCurrency(ccPrice,null,true))}else{$(this).html(ccFormatCurrency((exchangeRate*price).toFixed(2)))}}}})}//set the prices and symbols as per the updated currency
function setPriceAndCurrency(selectedCurrencyCode){var newSymbol=sessionStorage.getItem("currencyCodeSymbol");var currencyCodeValue=returnCurrencyCode();if(newSymbol&&currencyCodeValue===selectedCurrencyCode){ccSetCurrencyRules(selectedCurrencyCode);pageData.selectedCampaign.currencySymbol=newSymbol;displayPrices();convertStaticCurrencyValues();ccUpdateTokenSpanValues()}else{var currencyObj=fetchCurrentCurrencyObj(selectedCurrencyCode)||{};var currentCurrencySymbol=selectedCurrencyCode===pageData.selectedCampaign.currency?campaignBaseCurrencySymbol:currencyObj["currencySymbol"];sessionStorage.setItem("currencyCode",selectedCurrencyCode);var paypalSrc=pageData.pageTypeId===4&&$("[data-partner-attribution-id=CheckoutChampLLC_PPFM_PPCP]").attr("src");if(paypalSrc){$(".btnPayPal, .btnPayPal2").css("pointer-events","auto");$(".paypalSdkLoadFailureError, #paypal-notify").remove()}httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Currency/exchangerate",JSON.stringify({"currencyCode":selectedCurrencyCode,"baseCurrencyCode":pageData.selectedCampaign.currency})).then(function(data){if(data.result==="SUCCESS"){sessionStorage.setItem("exchangeRate",data.message);ccSetCurrencyRules(selectedCurrencyCode);sessionStorage.setItem("currencyCodeSymbol",currentCurrencySymbol);if(!appliedCouponCode.length){if(sessionStorage.getItem("discountsObj")){appliedCouponCode=JSON.parse(sessionStorage.getItem("discountsObj"))["coupons"]}}displayPrices();convertStaticCurrencyValues();ccUpdateTokenSpanValues();paypalSrc&&!paypalSrc.includes(selectedCurrencyCode)&&configurePayPalSmartButtons()}})}}function paymentOptionElementDisplayHandler(){var fkPaymentOptionTogglerField=document.querySelectorAll(".fk-payment-option-toggler-field");if(fkPaymentOptionTogglerField&&fkPaymentOptionTogglerField.length>0){fkPaymentOptionTogglerField.forEach(function(element){var openId=element.getAttribute("opencheckboxsection");if(openId){var obj=document.getElementById(openId);if(!obj)return;if(element.checked){obj.style.display="flex";return}obj.style.display="none"}})}}function hideCollapsibleListBodyOnLoad(){try{var collapsibleList=document.querySelectorAll(".fk-collapsible-list-wrapper");collapsibleList.forEach(function(list){var item=list.querySelectorAll(".fk-collapsible-list-details");if(item.length){var collapsibleDetailElement=item[0];var openIcon=$(collapsibleDetailElement).find(".open-icon");var closeIcon=$(collapsibleDetailElement).find(".close-icon");if(list.dataset.open==="true"){collapsibleDetailElement.open=true;openIcon.hide()}else{collapsibleDetailElement.open=false;closeIcon.hide()}var iconContainer=collapsibleDetailElement.querySelectorAll(".fk-collapsible-list-icon-rotate");iconContainer.length===1?iconContainer[0].classList.add("fk-icon-rotate"):null;collapsibleDetailElement.onclick=function(e){if(!$(e.target).closest("summary").length)return;var container=$(e.currentTarget).closest("[data-toggle-collapsible=true]");var openValue=e.currentTarget.open;if(container.length){var details=container.find("details");details.attr("open",false);details.find(".open-icon").show();details.find(".close-icon").hide();$(e.currentTarget).attr("open",openValue)}if(!openValue){openIcon.hide();closeIcon.show()}else{openIcon.show();closeIcon.hide()}return true}}})}catch(error){console.log(error)}}//fetch the current currency symbol
function fetchCurrentCurrencyObj(currencyCode){return pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencies&&pageData.selectedCampaign.currencies.find(function(obj){return obj.currencyCode===currencyCode})}function changeFaviconLink(url){if(url&&url.length>0){var link=$("head link[rel=\"shortcut icon\"]")||$("head link[rel=\"icon\"]");if(link&&link.length>0){$(link).attr("href",url)}else{var newLink=$("<link>");newLink.attr("href",url);newLink.attr("rel","shortcut icon");$("head").append(newLink)}}}function ccSetAttributesForYTAPI(targetElement,id,logs,type){try{if(YT&&YT.Player){$(targetElement).attr("id",id);$(targetElement).attr("data-video-logs",logs);$(targetElement).attr("data-video-type",type);ccYTAPIObjs[id]=new YT.Player(id,{events:{"onReady":ccOnYTPlayerReady,"onStateChange":ccOnYTPlayerStateChange}})}}catch(error){}}function loadYoutubeThumbnails(){var element=document.querySelectorAll(".fk-youtube");var _loop=function _loop(){var isEmbedClassExists=element[i].classList.value.match(/embed-responsive\S{0,}/g);source="https://img.youtube.com/vi/"+element[i].getAttribute("fk-video-id")+"/sddefault.jpg";div=document.createElement("DIV");div.style.backgroundImage="url('"+source+"')";if(isEmbedClassExists){div.style.top="0"}div.className="fk-rm image";div.addEventListener("load",function(){element[i].appendChild(div)}(i));var ytSrcIframe=$(element[i]).find("iframe");var iframeVideoType=ytSrcIframe.attr("data-video-type");var iframeVideoLogs=ytSrcIframe.attr("data-video-logs");var supportVSL=["yt","ytnc"].includes(iframeVideoType)&&iframeVideoLogs;var fkVideoSrc=element[i].getAttribute("fk-video-src");if(fkVideoSrc.includes("autoplay=1")||element[i].classList.contains("fk-disable-lazy")){iframe=getYoutubeIframe();isEmbedClassExists&&iframe.classList.add("embed-responsive-item");if(fkVideoSrc.includes("autoplay=1")){iframe.setAttribute("src",fkVideoSrc+"&mute=1")}else{iframe.setAttribute("src",fkVideoSrc)}element[i].innerHTML="";element[i].appendChild(iframe);supportVSL&&ccSetAttributesForYTAPI(iframe,"ccytvsl"+getUniqueId(),iframeVideoLogs,iframeVideoType)}else{element[i].addEventListener("click",function(){var iframe=getYoutubeIframe();isEmbedClassExists&&iframe.classList.add("embed-responsive-item");iframe.setAttribute("src","https://www.youtube.com/embed/"+this.getAttribute("fk-video-id")+"?rel=0&showinfo=0&autoplay=1"+(supportVSL?"&enablejsapi=1":""));this.innerHTML="";this.appendChild(iframe);supportVSL&&ccSetAttributesForYTAPI(iframe,"ccytvsl"+getUniqueId(),iframeVideoLogs,iframeVideoType)})}};for(var i=0;i<element.length;i++){var source;var div;var iframe;_loop()};}function getYoutubeIframe(){var iframe=document.createElement("iframe");iframe.setAttribute("frameborder","0");iframe.setAttribute("allowfullscreen","");iframe.setAttribute("allow","autoplay");return iframe}function updateReplacementProducts(orderItems){// Converting Nodelists to normal arrays to avoid forEach errors in Microsoft Edge - FUN2-1637
var productInputs=_toConsumableArray(document.getElementsByName("product"));if(productInputs){productInputs.forEach(function(product){var replacementProductValue=product.getAttribute("replaceproductid");if(replacementProductValue&&replacementProductValue.toLowerCase()!=="none"&&product.tagName.toLowerCase()==="input"){if(product.checked){if(orderItems[replacementProductValue]){delete orderItems[replacementProductValue]}}else{if(!orderItems[replacementProductValue]){orderItems[replacementProductValue]=1}}}})}return orderItems}function updateCheckboxAndRadioProductIdHashMap(){var shoppingCart=document.querySelectorAll(".fk-shopping-cart");if(shoppingCart&&shoppingCart.length||$(".cc-cart-container").length){var productInputs=document.querySelectorAll(".fk-product-checkbox, .fk-product-radio");var productInputsCount=productInputs.length;for(var _i28=0;_i28<productInputsCount;_i28++){var _item2=productInputs[_i28];var type=_item2.getAttribute("type");var value=_item2.getAttribute("value");if((type==="checkbox"||type==="radio")&&value){fkCheckboxAndRadioProductIdHashMap[value]=true}}}}function fetchPageData(){var isBuildOrTemplate=checkBuildOrTemplate();var funnelJsonResult=funnelJson;var campaignJsonResult=campaignJson;var funnelData=funnelJsonResult&&!funnelJsonResult.isFunnel?funnelJsonResult.funnelTemplateData:funnelJsonResult.funnelData;var faviconUrl=funnelJsonResult&&funnelJsonResult.faviconUrl;changeFaviconLink(faviconUrl);pageData.funnelData=funnelData;var currentFunnelData=sessionStorage.getItem("funnelData")!="undefined"?JSON.parse(sessionStorage.getItem("funnelData")):null;if(document.getElementById("fk-dynamic-orders-table")){sessionStorage.removeItem("orderStatusInfo")}if(currentFunnelData&&currentFunnelData.referenceId!=funnelData.referenceId){sessionStorage.removeItem("sessionId");sessionStorage.removeItem("requestUri");sessionStorage.removeItem("orderId");sessionStorage.removeItem("orderData");sessionStorage.removeItem("userDetails");sessionStorage.removeItem("products");sessionStorage.removeItem("importOrderSuccess");sessionStorage.removeItem("importOrderSuccessGA");sessionStorage.removeItem("importOrderSuccessSC");sessionStorage.removeItem("importUpsellSuccess");sessionStorage.removeItem("importUpsellSuccessGA")}sessionStorage.setItem("funnelData",JSON.stringify(funnelData));pageData.currentPage=getCurrentPage(funnelData);var currentSlug=window.location.pathname.substring(1).split(".")[0];try{if(currentSlug!==""&&currentSlug!==pageData.pageViewReferenceId&&currentSlug!==pageData.currentPage.urlSlug&&checkDomainForRoute()===false){window.history.replaceState({},"",(pageData.currentPage.urlSlug||pageData.pageViewReferenceId+".html")+window.location.search)}}catch(ex){console.log(ex)}var funnelTitle=funnelData.title;funnelTitle?$("title").text(funnelTitle):$("title").text("Checkout Champ");pageData.pageTypeId=pageData.currentPage&&pageData.currentPage.pageView[0].pageType;pageData.pageTypeId===5&&sessionStorage.removeItem("currentItem");globalOrderData=pageData.pageTypeId===9?JSON.parse(sessionStorage.getItem("orderStatusInfo")):JSON.parse(sessionStorage.getItem("orderData"));isVatOnOrder=globalOrderData&&globalOrderData.items&&Object.values(globalOrderData.items)[0].vatPrice;pageData.salt=funnelData.salt;sessionStorage.setItem("fk_salt",pageData.salt);pageData.navigationItems=funnelJsonResult.elements.filter(function(element){return element.pageViewReferenceId===pageData.currentPage.pageView[0].referenceId});pageData.selectedCampaign=campaignJsonResult.selectedCampaign;(pageData.pageTypeId===4||pageData.pageTypeId===9)&&checkForMembershipLogin();!isBuildOrTemplate&&pageData.pageTypeId===3&&updatePaymentButtons(globalOrderData);updateCheckboxAndRadioProductIdHashMap();campaignBaseCurrencySymbol=pageData.selectedCampaign.currencySymbol;swapCartProducts().then(function(){var variationIds=setOrderItemDetails();if(variationIds.length>0){populateVariantAsync(variationIds.join(",")).then(function(data){if(data.result==="SUCCESS"){populateProductVariants(data.message)}HeadAndInitializePage()})}else{HeadAndInitializePage()}})}function HeadAndInitializePage(){return _HeadAndInitializePage.apply(this,arguments)}function _HeadAndInitializePage(){_HeadAndInitializePage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var currencyCode,captureLeadArray,rightPanelEnabledPages,purchaseActionPageTypes;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!document.URL.includes("funnels-build"))getHeadCode();campaignBaseCurrencySymbol=pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol;currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;ccSetCurrencyRules(currencyCode);initializePage();captureLeadArray=[2,4,15];rightPanelEnabledPages=[2,17,18,34];if(captureLeadArray.includes(pageData.pageTypeId)&&!finishProcessing){captureLeadInterval=window.setInterval(function(){captureLead()},10000)}if(rightPanelEnabledPages.includes(pageData.pageTypeId)){showRightPanel()}$("img").each(function(){var hrefAttr=$(this).attr("href");if(hrefAttr!==""&&hrefAttr!==undefined&&hrefAttr!==false&&hrefAttr!==null){$(this).css("cursor","pointer");$(this).hover(function(){$(this).css("opacity","0.5")},function(){$(this).css("opacity","1")})}});if(pageData.pageTypeId!==13)sessionStorage.removeItem("ccActionPurchaseItem");if(!isMembershipPage(pageData.pageTypeId)){_context3.next=16;break}purchaseActionPageTypes=[10,11,13,31];if(!purchaseActionPageTypes.includes(pageData.pageTypeId)){sessionStorage.removeItem("actionPurchaseId");sessionStorage.removeItem("actionProductId");sessionStorage.removeItem("actionCurrentItem");sessionStorage.removeItem("actionNextBillDate");sessionStorage.removeItem("actionCurrentProductQty")}_context3.next=16;return validateToken();case 16:callWindowLoad();fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):{};case 18:case"end":return _context3.stop();}}},_callee3)}));return _HeadAndInitializePage.apply(this,arguments)}function showRightPanel(){// To load the required styles and html content for right panel
if($("body").find(".rightPanelHTML").length!==0){$("head").append("<style>.sidepanel { height: 100%; visibility: hidden; width: 300px; position: fixed; z-index: 1; top: 0; right: 0; background-color: white; overflow-x: hidden; padding-top: 10px; } .sidepanel a { padding: 8px 8px 8px 32px; text-decoration: none; font-size: 25px; color: #818181; display: block; } .sidepanel a:hover { color: #f1f1f1; } .sidepanel .closebtn { position: absolute; top: 0; right: 25px; font-size: 36px; margin-left: 50px; } .openbtn { font-size: 20px; cursor: pointer; background-color: #111; color: white; padding: 10px 15px; border: none; } .openbtn:hover { background-color: #444; } .image-quantity-container{ margin: 0 auto; width: 100px; height: auto; position: relative; } .image-cart-header { width: 300px; height: 56px; float:left; margin-left:10%; max-height:100px; } @media (max-width:480px) { .image-quantity-container { margin: 0 auto; width: 55px; position: relative; } .image-cart-header { margin-left: 5%; width: 150px; height: 28px; margin-top: 3%; } } .close-panel{float:right;margin-right:8%;cursor:pointer} .sidepanel .cc-panel-view-cart, .sidepanel .cc-panel-checkout{font-size:16px;padding:5px 0;margin: 0px auto;}</style>");$(".rightPanelHTML").css("display","block")}}function removeCartIcon(){// To remove the cart icon and quantity circle for Upsell and Thank you pages
$(".fk-parent-cart-element, .rightPanelHTML").remove()}function removeMenuElement(){// To remove menu elements and hamburger icon from upsell and thank you pages
$(".fk-menu-btn-container, .fk-menu-container").remove()}function getCurrentPage(funnelData){var funnelPages=funnelData.pages;if(funnelPages&&funnelPages.length){var matchedPage=$.grep(funnelPages,function(page){var currentPageView=page&&page.pageView&&page.pageView[0];if(currentPageView){return currentPageView.referenceId===pageData.pageViewReferenceId}});return matchedPage&&matchedPage[0]}return null}function autoLoadInputFromCustomerOrder(){orderQuery().then(function(){var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));autoLoadInputs(customerOrders[0])})["catch"](function(error){consumerLogout(false)})}function autoLoginCookie(){var productData=getNavigationItemFromPageData(cookieData["buttonId"]);var loginUrl=getCurrentWindowLocation().protocol+"//"+getCurrentWindowLocation().host+getCurrentWindowLocation().pathname;localStorage.setItem("loginUrl",loginUrl);if(localStorage.getItem("isMembershipLogin")==="true"){if(cookieData["status"]==="ACTIVE"){clubQuery(cookieData["clubId"],cookieData["memberId"],productData)}else{var _route="";var inActiveNavItem=pageData.navigationItems.find(function(element){return element.status&&element.status.toUpperCase()==="INACTIVE"});var linkWithNoProduct=inActiveNavItem&&inActiveNavItem.linkDetails.find(function(linkDetail){return linkDetail.products.length===0});if(linkWithNoProduct){_route=redirectPath(linkWithNoProduct,true)}else{var savedButtonLink=pageData.navigationItems.find(function(element){return element.elementId===cookieData["buttonId"]});savedButtonLink?_route=redirectPath(savedButtonLink.linkDetails[0],true):null}if(!_route){clubLogout(true);return}clubQuery(cookieData["clubId"],cookieData["memberId"],productData,_route)}}else{Promise.all([customerQuery(),orderQuery()]).then(function(){var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var orderInfo=customerOrders.find(function(_ref){var orderId=_ref.orderId;return orderId===cookieData["orderId"]})||customerOrders[customerOrders.length-1];sessionStorage.setItem("loginOrder",JSON.stringify(orderInfo));if(orderInfo&&orderInfo.items){var clubMembershipProducts=Object.entries(orderInfo.items).map(function(item){return parseInt(item[1].productId)});sessionStorage.setItem("orderLoginProducts",JSON.stringify(clubMembershipProducts));memberProductRoute(clubMembershipProducts,productData)}})["catch"](function(error){consumerLogout(false)})}}var importClickcounter=0;function triggerImportClick(pageType,firstTimeLoad){importClick(pageType).then(function(data){if(data.result==="SUCCESS"){var jsonStr=JSON.stringify(data);sessionStorage.setItem("sessionId",jsonStr);sessionStorage.setItem("requestUri",getCurrentWindowLocation().href);sessionStorage.setItem("httpReferer",document.referrer);if(data.message){if(data.message.pixel)firePixel(data.message.pixel);if(data.message.siftBeaconKey)fireSiftPixel(data.message.siftBeaconKey)}firstTimeLoad&&registerClick(0);loadCCPayPalFraudNetScripts()}else if(data.message==="session failed"){if(pageType!=="upsellPage"&&pageType!=="thankyouPage"){if(importClickcounter<10){triggerImportClick(pageType,firstTimeLoad)}importClickcounter++}else{$("body").append(data.message)}}else{$("body").append(data.message)}response=data})}function checkForMembershipLogin(){if(pageData&&pageData.currentPage&&pageData.currentPage.isMembershipRequired&&!(cookieData["access_token"]&&cookieData["memberId"]&&cookieData["status"]==="ACTIVE")){redirectToLoginPage()}}function updatePaymentButtons(orderData){var pageNavigationItems=pageData&&pageData.navigationItems;var isGooglePayCheckout=orderData&&orderData.prepaidType==="GOOGLEPAY";var isApplePayCheckout=orderData&&orderData.prepaidType==="APPLEPAY";var isGooglePay=isGooglePayCheckout&&($(".btnGoogle1").length||$(".btnGoogle2").length);var isApplePay=isApplePayCheckout&&$(".btnApplePay").length;for(var _i29=0;_i29<pageNavigationItems.length;_i29++){var btnLinkEle=$("[data-id="+pageNavigationItems[_i29].elementId+"]")[0];var btnLinkAction=btnLinkEle&&btnLinkEle.getAttribute("action");var btnLinkClassList=btnLinkEle&&btnLinkEle.classList;if(btnLinkAction==="submit"){if(isGooglePay){if(!(btnLinkClassList.contains("btnGoogle1")||btnLinkClassList.contains("btnGoogle2")))btnLinkEle.remove()}else if(isGooglePayCheckout){btnLinkClassList.add("cc-global-payment-btn");btnLinkClassList.contains("btnApplePay")&&btnLinkEle.remove()}else if(isApplePay){if(!btnLinkClassList.contains("btnApplePay"))btnLinkEle.remove()}else if(isApplePayCheckout){btnLinkClassList.add("cc-global-payment-btn");(btnLinkClassList.contains("btnGoogle1")||btnLinkClassList.contains("btnGoogle2"))&&btnLinkEle.remove()}else if(btnLinkClassList.contains("btnGoogle1")||btnLinkClassList.contains("btnGoogle2")||btnLinkClassList.contains("btnApplePay")){btnLinkEle.remove()}}}}function addTripleWhaleDefaultScript(shopPayUrl){var tripleWhaleGlobalScript=document.createElement("script");tripleWhaleGlobalScript.innerHTML="var TripleHeadless = '"+shopPayUrl.replace("https://","")+"'";var tripleWhaleDefaultScript=document.createElement("script");tripleWhaleDefaultScript.append("~(function (W, H, A, L, E, _) {function O(T, R) {void 0 === R && (R = !1),(H = new XMLHttpRequest()),H.open('GET','//triplewhale-pixel.web.app/triplepx.txt?' + ~(Date.now() / 9e7),!0),H.send(null),(H.onreadystatechange = function () {4 === H.readyState && 200 === H.status? setTimeout(function () {return eval(H.responseText);}, 50): (299 < H.status || H.status < 200) &&T &&!R &&((R = !0), O(T - 1));});}if (((L = window), !L[H + 'sn'])) {L[H + 'sn'] = 1;try {A.setItem(H, 1 + (0 | A.getItem(H) || 0)),W.includes('\u21C8') &&A.setItem(H + 'Stg', 1 + (0 | A.getItem(H + 'Stg') || 0)),(E = JSON.parse(A.getItem(H + 'U') || '[]')).push(location.href),A.setItem(H + 'U', JSON.stringify(E));} catch (e) {}A.getItem('\"!nC`') ||((A = L),A[H] ||((L = function () {return Date.now().toString(36) + '_' + Math.random().toString(36);}),(E = A[H] =function (t, e) {return ((W = L()),(E._q = E._q || []).push([W, t, e]),(E._headless = !0),W);}),(E.ch = W),O(5)));}})('', 'TriplePixel', localStorage);");$("head").append([tripleWhaleGlobalScript,tripleWhaleDefaultScript])}function addTripleWhaleFollowUpScript(){try{var _orderData2=JSON.parse(sessionStorage.getItem("orderData"));var buyerEmail=_orderData2&&_orderData2.emailAddress;if(buyerEmail){var tripleWhaleFollowUpScript=document.createElement("script");var tripleWhaleFollowUpScriptText="~function TP(){const email = '"+buyerEmail+"';if(!email||!window.TriplePixel){setTimeout(TP, 400); return;}TriplePixel('Contact', {email:email})}();";tripleWhaleFollowUpScript.append(tripleWhaleFollowUpScriptText);$("head").append(tripleWhaleFollowUpScript);sessionStorage.setItem("tripleWhaleFollowUpScriptAdded",true)}}catch(err){err}}function initializePage(){var queryString=getCurrentWindowLocation().search;var urlParams=new URLSearchParams(queryString);var firstTimeLoad=isFirstTime();var isBuildOrTemplate=checkBuildOrTemplate();if(pageData){var triggerUseSession=function triggerUseSession(session){useSession(session.message.sessionId,pageType).then(function(data){if(data.message==="session failed"){if(pageType!=="upsellPage"&&pageType!=="thankyouPage"){if(useSessionCounter<10){triggerUseSession(session)}useSessionCounter++}else{$("body").append(data.message)}}if(data.result==="ERROR"){$("body").append(data.message)}if(data.message){if(data.message.pixel)firePixel(data.message.pixel);if(data.message.siftBeaconKey)fireSiftPixel(data.message.siftBeaconKey)}})};var shopPayUrl=pageData.selectedCampaign&&pageData.selectedCampaign.shopPayUrl;var tripleWhaleTracking=shopPayUrl&&getAddOnKeyValue(findAddOn("TRIPLE_WHALE_REQ"))==="true";tripleWhaleTracking&&addTripleWhaleDefaultScript(shopPayUrl);//import click need to be called on the load of every page, so I added this function to the template
var pageType=pageData.pageTypeId;var pageTypeId=pageType;var fflApplied=pageTypeId===3&&globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber;if(!fflApplied&&[3,4].includes(pageTypeId)){pageData.selectedCampaign&&pageData.selectedCampaign.ffl&&pageData.selectedCampaign.ffl.length?addFFLPopUp():null;addFFLInfoOnPage()}switch(pageType){// Lead page
case 2:case"Lead":case 15:case"Opt-in":pageType="leadPage";initAddressFields();removeNavigationOffersFromCart();break;// Checkout Page
case 4:case"Checkout":pageType="checkoutPage";initSocialProof();initAddressFields();assignProdQtyEventListeners();assignCardDetailsEventListeners();removeNavigationOffersFromCart();sessionStorage.removeItem("upsalefkCart");configurePayPalSmartButtons();configureGooglePay();configureAmazonPay();configureSquare();configureRoutePlugin();configureApplePay();facebookCustomerChat();configureFBMessengerCheckboxPlugin();configureLoyaltyLion();break;// Upsell Page
case 3:case"Upsell":pageType="upsellPage";assignProdQtyEventListeners();configureAmazonPay();isBuildOrTemplate&&configureGooglePay();globalOrderData&&globalOrderData.prepaidType==="GOOGLEPAY"&&configureGooglePay();globalOrderData&&globalOrderData.prepaidType==="APPLEPAY"&&configureApplePay();configurePayPalSmartButtons();confirmation();removeCartIcon();removeMenuElement();updateMap();break;// Thank You Page
case 5:case"Thank You":pageType="thankyouPage";updateMap();removeCartIcon();removeMenuElement();break;case 8:case"Profile":initAddressFields();break;case 17:case 18:loadSortOptions();case 34:initSocialProof();displayPrices();break;case 1:case 21:// Clear shopping cart while loading Presell Page
sessionStorage.removeItem("fkCart");sessionStorage.removeItem("fkCartSent");break;case 31:document.getElementsByName("custom_restartDate")[0]&&affixImports("js","https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js");break;case 7:case"login":if(urlParams.get("emailAddress")&&urlParams.get("orderId")){autoLogin(urlParams.get("emailAddress"),urlParams.get("orderId"));return}if(urlParams.has("userName")&&urlParams.has("password")){autoLoginClub(urlParams.get("userName"),urlParams.get("password"));return}if(cookieData["access_token"]){autoLoginCookie()}break;case 13:sessionStorage.removeItem("newProductItem");sessionStorage.removeItem("currentItem");sessionStorage.removeItem("newProductQty");sessionStorage.removeItem("currentProductQty");sessionStorage.removeItem("currentNextBillDate");sessionStorage.removeItem("billingIntervalDays");sessionStorage.removeItem("currentPrice");var membership=getMembershipDetails();var currentProductItem=sessionStorage.getItem("actionCurrentItem");var currentProductQty=sessionStorage.getItem("actionCurrentProductQty");var currentNextBillDate=sessionStorage.getItem("actionNextBillDate");var currentBillingIntervalDays=sessionStorage.getItem("actionBillingIntervalDays");var currentPrice=sessionStorage.getItem("actionPrice");if(currentProductItem){sessionStorage.setItem("currentItem",currentProductItem);sessionStorage.setItem("currentProductQty",currentProductQty);sessionStorage.setItem("currentNextBillDate",currentNextBillDate);sessionStorage.setItem("billingIntervalDays",currentBillingIntervalDays);sessionStorage.setItem("currentPrice",currentPrice)}else if(membership){sessionStorage.setItem("currentItem",membership.productId);sessionStorage.setItem("currentProductQty",1);sessionStorage.setItem("currentNextBillDate",membership.nextBillDate);sessionStorage.setItem("billingIntervalDays",membership.frequency);sessionStorage.setItem("currentPrice",membership.price)}break;case 9:configureLoyaltyLion();break;default:pageType="presellPage";}if(pageTypeId===2){var cartPanelButtons=$("#mySidepanel").find("button[onclick='callMethod(event)']");var cartPanelButtonsLength=cartPanelButtons.length;if(cartPanelButtonsLength){for(var _i30=0;_i30<cartPanelButtonsLength;_i30++){var btn=cartPanelButtons[_i30];if(btn.innerText==="VIEW CART"){btn.setAttribute("onclick","route(event)");btn.setAttribute("action","route");break}}}}var fflNumberSection=$(".ffl-number");if(!fflApplied&&fflNumberSection&&fflNumberSection.length){var fflNumberSectionBtns=fflNumberSection.find("button, a");fflNumberSectionBtns&&fflNumberSectionBtns.length&&fflNumberSectionBtns.attr("onclick","callFFLPopUp(event)");[4,3].includes(pageTypeId)&&checkFFLProductsInCart(pageTypeId===3?ccUpsellPageFFLProducts:null)?$(".ffl-number").show():$(".ffl-number").hide()}else fflNumberSection.hide();updateLoginLinks();var session=sessionStorage.getItem("sessionId");var useSessionCounter=0;if(session){session=JSON.parse(session);triggerUseSession(session);loadCCPayPalFraudNetScripts()}else{sessionStorage.setItem("sessionStartDateTime",new Date().toJSON());var headCode=document.head.innerHTML;var _urlParams=new URLSearchParams(getCurrentWindowLocation().search);if(headCode&&headCode.includes("EF.urlParameter('_ef_transaction_id')")&&_urlParams.has("oid")&&!checkBuildOrTemplate()){var clickEventCalled=true;var cValueRegEx=/\s*updateURLParameter+\s*[(]+\s*window.location.href+\s*,+\s*"+(c+[1-3])+"\s*,+\s*\S+[)]+\s*/;var cValue=headCode.match(cValueRegEx);cValue=cValue&&cValue[1]||"c1";var EFInterval=setInterval(function(){_urlParams=new URLSearchParams(getCurrentWindowLocation().search);var cValueCheck=_urlParams.has(cValue)&&_urlParams.get(cValue);if(cValueCheck&&cValueCheck.length===32){clearInterval(EFInterval);clickEventCalled&&triggerImportClick(pageType,firstTimeLoad);clickEventCalled=false}},300);setTimeout(function(){if(clickEventCalled){clearInterval(EFInterval);triggerImportClick(pageType,firstTimeLoad);clickEventCalled=false}},5000)}else{triggerImportClick(pageType,firstTimeLoad)}}if(pageTypeId===3||pageTypeId===5){var followUpScriptAdded=sessionStorage.getItem("tripleWhaleFollowUpScriptAdded");tripleWhaleTracking&&followUpScriptAdded!=="true"&&addTripleWhaleFollowUpScript()}}if(urlParams.has("alertMessage")){var message=urlParams.get("alertMessage");var decodedMessage=decodeURI(message);$("body").append("<div class='alert alert-danger alert-dismissible fade show' role='alert' ><strong>"+decodedMessage+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div>")}session&&firstTimeLoad&&registerClick(0);initializeCountryStates(pageData.pageTypeId===8||pageData.pageTypeId==="Profile"?loadProfilePage:pageType==="checkoutPage"?displayPrices:undefined);loadMonth();loadYear();if(pageType===4||pageType==="checkoutPage"){cookieData["access_token"]&&addAcctOnFile()}loadShipProfiles();if(pageData.funnelData&&pageData.funnelData.addOns&&(pageData.pageTypeId===4||pageData.pageTypeId===3)){var paayKey=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="PAAY_API_key"});if(paayKey.length!==0&&paayKey[0].keyValue){sessionStorage.setItem("paayEnabled",true);sessionStorage.removeItem("paayCompleted");sessionStorage.removeItem("paayInitialAsRebill");sessionStorage.removeItem("paayInitialData");sessionStorage.removeItem("paayRebillData");var paayPageOption=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="PAAY_page_option"});if(paayPageOption&&paayPageOption[0]){sessionStorage.setItem("paay_page_option",paayPageOption[0].keyValue)}if(paayPageOption.length===0||paayPageOption[0].keyValue==="2"||pageData.pageTypeId===4&&paayPageOption[0].keyValue==="0"||pageData.pageTypeId===3&&paayPageOption[0].keyValue==="1")initializePAAY(paayKey[0].keyValue)}}if(window.location===window.parent.location){affixImports("css","https://code.jquery.com/ui/1.12.0-rc.2/themes/smoothness/jquery-ui.css");affixImports("js","https://code.jquery.com/ui/1.12.0-rc.2/jquery-ui.min.js",configurePopup)}loadVariants();loadAltValues();if(pageData.pageTypeId===4){if(sessionStorage.getItem("couponCode")!==null)appliedCouponCode=handleCouponSplit(sessionStorage.getItem("couponCode"));else{var defaultCoupon=pageData.selectedCampaign.defaultCouponCode;appliedCouponCode=defaultCoupon?handleCouponSplit(defaultCoupon):[]}if(document.getElementsByName("cardNumber").length){getVariants()}displayPrices()}if(pageData.pageTypeId===3){displayPrices()}if($(".fk-product-row").first().attr("lazyload")==="1"){$("head").append("\n    <style>\n    .fk-product-loader-wrapper {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        margin: 10px 0;\n    }\n    .fk-product-loader {\n        border-radius: 50%;\n        height: 30px;\n        width: 30px;\n        border: 3px solid #8080802e;\n        border-top-color: #0f0f0f;\n        animation: fkRotateProductLoader 1s infinite linear;\n    }\n    @keyframes fkRotateProductLoader {\n        from {\n            transform: rotate3d(0, 0, 1, 0deg);\n        }\n        to {\n            transform: rotate3d(0, 0, 1, 360deg);\n        }\n    }\n    </style>\n")}if($(".fk-shopping-cart").length){$("head").append("\n<style>\ntable.fold-table > tbody > tr.fk-custom-cart-view td, table.fold-table > tbody > tr.fk-custom-cart-view th {\n    cursor: pointer;\n}\ntable.fold-table > tbody > tr.fk-custom-cart-view.fk-custom-open td:nth-child(2) > i.fa.fa-caret-right.fk-caret-rotate {\n    color: #333;\n  }\ntable.fold-table > tbody > tr.fk-custom-cart-view.fk-custom-open td:nth-child(2) > i.fa.fa-caret-right {\n    -webkit-transform: rotate(90deg);\n    -ms-transform: rotate(90deg);\n    transform: rotate(90deg);\n    color: #333;\n}\ntable.fold-table > tbody > tr.fk-custom-cart-fold {\n  display: none;\n}\ntable.fold-table > tbody > tr.fk-custom-cart-fold.fk-custom-open {\n  display: table-row;\n}\n.fold-content > p {\n    margin: 6px;\n    color: #212529;\n}\n.fold-content > p > hr {\n    margin: 12px 0;\n    border-top: 1px solid #2125;\n}\n.fold-content {\n  padding: 0.5em;\n}\n.fk-custom-cart-fold > td {\n    background: #eee;\n}\n</style>")}}$(document).on("change","select[name='variant1'], select[name='variant2'], select[name='variant3'], select[name='productVariant'],input[type='radio'][class='variant-radio']",function(){var fbEventData={eventID:getUniqueId()};window.fbq&&window.fbq("track","CustomizeProduct",{},fbEventData),callFBConversion("CustomizeProduct",fbEventData);this.getAttribute("type")==="radio"&&this.classList.contains("variant-radio")&&productVariantTileClick(this);var element=$(this);var prodSection=element.closest("section.fk-product-section");var prodValue=prodSection&&prodSection[0]&&prodSection[0].getAttribute("value");if(prodSection&&prodSection[0]){var prodImg=$(prodSection).find("img");var prodPrice=$(prodSection).find(".fk-price");var prodShipPrice=$(prodSection).find(".fk-ship-price");var variantValue=$(this).attr("data-value");showVariantImage(prodSection[0],prodImg&&prodImg[0],prodValue,prodPrice&&prodPrice[0],prodShipPrice&&prodShipPrice[0],variantValue);if(pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length){//remove existing variant from cart
var orderItems=getOrderItems();for(var sessionItemCpId in orderItems){if(sessionItemCpId.indexOf(".")>0){var _productData2=sessionItemCpId.split(".");if(_productData2[0]==prodValue){delete orderItems[sessionItemCpId];sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}}}getVariants(prodSection[0].id);displayPrices()}var productVariantElement=this.closest(".fk-product-variant-select");if(productVariantElement&&this.classList.contains("variant-radio")){var _product=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==prodValue});filterTiles(productVariantElement,_product)}}});$(document).on("change","select[name='state'], select[name='shipState']",function(){var shipStateChange=false;if(this.getAttribute("name")==="shipState"){evaluateFFLSectionDisplay();shipStateChange=true}pageData.pageTypeId==4&&displayPrices(shipStateChange)});$(document).on("change","select[name='productSelect']",function(e){var productSection=e.target.closest(".fk-product-section");if(productSection){var previousValue=$(productSection).attr("value");$(productSection).attr("value",e.target.value);if(pageData.pageTypeId===13)sessionStorage.setItem("newProductItem",e.target.value);loadVariants(true,previousValue);var prodImg=$(productSection).find("img");showVariantImage(productSection,prodImg&&prodImg[0],e.target.value)}displayPrices()});$(document).on("change","input[name='quantity'], select[name='quantity']",function(){pageData.pageTypeId==3&&displayPrices()});function removeAcctOnFile(){try{var _acctOnFileContainer=document.getElementById("acctOnFileContainer");if(_acctOnFileContainer){var isChecked=document.getElementById("acctOnFile");isChecked.checked=false;sessionStorage.removeItem("paySource");$("[name=cardSecurityCode], [name=cardDate], [name=cardNumber]").val("").prop("disabled",false);$("[name=cardMonth]").val("0").prop("disabled",false);$("[name=cardYear]").val("").prop("disabled",false);$("#cardLockIcon").css("top","40%");_acctOnFileContainer.remove()}}catch(error){console.log(error)}}function populateAcctOnFile(){try{var cardExpiry=sessionStorage.getItem("customerCardExpiry");var cardNumber=sessionStorage.getItem("customerCardLastDigits");var cardExpiryDateArray=cardExpiry&&cardExpiry.split(" ")[0].split("-");cardExpiry=cardExpiryDateArray&&cardExpiryDateArray.length===3&&cardExpiryDateArray[1]+cardExpiryDateArray[0].substr(2);var isChecked=document.getElementById("acctOnFile");var cvvElement=$("[name=cardSecurityCode]");var cardDateElement=$("[name=cardDate]");var cardNumberElement=$("[name=cardNumber]");var cardMonth=$("[name=cardMonth]");var cardYear=$("[name=cardYear]");if(isChecked.checked===true){cardNumberElement.val(cardNumber?"XXXXXXXXXXXX"+cardNumber:"").prop("disabled",true);cardDateElement.val(cardExpiry?cardExpiry:"").prop("disabled",true);cardMonth.val(cardExpiryDateArray[1]).prop("disabled",true);cardYear.val(cardExpiryDateArray[0]).prop("disabled",true);cvvElement.val("***").prop("disabled",true);sessionStorage.setItem("paySource","ACCTONFILE")}else{cardNumberElement.val("").prop("disabled",false);cardDateElement.val("").prop("disabled",false);cardMonth.val("0").prop("disabled",false);cardYear.val("").prop("disabled",false);cvvElement.val("").prop("disabled",false);sessionStorage.removeItem("paySource")}}catch(error){console.log(error)}}function addAcctOnFile(){return _addAcctOnFile.apply(this,arguments)}function _addAcctOnFile(){_addAcctOnFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var customerOrderData,inputFieldObj,accOnFileTemplateStrContainer,inputFieldContainer,inputFieldParentContainer,lockIcon;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return orderQuery();case 3:customerOrderData=sessionStorage.getItem("customerOrders");customerOrderData=customerOrderData?JSON.parse(customerOrderData):null;customerOrderData=customerOrderData&&customerOrderData[customerOrderData.length-1];if(customerOrderData&&customerOrderData.cardLast4){_context4.next=8;break}return _context4.abrupt("return");case 8:sessionStorage.setItem("customerCardLastDigits",customerOrderData.cardLast4);sessionStorage.setItem("customerCardExpiry",customerOrderData.cardExpiryDate);inputFieldObj=document.getElementsByName("cardNumber")[0];if(inputFieldObj){accOnFileTemplateStrContainer=document.createElement("div");accOnFileTemplateStrContainer.id="acctOnFileContainer";accOnFileTemplateStrContainer.style.cssText="display:flex;flex-direction: row;";accOnFileTemplateStrContainer.innerHTML="<div id='' class=''><input id='acctOnFile' class='' type='checkbox' name='acctOnFile' checked='true' onclick='populateAcctOnFile()' style='cursor: pointer; height: auto; width: auto;'></div><div id='' class=''><label id='' class='' style='text-align: left; padding-left: 5px;'>Use card ending in "+customerOrderData.cardLast4+"</label></div>";inputFieldContainer=inputFieldObj.parentNode;inputFieldContainer.append(accOnFileTemplateStrContainer);inputFieldContainer.style.position="relative";inputFieldParentContainer=inputFieldContainer.parentNode;lockIcon=inputFieldParentContainer.getElementsByClassName("fa-lock")[0];if(lockIcon){lockIcon.remove();lockIcon=null}lockIcon=document.createElement("i");lockIcon.style.cssText="position: absolute; right: 3%; top: 60%;";lockIcon.id="cardLockIcon";lockIcon.classList="fa fa-lock";inputFieldContainer.append(lockIcon);inputFieldContainer.insertBefore(acctOnFileContainer,inputFieldObj);populateAcctOnFile()}_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4["catch"](0);consumerLogout(false);case 17:case"end":return _context4.stop();}}},_callee4,null,[[0,14]])}));return _addAcctOnFile.apply(this,arguments)}function removeNavigationOffersFromCart(){var fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;var offerItems=[];if(fkCart&&Object.keys(fkCart).length>0){for(var offer in fkCart){offerItems.push(String(offer))}}var buttonAndLinkItems=$("button, a");$(buttonAndLinkItems).each(function(){var offer=$(this).attr("offer");if(offerItems.includes(offer)){delete fkCart[offer]}});sessionStorage.setItem("fkCart",JSON.stringify(fkCart))}function updateMap(mapData){var orderData=mapData?mapData:JSON.parse(sessionStorage.getItem("orderData"));var requiredFields=["shipAddress1","shipAddress2","shipCity","shipState","shipPostalCode","shipCountry"];var addressDetails="";if(orderData){requiredFields.forEach(function(field,index){if(orderData[field]){addressDetails+=index===requiredFields.length-1?orderData[field]:orderData[field]+", "}});var mapElement=document.getElementsByName("map");if(mapElement&&mapElement.length>0){mapElement.forEach(function(elem){var src=$(elem).attr("src")!==""?$(elem).attr("src"):$(elem).attr("data-src");var pattern=/&q=.*?&/g;var testValue=pattern.test(src);var parseSrc=testValue?src.replace(/&q=.*?&/g,"&q="+addressDetails+"&"):src.replace(/maps\?/g,"maps?&q="+addressDetails);$(elem).attr("src",parseSrc);$(elem).attr("data-src",parseSrc)})}}}function getProvidersData(id){if(id&&pageData&&pageData.funnelData&&pageData.funnelData.providers&&pageData.funnelData.providers.length){var providers=pageData.funnelData.providers;var providerObj=providers.filter(function(provider){return provider.id===id});if(providerObj&&providerObj.length){return providerObj[0].keyValue}}return null}function getHeadCode(){var funnelData=pageData.funnelData;if(funnelData.providers&&funnelData.providers.length>0){pageData.funnelData.GA_MEASUREMENT_ID=getProvidersData(1);pageData.funnelData.facebookPixelID=getProvidersData(2);pageData.funnelData.snapchatPixelID=getProvidersData(3);pageData.funnelData.tiktokPixelID=getProvidersData(4);pageData.funnelData.lisTrakMerchantID=getProvidersData(5);pageData.funnelData.lisTrakRedirectUrl=getProvidersData(6);pageData.funnelData.lisTrakMeta1=getProvidersData(7);if(pageData.funnelData.GA_MEASUREMENT_ID!==null)getGoogleAnalyticsCode();if(pageData.funnelData.facebookPixelID!==null)getFacebookPixelCode();if(pageData.funnelData.snapchatPixelID!==null)getSnapchatPixelCode();if(pageData.funnelData.tiktokPixelID!==null)getTikTokPixelCode();if(pageData.funnelData.lisTrakMerchantID!==null)getLisTrakCode()}sessionStorage.removeItem("merchantRedirectUpsalefkCart");sessionStorage.removeItem("preUpsalefkCart");sessionStorage.removeItem("importUpsellSuccess");sessionStorage.removeItem("importUpsellSuccessGA");var scriptSplitter=function scriptSplitter(trackingCode){return trackingCode.split("<script").filter(function(script){return script!==""}).map(function(script){return"<script "+script.trim()})};var appendScript=function appendScript(appendTo,scriptArray,count){var headElement=document.createElement("head");// dummy element just to read src. wont be injected into dom.
headElement.innerHTML=scriptArray[count];if(headElement.firstChild.src!==""){loadScript(headElement.firstChild.src,function(){count++;count<scriptArray.length&&appendScript(appendTo,scriptArray,count)},appendTo,headElement.firstChild.id)}else{$(appendTo).append(scriptArray[count]).ready(function(){count++;count<scriptArray.length&&appendScript(appendTo,scriptArray,count)})}};if(funnelData.headTrackingCode){if(funnelData.headTrackingCode.includes("<script")){appendScript("head",scriptSplitter(funnelData.headTrackingCode),0)}else{var headTrackingScript=document.createElement("script");headTrackingScript.innerHTML=funnelData.headTrackingCode;document.head.append(headTrackingScript)}}if(funnelData.bodyTrackingCode){if(funnelData.bodyTrackingCode.includes("<script")){appendScript("body",scriptSplitter(funnelData.bodyTrackingCode),0)}else{var bodyTrackingScript=document.createElement("script");bodyTrackingScript.innerHTML=funnelData.bodyTrackingCode;document.body.append(bodyTrackingScript)}}}function getOrderDataObj(analyticsTool){var isSendExternalProductId=getAddOnKeyValue(findAddOn("EXTERNAL_TRACK_REQ"));var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(!(orderData&&orderData.hasOwnProperty("items"))){return}var orderPurchaseEvent=getAddOnKeyValue(findAddOn("Purchase_Event_FB"))==="3";var orderItems;var upsellOrderDataItems;var requiredProducts=[];var contentsAllProducts=[];var contentsUpsellProducts=[];if(orderPurchaseEvent){upsellOrderDataItems=sessionStorage.getItem("preUpsellOrderDataItems");upsellOrderDataItems=upsellOrderDataItems?JSON.parse(upsellOrderDataItems):null;var upsalefkCart=sessionStorage.getItem("merchantRedirectUpsalefkCart")||sessionStorage.getItem("preUpsalefkCart");orderItems=upsalefkCart?JSON.parse(upsalefkCart):null;var orderItemsKeys=orderItems&&Object.keys(orderItems);if(orderItemsKeys&&orderItemsKeys.length){orderItemsKeys.forEach(function(productId){var id=productId&&productId.split(".")[0];id&&requiredProducts.push(id)})}}var requiredProductsLength=requiredProducts.length;orderData.items.forEach(function(item){var doNotAddIntoUpsellProducts=requiredProductsLength&&!requiredProducts.includes(item.productId);var details={id:item.externalProductId&&isSendExternalProductId==="true"?item.externalProductId:item.productId.toString(),quantity:parseInt(item.qty)};if(analyticsTool==="FB"){contentsAllProducts.push(details);!doNotAddIntoUpsellProducts&&contentsUpsellProducts.push(details)}else if(analyticsTool==="GA"||analyticsTool==="GTM"){details["name"]=item.name;details["variant"]=item.title;details["price"]=parseFloat(item.price);contentsAllProducts.push(details);!doNotAddIntoUpsellProducts&&contentsUpsellProducts.push(details)}});if(orderPurchaseEvent&&upsellOrderDataItems&&analyticsTool==="GTM"){var upsell={};upsell.upsellTotalAmount=parseFloat((orderData.totalAmount-upsellOrderDataItems.totalAmount).toFixed(2));upsell.upsellTaxTotal=parseFloat((orderData.taxTotal-upsellOrderDataItems.taxTotal).toFixed(2));upsell.upsellShipTotal=parseFloat((orderData.shipTotal-upsellOrderDataItems.shipTotal).toFixed(2));upsell.upsellItems=contentsUpsellProducts;orderData.upsell=upsell}if(orderPurchaseEvent&&(analyticsTool==="FB"||analyticsTool==="GA")){var lastPurchasedUpsellItem=orderData.items[orderData.items.length-1];orderData.orderId=lastPurchasedUpsellItem.merchantTxnId||lastPurchasedUpsellItem.transactionItemId;contentsAllProducts=contentsUpsellProducts}return{orderData:orderData,contents:contentsAllProducts}}function generateSHA256Hash(_x4){return _generateSHA256Hash.apply(this,arguments)}function _generateSHA256Hash(){_generateSHA256Hash=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(message){var encoder,data,hash,hashArray,hashHex;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:encoder=new TextEncoder;data=encoder.encode(message);_context5.next=4;return crypto.subtle.digest("SHA-256",data);case 4:hash=_context5.sent;hashArray=Array.from(new Uint8Array(hash));hashHex=hashArray.map(function(_byte){return _byte.toString(16).padStart(2,"0")}).join("");return _context5.abrupt("return",hashHex);case 8:case"end":return _context5.stop();}}},_callee5)}));return _generateSHA256Hash.apply(this,arguments)}function callPurchaseEventOnGA(gtag){var orderInfo=getOrderDataObj("GA");var gtagCall=function gtagCall(){return gtag("event","purchase",{transaction_id:orderInfo.orderData.orderId,value:parseFloat(orderInfo.orderData.totalAmount),currency:pageData.selectedCampaign.currency,tax:parseFloat(orderInfo.orderData.taxTotal),shipping:parseFloat(orderInfo.orderData.shipTotal),items:orderInfo.contents})};(sessionStorage.getItem("importOrderSuccessGA")==="true"||sessionStorage.getItem("importUpsellSuccessGA")==="true")&&gtagCall();sessionStorage.removeItem("importOrderSuccessGA")}function callPurchaseEventOnGTM(){if(sessionStorage.getItem("importOrderSuccessGA")==="true"||sessionStorage.getItem("importUpsellSuccessGA")==="true"){var orderInfo=getOrderDataObj("GTM");window.dataLayer.push({"ecommerce":null});var dataLayerObj={"event":"purchase","ecommerce":{"purchase":{"actionField":{"id":orderInfo.orderData.orderId,"revenue":parseFloat(orderInfo.orderData.totalAmount),"tax":parseFloat(orderInfo.orderData.taxTotal),"shipping":parseFloat(orderInfo.orderData.shipTotal),"coupon":orderInfo.orderData.couponCode},"products":orderInfo.contents}}};if(orderInfo.orderData.upsell){dataLayerObj.ecommerce.purchase.upsell=orderInfo.orderData.upsell}if(getAddOnKeyValue(findAddOn("SEND_USER_DATA"))==="true"){var userinfo={emailAddress:orderInfo.orderData.emailAddress,phoneNumber:orderInfo.orderData.phoneNumber,address1:orderInfo.orderData.address1,address2:orderInfo.orderData.address2,firstName:orderInfo.orderData.firstName,lastName:orderInfo.orderData.lastName,city:orderInfo.orderData.city,state:orderInfo.orderData.state,country:orderInfo.orderData.country,postalCode:orderInfo.orderData.postalCode};var hashPromises=Object.keys(userinfo).map(function(key){return generateSHA256Hash(userinfo[key])});Promise.all(hashPromises).then(function(hashes){Object.keys(userinfo).forEach(function(key,index){userinfo[key]=hashes[index]});dataLayerObj.ecommerce.purchase.userinfo=userinfo;window.dataLayer.push(dataLayerObj)})["catch"](function(error){console.error("Error generating hashes:",error)})}else{window.dataLayer.push(dataLayerObj)}}sessionStorage.removeItem("importOrderSuccessGA")}function callPurchaseEventBasedOnType(methodToCall){var purchaseEventType=getAddOnKeyValue(findAddOn("Purchase_Event_FB"));switch(pageData.pageTypeId){// Upsell Page
case 3:(purchaseEventType==2||purchaseEventType==3)&&methodToCall();break;// Thank You Page
case 5:methodToCall();break;default:break;}}function getGoogleAnalyticsCode(){if(pageData.funnelData.GA_MEASUREMENT_ID.substring(0,3)==="GTM"){window.dataLayer=window.dataLayer||[];(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!="dataLayer"?"&l="+l:"";j.async=true;j.src="https://www.googletagmanager.com/gtm.js?id="+i+dl;f.parentNode.insertBefore(j,f)})(window,document,"script","dataLayer",pageData.funnelData.GA_MEASUREMENT_ID);var noscript=document.createElement("noscript");var iframe=document.createElement("iframe");iframe.src="https://www.googletagmanager.com/ns.html?id="+pageData.funnelData.GA_MEASUREMENT_ID;iframe.height="0";iframe.width="0";iframe.style.display="none";iframe.style.visibility="hidden";noscript.append(iframe);document.body.prepend(noscript);callPurchaseEventBasedOnType(callPurchaseEventOnGTM)}else{var gtag=function gtag(){dataLayer.push(arguments)};var scriptUrl="https://www.googletagmanager.com/gtag/js?id="+pageData.funnelData.GA_MEASUREMENT_ID;var script=document.createElement("script");script.src=scriptUrl;script.async=false;document.head.appendChild(script);var referrer=sessionStorage.getItem("httpReferer")?sessionStorage.getItem("httpReferer"):document.referrer;window.dataLayer=window.dataLayer||[];gtag("js",new Date);if(referrer&&referrer.indexOf(getCurrentWindowLocation().host)<0){var linkElement=document.createElement("a");linkElement.href=referrer;gtag("config",pageData.funnelData.GA_MEASUREMENT_ID,{"linker":{"domains":[linkElement.hostname,getCurrentWindowLocation().host],"accept_incoming":true}})}else{gtag("config",pageData.funnelData.GA_MEASUREMENT_ID)}callPurchaseEventBasedOnType(function(){callPurchaseEventOnGA(gtag)})}}function callPurchaseEvent(fbq,checkFlag,uniqueId){var orderInfo=getOrderDataObj("FB");if(orderInfo){var fbObj={value:orderInfo.orderData.totalAmount,currency:pageData.selectedCampaign.currency,num_items:orderInfo.orderData.items.length,contents:orderInfo.contents,order_id:orderInfo.orderData.orderId};var fbEventData={eventID:uniqueId?uniqueId:orderInfo.orderData.orderId};var fbqCall=function fbqCall(){return fbq("track","Purchase",fbObj,fbEventData)};if(sessionStorage.getItem("importOrderSuccess")==="true"||sessionStorage.getItem("importUpsellSuccess")==="true"){sessionStorage.removeItem("importOrderSuccess");fbqCall();callFBConversion("Purchase",_objectSpread(_objectSpread({},fbObj),fbEventData))}}}function callAddToCartEvent(product){var obj=getProductDetails(product);var fbObj={content_name:obj.productName,value:obj.productValue,currency:pageData.selectedCampaign.currency};var fbEventData={eventID:getUniqueId()};window.fbq&&window.fbq("track","AddToCart",fbObj,fbEventData);callFBConversion("AddToCart",_objectSpread(_objectSpread({},fbObj),fbEventData))}function getFacebookPixelCode(){!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version="2.0";n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init",pageData.funnelData.facebookPixelID);var facebookPixel=document.createElement("img");facebookPixel.height="1";facebookPixel.width="1";facebookPixel.style.display="none";facebookPixel.src="https://www.facebook.com/tr?id="+pageData.funnelData.facebookPixelID+"&ev=PageView&noscript=1";document.head.append(facebookPixel);var purchaseEventType=pageData.funnelData.addOns.find(function(_ref2){var keyName=_ref2.keyName;return keyName==="Purchase_Event_FB"}).keyValue;var sendTotalAmountAndAllProducts=getAddOnKeyValue(findAddOn("SEND_ALL_PRODUCTS"))==="true";window.fbq=fbq;var fbEventData={eventID:getUniqueId()};switch(pageData.pageTypeId){// Presell and VSL page
case 1:case 21:fbq("track","ViewContent",{},fbEventData);callFBConversion("ViewContent",fbEventData);break;// Checkout Page
case 4:document.getElementsByName("cardNumber").length&&fbq("track","InitiateCheckout",{},fbEventData),callFBConversion("InitiateCheckout",fbEventData);break;// Upsell Page
case 3:if(purchaseEventType==2){callPurchaseEvent(fbq)}else if(purchaseEventType==3){callPurchaseEvent(fbq,null,getUniqueId())}break;// Thank You Page
case 5:if(purchaseEventType==1||purchaseEventType==2){callPurchaseEvent(fbq)}else if(purchaseEventType==3){callPurchaseEvent(fbq,null,getUniqueId())}break;default:break;}}function getUniqueId(){return Math.random().toString(36).substring(7)}function callFBConversion(eventname,orderObj){if(!(pageData&&pageData.funnelData&&pageData.funnelData.facebookPixelID)){return}var orderData=JSON.parse(sessionStorage.getItem("orderData"));var data={event_name:eventname,event_time:new Date().getTime()/1000|0,event_source_url:window.location.href,action_source:"website",user_data:{client_user_agent:navigator.userAgent,fbc:getCookie("_fbc"),fbp:getCookie("_fbp")},custom_data:{}};if(document.getElementsByName("emailAddress")[0]){data.user_data["em"]=document.getElementsByName("emailAddress")[0].value.toLowerCase()}else if(orderData&&orderData.emailAddress){data.user_data["em"]=orderData.emailAddress.toLowerCase()}if(document.getElementsByName("phoneNumber")[0]){data.user_data["ph"]=document.getElementsByName("phoneNumber")[0].value.toLowerCase()}else if(orderData&&orderData.phoneNumber){data.user_data["ph"]=orderData.phoneNumber.toLowerCase()}if(document.getElementsByName("gender")[0]){data.user_data["ge"]=document.getElementsByName("gender")[0].value.includes("f")?"f":"m"}else if(orderData&&orderData.gender){data.user_data["ge"]=orderData.gender.includes("f")?"f":"m"}if(document.getElementsByName("dob")[0]){data.user_data["db"]=document.getElementsByName("dob")[0].value.toLowerCase()}else if(orderData&&orderData.dob){data.user_data["db"]=orderData.dob.toLowerCase()}if(document.getElementsByName("lastName")[0]){data.user_data["ln"]=document.getElementsByName("lastName")[0].value.toLowerCase()}else if(orderData&&orderData.lastName){data.user_data["ln"]=orderData.lastName.toLowerCase()}if(document.getElementsByName("firstName")[0]){data.user_data["fn"]=document.getElementsByName("firstName")[0].value.toLowerCase()}else if(orderData&&orderData.firstName){data.user_data["fn"]=orderData.firstName.toLowerCase()}if(document.getElementsByName("city")[0]){data.user_data["ct"]=document.getElementsByName("city")[0].value.toLowerCase()}else if(orderData&&orderData.city){data.user_data["ct"]=orderData.city.toLowerCase()}if(document.getElementsByName("state")[0]){data.user_data["st"]=document.getElementsByName("state")[0].value.toLowerCase()}else if(orderData&&orderData.state){data.user_data["st"]=orderData.state.toLowerCase()}if(document.getElementsByName("postalCode")[0]){data.user_data["zp"]=document.getElementsByName("postalCode")[0].value.toLowerCase()}else if(orderData&&orderData.postalCode){data.user_data["zp"]=orderData.postalCode.toLowerCase()}if(document.getElementsByName("country")[0]){data.user_data["country"]=document.getElementsByName("country")[0].value.toLowerCase()}else if(orderData&&orderData.country){data.user_data["country"]=orderData.country.toLowerCase()}var orderId=sessionStorage.getItem("orderId");if(orderId){data.user_data["subscription_id"]=JSON.parse(orderId)}if(orderObj){data["event_id"]=orderObj["eventID"];for(var key in orderObj){if(key!="eventID"){data.custom_data[key]=orderObj[key];if(key=="contents"){data.custom_data["content_ids"]=orderObj[key].map(function(x){return x.id})}}}}var request={"data":[data]};var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Conversion/fb/"+pageData.funnelReferenceId+"/"+pageData.funnelData.facebookPixelID,JSON.stringify(request))}function getCookie(cname){var name=cname+"=";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(";");for(var _i31=0;_i31<ca.length;_i31++){var c=ca[_i31];while(c.charAt(0)==" "){c=c.substring(1)}if(c.indexOf(name)==0){return c.substring(name.length,c.length)}}return""}function callPurchaseEventForSnapchat(snaptr){var orderData=JSON.parse(sessionStorage.getItem("orderData"));var snaptrCall=function snaptrCall(){return snaptr("track","PURCHASE",{currency:pageData.selectedCampaign.currency,price:parseFloat(orderData.totalAmount),transaction_id:orderData.orderId})};sessionStorage.getItem("importOrderSuccessSC")==="true"&&snaptrCall();sessionStorage.removeItem("importOrderSuccessSC")}function sendListrakCartValue(){var updateCartValue=getAddOnKeyValue(findAddOn("LISTRAK_CART_UPDATE"));if(updateCartValue==="true"){return true}return false}function callLisTrakConversion(listr,eventname){if(eventname=="CaptureEmail"){if(document.getElementsByName("emailAddress")[0]){var emailAddress=document.getElementsByName("emailAddress")[0].value;if(emailAddress!=""&&lisTrakCapturedEmail!=emailAddress){lisTrakCapturedEmail=emailAddress;listr.SCA.Update("email",emailAddress)}}}else if(eventname=="UpdateCart"&&!sendListrakCartValue()){var lisTrakItems=sessionStorage.getItem("fkCart");var existingLisTrakItems=sessionStorage.getItem("lisTrakItems");if(lisTrakItems!==existingLisTrakItems){var cartProducts=getOrderItemDetails();var lisTrakRedirectUrl=pageData&&pageData.funnelData&&pageData.funnelData.lisTrakRedirectUrl;var cartPathname=lisTrakRedirectUrl||getCurrentWindowLocation().protocol+"//"+getCurrentWindowLocation().host+getCurrentWindowLocation().pathname;var meta1=pageData&&pageData.funnelData&&pageData.funnelData.lisTrakMeta1;var cartProductsCount=cartProducts?Object.keys(cartProducts).length:0;if(!lisTrakCartUpdated&&cartProductsCount>0){lisTrakCartUpdated=true;var oneTimeItemsCount=recurringItemsCount=0;var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i32=0;_i32<cartProductsEntriesLength;_i32++){if(cartProductsEntries[_i32][1].billingCycleType==="ONE_TIME"||cartProductsEntries[_i32][1].finalBillingCycle==2)oneTimeItemsCount++;else recurringItemsCount++}var sendAllItems=oneTimeItemsCount==cartProductsCount||recurringItemsCount==cartProductsCount;// FUN2-3578
for(var _i33=0;_i33<cartProductsEntriesLength;_i33++){var _product2=cartProductsEntries[_i33][1];var sku=_product2.variant&&_product2.variant.productSku!==""?_product2.variant.productSku:_product2.productSku;if(sku.trim()=="")continue;if(!sendAllItems&&_product2.billingCycleType!=="ONE_TIME"&&_product2.finalBillingCycle!=2)continue;var variantName=_product2.variant?" "+_product2.variant.title:"";var title=_product2.productName+variantName;var imageURL=_product2.variant&&_product2.variant.imageUrl!==""?_product2.variant.imageUrl:_product2.imageUrl;var unitPrice=_product2.variant&&parseFloat(_product2.variant.price)>0&&!_product2.isVariantBundle&&!_product2.isEditable?_product2.variant.price:_product2.cycle1_price;var _price2=getItemPrice(cartProductsEntries[_i33][0],unitPrice,_product2.currentOrderQuantity).toFixed(2);var quantity=_product2.currentOrderQuantity;listr.SCA.AddItemWithLinks(sku,quantity,_price2,title,imageURL,cartPathname)}if(meta1){listr.SCA.Meta1=meta1}listr.SCA.Submit()}else if(lisTrakCartUpdated&&sessionStorage.getItem("lisTrakItems")&&cartProductsCount==0){lisTrakCartUpdated=false;listr.SCA.ClearCart();listr.SCA.Submit()}sessionStorage.setItem("lisTrakItems",lisTrakItems)}}}function callPurchaseEventForLisTrak(listr){var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(orderData&&orderData.emailAddress){listr.Order.SetCustomer(orderData.emailAddress,orderData.firstName,orderData.lastName);listr.Order.OrderNumber=orderData.orderId;listr.Order.customernumber=orderData.customerId;listr.Order.ShippingTotal=orderData.shipTotal;listr.Order.TaxTotal=orderData.taxTotal;listr.Order.OrderTotal=orderData.totalAmount;if(orderData.items&&orderData.items.length>0){var items=orderData.items;for(var index in items){if(!items[index].productSku)continue;listr.Order.AddItem(items[index].productSku,items[index].qty,items[index].price)}}listr.Order.Submit()}}function getTikTokPixelCode(){!function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++){ttq.setAndDefer(ttq,ttq.methods[i])}ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++){ttq.setAndDefer(e,ttq.methods[n])}return e},ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};ttq.load(pageData.funnelData.tiktokPixelID);ttq.page()}(window,document,"ttq")}function getLisTrakCode(){(function(d,tid,vid){if(typeof _ltk!="undefined")return;var js=d.createElement("script");js.id="ltkSDK";js.src="https://cdn.listrakbi.com/scripts/script.js?m="+tid+"&v="+vid;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(js,s)})(document,pageData.funnelData.lisTrakMerchantID,"1");(function(d){if(typeof _ltk=="undefined"){if(document.addEventListener)document.addEventListener("ltkAsyncListener",function(){_ltk_util.ready(d)});else{e=document.documentElement;e.ltkAsyncProperty=0;e.attachEvent("onpropertychange",function(e){if(e.propertyName=="ltkAsyncProperty"){_ltk_util.ready(d)}})}}else{_ltk_util.ready(d)}})(function(){window.ltk=_ltk;callLisTrakConversion(window.ltk,"UpdateCart");var purchaseEventType=pageData.funnelData.addOns.find(function(_ref3){var keyName=_ref3.keyName;return keyName==="Purchase_Event_FB"}).keyValue;switch(pageData.pageTypeId){// Upsell Page
case 3:purchaseEventType==2&&callPurchaseEventForLisTrak(_ltk);break;// Thank You Page
case 5:callPurchaseEventForLisTrak(_ltk);break;default:break;}})}function getSnapchatPixelCode(){var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(orderData&&orderData.emailAddress){(function(win,doc,sdk_url){if(win.snaptr)return;var tr=win.snaptr=function(){tr.handleRequest?tr.handleRequest.apply(tr,arguments):tr.queue.push(arguments)};tr.queue=[];var s="script";var new_script_section=doc.createElement(s);new_script_section.async=!0;new_script_section.src=sdk_url;var insert_pos=doc.getElementsByTagName(s)[0];insert_pos.parentNode.insertBefore(new_script_section,insert_pos)})(window,document,"https://sc-static.net/scevent.min.js");snaptr("init",pageData.funnelData.snapchatPixelID,{"user_email":orderData.emailAddress});snaptr("track","PAGE_VIEW");var purchaseEventType=pageData.funnelData.addOns.find(function(_ref4){var keyName=_ref4.keyName;return keyName==="Purchase_Event_FB"}).keyValue;switch(pageData.pageTypeId){// Upsell Page
case 3:purchaseEventType==2&&callPurchaseEventForSnapchat(snaptr);break;// Thank You Page
case 5:callPurchaseEventForSnapchat(snaptr);break;default:break;}}}function httpMethod(url,data,headerParams){var loading=document.getElementById("loading");loading?loading.style.display="block !important":null;return fetch(url,{method:"POST",mode:"cors",headers:headerParams?headerParams:{"Content-Type":"application/json; charset=utf-8","Cache-Control":"no-cache","Access-Control-Allow-Origin":"*",companyToken:sessionStorage.getItem("fk_salt")!==null?sessionStorage.getItem("fk_salt"):pageData.salt,funnelReferenceId:pageData.funnelReferenceId},body:data}).then(function(response){if(response.url.includes("ImportClick")&&!response.status.toString().startsWith("4")&&!response.ok){throw new Error("session failed")}return response.json()})["catch"](function(error){return error})}//TODO write test data function
function getIpAddress(){var response;$.ajax({async:false,type:"GET",// cors: true,
// headers: {
//     "Cache-Control": "no-cache",
//     "Access-Control-Allow-Origin": "*"
// },
url:"https://api.ipify.org",success:function success(result){response=result},error:function error(xhr){return xhr.status}});return response}function getIpPhysicalAddress(){return _getIpPhysicalAddress.apply(this,arguments)}function _getIpPhysicalAddress(){_getIpPhysicalAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(){var geoLocationDisabled,geoLocationInfo,url,apiResponse,_data3,regionCode,formattedData;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;geoLocationDisabled=getAddOnKeyValue(findAddOn("GEOLOCATION_ADDRESS"));if(!(geoLocationDisabled==="true"||pageData.pageTypeId==8)){_context6.next=4;break}return _context6.abrupt("return",null);case 4:geoLocationInfo=sessionStorage.getItem("ccGeoLocationInfo");geoLocationInfo=geoLocationInfo?JSON.parse(geoLocationInfo):null;if(!geoLocationInfo){_context6.next=8;break}return _context6.abrupt("return",geoLocationInfo);case 8:url="https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=&longitude=&localityLanguage=en";_context6.next=11;return fetch(url);case 11:apiResponse=_context6.sent;_context6.next=14;return apiResponse.json();case 14:_data3=_context6.sent;regionCode=_data3.principalSubdivisionCode&&_data3.principalSubdivisionCode.split("-");regionCode=regionCode&&regionCode[1];formattedData={city:_data3.city,region_code:regionCode||"",country_code:_data3.countryCode,zip_code:_data3.postcode};sessionStorage.setItem("ccGeoLocationInfo",JSON.stringify(formattedData));return _context6.abrupt("return",formattedData);case 22:_context6.prev=22;_context6.t0=_context6["catch"](0);return _context6.abrupt("return",null);case 25:case"end":return _context6.stop();}}},_callee6,null,[[0,22]])}));return _getIpPhysicalAddress.apply(this,arguments)}function getPageType(pageTypeId){var pageType="";switch(pageTypeId){// Lead page
case 2:case 15:pageType="leadPage";break;// Checkout Page
case 4:pageType="checkoutPage";break;// Upsell Page
case 3:pageType="upsellPage1";break;// Thank You Page
case 5:pageType="thankyouPage";break;default:pageType="presellPage";}return pageType}function addFunnelPageRefId(obj){var isBuildOrTemplate=checkBuildOrTemplate();if(!isBuildOrTemplate){obj.funnelReferenceId=pageData.funnelReferenceId;obj.pageReferenceId=pageData.currentPage.referenceId;obj.funnelName=pageData.funnelData.name;obj.pageName=pageData.currentPage.title}}function importClick(pageType){var obj={};obj.pageType=typeof pageType!=="string"?getPageType(pageType):pageType;if(obj.pageType==="upsellPage")obj.pageType="upsellPage1";//obj.ipAddress = getIpAddress();
obj.userAgent=navigator.userAgent;obj.campaignId=parseInt(pageData.funnelData.campaign);obj.requestUri=getCurrentWindowLocation().href;obj.httpReferer=document.referrer;if(pageData&&pageData.pageTypeId&&allowedFraudPixelPages.includes(pageData.pageTypeId))obj.fraudPixel=1;if(obj.pageType==="checkoutPage")obj.orderItems=sessionStorage.getItem("fkCart");addFunnelPageRefId(obj);var data=JSON.stringify(obj);var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ImportClick/CreateSession",data);if(obj.pageType===5||obj.pageType==="thankyouPage"){if(isFirstTime()){registerClick(1,function(regClickData){confirmation()})}else{confirmation()}}return response}function useSession(session,pageType){var obj={};obj.pageType=typeof pageType!=="string"?getPageType(pageType):pageType;if(obj.pageType==="upsellPage")obj.pageType="upsellPage1";obj.sessionId=session;obj.userAgent=navigator.userAgent;if(pageData&&pageData.pageTypeId&&allowedFraudPixelPages.includes(pageData.pageTypeId))obj.fraudPixel=1;if(obj.pageType==="checkoutPage")obj.orderItems=sessionStorage.getItem("fkCart");addFunnelPageRefId(obj);var data=JSON.stringify(obj);var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ImportClick/UseSession",data);if(obj.pageType===5||obj.pageType==="thankyouPage"){if(isFirstTime()){registerClick(0);registerClick(1,function(regClickData){confirmation()})}else{confirmation()}}return response}function memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle,noProducts,noBilling){//Check arrow product and page product
var selectedArrowPages=pageData.funnelData.pages.filter(function(page){return arrowWithMappedProducts.some(function(linkProduct){return linkProduct.targetPageReferenceId===page.referenceId})});var mappedPageProduct=selectedArrowPages.find(function(page){return page.pageProducts.some(function(productId){return arrowWithMappedProducts.some(function(linkProduct){return linkProduct.products.includes(productId)})})});//Check arrow Billing and page Billing
var selectedArrowPagesBilling=pageData.funnelData.pages.filter(function(page){return arrowWithBillingCycle.some(function(linkBilling){return linkBilling.targetPageReferenceId===page.referenceId})});var mappedPageBilling=selectedArrowPagesBilling.find(function(page){return arrowWithBillingCycle.some(function(linkBilling){return linkBilling.billingCycleIds[0]===page.pagebillingCycles[0]})});var pageWithoutBilling=selectedArrowPagesBilling.find(function(page){return page.pagebillingCycles.length===0});var pageWithNoProducts=selectedArrowPages.find(function(page){return page.pageProducts.length===0});if(!mappedPageProduct&&!pageWithNoProducts&&!noProducts){enableInteractions();$("body").append("<div class='alert alert-danger alert-dismissible fade show' role='alert' ><strong>"+"Access Denied"+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div>");console.log("There are no products listed on the Page. Please contact customer service.")}else if(!mappedPageBilling&&!pageWithoutBilling&&!noBilling){enableInteractions();$("body").append("<div class='alert alert-danger alert-dismissible fade show' role='alert' ><strong>"+"Access Denied"+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div>");console.log("Please provide valid billing cycle number")}else if(mappedPageProduct||mappedPageBilling){setCurrentWindowLocation(redirectPath(mappedPageProduct||mappedPageBilling,true))}else{setCurrentWindowLocation(redirectPath(pageWithoutBilling||pageWithNoProducts,true))}}function memberProductRoute(clubMembershipProducts,buttonProductData){var clubBillingCycleNumber=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;//Check the Arrow/Link with product
var arrowWithMappedProducts=buttonProductData&&buttonProductData.linkDetails.filter(function(linkDetail){return clubMembershipProducts.some(function(productId){return linkDetail.products.includes(productId)})});//Check the Arrow/Link with billingCycleNumber
var arrowWithBillingCycle=buttonProductData.linkDetails.filter(function(linkDetail){return clubBillingCycleNumber>=linkDetail.billingCycleIds[0]});if(arrowWithMappedProducts.length!==0&&arrowWithBillingCycle.length!==0){memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle)}if(arrowWithMappedProducts.length===0||arrowWithBillingCycle.length===0){//Get the Arrow with no product and redirect to that page
var arrowWithNoProducts=buttonProductData&&buttonProductData.linkDetails.filter(function(linkDetail){return linkDetail.products.length===0});var pageMappedWithArrow=pageData.funnelData.pages.filter(function(page){return arrowWithNoProducts.some(function(linkProduct){return linkProduct.targetPageReferenceId===page.referenceId})});var pageMappedWithClubProducts=pageMappedWithArrow.find(function(page){return page.pageProducts.some(function(pageProductId){return clubMembershipProducts.includes(pageProductId)})});var pageWithNoProducts=pageMappedWithArrow.find(function(page){return page.pageProducts.length===0});//Get the Arrow with no billing and redirect to that page
var arrowWithNoBilling=buttonProductData.linkDetails.filter(function(linkDetail){return linkDetail.billingCycleIds.length===0});var pageMappedWithArrowBilling=pageData.funnelData.pages.filter(function(page){return arrowWithNoBilling.some(function(linkBilling){return linkBilling.targetPageReferenceId===page.referenceId})});var pageMappedWithClubBilling=pageMappedWithArrowBilling.find(function(page){return page.pagebillingCycles.some(function(pageBillingId){return clubBillingCycleNumber>=pageBillingId})});var pageWithNoBilling=pageMappedWithArrowBilling.find(function(page){return page.pagebillingCycles.length===0});if(pageWithNoProducts){if(pageWithNoBilling){setCurrentWindowLocation(redirectPath(pageWithNoProducts||pageWithNoBilling,true))}else if(pageMappedWithClubBilling){setCurrentWindowLocation(redirectPath(pageMappedWithClubBilling,true))}else{memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle,pageWithNoProducts,pageWithNoBilling)}}else{memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle,pageWithNoProducts,pageWithNoBilling)}}}function isMembershipPage(pageType){var membershipPageTypes=[7,8,9,10,11,12,13,31];return membershipPageTypes.includes(pageType)}function memberRoute(buttonProductData){var memberships=JSON.parse(sessionStorage.getItem("clubMemberships"));var clubMembershipProducts=memberships?memberships.map(function(product){return product.productId}):sessionStorage.getItem("actionProductId")?JSON.parse(sessionStorage.getItem("actionProductId")):sessionStorage.getItem("orderLoginProducts")?JSON.parse(sessionStorage.getItem("orderLoginProducts")):[];var clubMembershipBillingCycle=memberships&&memberships[0]&&memberships[0].billingCycleNumber;memberProductRoute(clubMembershipProducts,buttonProductData,clubMembershipBillingCycle)}//memberships
function clubQuery(clubId,memberId,productData,route){var obj={};// obj.clubId = clubId
obj.memberId=memberId;var data=JSON.stringify(obj);var headers=getMembershipHeaders();httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/Query",data,headers).then(function(data){if(data.result==="SUCCESS"){sessionStorage.setItem("clubMemberships",JSON.stringify(data.message.data));setCookie("customerBoughtProducts",data.message.data.map(function(product){return product.productId}).join(","),false);setMembershipExternalProduct(data.message.data,clubId,false);sessionStorage.setItem("membership",JSON.stringify(data.message.data[0]));setCookie("customerId",data.message.data[0].customerId,true);if(urlParams.get("redirectToMe")){setCurrentWindowLocation(urlParams.get("redirectToMe"));return}var _result=data.message;if(_result&&_result.data[0].status==="ACTIVE"){var clubMembershipProducts=_result.data.map(function(product){return product.productId});var clubBillingCycleNumber=_result.data[0].billingCycleNumber;memberProductRoute(clubMembershipProducts,productData,clubBillingCycleNumber)}else{setCurrentWindowLocation(route)}}else{setCurrentWindowLocation(route)}})}function customerQuery(){var obj={};var data=JSON.stringify(obj);var headers=getMembershipHeaders();return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/CustomerQuery",data,headers).then(function(data){if(data.result==="SUCCESS"){sessionStorage.setItem("loginCustomer",JSON.stringify(data.message.data[0]));setCookie("customerId",data.message.data[0].customerId,true)}})}function orderQueryWithOrderId(){var obj={orderId:urlParams.get("orderId")};var data=JSON.stringify(obj);httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/OrderQueryByOrderId",data).then(function(data){var orderData=data&&data.message&&data.message.data&&data.message.data[0];orderData&&autoLoadInputs(orderData)})["catch"](function(err){})}function orderQuery(){var obj={};obj.funnelsOrderHistory=true;var loyaltyLionPluginId=getAddOnKeyValue(findAddOn("loyaltyLionPluginId"));var loyaltyLionToken=getAddOnKeyValue(findAddOn("loyaltyLionToken"));if(loyaltyLionPluginId&&loyaltyLionToken)obj.loyaltyLionPluginId=loyaltyLionPluginId;var data=JSON.stringify(obj);var headers=getMembershipHeaders();return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/OrderQuery",data,headers).then(function(data){if(data.result==="SUCCESS"){var orders=data.message.data;sessionStorage.setItem("customerOrders",JSON.stringify(orders));var orderPurchases={};var ordersEntries=[].concat(Object.entries(orders).reverse());var ordersEntriesLength=ordersEntries.length;for(var _i34=0;_i34<ordersEntriesLength;_i34++){var order=ordersEntries[_i34][1];if(order.items&&Object.keys(order.items).length>0){var orderItemsEntries=Object.entries(order.items);var orderItemsEntriesLength=orderItemsEntries.length;for(var j=0;j<orderItemsEntriesLength;j++){var _item3=orderItemsEntries[j][1];if(_item3.purchaseStatus&&!Object.keys(orderPurchases).includes(_item3.purchaseId)){orderPurchases[_item3.purchaseId]={"purchaseId":_item3.purchaseId,"productId":_item3.currentProductId,"product":_item3.currentProduct,"pauseSchedule":_item3.pauseScheduled,"cancellationSchedule":_item3.cancellationScheduled,"clubPluginId":_item3.clubPluginId,"actualProductId":_item3.actualProductId,"status":_item3.purchaseStatus,"nextBillDate":_item3.nextBillDate,"frequency":_item3.frequency,"customization":_item3.customization,"cancelAfterDate":_item3.cancelAfterDate,"price":_item3.currentPrice,"currentQty":_item3.currentQty,"currencySymbol":order.currencySymbol,"currentItem":_item3.currentVariantDetailId?_item3.currentProductId+"."+_item3.currentVariantDetailId:_item3.currentProductId}}}}}sessionStorage.setItem("customerPurchases",JSON.stringify(orderPurchases));if(data.message.loyaltyLionAuthToken)sessionStorage.setItem("loyaltyLionAuthToken",data.message.loyaltyLionAuthToken)}})}function purchaseQuery(){var obj={};var data=JSON.stringify(obj);var headers=getMembershipHeaders();return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/PurchaseQuery",data,headers).then(function(data){if(data.result==="SUCCESS"){return data.message.data}})["catch"](function(err){})}function getMembershipHeaders(){var accessToken=cookieData["access_token"];var headers={"Content-Type":"application/json; charset=utf-8","Cache-Control":"no-cache","Access-Control-Allow-Origin":"*","CompanyToken":pageData.salt,"Authorization":tokenType+" "+accessToken};return headers}function routingNotFound(){enableInteractions();alert("No page routing found. \nPlease verify this button or link is set properly on an arrow.");sessionStorage.removeItem("upsalefkCart")}function redirectPath(navigationItem){var shouldAppendDate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(navigationItem.externalURL){var _orderId=sessionStorage.getItem("orderId");return addOrderIdInExternalURL(navigationItem.externalURL,_orderId)}var appendHtml=shouldAppendDate?".html?"+Date.now():".html";var targetPageViewReferenceId;var targetPageUrlSlug=navigationItem.urlSlug;try{targetPageViewReferenceId=navigationItem.targetPageViewReferenceId?navigationItem.targetPageViewReferenceId:navigationItem.pageView[0].referenceId}catch(err){routingNotFound();throw err}return targetPageUrlSlug?targetPageUrlSlug:targetPageViewReferenceId+appendHtml}function checkBuildOrTemplate(){var buildOrTemplateUrls=["funnels-build","funneltemplates"];return buildOrTemplateUrls.some(function(url){return getCurrentWindowLocation().href.includes(url)})}function getEnvironment(){if(checkBuildOrTemplate()){return"Build"}return"Public"}function validateSession(){var currentUrl=getCurrentWindowLocation().href;var clubId=cookieData["clubId"];clubId=parseInt(clubId);//7 = Membership Login Page
var isLoginpage=pageData.currentPage.pageView[0].pageType===7;var isBuildOrTemplate=checkBuildOrTemplate();//Check the Current Page has access to the product
var clubMembershipProducts=sessionStorage.getItem("actionProductId")?JSON.parse(sessionStorage.getItem("actionProductId")):sessionStorage.getItem("orderLoginProducts")?JSON.parse(sessionStorage.getItem("orderLoginProducts")):getClubMembershipProducts();if((!clubMembershipProducts||!clubMembershipProducts.length)&&cookieData["customerBoughtProducts"]){clubMembershipProducts=cookieData["customerBoughtProducts"].split(",")}var isCurrentPageProductMatched=clubMembershipProducts.some(function(productId){return pageData.currentPage.pageProducts.includes(parseInt(productId))||pageData.currentPage.pageProducts.length===0});// Check the Current Page has access to the billingCycle
function checkBillingAccess(){var membershipBilling=JSON.parse(sessionStorage.getItem("clubMemberships"));var clubMemberShipBilling=membershipBilling?membershipBilling[0].billingCycleNumber:0;var isCurrentPageBillingCycleMatched=clubMemberShipBilling+"">=(pageData.currentPage.pagebillingCycles&&pageData.currentPage.pagebillingCycles[0])+""||pageData.currentPage.pagebillingCycles.length===0;if(isCurrentPageBillingCycleMatched){return true}return false}var orderData=sessionStorage.getItem("orderData");if(!isBuildOrTemplate&&!isLoginpage&&(!isCurrentPageProductMatched||!checkBillingAccess())&&!(orderData&&orderData.orderId)){redirectToLoginPage()}}function reInitializeAndValidateSession(){return _reInitializeAndValidateSession.apply(this,arguments)}function _reInitializeAndValidateSession(){_reInitializeAndValidateSession=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(){var _data4,customerOrders,orderInfo,clubMembershipProducts,obj,reqData,headers,_data5;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!(localStorage.getItem("isMembershipLogin")==="false")){_context7.next=12;break}_context7.next=3;return Promise.all([customerQuery(),orderQuery()]);case 3:_data4=_context7.sent;customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));setMembershipExternalProduct(customerOrders,cookieData["clubId"],true);orderInfo=customerOrders.find(function(_ref9){var orderId=_ref9.orderId;return orderId===cookieData["orderId"]})||customerOrders[customerOrders.length-1];sessionStorage.setItem("loginOrder",JSON.stringify(orderInfo));if(orderInfo&&orderInfo.items){clubMembershipProducts=Object.entries(orderInfo.items).map(function(item){return parseInt(item[1].productId)});sessionStorage.setItem("orderLoginProducts",JSON.stringify(clubMembershipProducts))}validateSession();_context7.next=21;break;case 12:if(!(localStorage.getItem("isMembershipLogin")==="true"&&cookieData["memberId"])){_context7.next=21;break}obj={};obj.memberId=cookieData["memberId"];reqData=JSON.stringify(obj);headers=getMembershipHeaders();_context7.next=19;return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/Query",reqData,headers);case 19:_data5=_context7.sent;if(_data5.result==="SUCCESS"){sessionStorage.setItem("clubMemberships",JSON.stringify(_data5.message.data));setCookie("customerBoughtProducts",_data5.message.data.map(function(product){return product.productId}).join(","),false);setMembershipExternalProduct(_data5.message.data,cookieData["clubId"],false);sessionStorage.setItem("membership",JSON.stringify(_data5.message.data[0]));validateSession()}case 21:case"end":return _context7.stop();}}},_callee7)}));return _reInitializeAndValidateSession.apply(this,arguments)}function validateToken(){return _validateToken.apply(this,arguments)}function _validateToken(){_validateToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(){var reqData,headers,isLoginpage,isBuildOrTemplate,_data6,_orderData6;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:reqData=JSON.stringify({});headers=getMembershipHeaders();isLoginpage=pageData.currentPage.pageView[0].pageType===7;isBuildOrTemplate=checkBuildOrTemplate();if(!(cookieData["access_token"]&&!isLoginpage)){_context8.next=31;break}_context8.prev=5;_context8.next=8;return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/OrderQuery",reqData,headers);case 8:_data6=_context8.sent;if(!(_data6.result==="SUCCESS")){_context8.next=23;break}if(!(localStorage.getItem("isMembershipLogin")==="false"&&(!sessionStorage.getItem("customerPurchases")||!sessionStorage.getItem("loginOrder")||!sessionStorage.getItem("orderLoginProducts")||!sessionStorage.getItem("customerOrders")||!sessionStorage.getItem("loginCustomer")))){_context8.next=15;break}_context8.next=13;return reInitializeAndValidateSession();case 13:_context8.next=21;break;case 15:if(!(localStorage.getItem("isMembershipLogin")==="true"&&(!sessionStorage.getItem("clubMemberships")||!sessionStorage.getItem("membership")))){_context8.next=20;break}_context8.next=18;return reInitializeAndValidateSession();case 18:_context8.next=21;break;case 20:validateSession();case 21:_context8.next=24;break;case 23:redirectToLoginPage();case 24:_context8.next=29;break;case 26:_context8.prev=26;_context8.t0=_context8["catch"](5);redirectToLoginPage();case 29:_context8.next=32;break;case 31:if(!isBuildOrTemplate&&!isLoginpage){_orderData6=JSON.parse(sessionStorage.getItem("orderData"));if(_orderData6&&_orderData6.orderId){clubLogin("","","",_orderData6)}else{redirectToLoginPage()}}case 32:case"end":return _context8.stop();}}},_callee8,null,[[5,26]])}));return _validateToken.apply(this,arguments)}function redirectToLoginPage(){clearCookies();var loginPageDetail=pageData.funnelData.pages.find(function(page){return page.pageView[0].pageType===7});var redirectUrl=redirectPath(loginPageDetail)+"?alertMessage=Access Denied";var encodedUrl=encodeURI(redirectUrl);setCurrentWindowLocation(encodedUrl)}function clearCookies(){var cookies=document.cookie.split("; ");cookies.forEach(function(cookie){var name=cookie.split("=")[0];if(name&&name!=="X-Source"){setCookie(name,"",false)}});document.cookie=""}function clearBrowserStorageData(storageType,keyList){var storage=storageType==="sessionStorage"?window.sessionStorage:window.localStorage;keyList.forEach(function(keyName){storage.removeItem(keyName)})}function clearConsumerLoginData(){/* NOTE:: IF THERE ANY CHANGES DONE IN THIS METHOD, IT NEEDS TO BE DONE IN /iframe.html ALSO WHICH IS DIRECTLY AVIALABLE FOR ALL MEMBERSHIP FUNNEL  */var sessionStorageData=["clubMemberships","membership","requestUri","count","customerOrders","customerCardExpiry","customerCardLastDigits","loginOrder","orderLoginProducts","customerPurchases","loginCustomer"];var localStorageData=["access_token","expireIn","loginUrl"];clearBrowserStorageData("sessionStorage",sessionStorageData);clearBrowserStorageData("localStorage",localStorageData);clearCookies();localStorage.setItem("logOutapp.checkoutchamp.com",Date.now())}function clubLogout(isConsumerLogout){var loginUrl=localStorage.getItem("loginUrl");clearConsumerLoginData();if(!isConsumerLogout){loginUrl&&setCurrentWindowLocation(loginUrl)}}function setCookie(name,value,allowCrossOrigin){var sameSite=allowCrossOrigin?"; SameSite=None; Secure":";";var date=new Date;var cookieLife=getAddOnKeyValue(findAddOn("Cookie_Life"));var loginRememberMe=$("[name=rememberMe]").prop("checked");if(cookieLife){if(loginRememberMe===undefined||loginRememberMe===false){var cookieLifeVal=parseInt(cookieLife);if(cookieLifeVal>0){var dateVal=cookieLifeVal*60*60*1000;date.setTime(date.getTime()+dateVal)}else{date.setTime(date.getTime()+1*24*60*60*1000)}}else{var _dateVal=365*24*60*60*1000;date.setTime(date.getTime()+_dateVal)}}else{date.setTime(date.getTime()+1*24*60*60*1000)}var expires="; expires="+date.toGMTString();document.cookie=name+"="+value+expires+"; domain="+document.domain.split(".").reverse().splice(0,2).reverse().join(".")+sameSite;cookieData[name]=value}function consumerLogout(e){e&&e.preventDefault();clubLogout(true);removeAcctOnFile();updateLoginLinks(true)}function isCustomerOrderDataExists(){var serializedOrderData=sessionStorage.getItem("orderData");serializedOrderData=serializedOrderData?JSON.parse(serializedOrderData):null;return serializedOrderData&&serializedOrderData.customerId}function updateLoginLinks(isLogoutAction){var linkCollection=$("a[action=login], a[action=consumerLogout]");var serializedTemplateLinkData=localStorage.getItem("templateLinkData");var isCustomerKnown=isCustomerOrderDataExists();var templateLinkData=serializedTemplateLinkData?JSON.parse(serializedTemplateLinkData):{};linkCollection.each(function(){var linkElement=this;var action=linkElement.getAttribute("action");var linkId=linkElement.getAttribute("id");var linkDataId=linkElement.dataset.id;var linkLabel=linkElement.innerHTML;var templateLinkHashMapId=linkId+linkDataId;var href=linkElement.getAttribute("href");if(!templateLinkData[templateLinkHashMapId]||action==="login"&&templateLinkData[templateLinkHashMapId]&&(templateLinkData[templateLinkHashMapId].label!==linkLabel||templateLinkData[templateLinkHashMapId].href!==href)){templateLinkData[templateLinkHashMapId]={action:action,href:href,label:linkLabel}}if(cookieData&&cookieData["access_token"]){linkElement.innerHTML="Logout";linkElement.setAttribute("action","consumerLogout");linkElement.setAttribute("onclick","consumerLogout(event)");linkElement.setAttribute("href","")}else{linkElement.innerHTML=templateLinkData[templateLinkHashMapId].label;linkElement.setAttribute("action","login");linkElement.setAttribute("onclick","linkMethod(event, false, true);");linkElement.setAttribute("href",templateLinkData[templateLinkHashMapId].href)}});localStorage.setItem("templateLinkData",JSON.stringify(templateLinkData))}function setMembershipExternalProduct(queryData,clubId,nonMembershipLogin){if(!(clubId&&queryData&&queryData.length)){return}var productExtId="";if(nonMembershipLogin){var ordersIterator=queryData.length-1;for(var _i35=ordersIterator;_i35>=0;_i35--){var order=queryData[_i35];var items=order&&order.items||{};var collection=Object.values(items);var collectionLength=collection.length;for(var j=0;j<collectionLength;j++){var _product3=collection[j];if(_product3&&_product3.externalProductId&&["ACTIVE","TRIAL"].includes(_product3.purchaseStatus)&&_product3.clubPluginId===clubId+""){setCookie("membershipExternalProduct",_product3.externalProductId,true);return}}}return}var queryDataLength=queryData.length;for(var _i36=0;_i36<queryDataLength;_i36++){var _productData3=queryData[_i36];if(["ACTIVE","TRIAL"].includes(_productData3["status"])&&_productData3["clubId"]===clubId){productExtId=_productData3["productId"];break}}var campaignProduct=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.products.find(function(product){return product["externalProductId"]&&product["campaignProductId"]===productExtId});if(campaignProduct){setCookie("membershipExternalProduct",campaignProduct.externalProductId,true)}}function clubLogin(buttonId,clubId,productData,orderData){var obj={};var isMembershipLogin=true;var clubIds;if(orderData){obj.emailAddress=orderData.emailAddress;obj.orderId=orderData.orderId;isMembershipLogin=false}else if(document.getElementsByName("emailAddress")[0]){isMembershipLogin=false;obj.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;obj.orderId=document.getElementsByName("orderId")[0]?document.getElementsByName("orderId")[0].value:null}else if(document.getElementsByName("userName")[0]){obj.clubUsername=document.getElementsByName("userName")[0].value;obj.clubPassword=document.getElementsByName("password")[0]?document.getElementsByName("password")[0].value:null;clubIds=_typeof(clubId)=="object"?clubId:null;obj.clubId=clubIds?parseInt(clubId[0]):clubId}else{return}var data=JSON.stringify(obj);httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/Login/",data).then(function(data){var count=sessionStorage.getItem("count");if(count===null||count===undefined){count=0;sessionStorage.setItem("count",count)}else if(performance.navigation.type==1){count=sessionStorage.getItem("count")}if(data.result==="SUCCESS"){var _route2=null;if(clubIds)clubId=parseInt(clubId[0]);count=0;sessionStorage.setItem("count",count);var results="";if(isJSON(data.message)){results=JSON.parse(data.message)}else{results=data.message}sessionStorage.setItem("count",count);setCookie("expireIn",results.expires_in,true);setCookie("access_token",results.access_token,true);setCookie("firstName",results.firstName,true);setCookie("lastName",results.lastName,true);setCookie("memberId",results.memberId,false);setCookie("username",obj.clubUsername,false);setCookie("status",results.status,false);setCookie("buttonId",buttonId,false);setCookie("clubId",clubId,false);var loginUrl=getCurrentWindowLocation().protocol+"//"+getCurrentWindowLocation().host+getCurrentWindowLocation().pathname;localStorage.setItem("loginUrl",loginUrl);if(isMembershipLogin&&results.memberId){localStorage.setItem("isMembershipLogin",true);if(results.status==="ACTIVE"){clubQuery(obj.clubId,results.memberId,productData)}else{var inActiveNavItem=pageData.navigationItems.find(function(element){return element.status&&element.status.toUpperCase()==="INACTIVE"});var linkWithNoProduct=inActiveNavItem&&inActiveNavItem.linkDetails.find(function(linkDetail){return linkDetail.products.length===0});if(linkWithNoProduct){_route2=redirectPath(linkWithNoProduct,true)}else{var targetButtonLink=pageData.navigationItems.find(function(element){return element.elementId===buttonId});targetButtonLink?_route2=redirectPath(targetButtonLink.linkDetails[0],true):null}clubQuery(obj.clubId,results.memberId,productData,_route2)}}else{localStorage.setItem("isMembershipLogin",false);var _orderId2=results.orderId?results.orderId:obj.orderId;setCookie("orderId",_orderId2,false);Promise.all([customerQuery(),orderQuery()]).then(function(data){var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var orderInfo=customerOrders.find(function(item){return item.orderId===_orderId2})||customerOrders[customerOrders.length-1];sessionStorage.setItem("loginOrder",JSON.stringify(orderInfo));if(orderInfo&&orderInfo.items){var clubMembershipProducts=Object.entries(orderInfo.items).map(function(item){return parseInt(item[1].productId)});setCookie("customerBoughtProducts",clubMembershipProducts.join(","),false);setMembershipExternalProduct(customerOrders,clubId,true);if(urlParams.get("redirectToMe")){setCurrentWindowLocation(urlParams.get("redirectToMe"));return}sessionStorage.setItem("orderLoginProducts",JSON.stringify(clubMembershipProducts));productData&&memberProductRoute(clubMembershipProducts,productData)}})}}else if(_typeof(clubId)=="object"&&clubId.length>1&&isMembershipLogin===true){clubId.splice(0,1);clubLogin(buttonId,clubId,productData,orderData)}else{/* Enabling the button again as we have disabled it onclick of the button (as part of restricting the double/triple click of the button)
            * so that the user can try re-submitting
            */enableInteractions();turnOffSpinner();if(isMembershipLogin)alert("Username or Password is invalid");else alert("Invalid email or Order ID");count++;sessionStorage.setItem("count",count);if(count>=3){$("[name=userName], [name=password], [name=orderId], [name=emailAddress]").prop("disabled",true);$("[data-id="+buttonId+"]").prop("disabled",true);alert("Too many failed attempts, Account will be disabled for 3 minutes");setTimeout(function(){$("[name=userName], [name=password], [name=orderId], [name=emailAddress]").prop("disabled",false);$("[data-id="+buttonId+"]").prop("disabled",false);count=0;sessionStorage.setItem("count",count)},180000)}}})}function isJSON(text){if(typeof text!=="string"){return false}try{var json=JSON.parse(text);return _typeof(json)==="object"}catch(error){return false}}function autoLogin(email,orderId){if(!email||!orderId)return;var buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status&&navItem.status.toLowerCase()==="automatic"});if(!buttonItem||buttonItem&&buttonItem.linkDetails.length===0)buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status==="Active"});if(!buttonItem)return;var buttonId=buttonItem.elementId;disableInteractions(buttonId,true,false);if(document.getElementsByName("emailAddress")[0])document.getElementsByName("emailAddress")[0].value=email;if(document.getElementsByName("orderId")[0])document.getElementsByName("orderId")[0].value=orderId;clubLogin(buttonId,null,buttonItem)}function autoLoginClub(userName,password){if(!userName||!password)return;var clubId=getClubId();var buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status&&navItem.status.toLowerCase()==="automatic"});if(!buttonItem||buttonItem&&buttonItem.linkDetails.length===0)buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status==="Active"});if(!buttonItem)return;var buttonId=buttonItem.elementId;disableInteractions(buttonId,true,false);fillInInputIfExists("userName",userName);fillInInputIfExists("password",password);clubLogin(buttonId,clubId,buttonItem)}function restartMembership(route){var membership=JSON.parse(sessionStorage.getItem("membership"));var obj={};obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;obj.reactivate=true;var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Purchases/Update",data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.status="ACTIVE";sessionStorage.setItem("membership",JSON.stringify(membership));alert("Membership has been restarted")}else{orderQuery();alert("Subscription has been restarted")}sessionStorage.removeItem("customerPurchases");setCurrentWindowLocation(route)})}else{enableInteractions();alert("There was an error restarting your membership, please contact customer service.")}})}function getClubId(){var clubId=[];var BreakException={};try{pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){if(product.clubPluginId&&!clubId.includes(product.clubPluginId)){clubId.push(product.clubPluginId)}})}catch(e){if(e!==BreakException)throw e}return clubId}function resetMemberPassword(){var obj={};function displayErrorMessage(message){if(!message){return}var errorPlacementElement=$(".fk-add-password-reset-error");var errorElement="<div style='color:red;width:100%;' class='fk-username-reset-error'>"+message+"</div>";errorPlacementElement.length?$(errorElement).insertAfter(errorPlacementElement.first()):$(errorElement).insertAfter($("[name=userName]"))}var userNameElement=document.getElementsByName("userName")[0];obj.clubId=getClubId();obj.clubId=_typeof(obj.clubId)=="object"?null:obj.clubId;obj.clubUsername=userNameElement?userNameElement.value:null;$(".fk-username-reset-error").remove();$("[name=userName]").removeClass("border-danger");if(!obj.clubUsername){$("[name=userName]").addClass("border-danger");displayErrorMessage("This is a required entry to reset password");return}var data=JSON.stringify(obj);var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/Reset",data).then(function(data){if(data.result==="SUCCESS"){alert(data.message)}else{$("[name=userName]").addClass("border-danger");displayErrorMessage(data.result)}})}function resetPW(route,clubId,memberId){var obj={};obj.clubId=clubId;obj.clubUsername=document.getElementsByName("userName")[0]?document.getElementsByName("userName")[0].value:null;obj.clubPassword=document.getElementsByName("password")[0]?document.getElementsByName("password")[0].value:null;if(obj.clubPassword!==document.getElementsByName("confirmPassword")[0]){alert("Passwords do not match")}var data=JSON.stringify(obj);var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/Reset",data).then(function(data){if(data.result==="SUCCESS"){alert("Password has been updated")}})}function cancelMembership(route){var obj={};obj.cancelReason=document.getElementsByName("cancelReason")[0]?document.getElementsByName("cancelReason")[0].value:null;var membership=JSON.parse(sessionStorage.getItem("membership"));obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Purchases/Cancel",data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.status="CANCELLED";sessionStorage.setItem("membership",JSON.stringify(membership));alert("Membership has been cancelled")}else{orderQuery();alert("Subscription has been cancelled")}sessionStorage.removeItem("customerPurchases");setCurrentWindowLocation(route)})}else{enableInteractions();if(membership)alert("There was an error cancelling your membership, please contact customer service.");else alert("There was an error cancelling your subscription, please contact customer service.")}})}function changeProduct(route){var obj={};var product_value,customFields;var isBillNow=$("[action=submit]")[0].attributes.billnow.value;var membership=getMembershipDetails();var customerPurchases=JSON.parse(sessionStorage.getItem("customPurchases"));var actionPurchaseId=sessionStorage.getItem("actionPurchaseId");var nextBillDateInput=document.getElementsByName("nextBillDate")[0];var billingIntervalDays=document.getElementsByName("frequency")[0];var currentPrice=document.getElementsByName("price")[0];var priceElement=$("input[name='price']");obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;var originalQuantity=sessionStorage.getItem("currentProductQty");obj.productQty=originalQuantity;var originalNextBillDate=sessionStorage.getItem("currentNextBillDate");var originalBillingIntervaldays=sessionStorage.getItem("billingIntervalDays");var originalCurrentPrice=sessionStorage.getItem("currentPrice");var nextBillDateValue,billingIntervalValue,selectedPrice;getVariants();for(var key in customerPurchases){if(key==actionPurchaseId){customFields=customerPurchases[key].customization}}if(customFields&&sessionStorage.getItem("selectedCombo"))obj.product_custom=sessionStorage.getItem("selectedCombo");var newProductItem=sessionStorage.getItem("newProductItem")?sessionStorage.getItem("newProductItem"):null;if(!newProductItem){var newProduct=document.getElementsByName("product");newProduct.forEach(function(product){if(product.checked){newProduct=product;newProductItem=newProduct.value;product.getAttribute("variantValue")?newProductItem+="."+newProduct.getAttribute("variantValue"):null}})}if(newProductItem){if(newProductItem.indexOf(".")>0){productData=newProductItem.split(".");obj.productId=productData[0];if(!obj.product_custom)obj.variantDetailId=productData[1]}else{obj.productId=newProductItem}}var newProductQty=sessionStorage.getItem("newProductQty")?sessionStorage.getItem("newProductQty"):null;if(newProductQty){obj.productQty=parseFloat(Math.floor(newProductQty))}else{obj.productQty=originalQuantity;var productInputs=$("input[name='product']");var prodInputLength=productInputs.length;if(prodInputLength){for(var _i37=0;_i37<prodInputLength;_i37++){var input=productInputs[_i37];if(input.checked){var prodSection=$(input).closest("section.fk-product-section");var quantityInputNode=prodSection.find("input[name='quantity'],select[name='quantity']")[0];obj.productQty=quantityInputNode?quantityInputNode.value:obj.productQty}}}else{var _prodSection=$(".fk-product-section");var _quantityInputNode=_prodSection.find("input[name='quantity'], select[name='quantity']")[0];obj.productQty=_quantityInputNode?_quantityInputNode.value:obj.productQty}}if(nextBillDateInput){nextBillDateValue=nextBillDateInput.value;obj.priorToNextBill=1;obj.nextBillDate=nextBillDateValue?nextBillDateValue:originalNextBillDate;if(nextBillDateValue==null){enableInteractions();alert("Please enter a valid Next Bill Date");return}}if(billingIntervalDays){billingIntervalValue=billingIntervalDays.value;obj.billingIntervalDays=billingIntervalValue?billingIntervalValue:originalBillingIntervaldays;if(!billingIntervalValue){enableInteractions();alert("Please enter a valid billing frequency");return}}if(priceElement.length){var _productInputs=$("input[name='product']");var _prodInputLength=_productInputs.length;for(var _i38=0;_i38<_prodInputLength;_i38++){var _input2=_productInputs[_i38];if(_input2.checked){var _prodSection2=$(_input2).closest("section.fk-product-section");var priceInputNode=_prodSection2.find("input[name='price']")[0];selectedPrice=priceInputNode&&priceInputNode.value;obj.price=priceInputNode&&priceInputNode.value?priceInputNode.value:originalCurrentPrice;if(!selectedPrice){enableInteractions();alert("Please enter a valid price amount");return}}}}var currentItem=sessionStorage.getItem("actionCurrentItem")?sessionStorage.getItem("actionCurrentItem"):membership?membership.productId.toString():null;if(currentItem&&!(obj.productQty&&obj.productQty!=originalQuantity)){var currentProductId=currentItem;var currentVariantDetailId=null;if(currentItem.indexOf(".")>0){var currentItemData=currentItem.split(".");currentProductId=currentItemData[0];currentVariantDetailId=currentItemData[1]}}if(isBillNow==="true"){obj.billNow=true}var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Purchases/Update",data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.productId=membership.productId?newProductItem:product_value;sessionStorage.setItem("membership",JSON.stringify(membership))}else{sessionStorage.removeItem("actionCurrentItem");orderQuery()}sessionStorage.removeItem("customerPurchases");alert("Your product has been updated");setCurrentWindowLocation(route)})}else{enableInteractions();alert("There was an error processing your request, if problems persist please contact customer service")}})}function pauseMembership(route){var obj={};var customrestartDate=document.getElementsByName("custom_restartDate")[0];var date=customrestartDate?customrestartDate.value:null;var membership=sessionStorage.getItem("membership")?JSON.parse(sessionStorage.getItem("membership")):null;obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;obj.priorToNextBill=1;var momentDate=moment(date);if(date==null||!momentDate.isValid()){enableInteractions();alert("Please enter a valid Restart Date");return}obj.restartDate=momentDate.format("YYYY-MM-DD");var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Purchases/Pause",data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.status="PAUSED";sessionStorage.setItem("membership",JSON.stringify(membership))}orderQuery();alert(data.message);setCurrentWindowLocation(route)})}else{enableInteractions();alert(data.message)}})}function updateCard(productData){var membership=getMembershipDetails();var customer=sessionStorage.getItem("loginCustomer")?JSON.parse(sessionStorage.getItem("loginCustomer")):null;var paySourceId=membership?membership.paySourceId:customer?customer.paySourceId:null;if(!paySourceId)return;var cardNumber=$("input[name=\"cardNumber\"]").val().replace(/\D/g,"");var cardMonth=$("select[name=\"cardMonth\"]").val();var cardYear=$("select[name=\"cardYear\"]").val();var cardSecurityCode=$("input[name=\"cardSecurityCode\"]").val();if(/\d{12,16}/.test(cardNumber)&&cardMonth&&cardYear){var obj={cardNumber:cardNumber,cardMonth:cardMonth,cardYear:cardYear,cardSecurityCode:cardSecurityCode,validateCard:1};var _data=JSON.stringify(obj);var headers=getMembershipHeaders();httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/UpdateCard",_data,headers).then(function(data){if(data.result==="SUCCESS"){if(customer)customerQuery();alert("Card Details have been updated successfully");memberRoute(productData)}else{enableInteractions();alert("error "+data.message)}})}else{enableInteractions();alert("Please provide valid card number, month, and year")}}function updateMember(route,clubId,callback){var obj={};var url="";var customer=null;var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(cookieData["memberId"]){obj.clubId=clubId;obj.memberId=cookieData["memberId"];if(document.getElementsByName("newPassword")[0].value!==document.getElementsByName("confirmPassword")[0].value){enableInteractions();$("#validationMessage").length?$("#validationMessage").show():alert("Passwords do not match");return}$("#validationMessage").hide();obj.clubPassword=document.getElementsByName("newPassword")[0]?document.getElementsByName("newPassword")[0].value:null;url="https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/Update"}else{if(document.getElementsByName("newPassword")[0]){if(document.getElementsByName("newPassword")[0].value!==document.getElementsByName("confirmPassword")[0].value){enableInteractions();$("#validationMessage").length?$("#validationMessage").show():alert("Passwords do not match");return}$("#validationMessage").hide();obj.eCommercePassword=document.getElementsByName("newPassword")[0].value}if(!orderData){customer=JSON.parse(sessionStorage.getItem("loginCustomer"))}url="https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/CustomerUpdate"}memberFields.forEach(function(field){if(field==="phoneNumber"&&phFormatByCountry==="true"){obj[field]=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:null;obj[field]=obj[field]?obj[field].replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):null}else{obj[field]=document.getElementsByName(field)[0]?document.getElementsByName(field)[0].value:null}});ship.forEach(function(field){obj[field]=document.getElementsByName(field)[0]?document.getElementsByName(field)[0].value:null});var inputs=$("input, select");inputs.each(function(index,input){if(input.name.indexOf("custom_")>=0){if(input.type==="checkbox")obj[input.name]=input.checked?1:0;else if(input.type==="radio"){if(input.checked)obj[input.name]=input.value}else obj[input.name]=input.value}else if(input.type==="checkbox"&&input.name!=="product"){if(input.name==="doNotSellName"){obj[input.name]=input.checked?0:1}else{obj[input.name]=input.checked?1:0}}});var data=JSON.stringify(obj);var headers=getMembershipHeaders();httpMethod(url,data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(customer)customerQuery();alert("Your profile has been updated");if(route!==null)setCurrentWindowLocation(route);if(typeof callback==="function")callback()})}else{enableInteractions();alert("error "+data.message)}})}function generateComboDropDown(newDynamicCell,itemId,item,isPurchaseTable){var comboResult=comboDisplay("","","","","",itemId,"","","",item,isPurchaseTable);var container=document.createElement("span");container.innerHTML=comboResult.listOfItem;newDynamicCell.append(container)}function displayOrdersTable(){var repeatOrderButton=false;var buyAgain=document.getElementById("buyAgainButton");var orderStatus=document.getElementById("orderStatusButton");var ordersTable=document.getElementById("fk-dynamic-orders-table");var dynamicOrdersBody=document.querySelector("tbody[id='fk-dynamic-orders-body']");var ordersTableHeader=document.querySelector("thead[id='fk-dynamic-orders-head']");var headerRow=document.querySelector("thead[id='fk-dynamic-orders-head'] > tr");if(buyAgain||orderStatus){var headerCell=document.createElement("TH");buyAgain&&headerRow.appendChild(headerCell);orderStatus&&headerRow.appendChild(headerCell)}if(!ordersTable)return;var orders=sessionStorage.getItem("customerOrders")?JSON.parse(sessionStorage.getItem("customerOrders")):null;if(!orders){var member=getMembershipDetails();var loginCustomer=sessionStorage.getItem("loginCustomer");if(member||loginCustomer){orderQuery().then(function(data){displayOrdersTable()})}return}var orderCellFormat=[];var currentOrderRow=document.querySelector("tr[id='fk-dynamic-orders-row']");if(currentOrderRow){orderCellFormat=Array.prototype.slice.call(currentOrderRow.cells)}dynamicOrdersBody.innerHTML="";var newButton=function newButton(actionType){var actionBtn=document.createElement(actionType.nodeName);actionBtn.className=actionType.className;var buttonId=actionType.getAttribute("data-id");actionBtn.setAttribute("data-id",buttonId);var id=actionType.getAttribute("id");actionBtn.title=actionType.title;actionBtn.setAttribute("id",id);actionBtn.innerHTML=actionType.innerHTML;actionBtn.style.cursor="pointer";return actionBtn};if(orders&&Object.keys(orders).length>0){var orderEntries=[].concat(Object.entries(orders).reverse());var orderEntriesLength=orderEntries.length;var _loop2=function _loop2(_i39){var order=orderEntries[_i39][1];var newDynamicOrderRow=document.createElement("TR");var orderCellFormatLength=orderCellFormat.length;for(var j=0;j<orderCellFormatLength;j++){var cell=orderCellFormat[j];var newDynamicCell=document.createElement("TD");cell.id!==""&&newDynamicCell.setAttribute("id",cell.id);newDynamicCell.className="table-cell";newDynamicCell.textContent="";switch(cell.title){case"Order":newDynamicCell.textContent=order.orderId;break;case"Date":newDynamicCell.textContent=setDateFormat(new Date(order.dateCreated),"MM/dd/yy");break;case"Items":if(order.items&&Object.keys(order.items).length>0){var orderItemEntries=Object.entries(order.items);var orderItemsLength=orderItemEntries.length;for(var k=0;k<orderItemsLength;k++){var _item4=orderItemEntries[k][1];var productName="("+_item4.qty+") ";productName+=_item4.variantName?_item4.name+" "+_item4.variantName:_item4.name;if(_item4.customization&&_item4.customization.length){var orderItemId=_item4.orderItemId;generateComboDropDown(newDynamicCell,orderItemId,_item4,false)}else{newDynamicCell.append(productName+" ")}var lineBreak=document.createElement("BR");newDynamicCell.append(lineBreak)}}break;case"Amount":newDynamicCell.append(order.currencySymbol+order.totalAmount);var amountRefunded=parseFloat(order.totalAmount)-parseFloat(order.refundRemaining);if(amountRefunded>0){var _lineBreak=document.createElement("BR");newDynamicCell.append(_lineBreak);var refundDiv=document.createElement("DIV");refundDiv.style.color="red";refundDiv.append("-"+order.currencySymbol+amountRefunded.toFixed(2)+" Refunded");newDynamicCell.append(refundDiv)}break;case"Tracking":newDynamicCell.textContent="";if(order.fulfillments&&Object.keys(order.fulfillments).length>0){var orderFulfillmentEntries=Object.entries(order.fulfillments);var orderFulfillmentEntriesLength=orderFulfillmentEntries.length;for(var _k=0;_k<orderFulfillmentEntriesLength;_k++){var fulfillment=orderFulfillmentEntries[_k][1];if(fulfillment.trackingNumber){newDynamicCell.append(addTrackingNumberLink(fulfillment.trackingNumber,true));var _lineBreak2=document.createElement("BR");newDynamicCell.append(_lineBreak2)}}}break;case"Date Shipped":var shippedFulfillmentEntries=Object.entries(order.fulfillments);var shippedFulfillmentEntriesLength=shippedFulfillmentEntries.length;for(var _k2=0;_k2<shippedFulfillmentEntriesLength;_k2++){newDynamicCell.textContent=setDateFormat(new Date(shippedFulfillmentEntries[_k2][1].dateShipped),"MM/dd/yy")}break;case"Date Delivered":var deliveredFulfillmentsEntries=Object.entries(order.fulfillments);var deliveredFulfillmentsEntriesLength=deliveredFulfillmentsEntries.length;for(var _k3=0;_k3<deliveredFulfillmentsEntriesLength;_k3++){newDynamicCell.textContent=setDateFormat(new Date(deliveredFulfillmentsEntries[_k3][1].dateDelivered),"MM/dd/yy")}break;case"Shipping Address":newDynamicCell.textContent="";if(order&&Object.keys(order.address1).length>0){var orderAddressEntries=Object.entries(order.address1);var orderAddressEntriesLength=orderAddressEntries.length;for(var _k4=0;_k4<orderAddressEntriesLength;_k4++){var address1=orderAddressEntries[_k4][1];if(address1){newDynamicCell.append(address1);var _lineBreak3=document.createElement("BR");newDynamicCell.append(_lineBreak3)}}}break;case"Order Actions":if(buyAgain){if(order.orderType&&order.orderType==="NEW_SALE"){var bodyCell=document.createElement("SPAN");bodyCell.innerHTML=newButton(buyAgain).outerHTML;bodyCell.onclick=function(){if(order.items&&Object.keys(order.items).length>0){var orderActionsEntries=Object.entries(order.items);var orderActionsEntriesLength=orderActionsEntries.length;for(var _k5=0;_k5<orderActionsEntriesLength;_k5++){var _item5=orderActionsEntries[_k5][1];var _productId2=_item5.variantDetailId?_item5.productId+"."+_item5.variantDetailId:_item5.productId;var ordersObject=JSON.parse(sessionStorage.getItem("fkCart"));ordersObject[_productId2]=_item5.qty;sessionStorage.setItem("fkCart",JSON.stringify(ordersObject))}}};newDynamicCell.append(bodyCell)}if(orderStatus){(function(){var bodyCell=document.createElement("SPAN");bodyCell.innerHTML=newButton(orderStatus).outerHTML;var buttonId=orderStatus.getAttribute("data-id");bodyCell.onclick=function(e){sessionStorage.setItem("orderStatusInfo",JSON.stringify(order));callMethodApply(buttonId)};newDynamicCell.append(bodyCell)})()}else{var _bodyCell=document.createElement("SPAN");newDynamicCell.append(_bodyCell)}}break;}newDynamicOrderRow.appendChild(newDynamicCell)}newDynamicOrderRow.id="fk-dynamic-orders-row";dynamicOrdersBody.appendChild(newDynamicOrderRow)};for(var _i39=0;_i39<orderEntriesLength;_i39++){_loop2(_i39)}}}function displayShipmentsTable(){var ordersTable=document.getElementById("fk-dynamic-shipments-table");var dynamicOrdersBody=document.querySelector("tbody[id='fk-dynamic-shipments-body']");var ordersTableHeader=document.querySelector("thead[id='fk-dynamic-shipments-head']");if(!ordersTable)return;var orders=sessionStorage.getItem("customerOrders")?JSON.parse(sessionStorage.getItem("customerOrders")):null;if(!orders){var member=getMembershipDetails();var loginCustomer=sessionStorage.getItem("loginCustomer");if(member||loginCustomer){orderQuery().then(function(data){displayShipmentsTable()})}return}var orderCellFormat=[];var currentOrderRow=document.querySelector("tr[id='fk-dynamic-shipments-row']");if(currentOrderRow){orderCellFormat=Array.prototype.slice.call(currentOrderRow.cells)}dynamicOrdersBody.innerHTML="";if(orders&&Object.keys(orders).length>0){var orderEntries=[].concat(Object.entries(orders).reverse());var orderEntriesLength=orderEntries.length;for(var _i40=0;_i40<orderEntriesLength;_i40++){var order=orderEntries[_i40][1];if(order&&order.fulfillments){var fulfillmentsEntries=Object.entries(order.fulfillments);var fulfillmentsEntriesLength=fulfillmentsEntries.length;for(var j=0;j<fulfillmentsEntriesLength;j++){var fulfillment=fulfillmentsEntries[j][1];var newDynamicOrderRow=document.createElement("TR");var orderCellFormatLength=orderCellFormat.length;for(var k=0;k<orderCellFormatLength;k++){var cell=orderCellFormat[k];var newDynamicCell=document.createElement("TD");cell.id!==""&&newDynamicCell.setAttribute("id",cell.id);newDynamicCell.className="table-cell";newDynamicCell.textContent="";switch(cell.title){case"Order":newDynamicCell.textContent=order.orderId;break;case"Tracking":newDynamicCell.textContent="";if(order.fulfillments&&Object.keys(order.fulfillments).length>0){if(fulfillment.trackingNumber){newDynamicCell.append(addTrackingNumberLink(fulfillment.trackingNumber,true));var lineBreak=document.createElement("BR");newDynamicCell.append(lineBreak)}}break;case"Shipped":if(order.fulfillments&&Object.keys(order.fulfillments).length>0){newDynamicCell.textContent=fulfillment.dateShipped?setDateFormat(new Date(fulfillment.dateShipped),"MM/dd/yy"):""}break;case"Delivered":if(order.fulfillments&&Object.keys(order.fulfillments).length>0){newDynamicCell.textContent=fulfillment.dateDelivered?setDateFormat(new Date(fulfillment.dateDelivered),"MM/dd/yy"):""}break;case"Address":newDynamicCell.textContent="";if(order&&order.address1&&Object.keys(order.address1).length>0){var orderAddress1Entries=Object.entries(order.address1);var orderAddress1EntriesLength=orderAddress1Entries.length;for(var l=0;l<orderAddress1EntriesLength;l++){var address1=orderAddress1Entries[l][1];if(address1){newDynamicCell.append(address1)}}order.address2?newDynamicCell.append(", "):newDynamicCell.append(document.createElement("BR"))}if(order&&order.address2&&Object.keys(order.address2).length>0){var orderAddress2Entries=Object.entries(order.address2);var orderAddress2EntriesLength=orderAddress2Entries.length;for(var _l=0;_l<orderAddress2EntriesLength;_l++){var address2=orderAddress2Entries[_l][1];if(address2){newDynamicCell.append(address2)}}newDynamicCell.append(document.createElement("BR"))}if(order&&order.city&&Object.keys(order.city).length>0){var orderCityEntries=Object.entries(order.city);var orderCityEntriesLength=orderCityEntries.length;for(var _l2=0;_l2<orderCityEntriesLength;_l2++){var city=orderCityEntries[_l2][1];if(city){newDynamicCell.append(city)}}if(order.state){newDynamicCell.append(", ")}}if(order&&order.state&&Object.keys(order.state).length>0){var orderStateEntries=Object.entries(order.state);var orderStateEntriesLength=orderStateEntries.length;for(var _l3=0;_l3<orderStateEntriesLength;_l3++){var state=orderStateEntries[_l3][1];if(state){newDynamicCell.append(state)}}if(order.postalCode){newDynamicCell.append(" ")}}if(order&&order.postalCode&&Object.keys(order.postalCode).length>0){var postalCodeEntries=Object.keys(order.postalCode);var postalCodeEntriesLength=postalCodeEntries.length;for(var _l4=0;_l4<postalCodeEntriesLength;_l4++){var postalCode=postalCodeEntries[_l4][1];if(postalCode){newDynamicCell.append(postalCode)}}}break;}newDynamicOrderRow.appendChild(newDynamicCell)}newDynamicOrderRow.id="fk-dynamic-shipments-row";dynamicOrdersBody.appendChild(newDynamicOrderRow)}}}}}function displayPurchasesTable(){return _displayPurchasesTable.apply(this,arguments)}function _displayPurchasesTable(){_displayPurchasesTable=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(){var purchasesTable,dynamicPurchasesBody,purchasesTableHeader,customerPurchases,purchases,purchaseEntries,purchaseEntriesLength,_i123,_item21,member,purchaseCellFormat,currentPurchaseRow,pauseBtn,cancelBtn,reactivateBtn,editBtn,createActionBtn,_purchaseEntries,sortedStatuses,_purchaseEntriesLength,_i124,newDynamicPurchaseRow,purchaseCellFormatLength,j,cell,newDynamicCell,purchaseId,displayStatus,displayText,displaySubscriptionStatus,subscriptionStatus;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:purchasesTable=document.getElementById("fk-dynamic-purchases-table");dynamicPurchasesBody=document.querySelector("tbody[id='fk-dynamic-purchases-body']");purchasesTableHeader=document.querySelector("thead[id='fk-dynamic-purchases-head']");if(purchasesTable){_context9.next=5;break}return _context9.abrupt("return");case 5:_context9.next=7;return purchaseQuery();case 7:customerPurchases=_context9.sent;purchases={};purchaseEntries=[].concat(Object.entries(customerPurchases));purchaseEntriesLength=purchaseEntries.length-1;for(_i123=purchaseEntriesLength;_i123>=0;_i123--){_item21=purchaseEntries[_i123][1];if(_item21&&_item21.status){purchases[_item21.purchaseId]={"purchaseId":_item21.purchaseId,"productId":_item21.productId,"product":_item21.displayName,"pauseSchedule":_item21.pauseScheduled,"cancellationSchedule":_item21.cancellationScheduled,"clubPluginId":_item21.clubPluginId,"actualProductId":_item21.actualProductId,"status":_item21.status,"nextBillDate":_item21.nextBillDate,"frequency":_item21.billingIntervalDays,"customization":_item21.customization,"cancelAfterDate":_item21.cancelAfterDate,"price":_item21.price,"currentQty":_item21.productQty,"currencySymbol":_item21.currencySymbol,"currentItem":_item21.variantDetailId?_item21.productId+"."+_item21.variantDetailId:_item21.productId}}}sessionStorage.setItem("customPurchases",JSON.stringify(purchases));if(purchases){_context9.next=17;break}member=getMembershipDetails();if(member){orderQuery().then(function(data){displayPurchasesTable()})}return _context9.abrupt("return");case 17:purchaseCellFormat=[];currentPurchaseRow=document.querySelector("tr[id='fk-dynamic-purchases-row']");if(currentPurchaseRow){purchaseCellFormat=Array.prototype.slice.call(currentPurchaseRow.cells)}pauseBtn=document.getElementById("purchasePauseBtn");cancelBtn=document.getElementById("purchaseCancelBtn");reactivateBtn=document.getElementById("purchaseReactivateBtn");editBtn=document.getElementById("purchaseEditBtn");dynamicPurchasesBody.innerHTML="";if(!(purchases&&Object.keys(purchases).length>0)){_context9.next=92;break}createActionBtn=function createActionBtn(purchase,sampleBtn){var actionBtn=document.createElement(sampleBtn.nodeName);actionBtn.className=sampleBtn.className;var buttonId=sampleBtn.getAttribute("data-id");actionBtn.setAttribute("data-id",buttonId);var id=sampleBtn.getAttribute("id");actionBtn.setAttribute("id",id);actionBtn.innerHTML=sampleBtn.innerHTML;actionBtn.title=sampleBtn.title;actionBtn.style.cursor="pointer";actionBtn.onclick=function(e){e.preventDefault();sessionStorage.setItem("actionPurchaseId",purchase.purchaseId);sessionStorage.setItem("actionProductId",JSON.stringify([parseInt(purchase.productId)]));sessionStorage.setItem("actionCurrentItem",purchase.currentItem);sessionStorage.setItem("actionCurrentProductQty",parseFloat(purchase.currentQty));sessionStorage.setItem("actionNextBillDate",purchase.nextBillDate);sessionStorage.setItem("actionBillingIntervalDays",purchase.frequency);sessionStorage.setItem("actionPrice",purchase.price);sessionStorage.setItem("ccActionPurchaseItem",JSON.stringify(purchase));callMethodApply(buttonId)};return actionBtn};_purchaseEntries=Object.entries(purchases);sortedStatuses={"ACTIVE":0,"TRIAL":0,"INACTIVE":1,"PENDING":2,"RECYCLE_BILLING":3,"RECYCLE_FAILED":3,"CANCELLED":4,"COMPLETE":5};_purchaseEntries.sort(function(a,b){return sortedStatuses[a[1].status]<sortedStatuses[b[1].status]?-1:sortedStatuses[a[1].status]>sortedStatuses[b[1].status]?1:0});_purchaseEntriesLength=_purchaseEntries.length;_i124=0;case 32:if(!(_i124<_purchaseEntriesLength)){_context9.next=92;break}purchase=_purchaseEntries[_i124][1];newDynamicPurchaseRow=document.createElement("TR");purchaseCellFormatLength=purchaseCellFormat.length;j=0;case 37:if(!(j<purchaseCellFormatLength)){_context9.next=87;break}cell=purchaseCellFormat[j];newDynamicCell=document.createElement("TD");cell.id!==""&&newDynamicCell.setAttribute("id",cell.id);newDynamicCell.className="table-cell";newDynamicCell.textContent="";_context9.t0=cell.title;_context9.next=_context9.t0==="Purchase"?46:_context9.t0==="Product"?48:_context9.t0==="Quantity"?50:_context9.t0==="Status"?52:_context9.t0==="NextBill"?68:_context9.t0==="Actions"?70:_context9.t0==="Price"?81:83;break;case 46:newDynamicCell.textContent=purchase.purchaseId;return _context9.abrupt("break",83);case 48:if(purchase.customization&&purchase.customization.length){purchaseId=purchase.purchaseId;generateComboDropDown(newDynamicCell,purchaseId,purchases[purchaseId],true)}else{newDynamicCell.textContent=purchase.product+" "}return _context9.abrupt("break",83);case 50:newDynamicCell.textContent=purchase.currentQty;return _context9.abrupt("break",83);case 52:displayStatus=purchase.status;displayText=displayStatus.charAt(0)+displayStatus.slice(1).toLowerCase();displaySubscriptionStatus=void 0;subscriptionStatus=false;if(+purchase.pauseSchedule){subscriptionStatus=true;displaySubscriptionStatus="pause scheduled for "+purchase.nextBillDate}else if(+purchase.cancellationSchedule){subscriptionStatus=true;displaySubscriptionStatus="cancellation scheduled for "+(purchase.nextBillDate?purchase.nextBillDate:purchase.cancelAfterDate)}_context9.t1=displayStatus;_context9.next=_context9.t1==="INACTIVE"?60:_context9.t1==="RECYCLE_BILLING"?62:_context9.t1==="RECYCLE_FAILED"?62:64;break;case 60:displayStatus="Paused";return _context9.abrupt("break",66);case 62:displayStatus="Declined";return _context9.abrupt("break",66);case 64:displayStatus=displayStatus&&subscriptionStatus?displayText+" ("+displaySubscriptionStatus+")":displayText;return _context9.abrupt("break",66);case 66:newDynamicCell.textContent=displayStatus;return _context9.abrupt("break",83);case 68:newDynamicCell.textContent=+purchase.pauseSchedule||+purchase.cancellationSchedule?"--":purchase.nextBillDate;return _context9.abrupt("break",83);case 70:_context9.t2=purchase.status;_context9.next=_context9.t2==="CANCELLED"?73:_context9.t2==="INACTIVE"?73:_context9.t2==="ACTIVE"?75:_context9.t2==="TRIAL"?75:77;break;case 73:if(reactivateBtn){newDynamicCell.append(createActionBtn(purchase,reactivateBtn))}return _context9.abrupt("break",80);case 75:if(+purchase.pauseSchedule||+purchase.cancellationSchedule){newDynamicCell.append(createActionBtn(purchase,reactivateBtn))}else{if(editBtn&&purchase.status==="ACTIVE"){newDynamicCell.append(createActionBtn(purchase,editBtn))}if(pauseBtn){newDynamicCell.append(createActionBtn(purchase,pauseBtn))}if(cancelBtn){newDynamicCell.append(createActionBtn(purchase,cancelBtn))}}return _context9.abrupt("break",80);case 77:if(pauseBtn){newDynamicCell.append(createActionBtn(purchase,pauseBtn))}if(cancelBtn){newDynamicCell.append(createActionBtn(purchase,cancelBtn))}return _context9.abrupt("break",80);case 80:return _context9.abrupt("break",83);case 81:newDynamicCell.textContent=purchase.price?purchase.currencySymbol+parseFloat(purchase.price).toFixed(2):"N/A";return _context9.abrupt("break",83);case 83:newDynamicPurchaseRow.appendChild(newDynamicCell);case 84:j++;_context9.next=37;break;case 87:newDynamicPurchaseRow.id="fk-dynamic-purchases-row";dynamicPurchasesBody.appendChild(newDynamicPurchaseRow);case 89:_i124++;_context9.next=32;break;case 92:case"end":return _context9.stop();}}},_callee9)}));return _displayPurchasesTable.apply(this,arguments)}function captureLead(_x5){return _captureLead.apply(this,arguments)}function _captureLead(){_captureLead=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(callSync){var currentOrderItems,params,inputs,inputsLength,_i125,input,fullName,pos,_fullName3,_pos3,emailRegex,shipData,orderData,orderItems,index,sessionItemCpId,_productData15,session,leadParams,existingParams,setOrderDetails,_response6;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:getExternalShipping();loadShipProfiles();if(pageData.selectedCampaign&&pageData.selectedCampaign.taxServiceId&&pageData.selectedCampaign.autoTax){currentOrderItems=getOrderItemDetails();getExternalTax(currentOrderItems)}params={};inputs=$("input, select");inputsLength=inputs.length;for(_i125=0;_i125<inputsLength;_i125++){input=inputs[_i125];if(input.name==="fullName"){fullName=input.value.trim();pos=fullName.indexOf(" ");params.firstName=pos>-1?fullName.substring(0,pos):fullName;params.lastName=pos>-1?fullName.substring(pos+1):null}else if(input.name==="shipFullName"){_fullName3=input.value.trim();_pos3=_fullName3.indexOf(" ");params.shipFirstName=_pos3>-1?_fullName3.substring(0,_pos3):_fullName3;params.shipLastName=_pos3>-1?_fullName3.substring(_pos3+1):null}else if(input.type==="checkbox"){if(input.name!=="product"){if(input.name==="doNotSellName"){params[input.name]=input.checked?0:1}else{params[input.name]=input.checked?1:0}}}else if(input.type==="radio"){if(input.checked&&input.name!=="product"){params[input.name]=input.value}}else if(input.name==="phoneNumber"&&phFormatByCountry==="true"){params.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";params.phoneNumber=params.phoneNumber?params.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else if(!input.name.startsWith("custom_item_")){params[input.name]=input.value}}delete params.cardNumber;delete params.cardSecurityCode;delete params.password;if(params.emailAddress){emailRegex=/^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$/i;if(!emailRegex.test(params.emailAddress))params.emailAddress=null}if(params.phoneNumber){params.phoneNumber=phFormatByCountry==="true"?params.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):params.phoneNumber.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}if(params.emailAddress){_context10.next=17;break}if(!((!params.firstName||!params.lastName)&&(!params.shipFirstName||!params.shipLastName))){_context10.next=15;break}return _context10.abrupt("return");case 15:if(!(!params.phoneNumber||params.phoneNumber.length<10)){_context10.next=17;break}return _context10.abrupt("return");case 17:fetchLeadDetails(params);if(params.billShipSame===1&&!params.address1){params.country=null}if(params.billShipSame===1&&!params.shipAddress1){params.shipCountry=null}params.shipProfileId=getCurrentShipProfile();if(params.shipProfileId&&params.shipProfileId.indexOf(":")>0){shipData=params.shipProfileId.split(":");params.shipProfileId=null;params.shipCarrier=shipData[1];params.shipMethod=shipData[3]}orderData=JSON.parse(sessionStorage.getItem("orderData"));if(orderData&&orderData.orderId)params.orderId=orderData.orderId;params.salesUrl=getCurrentWindowLocation().href;params.campaignId=parseInt(pageData.funnelData.campaign);if(!params.custom1)params.custom1=pageData.funnelData.name;if(!params.custom2)params.custom2=pageData.currentPage.title;orderItems=getOrderItems();index=0;for(sessionItemCpId in orderItems){index++;if(sessionItemCpId.indexOf(".")>0){_productData15=sessionItemCpId.split(".");params["product"+index+"_id"]=_productData15[0];params["variant"+index+"_id"]=_productData15[1]}else{params["product"+index+"_id"]=sessionItemCpId}params["product"+index+"_qty"]=orderItems[sessionItemCpId]}session=sessionStorage.getItem("sessionId");session=JSON.parse(session);if(session)params.sessionId=session.message.sessionId;leadParams=JSON.stringify(params);existingParams=sessionStorage.getItem("leadParams");if(!(leadParams!==existingParams)){_context10.next=48;break}setOrderDetails=function setOrderDetails(data){if(data&&data.result==="SUCCESS"){sessionStorage.setItem("orderData",JSON.stringify(data.message));var _orderId5=data.message.orderId;sessionStorage.setItem("orderId",JSON.stringify(_orderId5))}};sessionStorage.setItem("leadParams",leadParams);if(!callSync){_context10.next=46;break}_context10.next=42;return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Lead",leadParams);case 42:_response6=_context10.sent;setOrderDetails(_response6);_context10.next=47;break;case 46:httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Lead",leadParams).then(function(data){setOrderDetails(data)});case 47:if(window.ltk&&params.emailAddress){callLisTrakConversion(window.ltk,"CaptureEmail");callLisTrakConversion(window.ltk,"UpdateCart")}case 48:case"end":return _context10.stop();}}},_callee10)}));return _captureLead.apply(this,arguments)}function showExceptionInPopupValue(){return getAddOnKeyValue(findAddOn("ENABLE_POPUP"))==="true"?true:false}function importLead(buttonId,route){var obj={};if(document.getElementsByName("fullName")[0]){var fullName=document.getElementsByName("fullName")[0].value.trim();var pos=fullName.indexOf(" ");obj.firstName=pos>-1?fullName.substring(0,pos):fullName;obj.lastName=pos>-1?fullName.substring(pos+1):null}else{obj.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;obj.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}obj.companyName=document.getElementsByName("companyName")[0]?document.getElementsByName("companyName")[0].value:null;obj.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;obj.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;obj.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;obj.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;obj.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;obj.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;obj.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){obj.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";obj.phoneNumber=obj.phoneNumber?obj.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{obj.phoneNumber=document.getElementsByName("phoneNumber")[0].value.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}}obj.gender=document.getElementsByName("gender")[0]?document.getElementsByName("gender")[0].value:null;obj.dob=document.getElementsByName("dob")[0]?document.getElementsByName("dob")[0].value:null;obj.shipProfileId=getCurrentShipProfile();if(obj.shipProfileId&&obj.shipProfileId.indexOf(":")>0){var shipData=obj.shipProfileId.split(":");obj.shipProfileId=null;obj.shipCarrier=shipData[1];obj.shipMethod=shipData[3]}obj.custom1=document.getElementsByName("custom1")[0]?document.getElementsByName("custom1")[0].value:null;obj.custom2=document.getElementsByName("custom2")[0]?document.getElementsByName("custom2")[0].value:null;obj.custom3=document.getElementsByName("custom3")[0]?document.getElementsByName("custom3")[0].value:null;obj.custom4=document.getElementsByName("custom4")[0]?document.getElementsByName("custom4")[0].value:null;obj.custom5=document.getElementsByName("custom5")[0]?document.getElementsByName("custom5")[0].value:null;if(!obj.custom1)obj.custom1=pageData.funnelData.name;if(!obj.custom2)obj.custom2=pageData.currentPage.title;if(document.getElementsByName("newPassword")[0]){if(document.getElementsByName("newPassword")[0].value!==document.getElementsByName("confirmPassword")[0].value){enableInteractions();$("#validationMessage").length?$("#validationMessage").show():alert("Passwords do not match");return}$("#validationMessage").hide();obj.eCommercePassword=document.getElementsByName("newPassword")[0].value;obj.eCommerceLogin=obj.emailAddress}var inputs=$("input, select");inputs.each(function(index,input){if(input.name.indexOf("custom_")>=0){if(input.type==="checkbox")obj[input.name]=input.checked?1:0;else if(input.type==="radio"){if(input.checked)obj[input.name]=input.value}else obj[input.name]=input.value}else if(input.type==="checkbox"&&input.name!=="product"){if(input.name==="doNotSellName"){obj[input.name]=input.checked?0:1}else{obj[input.name]=input.checked?1:0}}});var sessionKeys=Object.keys(sessionStorage);sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)obj[key]=sessionStorage.getItem(key)});obj.billShipSame=document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked?1:0;obj.salesUrl=getCurrentWindowLocation().href;obj.campaignId=parseInt(pageData.funnelData.campaign);fetchLeadDetails(obj);//getting variant products
getVariants();var orderItems=getOrderItems();var offer=getOfferFromNavigationItem(buttonId);if(offer){orderItems[offer]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}var index=0;for(var sessionItemCpId in orderItems){index++;if(sessionItemCpId.indexOf(".")>0){var _productData4=sessionItemCpId.split(".");obj["product"+index+"_id"]=_productData4[0];obj["variant"+index+"_id"]=_productData4[1]}else{obj["product"+index+"_id"]=sessionItemCpId}obj["product"+index+"_qty"]=orderItems[sessionItemCpId]}var session=sessionStorage.getItem("sessionId");session=JSON.parse(session);if(session)obj.sessionId=session.message.sessionId;var data=JSON.stringify(obj);sessionStorage.setItem("userDetails",data);var fbEventData={eventID:getUniqueId()};window.fbq&&window.fbq("track","Lead",{},fbEventData),callFBConversion("Lead",fbEventData);if(window.ltk&&obj.emailAddress)callLisTrakConversion(window.ltk,"CaptureEmail");var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Lead",data).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){sessionStorage.setItem("orderData",JSON.stringify(data.message));//setting orderId to be used globally
orderId=data.message.orderId;sessionStorage.setItem("orderId",JSON.stringify(orderId));sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)sessionStorage.removeItem(key)});if(route&&route.includes("__ORDERID__")){route=route.replace("__ORDERID__",orderId)}setCurrentWindowLocation(route)})}else{var tag=document.getElementById("error-"+buttonId);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+buttonId)}else{tag.innerHTML=""}tag.innerHTML=data.message;var color=tag.style.color="red";var pageForm=$("button[data-id='"+buttonId+"']").length?$("button[data-id='"+buttonId+"']"):$("a[data-id='"+buttonId+"']");showExceptionInPopupValue()?alert(data.message.replaceAll(/(<br\/>|<br>|<\/br>)/g,"\n")):$(tag).insertAfter(pageForm);enableInteractions();return result=false}})}var ProductType={"offer":0,"upsell":1};var getCommonReferenceId=function getCommonReferenceId(){try{var _funnelJson,_funnelJson$funnelDat;return(_funnelJson=funnelJson)===null||_funnelJson===void 0?void 0:(_funnelJson$funnelDat=_funnelJson.funnelData.pages.find(function(page){return page.pageView.find(function(pv){return pv.pageType==36})!=null}))===null||_funnelJson$funnelDat===void 0?void 0:_funnelJson$funnelDat.pageView[0].referenceId}catch(er){return null}};var getCommonElements=function getCommonElements(id){var commonReferenceId=getCommonReferenceId();if(commonReferenceId){return funnelJson.elements.find(function(element){return element.pageViewReferenceId===commonReferenceId&&element.elementId===id})}return null};function getNavigationItemFromPageData(buttonId){var _navigation$linkDetai;// {
//     "elementId": "fkt-button-d312fcad-5eae-45f6-9e8d-4db6cd414ce0",
//     "href": "",
//     "status": null,
//     "pageViewReferenceId": "e4c34dc7-be70-4be4-8db7-6588ce552ec6",
//     "linkDetails": [],
//     "products": []
// },
//Use pageData from session if pageData hasn't loaded from ajax before 2 click Paypal upsale processing
var newButtonId=buttonId&&buttonId.split("_prodCol")[0];if(!pageData.navigationItems&&sessionStorage.getItem("paypalUpsalePageData"))pageData=JSON.parse(sessionStorage.getItem("paypalUpsalePageData"));var navigation=pageData.navigationItems.find(function(navItem){return navItem.elementId===newButtonId});if(navigation&&(_navigation$linkDetai=navigation.linkDetails)!==null&&_navigation$linkDetai!==void 0&&_navigation$linkDetai.length){return navigation}return getCommonElements(newButtonId)||navigation}function getProductInfoFromNavigationItem(type,buttonId){var productButton=document.querySelector("[data-id="+buttonId+"]");var productButtonValue=productButton.getAttribute(type);if(productButtonValue&&parseInt(productButtonValue)>0){return productButtonValue}var item=getNavigationItemFromPageData(buttonId);if(item&&item.products&&item.products.length){return item.products[0]}return null}function getOfferFromNavigationItem(buttonId){return getProductInfoFromNavigationItem("offer",buttonId)}function getUpsellFromNavigationItem(buttonId){return getProductInfoFromNavigationItem("upsell",buttonId)}function rolebackSessionProducts(offer){var orderItems=getOrderItems();delete orderItems[offer];sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}function addItemToCustomCart(itemKey,input,offer){var customCart=sessionStorage.getItem("customCart")!==null?JSON.parse(sessionStorage.getItem("customCart")):{};try{var _ret=function(){var customCartLength=Object.keys(customCart).length;var customInputName=input.name.replace("custom_item_","");var productId,customValue,qty;var orderItems=getOrderItems();if(itemKey){productId=itemKey}else{var keys=orderItems&&Object.keys(orderItems).length&&Object.keys(orderItems);productId=!keys&&offer?offer:keys&&keys.length?productId=keys[0]:""}qty=productId&&orderItems[productId]?orderItems[productId]:0;var productExistsInCC=false;var noMatchCount=0;if(customCartLength&&productId){var _loop3=function _loop3(_i41){var customCartValues=customCart[_i41].split("|");var customCartProductId=customCartValues[0];if(customCartProductId==productId){if(!customCart[_i41].includes("|"+customInputName+":")&&input.value){customValue=customInputName+":"+input.value;customCart[_i41]=customCart[_i41].concat("|"+customValue)}else{customCartValues.forEach(function(value,index){var customFieldName=value.split(":")[0];if(customFieldName==customInputName){var _index=customCartValues.indexOf(value);if(!input.value){customCartValues.splice(_index,1)}else{customCartValues[_index]=customInputName+":"+input.value}customCart[_i41]=customCartValues.join("|")}})}}else noMatchCount++};for(var _i41=0;_i41<customCartLength;_i41++){_loop3(_i41)}}else if(productId&&qty){noMatchCount=-1}if(noMatchCount===-1||noMatchCount==customCartLength){customValue=customInputName+":"+input.value;customCart[customCartLength]=productId+"|"+qty+"|"+customValue}return{v:customCart}}();if(_typeof(_ret)==="object")return _ret.v}catch(err){err}}function importOrder(_x6,_x7,_x8){return _importOrder.apply(this,arguments)}function _importOrder(){_importOrder=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(buttonId,route,paypalSdkPrePaidType){var outOfStockProducts,orderId,obj,orderData,paypalSmartButtonSdk,customCart,fullName,pos,preventDefaultCouponRemoval,defaultCouponCode,shipData,cardNonce,offer,buttonElement,buttonVariantValue,quantity,orderItems,orderItemsCopy,_rebillCart2,buttonReplacementValue,itemOfferKey,inputs,sessionKeys,cardDateVal,cardDateValueParsed,month,year,isCardOnFileElementExists,loginCustomer,headers,checkoutResource,squareMerchantAccount,shopPayUrl,baseProductId,multiPayProductId,multiPayRebillsEnabled,multiPayProductMap,_loop26,_productId11,_ret7,shippableOrder,_loop27,sessionItemCpId,index,_sessionItemCpId,_item22,_productData16,customCartLength,_i126,bundleStockParams,firstCCDigit,paayItem,paayInitialData,paayRebillData,session,submitImportOrder,_JSON$parse7,salesTax,shipTotal,googlePayMerchantAccount,amazonName,_pos4,amazonEmail,payment,applePayMerchantAccount,details,merchantInitiatedRebills,fflNumber,_data7,orderItemsForDB,totals,fbObj,fbEventData,tagElements,tag,pageForm,message,_response7;return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:outOfStockProducts=[];orderId=sessionStorage.getItem("orderId");orderId=JSON.parse(orderId);obj={};//If import order is success and customer tries to checkout again just redirect to route
orderData=JSON.parse(sessionStorage.getItem("orderData"));paypalSmartButtonSdk=sessionStorage.getItem("paypalSdk");customCart=sessionStorage.getItem("customCart")!==null?JSON.parse(sessionStorage.getItem("customCart")):null;if(!(!orderData||orderData.orderStatus==="DECLINED"||orderData.orderStatus==="PARTIAL")){_context11.next=279;break}if(document.getElementsByName("fullName")[0]){fullName=document.getElementsByName("fullName")[0].value.trim();pos=fullName.indexOf(" ");obj.firstName=pos>-1?fullName.substring(0,pos):fullName;obj.lastName=pos>-1?fullName.substring(pos+1):null}else{obj.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;obj.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}obj.companyName=document.getElementsByName("companyName")[0]?document.getElementsByName("companyName")[0].value:null;obj.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;obj.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;obj.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;obj.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;obj.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;obj.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;obj.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){obj.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";obj.phoneNumber=obj.phoneNumber?obj.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{obj.phoneNumber=document.getElementsByName("phoneNumber")[0].value.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}}obj.gender=document.getElementsByName("gender")[0]?document.getElementsByName("gender")[0].value:null;obj.dob=document.getElementsByName("dob")[0]?document.getElementsByName("dob")[0].value:null;preventDefaultCouponRemoval=getAddOnKeyValue(findAddOn("PRE_COUPON_REMOVAL"))==="true";defaultCouponCode=pageData.selectedCampaign.defaultCouponCode;if(preventDefaultCouponRemoval&&defaultCouponCode&&!appliedCouponCode.includes(defaultCouponCode)){appliedCouponCode.splice(0,0,defaultCouponCode)}obj.couponCode=appliedCouponCode.length>0?appliedCouponCode.toString():null;obj.shipProfileId=getCurrentShipProfile();if(obj.shipProfileId&&obj.shipProfileId.indexOf(":")>0){obj.externalShipProfileId=obj.shipProfileId;shipData=obj.shipProfileId.split(":");obj.shipProfileId=null;obj.shipCarrier=shipData[1];obj.shipMethod=shipData[3];obj.totalShipping=shipData[2]}obj.achRoutingNumber=document.getElementsByName("achRoutingNumber")[0]?document.getElementsByName("achRoutingNumber")[0].value:null;obj.achAccountNumber=document.getElementsByName("achAccountNumber")[0]?document.getElementsByName("achAccountNumber")[0].value:null;obj.achAccountType=document.getElementsByName("achAccountType")[0]?document.getElementsByName("achAccountType")[0].value:null;obj.iban=document.getElementsByName("iban")[0]?document.getElementsByName("iban")[0].value:null;cardNonce=document.getElementById("formCardNonce");if(cardNonce&&cardNonce.value!="")obj.formCardNonce=cardNonce.value;obj.custom1=document.getElementsByName("custom1")[0]?document.getElementsByName("custom1")[0].value:null;obj.custom2=document.getElementsByName("custom2")[0]?document.getElementsByName("custom2")[0].value:null;obj.custom3=document.getElementsByName("custom3")[0]?document.getElementsByName("custom3")[0].value:null;obj.custom4=document.getElementsByName("custom4")[0]?document.getElementsByName("custom4")[0].value:null;obj.custom5=document.getElementsByName("custom5")[0]?document.getElementsByName("custom5")[0].value:null;if(!obj.custom1)obj.custom1=pageData.funnelData.name;if(!obj.custom2)obj.custom2=pageData.currentPage.title;//Parameters that might be needed for native 3DS
if(route.indexOf("V1/SplitTest/funnel/")>0)obj.redirectsTo=route;else if(checkDomainForRoute())obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+pageData.funnelData.referenceId+"/"+route;else obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+route;obj.errorRedirectsTo=getCurrentWindowLocation().toString();obj.browserData=JSON.stringify(browserData);if(document.getElementsByName("billShipSame")[0]){obj.billShipSame=document.getElementsByName("billShipSame")[0].checked?1:0}else if(document.getElementsByName("address1")[0]&&!document.getElementsByName("shipAddress1")[0]){obj.billShipSame=1}obj.salesUrl=getCurrentWindowLocation().href;obj.cartId=sessionStorage.getItem("cartId");obj.campaignId=parseInt(pageData.funnelData.campaign);offer=getOfferFromNavigationItem(buttonId);buttonElement=document.querySelector("[data-id="+buttonId+"]");buttonVariantValue=buttonElement.getAttribute("variantvalue");quantity=buttonElement.getAttribute("quantity");//getting variant products
getVariants();orderItems=getOrderItems();orderItemsCopy=JSON.parse(JSON.stringify(orderItems));_rebillCart2=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):null;if(offer){buttonReplacementValue=buttonElement.getAttribute("replaceproductid");if(Object.keys(orderItems).length===0&&document.getElementsByName("price")[0]&&!buttonVariantValue){obj.product1_id=offer;obj.product1_qty=getQuantity();obj.product1_price=document.getElementsByName("price")[0].value}else if(buttonVariantValue){itemOfferKey=offer+"."+buttonVariantValue;orderItems[itemOfferKey]=quantity?quantity:getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}else if(buttonReplacementValue&&buttonReplacementValue.toLowerCase()!=="none"&&orderItems[buttonReplacementValue]){orderItems[offer]=orderItems[buttonReplacementValue];delete orderItems[buttonReplacementValue];sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}else{orderItems[offer]=quantity?quantity:getQuantity();updateReplacementProducts(orderItems);//remove the button product?
sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}}inputs=$("input, select");inputs.each(function(index,input){if(input.name.startsWith("custom_item_")){var section=$(input).closest("section.fk-product-section");customCart=!section.length&&input.value?addItemToCustomCart(0,input,offer):customCart;customCart&&Object.keys(customCart).length&&sessionStorage.setItem("customCart",JSON.stringify(customCart))}else if(input.name.startsWith("custom_")){if(input.type==="checkbox")obj[input.name]=input.checked?1:0;else if(input.type==="radio"){if(input.checked)obj[input.name]=input.value}else obj[input.name]=input.value}else if(input.type==="checkbox"&&input.name!=="product"&&input.name!=="shipProfileId"){if(input.name==="doNotSellName"){obj[input.name]=input.checked?0:1}else{obj[input.name]=input.checked?1:0}}});sessionKeys=Object.keys(sessionStorage);sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)obj[key]=sessionStorage.getItem(key)});if(orderId){obj.orderId=orderId}fetchLeadDetails(obj);if(getInputValue("cardNumber")){obj.cardNumber=getInputValue("cardNumber").replace(/-/g,"").replace(/ /g,"")}cardDateVal=getInputValue("cardDate")?getInputValue("cardDate"):"";cardDateValueParsed=cardDateVal.replace("/","");if(cardDateValueParsed){month=cardDateValueParsed.substring(0,2);year=cardDateValueParsed.substr(cardDateValueParsed.length-2);obj.cardMonth=getInputValue("cardMonth")?parseInt(getInputValue("cardMonth")):parseInt(month)||null;obj.cardYear=getInputValue("cardYear")?parseInt(getInputValue("cardYear")):parseInt(year)||null}else{obj.cardMonth=getInputValue("cardMonth")?parseInt(getInputValue("cardMonth")):null;obj.cardYear=getInputValue("cardYear")?parseInt(getInputValue("cardYear")):null}obj.cardSecurityCode=getInputValue("cardSecurityCode");isCardOnFileElementExists=document.getElementById("acctOnFile");loginCustomer=null;headers=null;checkoutResource="Order";obj.paySource=sessionStorage.getItem("paySource")!==null?sessionStorage.getItem("paySource"):"CREDITCARD";if(isCardOnFileElementExists&&isCardOnFileElementExists.checked===true&&(obj.paySource==="CREDITCARD"||obj.paySource==="ACCTONFILE")||obj.cardNumber==null&&obj.paySource==="CREDITCARD"){obj.cardMonth="";obj.cardYear="";obj.cardNumber="";obj.cardSecurityCode="";loginCustomer=JSON.parse(sessionStorage.getItem("loginCustomer"));if(cookieData["access_token"]){checkoutResource="MemberOrder";headers=getMembershipHeaders();sessionStorage.setItem("paySource","ACCTONFILE");obj.paySource="ACCTONFILE"}}if(prepaidGateways.includes(obj.paySource)){obj.prepaidType=obj.paySource;obj.paySource="PREPAID"}if(obj.prepaidType==="WITHREACH_PAYPAL"){obj.forceMerchantId=parseInt(getAddOnKeyValue(findAddOn("Paypal_billerId")))}if(!(obj.paySource==="CREDITCARD"||obj.paySource==="ACCTONFILE")){_context11.next=78;break}obj.forceMerchantId=document.getElementsByName("forceMerchantId")[0]?getInputValue("forceMerchantId"):null;_context11.next=164;break;case 78:if(!(obj.paySource==="AFFIRM")){_context11.next=84;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref10){var keyName=_ref10.keyName;return keyName==="Affirm_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="AFFIRM";_context11.next=164;break;case 84:if(!(obj.paySource==="KLARNA")){_context11.next=90;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref11){var keyName=_ref11.keyName;return keyName==="Klarna_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="KLARNA";_context11.next=164;break;case 90:if(!(obj.paySource==="SEZZLE")){_context11.next=96;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref12){var keyName=_ref12.keyName;return keyName==="Sezzle_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="SEZZLE";_context11.next=164;break;case 96:if(!(obj.paySource==="AFTERPAY")){_context11.next=102;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref13){var keyName=_ref13.keyName;return keyName==="Afterpay_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="AFTERPAY";_context11.next=164;break;case 102:if(!(obj.paySource==="BANCONTACT")){_context11.next=108;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref14){var keyName=_ref14.keyName;return keyName==="Bancontact_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="BANCONTACT";_context11.next=164;break;case 108:if(!(obj.paySource==="IDEAL")){_context11.next=114;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref15){var keyName=_ref15.keyName;return keyName==="iDEAL_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="IDEAL";_context11.next=164;break;case 114:if(!(obj.paySource==="GIROPAY")){_context11.next=120;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref16){var keyName=_ref16.keyName;return keyName==="Giropay_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="GIROPAY";_context11.next=164;break;case 120:if(!(obj.paySource==="SOFORT")){_context11.next=126;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref17){var keyName=_ref17.keyName;return keyName==="Sofort_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="SOFORT";_context11.next=164;break;case 126:if(!(obj.paySource==="P24")){_context11.next=132;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref18){var keyName=_ref18.keyName;return keyName==="P24_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="P24";_context11.next=164;break;case 132:if(!(obj.paySource==="BOLETO")){_context11.next=138;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref19){var keyName=_ref19.keyName;return keyName==="Boleto_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="BOLETO";_context11.next=164;break;case 138:if(!(obj.paySource==="PIX")){_context11.next=144;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref20){var keyName=_ref20.keyName;return keyName==="PIX_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="PIX";_context11.next=164;break;case 144:if(!(obj.paySource==="SEPA_DEBIT")){_context11.next=150;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref21){var keyName=_ref21.keyName;return keyName==="SEPA_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="SEPA_DEBIT";_context11.next=164;break;case 150:if(!(obj.paySource==="SQUAREV2")){_context11.next=157;break}squareMerchantAccount=getAddOnKeyValue(findAddOn("squareBillerId"));if(squareMerchantAccount!==""){obj.forceMerchantId=squareMerchantAccount}obj.paySource="PREPAID";obj.prepaidType="SQUAREV2";_context11.next=164;break;case 157:if(!(obj.paySource==="SHOPPAY")){_context11.next=163;break}shopPayUrl=getShopPayCheckoutUrl(orderItems);if(shopPayUrl){setCurrentWindowLocation(shopPayUrl)}else{enableInteractions()}return _context11.abrupt("return");case 163:if(obj.paySource==="BITPAY"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref22){var keyName=_ref22.keyName;return keyName==="BitPay_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="BITPAY"}case 164:if(!obj.prepaidType){_context11.next=187;break}if(!(sessionStorage.getItem("multiPayProductId")&&sessionStorage.getItem("multiPayBaseProductId"))){_context11.next=172;break}baseProductId=sessionStorage.getItem("multiPayBaseProductId");multiPayProductId=sessionStorage.getItem("multiPayProductId");if(orderItems[baseProductId]){orderItems[multiPayProductId]=orderItems[baseProductId];delete orderItems[baseProductId];sessionStorage.setItem("fkCart",JSON.stringify(orderItems));captureLead()}if(sessionStorage.getItem("multiPayRebillProductId"))obj.redirectsTo=obj.errorRedirectsTo;_context11.next=187;break;case 172:if(!multiPayRebillGateways.includes(obj.prepaidType)){_context11.next=187;break}multiPayRebillsEnabled=getAddOnKeyValue(findAddOn("multiPayRebills"));if(!multiPayRebillsEnabled){_context11.next=187;break}multiPayProductMap=getAddOnKeyValue(findAddOn("multiPayProducts"));if(!multiPayProductMap){_context11.next=187;break}multiPayProductMap=JSON.parse(multiPayProductMap);_loop26=function _loop26(_productId11){var multiPayRebillMapping=multiPayProductMap.find(function(_ref23){var baseProductId=_ref23.baseProductId;return baseProductId===_productId11.toString()});if(multiPayRebillMapping){sessionStorage.setItem("multiPayRoute",route);if(checkRequiredInputs()){sessionStorage.setItem("multiPayButtonId",buttonId);sessionStorage.setItem("multiPayBaseProductId",multiPayRebillMapping.baseProductId);sessionStorage.setItem("multiPayProductId",multiPayRebillMapping.multiPayProductId);sessionStorage.setItem("multiPayRebillProductId",multiPayRebillMapping.rebillProductId);sessionStorage.setItem("multiPayCode",obj.cardSecurityCode);validateCard()}else{sessionStorage.removeItem("multiPayRoute");enableInteractions()}return{v:void 0}}};_context11.t0=_regeneratorRuntime().keys(orderItems);case 180:if((_context11.t1=_context11.t0()).done){_context11.next=187;break}_productId11=_context11.t1.value;_ret7=_loop26(_productId11);if(!(_typeof(_ret7)==="object")){_context11.next=185;break}return _context11.abrupt("return",_ret7.v);case 185:_context11.next=180;break;case 187:shippableOrder=false;_loop27=function _loop27(sessionItemCpId){var productDetails=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId.split(".")[0])});if(Object.keys(productDetails).length>0){shippableOrder=productDetails[0].cycle1_isShippable?true:shippableOrder}};for(sessionItemCpId in orderItems){_loop27(sessionItemCpId)}index=0;for(_sessionItemCpId in orderItems){index++;_item22=void 0;if(_sessionItemCpId.indexOf(".")>0){_productData16=_sessionItemCpId.split(".");_item22=verifyStock&&getOutStockedVariant(_productData16,"","","",orderItems[_sessionItemCpId]);obj["product"+index+"_id"]=_productData16[0];obj["variant"+index+"_id"]=_productData16[1]}else{_item22=verifyStock&&getOutStockedProduct(_sessionItemCpId,orderItems[_sessionItemCpId]);obj["product"+index+"_id"]=_sessionItemCpId}_item22&&_item22.length>0&&outOfStockProducts.push(_item22);obj["product"+index+"_qty"]=orderItems[_sessionItemCpId];if($("input[type=checkbox][freeshipping=true]").is(":checked")||!shippableOrder){obj["product"+index+"_shipPrice"]=0;obj.totalShipping=0}if(_rebillCart2&&_rebillCart2[_sessionItemCpId])obj["product"+index+"_recur"]=_rebillCart2[_sessionItemCpId];if(altValues[_sessionItemCpId+"|"+orderItems[_sessionItemCpId]])obj["product"+index+"_alt"]=getItemAlt(_sessionItemCpId,orderItems[_sessionItemCpId])}if(customCart){customCartLength=Object.keys(customCart).length;for(_i126=0;_i126<customCartLength;_i126++){obj["product_custom"+(_i126+1)]=customCart[_i126]}}bundleStockParams=getBundleVariants(obj,index);obj=bundleStockParams.params;outOfStockProducts=outOfStockProducts.concat(bundleStockParams.outOfStockBundleVariants);if(!(obj.paySource!=="GOOGLEPAY")){_context11.next=200;break}calculateTotals();_context11.next=202;break;case 200:_context11.next=202;return calculateTotals();case 202:if(!(sessionStorage.getItem("paayEnabled")!==null&&sessionStorage.getItem("paayCompleted")===null&&obj.paySource==="CREDITCARD"&&sessionStorage.getItem("paay_page_option")!=="1"&&obj.cardNumber!==null&&Object.keys(orderItems).length>0)){_context11.next=214;break}firstCCDigit=obj&&obj.cardNumber&&obj.cardNumber.charAt(0);if(!(firstCCDigit!=="3"&&firstCCDigit!=="6")){_context11.next=213;break}sessionStorage.setItem("paay_buttonId",buttonId);sessionStorage.setItem("paay_route",route);paayItem=offer?offer:Object.keys(orderItems)[0];sessionStorage.setItem("paay_item",paayItem);triggerPAAY();return _context11.abrupt("return");case 213:sessionStorage.removeItem("paayEnabled");case 214:paayInitialData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayInitialData")!==null?JSON.parse(sessionStorage.getItem("paayInitialData")):null;paayRebillData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayRebillData")!==null?JSON.parse(sessionStorage.getItem("paayRebillData")):null;if(sessionStorage.getItem("paayInitialAsRebill")==="1"){obj.rebill_eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.rebill_cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.rebill_xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null}else{obj.eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null;obj.rebill_eci=paayRebillData&&paayRebillData.eci?paayRebillData.eci:document.getElementsByName("rebill_eci")[0]?document.getElementsByName("rebill_eci")[0].value:null;obj.rebill_cavv=paayRebillData&&paayRebillData.authenticationValue?paayRebillData.authenticationValue:document.getElementsByName("rebill_authenticationValue")[0]?document.getElementsByName("rebill_authenticationValue")[0].value:document.getElementsByName("rebill_cavv")[0]?document.getElementsByName("rebill_cavv")[0].value:null;obj.rebill_xid=paayRebillData&&paayRebillData.dsTransId?paayRebillData.dsTransId:document.getElementsByName("rebill_dsTransId")[0]?document.getElementsByName("rebill_dsTransId")[0].value:document.getElementsByName("rebill_xid")[0]?document.getElementsByName("rebill_xid")[0].value:null}if(obj.paySource==="CREDITCARD"&&sessionStorage.getItem("paayEnabled")!==null&&(obj.eci!==null||sessionStorage.getItem("paay_page_option")==="1")){sessionStorage.setItem("paay_pan",obj.cardNumber);sessionStorage.setItem("paay_month",obj.cardMonth);sessionStorage.setItem("paay_year",obj.cardYear)}session=sessionStorage.getItem("sessionId");session=JSON.parse(session);if(session){obj.sessionId=session.message.sessionId}submitImportOrder=true;if(!(obj.paySource==="PAYPAL")){_context11.next=234;break}captureLead();_JSON$parse7=JSON.parse(sessionStorage.getItem("totals")),salesTax=_JSON$parse7.salesTax,shipTotal=_JSON$parse7.shipTotal;obj.salesTax=salesTax?salesTax.toString():"0.00";obj.totalShipping=shipTotal?shipTotal.toString():"0.00";obj.paypalBillerId=parseInt(pageData.funnelData.addOns.find(function(_ref24){var keyName=_ref24.keyName;return keyName==="Paypal_billerId"}).keyValue);if(document.getElementsByName("paypalClientMetadataId")[0]){obj.paypalClientMetadataId=document.getElementsByName("paypalClientMetadataId")[0].value;sessionStorage.setItem("paypalClientMetadataId",obj.paypalClientMetadataId)}sessionStorage.setItem("paypalSuccessRoute",route);sessionStorage.setItem("paypalCart",JSON.stringify(orderItems));sessionStorage.setItem("paypalButtonId",buttonId);_context11.next=246;break;case 234:if(!(obj.paySource==="GOOGLEPAY")){_context11.next=245;break}googlePayMerchantAccount=getAddOnKeyValue(findAddOn("GPay_Merchant_Acc"));if(googlePayMerchantAccount!==""){obj.forceMerchantId=googlePayMerchantAccount}googlePaymentDataRequest=getGooglePaymentDataRequest();googlePaymentDataRequest.transactionInfo=getGoogleTransactionInfo();addGooglePaymentSheetShippingCostIncluded(googlePaymentDataRequest);googlePaymentsClient=getGooglePaymentsClient();_context11.next=243;return googlePaymentsClient.loadPaymentData(googlePaymentDataRequest).then(function(response){var shippingAddress=response.shippingAddress;shippingAddress&&fillInShipAddressGPay(obj,shippingAddress);var email=response.emailAddress||response.email;if(email){obj.emailAddress=email;fillInInputIfExists("emailAddress",email)}var phoneNumber=shippingAddress&&shippingAddress.phoneNumber||response.phoneNumber;if(phoneNumber){obj.phoneNumber=phoneNumber;fillInInputIfExists("phoneNumber",phoneNumber)}obj.googlePayToken=response.paymentMethodData.tokenizationData.token})["catch"](function(err){sessionStorage.removeItem("paySource");offer&&rolebackSessionProducts(offer);displayPrices();enableInteractions();submitImportOrder=false});case 243:_context11.next=246;break;case 245:if(obj.paySource==="AMAZON"){obj.amazonBillerId=parseInt(sessionStorage.getItem("amazonBillerId"));obj.amazonOrderId=sessionStorage.getItem("amazonOrderId");obj.amazonAddressConsent=sessionStorage.getItem("amazonAccessToken");amazonName=sessionStorage.getItem("amazonName");if(amazonName){_pos4=amazonName.indexOf(" ");if(!obj.firstName)obj.firstName=_pos4>-1?amazonName.substring(0,_pos4):amazonName;if(!obj.lastName)obj.lastName=_pos4>-1?amazonName.substring(_pos4+1):null}amazonEmail=sessionStorage.getItem("amazonEmail");if(amazonEmail&&!obj.emailAddress)obj.emailAddress=amazonEmail}else if(obj.paySource==="APPLEPAY"){payment=JSON.parse(sessionStorage.getItem("applePayPayment"));//payment.shippingContact - shipping address
setAppleAddress(payment.shippingContact,"shipping",obj);//payment.billingContact - billing address
setAppleAddress(payment.billingContact,"billing",obj);obj.applePayToken=sessionStorage.getItem("applePayToken");applePayMerchantAccount=getAddOnKeyValue(findAddOn("applePayBillerId"));if(applePayMerchantAccount!==""){obj.forceMerchantId=applePayMerchantAccount}if(obj.address1&&obj.shipAddress1){obj.billShipSame=0}}case 246:obj.insureShipment=document.getElementsByName("insureShipment")[0]?document.getElementsByName("insureShipment")[0].checked:0;obj.insureShipment=obj.insureShipment===true?1:0;obj.shipmentInsurancePrice=document.getElementById("shipmentInsurancePrice")?document.getElementById("shipmentInsurancePrice").value:"";details=JSON.parse(JSON.stringify(obj));delete details.cardNumber;delete details.cardSecurityCode;sessionStorage.setItem("userDetails",JSON.stringify(details));merchantInitiatedRebills=getAddOnKeyValue(findAddOn("Merchant_Rebills"));if(merchantInitiatedRebills==="1"){obj.merchantInitiated=merchantInitiatedRebills;obj.funnelReferenceId=pageData.funnelData.referenceId}if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){obj.paypalSdk=true;if(paypalSdkPrePaidType){obj.prepaidType=paypalSdkPrePaidType}}obj.currencyCode=returnCurrencyCode();fflNumber=sessionStorage.getItem("fflNumber");if(fflNumber&&pageData.pageTypeId===4&&checkFFLProductsInCart()){obj["custom_order_fflNumber"]=fflNumber;if(document.getElementsByName("fflSplit")[0]&&document.getElementsByName("fflSplit")[0].checked===false)obj["custom_order_fflSplit"]=1}_data7=JSON.stringify(obj);if(obj.cardNumber&&window.fbq){orderItemsForDB=[];Object.keys(orderItemsCopy).forEach(function(key){orderItemsForDB.push({id:key.split(".")[0].toString(),quantity:parseInt(orderItemsCopy[key])})});totals=JSON.parse(sessionStorage.getItem("totals"));fbObj={contents:orderItemsForDB,currency:pageData.selectedCampaign.currency,value:totals.grandTotal};fbEventData={eventID:getUniqueId()};window.fbq("track","AddPaymentInfo",fbObj);callFBConversion("AddPaymentInfo",_objectSpread(_objectSpread({},fbObj),fbEventData))}confirmOptIn();if(submitImportOrder){window.clearInterval(captureLeadInterval)}if(!(outOfStockProducts.length>0&&verifyStock)){_context11.next=275;break}tagElements=generateErrorTag(buttonId,paypalSmartButtonSdk);tag=tagElements.tag;pageForm=tagElements.pageForm;outOfStockProducts=outOfStockProducts.join("<br>");message="Products are out of stock: <br>"+outOfStockProducts;tag.innerHTML=message;showExceptionInPopupValue()?alert(message.replaceAll(/(<br\/>|<br>|<\/br>)/g,"\n")):$(tag).insertAfter(pageForm);obj.paySource==="PAYPAL"&&clearCCPayPalSessionData();enableInteractions();_context11.next=277;break;case 275:_response7=submitImportOrder&&httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/"+checkoutResource,_data7,headers).then(function(data){if(data.result==="SUCCESS"){//if paySource === "PAYPAL" -> redirect to paypalURL
if(data.message.paypalUrl&&paypalSmartButtonSdk!=="true"){setCurrentWindowLocation(data.message.paypalUrl);return}if(data.message.paypalSdkParams){sessionStorage.setItem("paypalSmartButton",true);return data}registerClick(1,function(regClickData){var salesProduct=[];sessionStorage.setItem("orderData",JSON.stringify(data.message));orderId=data.message.orderId;salesProduct.push(data.message.items);sessionStorage.setItem("orderId",JSON.stringify(orderId));sessionStorage.setItem("products",JSON.stringify(salesProduct[0]));sessionStorage.setItem("importOrderSuccess",true);pageData.funnelData.GA_MEASUREMENT_ID?sessionStorage.setItem("importOrderSuccessGA",true):"";pageData.funnelData.snapchatPixelID?sessionStorage.setItem("importOrderSuccessSC",true):"";sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)sessionStorage.removeItem(key)});sessionStorage.removeItem("cartId");sessionStorage.removeItem("currentItem");if(sessionStorage.getItem("applePayToken")&&window.session){var update={status:ApplePaySession.STATUS_SUCCESS};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}if(route&&route.includes("__ORDERID__")){route=route.replace("__ORDERID__",orderId)}if(loginCustomer)orderQuery();setCurrentWindowLocation(route)})}else{sessionStorage.removeItem("paay_pan");sessionStorage.removeItem("paay_month");sessionStorage.removeItem("paay_year");//handle merchant redirect for native 3DS
if(data.result==="MERC_REDIRECT"){sessionStorage.setItem("merchantRedirectfkCart",JSON.stringify(orderItemsCopy||{}));sessionStorage.setItem("cc3dsPageSubmitDetails",JSON.stringify({pageTypeId:pageData.pageTypeId,referenceId:pageData.currentPage.referenceId}));if(data.message&&data.message.url){setCurrentWindowLocation(data.message.url)}else if(data.message&&data.message.script){eval(data.message.script)}return false}offer&&rolebackSessionProducts(offer);sessionStorage.removeItem("paySource");if(sessionStorage.getItem("applePayToken")&&window.session){var update={status:ApplePaySession.STATUS_FAILURE};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}var handleErrors=function handleErrors(data,buttonId){var showExceptionInPopup=showExceptionInPopupValue();var _data$message=data.message,message=_data$message===void 0?"":_data$message;var messageInLC=message.toLowerCase();var handleErrorMessage=document.getElementById("error-"+buttonId);// Handle handleErrorMessage element
if(!handleErrorMessage){handleErrorMessage=document.createElement("p");handleErrorMessage.setAttribute("id","error-"+buttonId)}else{handleErrorMessage.innerHTML=""}function handleErrorElement(element){handleErrorMessage.innerHTML=message;var color=handleErrorMessage.style.color="red";var pageForm=document.getElementsByName(element);if(pageForm&&pageForm.length>0){pageForm[0].style.outline="red solid 1px";!showExceptionInPopup&&$(handleErrorMessage).insertAfter(pageForm);$(pageForm[0]).focus();return true}return false}// Show error message next to button AND next to input
var handleButtonMessage=document.getElementById("error-"+buttonId+"x");if(!handleButtonMessage){handleButtonMessage=document.createElement("p");handleButtonMessage.setAttribute("id","error-"+buttonId+"x")}else{handleButtonMessage.innerHTML=""}handleButtonMessage.innerHTML=message;var color=handleButtonMessage.style.color="red";var actionBtn=$("button[data-id='"+buttonId+"']").length?$("button[data-id='"+buttonId+"']"):$("a[data-id='"+buttonId+"']");if(paypalSmartButtonSdk==="true"&&!actionBtn.length){actionBtn=$("div[data-id='"+buttonId+"']")}if(actionBtn&&actionBtn.length&&$(".fk-popup").find(actionBtn[0]).length){var popup=$(actionBtn[0]).closest(".fk-popup");var id=popup.attr("id");hidePopUpBlock(id);actionBtn=$("[openpopup='"+id+"']");actionBtn=actionBtn.length?actionBtn:$("[action=openPopup]")[0]}showExceptionInPopup?alert(message.replaceAll(/(<br\/>|<br>|<\/br>)/g,"\n")):$(handleButtonMessage).insertAfter(actionBtn);if(messageInLC.includes("date")||messageInLC.includes("month")||messageInLC.includes("year")){// Display message inside date
if(handleErrorElement("cardDate")||handleErrorElement("cardMonth")||handleErrorElement("cardYear"))return}// Display a message below the card number
if(messageInLC.includes("card")&&handleErrorElement("cardNumber")){return}//Check for security errors
var hasSecurityError=["cvv","cvc","security"].some(function(input){return messageInLC.includes(input)});// Display error inside cardSecurityCode
if(hasSecurityError&&handleErrorElement("cardSecurityCode")){return}if(messageInLC.includes("emailaddress")&&handleErrorElement("emailAddress")){return}};if(data.result==="ERROR"){handleErrors(data,buttonId)}enableInteractions();return result=false}});return _context11.abrupt("return",_response7);case 277:_context11.next=280;break;case 279:if(paypalSmartButtonSdk!=="true"){setCurrentWindowLocation(route)}case 280:case"end":return _context11.stop();}}},_callee11)}));return _importOrder.apply(this,arguments)}function hidePopUpBlock(popupId){var popupBlock=document.getElementById(popupId||"customizable_popup");if(popupBlock){popupBlock.style.display="none"}}function clearCCPayPalSessionData(){sessionStorage.removeItem("paySource");sessionStorage.removeItem("paypalSuccessRoute");sessionStorage.removeItem("paypalSdk");sessionStorage.removeItem("paypalButtonId");var pageTypeId=pageData&&pageData.pageTypeId;if(pageTypeId===4){sessionStorage.removeItem("paypalCart");sessionStorage.removeItem("paypalSmartButton")}else if(pageTypeId===3){sessionStorage.removeItem("paypalUpsaleSuccessRoute");sessionStorage.removeItem("paypalUpsalePageData");sessionStorage.removeItem("paypalUpsaleCart");sessionStorage.removeItem("upsalefkCart")}}function confirmPaypal(token,payerID,baToken,paypalPrePaidType){//2 click Paypal upsells
var upsaleRoute=sessionStorage.getItem("paypalUpsaleSuccessRoute");var buttonId=sessionStorage.getItem("paypalButtonId");if(upsaleRoute&&buttonId){sessionStorage.setItem("upsalePaypalToken",token);sessionStorage.setItem("upsalePaypalPayerId",payerID);importUpsale(buttonId,upsaleRoute);return}var funnelData=JSON.parse(sessionStorage.getItem("funnelData"));data={};data.token=token;data.payerId=payerID;data.baToken=baToken;data.orderId=JSON.parse(sessionStorage.getItem("orderId"));var session=sessionStorage.getItem("sessionId");session=JSON.parse(session);if(session){data.sessionId=session.message.sessionId}var fkCart=JSON.parse(sessionStorage.getItem("paypalCart"));var rebillCart=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):null;var index=0;var customerDetails=JSON.parse(sessionStorage.getItem("userDetails"));var totalShipping=customerDetails.totalShipping?parseInt(customerDetails.totalShipping):"";for(var sessionItemCpId in fkCart){index++;if(sessionItemCpId.indexOf(".")>0){var _productData5=sessionItemCpId.split(".");data["product"+index+"_id"]=_productData5[0];data["variant"+index+"_id"]=_productData5[1]}else{data["product"+index+"_id"]=sessionItemCpId}data["product"+index+"_qty"]=fkCart[sessionItemCpId];if($("input[type=checkbox][freeshipping=true]").is(":checked")||totalShipping===0){data["product"+index+"_shipPrice"]=0;data.totalShipping=0}if(rebillCart&&rebillCart[sessionItemCpId])data["product"+index+"_recur"]=rebillCart[sessionItemCpId];if(altValues[sessionItemCpId+"|"+fkCart[sessionItemCpId]])data["product"+index+"_alt"]=getItemAlt(sessionItemCpId,fkCart[sessionItemCpId])}if(customCart){var customCartLength=Object.keys(customCart).length;for(var _i42=0;_i42<customCartLength;_i42++){data["product_custom"+(_i42+1)]=customCart[_i42]}}data=getBundleVariants(data,index).params;data.cartId=sessionStorage.getItem("cartId");data.campaignId=parseInt(funnelData.campaign);data.paypalBillerId=parseInt(funnelData.addOns.find(function(_ref5){var keyName=_ref5.keyName;return keyName==="Paypal_billerId"}).keyValue);data.paypalClientMetadataId=sessionStorage.getItem("paypalClientMetadataId");if(customerDetails.couponCode)data.couponCode=customerDetails.couponCode;data.shipProfileId=customerDetails.shipProfileId;if(customerDetails.externalShipProfileId){var shipData=customerDetails.externalShipProfileId.split(":");data.shipProfileId=null;data.shipCarrier=shipData[1];data.shipMethod=shipData[3];data.totalShipping=shipData[2]}data.custom1=customerDetails.custom1;data.custom2=customerDetails.custom2;data.custom3=customerDetails.custom3;data.custom4=customerDetails.custom4;data.custom5=customerDetails.custom5;data.emailAddress=customerDetails.emailAddress;data.phoneNumber=customerDetails.phoneNumber;data.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;var paypalSmartButtonSdk=sessionStorage.getItem("paypalSdk");if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){data.paypalSdk=true;if(paypalPrePaidType){data.prepaidType=paypalPrePaidType}}var customerDetailsKeys=Object.keys(customerDetails);customerDetailsKeys.forEach(function(key){if(key.indexOf("custom_")===0)data[key]=customerDetails[key]});data=JSON.stringify(data);showOverlayEffect();var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Paypal",data).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){sessionStorage.setItem("orderData",JSON.stringify(data.message));sessionStorage.setItem("orderId",JSON.stringify(data.message.orderId));sessionStorage.setItem("importOrderSuccess",true);pageData.funnelData.GA_MEASUREMENT_ID?sessionStorage.setItem("importOrderSuccessGA",true):"";pageData.funnelData.snapchatPixelID?sessionStorage.setItem("importOrderSuccessSC",true):"";sessionStorage.removeItem("cartId");sessionStorage.removeItem("currentItem");var route=sessionStorage.getItem("paypalSuccessRoute");if(route&&route.includes("__ORDERID__")){route=route.replace("__ORDERID__",data.message.orderId)}replaceCurrentWindow(route)})}else{hideOverlayEffect();sessionStorage.removeItem("paySource");var tag=document.getElementById("error-paypal");if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-paypal")}else{tag.innerHTML=""}var _buttonId=sessionStorage.getItem("paypalButtonId");var payPalButton=$("button[data-id='"+_buttonId+"']").length?$("button[data-id='"+_buttonId+"']"):$("a[data-id='"+_buttonId+"']");var pageForm=payPalButton&&payPalButton[0]&&$(payPalButton[0]).closest("div");tag.innerHTML="Error Processing PayPal Payment: "+data.message;var color=tag.style.color="red";$(tag).insertAfter(pageForm);clearCCPayPalSessionData();enableInteractions()}sessionStorage.removeItem("paypalSdk")})}function validateCard(){var params={};params.orderId=sessionStorage.getItem("orderId")?JSON.parse(sessionStorage.getItem("orderId")):null;if(!params.orderId){captureLead();validateCard();return}params.cardNumber=getInputValue("cardNumber");if(!params.orderId||!params.cardNumber)return false;else params.cardNumber=params.cardNumber.replace(/-/g,"").replace(/ /g,"");params.campaignId=pageData.selectedCampaign.campaignId;params.paySource="CREDITCARD";var cardDateVal=getInputValue("cardDate")?getInputValue("cardDate"):"";var cardDateValueParsed=cardDateVal.replace("/","");if(cardDateValueParsed){var month=cardDateValueParsed.substring(0,2);var year=cardDateValueParsed.substr(cardDateValueParsed.length-2);params.cardMonth=parseInt(month)||null;params.cardYear=parseInt(year)||null}else{params.cardMonth=getInputValue("cardMonth");params.cardYear=getInputValue("cardYear")}if(document.getElementsByName("fullName")[0]){var fullName=document.getElementsByName("fullName")[0].value.trim();var pos=fullName.indexOf(" ");params.firstName=pos>-1?fullName.substring(0,pos):fullName;params.lastName=pos>-1?fullName.substring(pos+1):null}else{params.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;params.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}params.companyName=document.getElementsByName("companyName")[0]?document.getElementsByName("companyName")[0].value:null;params.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;params.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;params.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;params.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;params.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;params.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;params.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){params.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";params.phoneNumber=params.phoneNumber?params.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{params.phoneNumber=document.getElementsByName("phoneNumber")[0].value.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}}var data=JSON.stringify(params);var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Preauth",data).then(function(data){var multiPayButtonId=sessionStorage.getItem("multiPayButtonId");if(data.result&&(data.result==="SUCCESS"||data.message=="Card is already preauthorized")){sessionStorage.setItem("cardValidated",true);var multiPayRoute=sessionStorage.getItem("multiPayRoute");if(multiPayButtonId&&multiPayRoute){importOrder(multiPayButtonId,multiPayRoute)}}else{sessionStorage.removeItem("multiPayButtonId");sessionStorage.removeItem("multiPayRoute");sessionStorage.removeItem("multiPayBaseProductId");sessionStorage.removeItem("multiPayProductId");sessionStorage.removeItem("multiPayRebillProductId");sessionStorage.removeItem("multiPayCode");sessionStorage.removeItem("paySource");var tag=document.getElementById("error-"+multiPayButtonId);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+multiPayButtonId)}else{tag.innerHTML=""}tag.innerHTML=data.message;var color=tag.style.color="red";var pageForm=$("button[data-id='"+multiPayButtonId+"']").length?$("button[data-id='"+multiPayButtonId+"']"):$("a[data-id='"+multiPayButtonId+"']");showExceptionInPopupValue()?alert(data.message.replaceAll(/(<br\/>|<br>|<\/br>)/g,"\n")):$(tag).insertAfter(pageForm);enableInteractions()}})}function getInputValue(name){var pageInputs=document.getElementsByName(name);var pageInputsLength=pageInputs.length;if(pageInputsLength>0){for(var _i43=0;_i43<pageInputsLength;_i43++){var input=pageInputs[_i43];if(input.value){return input.value}}}return null}function processMultiPayRebill(orderData){var multiPayRoute=sessionStorage.getItem("multiPayRoute");if(!multiPayRoute)return;var productId=sessionStorage.getItem("multiPayRebillProductId");if(!productId){setCurrentWindowLocation(multiPayRoute);return}var params={};params.campaignId=orderData.campaignId;params.customerId=orderData.customerId;params.paySource="ACCTONFILE";params.cardSecurityCode=sessionStorage.getItem("multiPayCode");params.salesUrl=orderData.salesUrl;params.product1_id=productId;var data=JSON.stringify(params);var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Order",data).then(function(data){if(data.result&&data.result==="SUCCESS"){sessionStorage.setItem("multiPayRebillOrderId",JSON.stringify(data.message.orderId));sessionStorage.setItem("multiPayRebillOrder",JSON.stringify(data.message))}sessionStorage.removeItem("multiPayRoute");sessionStorage.removeItem("multiPayButtonId");sessionStorage.removeItem("multiPayBaseProductId");sessionStorage.removeItem("multiPayProductId");sessionStorage.removeItem("multiPayRebillProductId");sessionStorage.removeItem("multiPayCode");setCurrentWindowLocation(multiPayRoute)})}function renderPopupCartDetails(){var visibility=$("#mySidepanel").css("visibility");var display=$("#rightPanelHTML").css("display");if(visibility!=="visible"||display==="none"){return}var cartProducts=getOrderItemDetails();var totals=JSON.parse(sessionStorage.getItem("totals"));var cartSubTotal=totals?totals.subTotal:0;var symbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";$(".cartPanelSubtotalClass").css({"float":"right","margin-right":"2%"}).html(ccFormatCurrency(cartSubTotal.toFixed(2),symbol));var cartPanelElement=$("#cartPanelId");if(cartPanelElement.length){$("#cartPanelId").html("");if(cartProducts&&Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i44=0;_i44<cartProductsEntriesLength;_i44++){var _product4=cartProductsEntries[_i44][1];var currentOrderQuantity=_product4.currentOrderQuantity;var stockStatus="";if(!_product4.variant){stockStatus=verifyStock&&_product4.cycle1_isShippable&&parseInt(_product4.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":""}else if(_product4.variant.length){stockStatus=verifyStock&&_product4.cycle1_isShippable&&parseInt(_product4.variant.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":""}var imageUrl=_product4.variant&&_product4.variant.imageUrl!==""?_product4.variant.imageUrl:_product4.imageUrl?_product4.imageUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3R5bGU9ImZpbGw6IHJnYmEoMCwwLDAsMC4xNSk7IHRyYW5zZm9ybTogc2NhbGUoMC43NSkiPgogICAgICAgIDxwYXRoIGQ9Ik04LjUgMTMuNWwyLjUgMyAzLjUtNC41IDQuNSA2SDVtMTYgMVY1YTIgMiAwIDAgMC0yLTJINWMtMS4xIDAtMiAuOS0yIDJ2MTRjMCAxLjEuOSAyIDIgMmgxNGMxLjEgMCAyLS45IDItMnoiPjwvcGF0aD4KICAgICAgPC9zdmc+";var title=_product4.variant?" "+_product4.variant.title:"";var unitPrice=_product4.variant&&parseFloat(_product4.variant.price)>0&&!_product4.isVariantBundle&&!_product4.isEditable?_product4.variant.price:_product4.cycle1_price;var productPrice=ccFormatCurrency(getItemPrice(null,parseFloat(unitPrice),1,null),symbol);var currentHTML="<div class='sticky' style='padding:1%;overflow:hidden'> <img class='image-quantity-container' style='width:50px' src='"+imageUrl+"' style='float:left'/> <span> <span class='cartPanelProductName'>"+_product4.productName+title+stockStatus+"</span><br/> <span> Quantity </span><span class='cartPanelProductQuantity'>"+_product4.currentOrderQuantity+"</span> </span> <span style='float:right;margin-right:10%;font-size: 20px;margin-top:15px;cursor: pointer' class='gjs-pn-btn fa fa-trash' onclick='removeFromCart("+String.fromCharCode(34)+cartProductsEntries[_i44][0]+String.fromCharCode(34)+");'></span><br/><span>Unit Price </span><span class='cartPanelProductPrice'>"+productPrice+"</span><br/> </div> <br/><br/>";$("#cartPanelId").append(currentHTML)}}}}function openNav(){var quantityCircleBgColor=$(".panelCartCircle").css("background-color");var quantityCircleTextColor=$(".panelCartCircle").css("color");$(".cc-custom-right-panel").length===0&&$(".panel-checkout").css({"background-color":quantityCircleBgColor,"color":quantityCircleTextColor});$("#mySidepanel").css("visibility","visible");renderPopupCartDetails()}/* Set the width of the sidebar to 0 (hide it) */function closeNav(){document.getElementById("mySidepanel").style.visibility="hidden"}function getOutStockedVariant(productData,combination,customProductData,product,currentQty){try{var _item6=[];if(combination){var customData=customProductData.split("|");if(product&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(customData[1])){_item6.push(product.baseProductName)}else{var comboVariantOutStock,selectedComboProduct;var _loop4=function _loop4(_i45){var checkVariant=customData[_i45]&&customData[_i45].split(":");checkVariant[0]=checkVariant[0].replace("  - OUT-OF-STOCK","");checkVariant[1]=checkVariant[1].replace("  - OUT-OF-STOCK","");selectedComboProduct=product.combinations.find(function(combination){return combination.comboProductName===checkVariant[0]});if(checkVariant[0]===checkVariant[1]){if(selectedComboProduct&&product.cycle1_isShippable&&parseInt(selectedComboVariant.stockQuantity)<parseInt(customData[1])){_item6.push("<br>"+selectedComboProduct.comboProductName)}}if(checkVariant[0]!==checkVariant[1]){selectedComboVariant=selectedComboProduct.variants.find(function(variant){return variant.title===checkVariant[1]});if(selectedComboVariant&&product.cycle1_isShippable&&parseInt(selectedComboVariant.stockQuantity)<parseInt(customData[1])){_item6.push("<br>"+selectedComboProduct.comboProductName+" - "+selectedComboVariant.title)}}};for(var _i45=2;_i45<customData.length-1;_i45++){_loop4(_i45)}}}else{var _product5=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId.toString()===productData[0].toString()});var variant=_product5.variants.find(function(variant){return variant.variantDetailId.toString()===productData[1].toString()});if(variant&&parseInt(variant.stockQuantity)<parseInt(currentQty)){_item6.push(_product5.baseProductName+" - "+variant.title)}}return _item6}catch(error){error}}function getOutStockedProduct(itemCpId,currentQty){var product=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId.toString()===itemCpId.toString()});var item;if(product&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(currentQty)){item=product.baseProductName}return item}function addGooglePaymentSheetShippingCostIncluded(googlePaymentDataRequest){if(shippingCostIncluded){googlePaymentDataRequest.shippingOptionRequired=true;googlePaymentDataRequest.shippingOptionParameters={defaultSelectedOptionId:"shipping-001",shippingOptions:[{id:"shipping-001",label:"Shipping cost included"}]}}}function importUpsale(_x9,_x10){return _importUpsale.apply(this,arguments)}function _importUpsale(){_importUpsale=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(buttonId,route){var outOfStockProducts,outOfStockProductIds,obj,paypalSmartButtonSdk,upsell,upsellButtonElement,upsellButtonVariantValue,quantity,upsellButtonReplacementValue,prodSection,upsellCount,upsellItems,upsellItemsLength,_i127,_item23,orderItems,itemOfferKey,orderData,orderFFLNumber,fflNumber,index,upsaleComboProducts,_loop28,upsaleItemCpId,bundleStockParams,orderId,paayInitialData,paayRebillData,_token2,payerId,googlePayMerchantAccount,_response8,buttonItems,squareMerchantAccount,applePayMerchantAccount,merchantInitiatedRebills,data,_response9,tagElements,tag,pageForm,message,upsalefkCartItems;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:outOfStockProducts=[];outOfStockProductIds=[];obj={};// let upsell = pageData[buttonId].UPSELL;
// getting product from button
paypalSmartButtonSdk=sessionStorage.getItem("paypalSdk");upsell=getUpsellFromNavigationItem(buttonId);upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");quantity=upsellButtonElement.getAttribute("quantity");upsellButtonReplacementValue=upsellButtonElement.getAttribute("replaceproductid");if(upsellButtonReplacementValue&&upsellButtonReplacementValue.toLowerCase()!=="none"){obj.replaceProductId=upsellButtonReplacementValue}// getting variant products
prodSection=$(upsellButtonElement).closest("section.fk-product-section");if(!(prodSection&&prodSection.length>0)){_context12.next=29;break}upsellCount=Object.keys(getUpsaleItems()).length;getVariants($(prodSection).attr("id"));upsellItems=Object.keys(getUpsaleItems());upsellItemsLength=upsellItems.length;if(upsellCount<upsellItemsLength)upsell=null;if(!upsell){_context12.next=27;break}_i127=0;case 19:if(!(_i127<upsellItemsLength)){_context12.next=27;break}_item23=upsellItems[_i127].split(".")[0];if(!(_item23===upsell)){_context12.next=24;break}upsell=null;return _context12.abrupt("break",27);case 24:_i127++;_context12.next=19;break;case 27:_context12.next=30;break;case 29:getVariants();case 30:// getting products from radio button or check box
orderItems=getUpsaleItems();// use button product or cart products
if(upsell){if(upsellButtonVariantValue){itemOfferKey=upsell+"."+upsellButtonVariantValue;orderItems[itemOfferKey]=quantity?quantity:getQuantity()}else{orderItems[upsell]=quantity?quantity:getQuantity();updateReplacementProducts(orderItems);//remove the button product?
}sessionStorage.setItem("upsalefkCart",JSON.stringify(orderItems))}orderData=sessionStorage.getItem("multiPayRebillOrder")?JSON.parse(sessionStorage.getItem("multiPayRebillOrder")):JSON.parse(sessionStorage.getItem("orderData"));orderFFLNumber=orderData&&orderData.customFields&&orderData.customFields.fflNumber;if(orderFFLNumber){_context12.next=44;break}if(!fflPopUpRequired(buttonId)){_context12.next=42;break}updateFFLModalButtonCSS(buttonId);showFFLPopUp();$("[data-id="+buttonId+"]").attr("disabled",false);sessionStorage.removeItem("upsalefkCart");enableInteractions();return _context12.abrupt("return");case 42:fflNumber=sessionStorage.getItem("fflNumber");if(fflNumber&&pageData.pageTypeId===3&&checkFFLProductsInCart()){obj["custom_order_fflNumber"]=fflNumber;if(document.getElementsByName("fflSplit")[0]&&document.getElementsByName("fflSplit")[0].checked===false)obj["custom_order_fflSplit"]=1}else if(fflNumber&&!orderFFLNumber)removeFFLInfoFromPage();case 44:index=0;if(Object.keys(orderItems).length){upsaleComboProducts=JSON.parse(sessionStorage.getItem("upsaleComboProducts"))||[];_loop28=function _loop28(upsaleItemCpId){index++;var item=void 0;if(upsaleItemCpId.includes("product_custom")){obj[upsaleItemCpId]=orderItems[upsaleItemCpId];upsaleComboProducts.push(orderItems[upsaleItemCpId]);sessionStorage.setItem("upsaleComboProducts",JSON.stringify(upsaleComboProducts))}else{if(upsaleItemCpId.indexOf(".")>0){var _productData17=upsaleItemCpId.split(".");item=verifyStock&&getOutStockedVariant(_productData17,"","","",orderItems[upsaleItemCpId]);obj["product"+index+"_id"]=_productData17[0];obj["variant"+index+"_id"]=_productData17[1]}else{var comboProduct=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==upsaleItemCpId});comboProductlength=comboProduct&&comboProduct.combinations.length>0;if(comboProductlength){var customKeys=Object.keys(orderItems).filter(function(key){return key.includes("product_custom")});for(var _i128=0;_i128<customKeys.length;_i128++){var key=customKeys[_i128];var _productId12=orderItems[key].split("|")[0];if(upsaleItemCpId.toString()===_productId12.toString()){var customData=orderItems[key];item=verifyStock&&getOutStockedVariant(upsaleItemCpId,true,customData,comboProduct)}}}else{item=verifyStock&&getOutStockedProduct(upsaleItemCpId,orderItems[upsaleItemCpId])}obj["product"+index+"_id"]=upsaleItemCpId}if(item&&item.length>0){outOfStockProducts.push(item);outOfStockProductIds.push(upsaleItemCpId)}obj["product"+index+"_qty"]=orderItems[upsaleItemCpId];if(altValues[upsaleItemCpId+"|"+orderItems[upsaleItemCpId]])obj["product"+index+"_alt"]=getItemAlt(upsaleItemCpId,orderItems[upsaleItemCpId])}};for(upsaleItemCpId in orderItems){_loop28(upsaleItemCpId)}}bundleStockParams=getBundleVariants(obj,index);obj=bundleStockParams.params;outOfStockProducts=outOfStockProducts.concat(bundleStockParams.outOfStockBundleVariants);outOfStockProductIds=outOfStockProductIds.concat(bundleStockParams.outOfStockBundleProductIds);//Parameters that might be needed for native 3DS
if(route.indexOf("V1/SplitTest/funnel/")>0)obj.redirectsTo=route;else if(checkDomainForRoute())obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+pageData.funnelData.referenceId+"/"+route;else obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+route;obj.errorRedirectsTo=getCurrentWindowLocation().toString();obj.browserData=JSON.stringify(browserData);addFunnelPageRefId(obj);orderId=sessionStorage.getItem("multiPayRebillOrderId")?sessionStorage.getItem("multiPayRebillOrderId"):sessionStorage.getItem("orderId");orderId=orderId?JSON.parse(orderId):orderData.orderId;if(orderId)obj.orderId=orderId;if(!(sessionStorage.getItem("paayEnabled")!==null&&sessionStorage.getItem("paayCompleted")===null&&orderData!==null&&orderData.paySource==="CREDITCARD"&&sessionStorage.getItem("paay_page_option")!=="0"&&sessionStorage.getItem("paay_pan")!==null)){_context12.next=63;break}sessionStorage.setItem("paay_buttonId",buttonId);sessionStorage.setItem("paay_route",route);sessionStorage.setItem("paay_item",obj.product1_id);triggerPAAY();return _context12.abrupt("return");case 63:paayInitialData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayInitialData")!==null?JSON.parse(sessionStorage.getItem("paayInitialData")):null;paayRebillData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayRebillData")!==null?JSON.parse(sessionStorage.getItem("paayRebillData")):null;if(sessionStorage.getItem("paayInitialAsRebill")==="1"){obj.rebill_eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.rebill_cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.rebill_xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null}else{obj.eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null;obj.rebill_eci=paayRebillData&&paayRebillData.eci?paayRebillData.eci:document.getElementsByName("rebill_eci")[0]?document.getElementsByName("rebill_eci")[0].value:null;obj.rebill_cavv=paayRebillData&&paayRebillData.authenticationValue?paayRebillData.authenticationValue:document.getElementsByName("rebill_authenticationValue")[0]?document.getElementsByName("rebill_authenticationValue")[0].value:document.getElementsByName("rebill_cavv")[0]?document.getElementsByName("rebill_cavv")[0].value:null;obj.rebill_xid=paayRebillData&&paayRebillData.dsTransId?paayRebillData.dsTransId:document.getElementsByName("rebill_dsTransId")[0]?document.getElementsByName("rebill_dsTransId")[0].value:document.getElementsByName("rebill_xid")[0]?document.getElementsByName("rebill_xid")[0].value:null}if(!(orderData.paySource==="PAYPAL")){_context12.next=76;break}sessionStorage.setItem("paySource","PAYPAL");obj.paypalBillerId=parseInt(pageData.funnelData.addOns.find(function(_ref25){var keyName=_ref25.keyName;return keyName==="Paypal_billerId"}).keyValue);obj.salesUrl=getCurrentWindowLocation().href;//2 click Paypal upsells
_token2=sessionStorage.getItem("upsalePaypalToken");payerId=sessionStorage.getItem("upsalePaypalPayerId");if(_token2&&payerId){obj.token=_token2;obj.payerId=payerId;paypalSmartButtonSdk&&showOverlayEffect()}else{sessionStorage.setItem("paypalUpsaleSuccessRoute",route);sessionStorage.setItem("paypalButtonId",buttonId);sessionStorage.setItem("paypalUpsalePageData",JSON.stringify(pageData));sessionStorage.setItem("paypalUpsaleCart",JSON.stringify(orderItems))}if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){sessionStorage.setItem("paypalSuccessRoute",route)}_context12.next=99;break;case 76:if(!(orderData.prepaidType==="GOOGLEPAY")){_context12.next=99;break}googlePayMerchantAccount=getAddOnKeyValue(findAddOn("GPay_Merchant_Acc"));if(googlePayMerchantAccount!==""){obj.forceMerchantId=googlePayMerchantAccount}googlePaymentDataRequest=getGooglePaymentDataRequest();googlePaymentDataRequest.transactionInfo=getGoogleTransactionInfo("upsell",buttonId);addGooglePaymentSheetShippingCostIncluded(googlePaymentDataRequest);googlePaymentsClient=getGooglePaymentsClient();_context12.prev=83;_context12.next=86;return googlePaymentsClient.loadPaymentData(googlePaymentDataRequest);case 86:_response8=_context12.sent;obj.googlePayToken=_response8.paymentMethodData.tokenizationData.token;_context12.next=98;break;case 90:_context12.prev=90;_context12.t0=_context12["catch"](83);sessionStorage.removeItem("paySource");sessionStorage.removeItem("upsalefkCart");buttonItems=$("[action=\"addToCart\"]");buttonItems.each(function(i,item){toggleProductSelection(item,true)});enableInteractions();return _context12.abrupt("return");case 98:;case 99:if(orderData.prepaidType&&orderData.prepaidType==="WITHREACH_PAYPAL"){obj.forceMerchantId=parseInt(getAddOnKeyValue(findAddOn("Paypal_billerId")))}if(orderData.prepaidType&&orderData.prepaidType==="AFFIRM"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref26){var keyName=_ref26.keyName;return keyName==="Affirm_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="KLARNA"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref27){var keyName=_ref27.keyName;return keyName==="Klarna_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SEZZLE"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref28){var keyName=_ref28.keyName;return keyName==="Sezzle_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="AFTERPAY"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref29){var keyName=_ref29.keyName;return keyName==="Afterpay_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="BANCONTACT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref30){var keyName=_ref30.keyName;return keyName==="Bancontact_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="IDEAL"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref31){var keyName=_ref31.keyName;return keyName==="iDEAL_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="GIROPAY"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref32){var keyName=_ref32.keyName;return keyName==="Giropay_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SOFORT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref33){var keyName=_ref33.keyName;return keyName==="Sofort_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="P24"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref34){var keyName=_ref34.keyName;return keyName==="P24_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="BOLETO"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref35){var keyName=_ref35.keyName;return keyName==="Boleto_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="PIX"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref36){var keyName=_ref36.keyName;return keyName==="PIX_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SEPA_DEBIT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref37){var keyName=_ref37.keyName;return keyName==="SEPA_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SQUAREV2"){squareMerchantAccount=getAddOnKeyValue(findAddOn("squareBillerId"));if(squareMerchantAccount!==""){obj.forceMerchantId=squareMerchantAccount}}if(orderData.paySource==="AMAZON"){obj.amazonBillerId=parseInt(sessionStorage.getItem("amazonBillerId"));obj.amazonOrderId=sessionStorage.getItem("amazonOrderId");obj.amazonAddressConsent=sessionStorage.getItem("amazonAccessToken")}else if(orderData.prepaidType&&orderData.prepaidType==="APPLEPAY"){obj.applePayToken=sessionStorage.getItem("applePayToken");applePayMerchantAccount=getAddOnKeyValue(findAddOn("applePayBillerId"));if(applePayMerchantAccount!==""){obj.forceMerchantId=applePayMerchantAccount}}merchantInitiatedRebills=getAddOnKeyValue(findAddOn("Merchant_Rebills"));if(merchantInitiatedRebills==="1"){obj.merchantInitiated=merchantInitiatedRebills;obj.funnelReferenceId=pageData.funnelData.referenceId}if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){obj.paypalSdk=true}data=JSON.stringify(obj);if(!(obj.product1_id&&outOfStockProducts.length===0)){_context12.next=123;break}_response9=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Upsale",data).then(function(data){var orderPurchaseEvent=getAddOnKeyValue(findAddOn("Purchase_Event_FB"))==="3";if(data.result==="SUCCESS"){//if paySource === "PAYPAL" and reference transactions not enabled -> redirect to paypalURL
if(data.message.paypalUrl&&paypalSmartButtonSdk!=="true"){setCurrentWindowLocation(data.message.paypalUrl);return}if(data.message.paypalSdkParams){return data}registerClick(1,function(regClickData){if(sessionStorage.getItem("multiPayRebillOrder")){sessionStorage.setItem("multiPayRebillOrder",JSON.stringify(data.message))}else{sessionStorage.setItem("orderData",JSON.stringify(data.message));sessionStorage.removeItem("products");sessionStorage.setItem("products",JSON.stringify(data.message.items))}//clear out 2-click PayPal upsale session storage items
sessionStorage.removeItem("paypalUpsaleSuccessRoute");sessionStorage.removeItem("paypalUpsaleButtonId");sessionStorage.removeItem("upsalePaypalToken");sessionStorage.removeItem("upsalePaypalPayerId");sessionStorage.removeItem("paypalUpsalePageData");sessionStorage.removeItem("paypalCart");sessionStorage.removeItem("paypalUpsaleCart");if(sessionStorage.getItem("applePayToken")&&window.session){var update={status:ApplePaySession.STATUS_SUCCESS};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}if(orderPurchaseEvent){sessionStorage.setItem("preUpsalefkCart",JSON.stringify(orderItems||{}));sessionStorage.setItem("importUpsellSuccess",true);pageData.funnelData.GA_MEASUREMENT_ID&&sessionStorage.setItem("importUpsellSuccessGA",true);if(orderData){sessionStorage.setItem("preUpsellOrderDataItems",JSON.stringify({totalAmount:orderData.totalAmount,taxTotal:orderData.taxTotal,shipTotal:orderData.shipTotal,couponCode:""}))}}// showing list of product in thanks page - merge on successful upsell
mergeOfferUpsale(orderItems);setCurrentWindowLocation(route)});return data}else{// removing the upsellfkCart from session
sessionStorage.removeItem("upsalefkCart");//handle merchant redirect for native 3DS
if(data.result==="MERC_REDIRECT"){sessionStorage.setItem("merchantRedirectUpsalefkCart",JSON.stringify(orderItems||{}));sessionStorage.setItem("cc3dsPageSubmitDetails",JSON.stringify({pageTypeId:pageData.pageTypeId,referenceId:pageData.currentPage.referenceId}));if(orderPurchaseEvent){if(orderData){sessionStorage.setItem("preUpsellOrderDataItems",JSON.stringify({totalAmount:orderData.totalAmount,taxTotal:orderData.taxTotal,shipTotal:orderData.shipTotal,couponCode:""}))}}if(data.message&&data.message.url){setCurrentWindowLocation(data.message.url)}else if(data.message&&data.message.script){eval(data.message.script)}return false}if(sessionStorage.getItem("applePayToken")&&window.session){var appleErrors=[data.message];var update={status:ApplePaySession.STATUS_FAILURE,errors:appleErrors};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}paypalSmartButtonSdk&&hideOverlayEffect();var tagElements=generateErrorTag(buttonId,paypalSmartButtonSdk);var tag=tagElements.tag;var pageForm=tagElements.pageForm;orderData.paySource==="PAYPAL"&&clearCCPayPalSessionData();var declineNavItem=pageData.navigationItems.find(function(element){return element.elementId===buttonId+"-Decline"});if(declineNavItem&&declineNavItem.linkDetails[0]){route=redirectPath(declineNavItem.linkDetails[0],true);disableInteractions(buttonId,true,true);setCurrentWindowLocation(route)}else{tag.innerHTML=data.message;showExceptionInPopupValue()?alert(data.message.replaceAll(/(<br\/>|<br>|<\/br>)/g,"\n")):$(tag).insertAfter(pageForm);enableInteractions()}return result=false}});return _context12.abrupt("return",_response9);case 123:if(outOfStockProducts.length>0&&verifyStock){tagElements=generateErrorTag(buttonId,paypalSmartButtonSdk);tag=tagElements.tag;pageForm=tagElements.pageForm;outOfStockProducts=outOfStockProducts.join("<br>");message="Products are out of stock: <br>"+outOfStockProducts;upsalefkCartItems=JSON.parse(sessionStorage.getItem("upsalefkCart"));outOfStockProductIds.length>0&&outOfStockProductIds.forEach(function(prodId){for(var key in upsalefkCartItems){if(key.toString()===prodId){delete upsalefkCartItems[key]}}});sessionStorage.setItem("upsalefkCart",JSON.stringify(upsalefkCartItems));tag.innerHTML=message;showExceptionInPopupValue()?alert(message.replaceAll(/(<br\/>|<br>|<\/br>)/g,"\n")):$(tag).insertAfter(pageForm);orderData.paySource==="PAYPAL"&&clearCCPayPalSessionData();enableInteractions()}else{setCurrentWindowLocation(route)}case 124:case"end":return _context12.stop();}}},_callee12,null,[[83,90]])}));return _importUpsale.apply(this,arguments)}function generateErrorTag(buttonId,paypalSmartButtonSdk){var tag=document.getElementById("error-"+buttonId);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+buttonId)}else{tag.innerHTML=""}tag.style.color="red";var pageForm=$("button[data-id='"+buttonId+"']").length?$("button[data-id='"+buttonId+"']"):$("a[data-id='"+buttonId+"']");if(paypalSmartButtonSdk==="true"&&!pageForm.length){pageForm=$("div[data-id='"+buttonId+"']")}var elements={tag:tag,pageForm:pageForm};return elements}function constructComboProducts(product,variant,combo,breakTag,i){var comboProducts="";if(product===variant){comboProducts=product+breakTag}else{comboProducts=combo?combo[i]+breakTag:product+" : "+variant+breakTag}return comboProducts}function comboDisplay(confirmation,productCombo,prodId,prodQty,product,collapseIndex,matchUpsale,newSymbol,itemPrice,purchases,isPurchaseQuery){try{$("head").append("\n<style>\n.combo {\n    padding: 5px 15px;\n    background-color: rgb(244 245 249);\n    border-radius: 5px;\n    text-wrap: wrap;\n    text-align:left;\n}\n.combo-caret {\n    cursor: pointer;\n}\n.rotateComboCaret {\n    rotate: 90deg;\n}\n.combo hr{\n    margin: 0;\n}\n</style>");var listOfItem="";var productsLength=productCombo?productCombo.length:1;for(var j=0;j<productsLength;j++){var combo=productsLength&&productCombo[j];var customization=purchases&&(isPurchaseQuery?purchases.customization:purchases.customization[0]);var comboProducts="";combo=combo&&combo.split("|");var breakTag=confirmation?"<br>":"<br><br>";if(combo&&combo[0]&&combo[0]===prodId&&combo[1]===prodQty){for(var _i46=2;_i46<combo.length;_i46++){var checkVariant=combo[_i46].split(":");comboProducts+=constructComboProducts(checkVariant[0],checkVariant[1],combo,breakTag,_i46)}matchUpsale=true;if(confirmation===false){listOfItem="<a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+collapseIndex+"\">+</a>"+" "+product.productName+"<tr><td ><div id=\"index"+collapseIndex+"\" class=\"collapse combo\"> "+comboProducts+" </div></td></tr>"}else if(confirmation===true){var productVariant=(pageData.pageTypeId===9?product.variantName:product.title)||"";listOfItem="<tr><td><a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+collapseIndex+"\">+</a>"+" "+product.name+" "+productVariant+"</td><td style=\"text-align:center;\">"+product.qty+"</td><td style=\"text-align:right;\"> "+ccFormatCurrency(itemPrice,newSymbol)+" </td></tr><tr><td><div id=\"index"+collapseIndex+"\" class=\"collapse combo\"> "+comboProducts+" </div></td></tr>"}break}else if(customization){var _breakTag="<hr>";var customizationLength=isPurchaseQuery?customization.length:customization.attributes&&customization.attributes.length;for(var _i47=0;_i47<customizationLength;_i47++){comboProducts+=constructComboProducts(isPurchaseQuery?customization[_i47].key:customization.attributes[_i47].key,isPurchaseQuery?customization[_i47].value:customization.attributes[_i47].value,combo,_breakTag)}var productName=purchases.name||purchases.product;listOfItem="<a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+collapseIndex+"\" onClick=\"rotateCaret(event)\"><i class=\"fas fa-caret-right combo-caret\"></i></a>"+" "+productName+"<tr><td ><div id=\"index"+collapseIndex+"\" class=\"collapse combo\"> Quantity: "+(customization.quantity||purchases.currentQty)+"<br>"+comboProducts+" </div></td></tr>"}else{matchUpsale=false}}var comboResult={matchUpsale:matchUpsale,listOfItem:listOfItem};return comboResult}catch(error){error}}function rotateCaret(e){e.currentTarget.classList.toggle("rotateComboCaret")}function getLoginOrderDetails(){try{var loginOrderData=sessionStorage.getItem("orderStatusInfo")||sessionStorage.getItem("loginOrder");loginOrderData=loginOrderData&&JSON.parse(loginOrderData);var shippingCharge=0;if(loginOrderData){var currencySymbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol||"";var _price3=isVatOnOrder?parseFloat(loginOrderData.price||0)+parseFloat(loginOrderData.salesTax||0):parseFloat(loginOrderData.price||0);var salesTax=isVatOnOrder?0:loginOrderData.salesTax?loginOrderData.salesTax:"";_price3&&$(".dynamic-price-total").html(currencySymbol+_price3.toFixed(2));salesTax&&$(".salesTax").html(currencySymbol+salesTax);shippingCharge=(parseFloat(loginOrderData.baseShipping||0)+parseFloat(loginOrderData.shipUpcharge||0)).toFixed(2);shippingCharge&&$(".dynamic-shipping-total").html(currencySymbol+shippingCharge);loginOrderData.totalDiscount&&$(".discount").html(currencySymbol+loginOrderData.totalDiscount);loginOrderData.totalAmount&&$(".grandTotal").html(currencySymbol+loginOrderData.totalAmount);return loginOrderData}return{}}catch(error){return{}}}function ccProductAttrToString(product){var customization=product&&product.customization&&product.customization[0];if(customization&&customization.attributes&&customization.attributes.length){var productAttrString=product.productId+(product.variantDetailId?"."+product.variantDetailId:"")+"|"+(customization.quantity||product.qty);customization.attributes.forEach(function(item){productAttrString=productAttrString+"|"+item.key+":"+item.value});return productAttrString}return""}function confirmation(){var symbol=pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";var newSymbol=sessionStorage.getItem("currencyCodeSymbol")?sessionStorage.getItem("currencyCodeSymbol"):symbol;var memberAreaPage=pageData.pageTypeId===9;var orderData=memberAreaPage?getLoginOrderDetails():JSON.parse(sessionStorage.getItem("orderData"));var userDetails=JSON.parse(sessionStorage.getItem("userDetails"));var listOfItem="";var subTotal=0;var totalShipping=0;var totalDiscount=0;var priceDiscount=0;var salesTax=0;for(var key in userDetails){if(orderData&&!userDetails[key])userDetails[key]=orderData[key];if(key==="state"||key==="shipState"||key==="country"||key==="shipCountry"){var element=document.getElementById(key+"-field");element?element.innerHTML=userDetails[key]:""}else{var _element=document.getElementById(key);_element?_element.innerHTML=userDetails[key]:""}}var invoiceCellFormat=[];var currentInvoiceRow=document.querySelector("tr[id='fk-dynamic-invoice-row']");if(currentInvoiceRow){invoiceCellFormat=Array.prototype.slice.call(currentInvoiceRow.cells)}var elementIds=[];var invoiceCellFormatLength=invoiceCellFormat.length;for(var _i48=0;_i48<invoiceCellFormatLength;_i48++){var cell=invoiceCellFormat[_i48];elementIds[_i48]=cell.id}var exchangeRate=1;if([3,5].includes(pageData.pageTypeId)){exchangeRate=Number(sessionStorage.getItem("exchangeRate"))||exchangeRate;exchangeRate=orderData&&orderData.currencyCode===(returnCurrencyCode()||pageData.selectedCampaign.currency)?1:exchangeRate}if(orderData){var orderDataItems=memberAreaPage?Object.values(orderData.items||{}):orderData.items;var basePrice=parseFloat(memberAreaPage?orderData.price:orderData.subTotal);totalDiscount=orderData.totalDiscount?parseFloat(orderData.totalDiscount):0;priceDiscount=orderData.discountPrice?parseFloat(orderData.discountPrice):0;subTotal=parseFloat(basePrice+priceDiscount);totalShipping=parseFloat(memberAreaPage?(parseFloat(orderData.baseShipping||0)+parseFloat(orderData.shipUpcharge||0)).toFixed(2):orderData.shipTotal);salesTax=parseFloat(memberAreaPage?orderData.salesTax:orderData.taxTotal);if(sessionStorage.getItem("multiPayRebillOrder")){var multiPayRebillOrder=JSON.parse(sessionStorage.getItem("multiPayRebillOrder"));var multiPayRebillItems=multiPayRebillOrder.items;var multiPayRebillOrderPrice=parseFloat(multiPayRebillOrder.subTotal);var multiPayRebillOrderDiscount=multiPayRebillOrder.totalDiscount?parseFloat(multiPayRebillOrder.totalDiscount):0;var multiPayRebillPriceDiscount=multiPayRebillOrder.discountPrice?parseFloat(multiPayRebillOrder.discountPrice):0;totalDiscount+=multiPayRebillOrderDiscount;subTotal+=parseFloat(multiPayRebillOrderPrice+multiPayRebillPriceDiscount);totalShipping+=parseFloat(multiPayRebillOrder.shipTotal);salesTax+=parseFloat(multiPayRebillOrder.taxTotal);delete multiPayRebillItems[0];orderDataItems=orderDataItems.concat(multiPayRebillItems)}if(isVatOnOrder){subTotal=parseFloat(subTotal)+salesTax;salesTax=0}var productCombo=JSON.parse(sessionStorage.getItem("upsaleComboProducts")||"{}");var isCombo=productCombo&&productCombo.length>0;(isCombo||$("#items-list").length)&&$("head").append("\n<style>\n.combo {\n    padding: 5px 15px;\n    background-color: rgb(244 245 249);\n    border-radius: 5px;\n    text-wrap: wrap;\n    text-align:left;\n}\n.combo-caret {\n    cursor: pointer;\n}\n.rotateComboCaret {\n    rotate: 90deg;\n}\n.combo hr{\n    margin: 0;\n}\n</style>");var addedProducts=[];var collapseIndex=1;var matchUpsale,comboResult;orderDataItems.length>0&&orderDataItems.forEach(function(order){var itemPrice=order.isPreauthVoid=="1"?"0.00":order.vatPrice||order.price;itemPrice=(parseFloat(itemPrice)*parseFloat(exchangeRate)).toFixed(2);if(memberAreaPage){var customAttrString=ccProductAttrToString(order);isCombo=false;if(customAttrString){isCombo=true;productCombo=[customAttrString]}}if(isCombo){var _productId3=memberAreaPage?order.productId+(order.variantDetailId?"."+order.variantDetailId:""):order.productId;comboResult=comboDisplay(true,productCombo,_productId3,order.qty,order,collapseIndex,matchUpsale,newSymbol,itemPrice);matchUpsale=comboResult.matchUpsale;listOfItem+=comboResult.listOfItem}else{matchUpsale=false}if(matchUpsale===false){var variantTitle=(memberAreaPage?order.variantName:order.title)||"";listOfItem+="<tr><td id=\""+elementIds[0]+"\">"+order.name+" "+variantTitle+"</td><td id=\""+elementIds[1]+"\" style=\"text-align:center;\">"+order.qty+"</td><td id=\""+elementIds[2]+"\" style=\"text-align:right;\"> "+ccFormatCurrency(itemPrice,newSymbol)+"</td></tr>"}else if(matchUpsale===true){collapseIndex++}})}else{var _products=JSON.parse(sessionStorage.getItem("products"));_products&&_products.length>0&&_products.forEach(function(product){var itemPrice=product.isPreauthVoid=="1"?"0.00":product.vatPrice||product.price;subTotal+=parseFloat(itemPrice);totalShipping+=parseFloat(product.shipping);listOfItem+="<tr><td id=\""+elementIds[0]+"\">"+product.name+"</td><td id=\""+elementIds[1]+"\" style=\"text-align:center;\">"+product.qty+"</td><td id=\""+elementIds[2]+"\" style=\"text-align:right;\"> "+ccFormatCurrency(getItemPrice(0,itemPrice,1,1).toFixed(2),newSymbol)+"</td></tr>"})}$("#items-list").html("");$("#items-list").prepend(listOfItem);$("#fk-dynamic-invoice-row").remove();var paid=parseFloat(subTotal);if($("#fk-dynamic-invoice-price-row").length>0){var priceElementClassMap=[["subTotal",paid],["sAndHFee",totalShipping],["tax",salesTax],["grandTotal",paid+salesTax+totalShipping-totalDiscount],["discount",totalDiscount]];var displayElements;var priceElementClassMapLength=priceElementClassMap.length;for(var _i49=0;_i49<priceElementClassMapLength;_i49++){var _key=priceElementClassMap[_i49][0];var value=priceElementClassMap[_i49][1];displayElements=$("#fk-dynamic-invoice-price-row").find("#"+_key);if(displayElements.length>0){var displayElementsLength=displayElements.length;for(var j=0;j<displayElementsLength;j++){var _element2=displayElements[j];var finalValue=ccFormatCurrency((exchangeRate*parseFloat(value)).toFixed(2),newSymbol);if(_key==="discount"&&parseFloat(value)>0){_element2.innerHTML=" -"+finalValue}else{_element2.innerHTML=" "+finalValue}}}}if(totalDiscount===0){$("#items-list").find("#discount").closest("div").remove()}if(salesTax<=0){$("#items-list").find("#tax").closest("div").remove()}}else{var isDiscountInactive="<tr><td colspan=\"3\"><div class=\"total-prices\"><div class=\"each-price\"><label>Sub Total :</label> <span id=\"subTotal\">"+ccFormatCurrency((paid*exchangeRate).toFixed(2),newSymbol)+"</span></div><div class=\"each-price\"><label>Shipping :</label> <span id=\"sAndHFee\"> "+ccFormatCurrency((totalShipping*exchangeRate).toFixed(2),newSymbol)+"</span></div>[tax]<div class=\"each-price\"><label>Grand Total: </label><span id=\"grandTotal\"> "+ccFormatCurrency((parseFloat(paid+salesTax+totalShipping)*exchangeRate).toFixed(2),newSymbol)+"</span></div></div></td></tr><style>.total-prices .each-price label { margin: 0;font-weight: 700;font-size: 18px;}.total-prices{margin-top:15px;padding-top:15px;text-align: right;border-top: 1px solid #277098;}</style>";var isDiscountActive="<tr><td colspan=\"4\"><div class=\"total-prices\"><div class=\"each-price\"><label>Sub Total :</label> <span id=\"subTotal\">"+ccFormatCurrency((paid*exchangeRate).toFixed(2),newSymbol)+"</span></div><div class=\"each-price\"><label>Shipping :</label> <span id=\"sAndHFee\"> "+ccFormatCurrency((totalShipping*exchangeRate).toFixed(2),newSymbol)+"</span></div>[tax]<div class=\"each-price\"><label>Discount :</label> <span id=\"discount\"> "+"-"+ccFormatCurrency((totalDiscount*exchangeRate).toFixed(2),newSymbol)+"</span></div><div class=\"each-price\"><label>Grand Total: </label><span id=\"grandTotal\"> "+ccFormatCurrency((parseFloat(paid+salesTax+totalShipping-totalDiscount)*exchangeRate).toFixed(2),newSymbol)+"</span></div></div></td></tr><style>.total-prices .each-price label { margin: 0;font-weight: 700;font-size: 18px;}.total-prices{margin-top:15px;padding-top:15px;text-align: right;border-top: 1px solid #277098;}</style>";var invoiceFinal=totalDiscount===0?isDiscountInactive:isDiscountActive;var taxDiv=salesTax>0?"<div class=\"each-price\"><label>Sales Tax :</label> <span id=\"tax\"> "+ccFormatCurrency((salesTax*exchangeRate).toFixed(2),newSymbol)+"</span></div>":"";invoiceFinal=invoiceFinal.replace("[tax]",taxDiv);$("#items-list").append(invoiceFinal)}var productsContainer=document.getElementById("productsContainer");var elem=document.getElementById("products");elem&&elem.remove();var productsEL=document.createElement("tbody");productsEL.setAttribute("id","products");productsContainer&&productsContainer.appendChild(productsEL);var total=0;products&&products.length>0&&products.map(function(product,i){var tr=document.createElement("tr");var th=document.createElement("th");var td=document.createElement("td");var td1=document.createElement("td");var productPrice=product.isPreauthVoid=="1"?"0.00":product.vatPrice||product.price;th.innerHTML=i+1;td.innerHTML=product.name;td1.innerHTML=productPrice;total=total+parseInt(productPrice);tr.appendChild(th);tr.appendChild(td);tr.appendChild(td1);productsEL.appendChild(tr)});var tr=document.createElement("tr");var th=document.createElement("th");var td=document.createElement("td");var td1=document.createElement("td");td.innerHTML="Total";td1.innerHTML=total.toFixed(2);tr.appendChild(th);tr.appendChild(td);tr.appendChild(td1);productsEL.appendChild(tr);enableInteractions();if(pageData.selectedCampaign.currencies&&pageData.selectedCampaign.currencies.length){loadStaticCurrencyValues();convertStaticCurrencyValues()}}function UpdateProduct(id){productId=id}function closePopup(elem,type){if(type==="id"){var popup=document.getElementById(elem);var showOnScroll="true";if(popup){popup.setAttribute("style","display:none;");showOnScroll=popup.dataset.showonscroll}if(!isVisitedOnScroll||!isVisited||!isVisitedOnLoad||showOnScroll!=="true"||!ccIsVisitedOnScrollUp){document.getElementsByTagName("html")[0].style.removeProperty("overflow-y")}}else if(type==="tag"){document.getElementsByTagName(elem)[0].setAttribute("style","display:none;")}}function membershipRouteForPreview(route){setCurrentWindowLocation(route)}function getClubMembershipProducts(){var membershipInfo=JSON.parse(sessionStorage.getItem("clubMemberships"));return membershipInfo?membershipInfo.map(function(product){return product.productId}):[]}function getMembershipDetails(){return JSON.parse(sessionStorage.getItem("membership"))}function checkCartProductsAndVariants(link,productKeys,isCheckoutPage,shipCountryElement,shipStateElement){var linkProductsAndVariants=link.pageVariants?JSON.parse(link.pageVariants):"";var offerCart=JSON.parse(sessionStorage.getItem("fkCart"))||{};var upsellCart=JSON.parse(sessionStorage.getItem("upsalefkCart"))||{};var cartProductsAndVariants=[].concat(_toConsumableArray(Object.keys(offerCart)),_toConsumableArray(Object.keys(upsellCart)));var variantList={};function checkVariants(elementId){elementId=elementId.toString();if(linkProductsAndVariants&&linkProductsAndVariants[elementId]){if(variantList&&variantList[elementId]){return variantList[elementId].includes(linkProductsAndVariants[elementId])}else{return false}}else{return true}}cartProductsAndVariants&&cartProductsAndVariants.forEach(function(ele){var productKey=ele.split(".")[0];var variantKey=ele.split(".")[1];if(variantList.hasOwnProperty(productKey)){variantList[productKey]=variantList[productKey].toString()+","+variantKey.toString()}else{if(variantKey){variantList[productKey]=variantKey.toString()}}});var mappedProduct=link.isAllProducts?link.products.every(function(prod){return productKeys.indexOf(prod.toString())>-1}):link.products.find(function(product){return productKeys.includes(product.toString())});var result=mappedProduct;if(mappedProduct){if(!link.isAllProducts){var _product6=mappedProduct.toString();if(linkProductsAndVariants&&linkProductsAndVariants[_product6]){var productVariantList=variantList[_product6]&&variantList[_product6].split(",")||[];var variantsOnButton=linkProductsAndVariants[_product6].split(",")||[];var variantCount=0;productVariantList.forEach(function(variant){if(variantsOnButton.indexOf(variant)!==-1){variantCount++}});result=variantCount===productVariantList.length?mappedProduct:null}else{return checkCountryAndState(link,shipCountryElement,shipStateElement)&&result}}else{result=link.products.every(function(elementId){return checkVariants(elementId)})}}return checkCountryAndState(link,shipCountryElement,shipStateElement)&&result}function sortLinkDetailsForDynamicRoutes(){var linkDetails=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var linkData=[].concat(linkDetails);linkData.sort(function(a,b){return b.products.length-a.products.length});linkData.sort(function(a,b){return b.isAllProducts-a.isAllProducts});return linkData}function checkCountryAndState(link,country,state){var parsedLinkCountries=link.countryStates&&link.countryStates!=="{}"?JSON.parse(link.countryStates):"";if(!parsedLinkCountries){return true}if(parsedLinkCountries[country]){var parsedStates=parsedLinkCountries[country];if(parsedStates!=="all"){var statesArray=parsedStates.split(",");if(statesArray.includes(state)){return true}return false}return true}}function getButtonOrLinkData(buttonOrLink,pageType){try{if(!buttonOrLink){throw"Missing routing information. Please check button or link configuration."}var targetElement=$("[data-id="+buttonOrLink.elementId+"]")[0];var buttonOrLinkString=targetElement&&(targetElement.getAttribute("data-text-value")||targetElement.textContent||"");var buttonOrLinkText=buttonOrLinkString&&buttonOrLinkString.trimStart();var buttonOrLinkData,_fkCart,upsalefkCart,cartProducts=[],productCheck=false;var checkoutPage=pageType===4,upsellPage=pageType===3,checkoutOrUpsellPage=checkoutPage||upsellPage;var _orderData3=JSON.parse(sessionStorage.getItem("orderData"));var shipCountryElement=document.getElementsByName("shipCountry")[0]?document.getElementsByName("shipCountry")[0].value:_orderData3&&_orderData3.shipCountry?_orderData3.shipCountry:null;var shipStateElement=document.getElementsByName("shipState")[0]?document.getElementsByName("shipState")[0].value:_orderData3&&_orderData3.shipState?_orderData3.shipState:null;if(checkoutOrUpsellPage){if(upsellPage){var prodSection=$(targetElement).closest("section.fk-product-section");var id=prodSection&&prodSection.length>0&&prodSection.attr("id");buttonOrLinkText&&!buttonOrLinkText.toLowerCase().startsWith("no")&&getVariants(id);upsalefkCart=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};var upsell=getUpsellFromNavigationItem(buttonOrLink.elementId);if(upsell)upsalefkCart[upsell]=1}else{getVariants();upsalefkCart={}}_fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):{};var cart=_objectSpread(_objectSpread({},_fkCart),upsalefkCart);cartProducts=Object.keys(cart).map(function(cartKey){return cartKey.split(".")[0]})}if(getMembershipDetails()){var routingProducts=cartProducts.concat(getClubMembershipProducts());var linkWithOutProducts=buttonOrLink.linkDetails.find(function(linkDetail){return!linkDetail.products||!linkDetail.products.length});if(checkoutOrUpsellPage){if(buttonOrLink.linkDetails.find(function(link){return link.products&&link.products.length>0})){if(cartProducts.length){productCheck=true;var linkData=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);buttonOrLinkData=linkData.find(function(link){return checkCartProductsAndVariants(link,routingProducts,checkoutPage,shipCountryElement,shipStateElement)})||linkWithOutProducts}else if(linkWithOutProducts){buttonOrLinkData=linkWithOutProducts}else{buttonOrLinkData=buttonOrLink.linkDetails[0]}}else{buttonOrLinkData=linkWithOutProducts?linkWithOutProducts:buttonOrLink.linkDetails[0]}}else{var linkWithProducts=buttonOrLink.linkDetails.find(function(linkDetail){return routingProducts.some(function(productId){return linkDetail.products.includes(productId)})});buttonOrLinkData=linkWithProducts?linkWithProducts:linkWithOutProducts}if(!buttonOrLinkData){throw"There are no products listed on the Page. Please contact customer service."}}else if(checkoutOrUpsellPage&&buttonOrLink.linkDetails.find(function(link){return link.products&&link.products.length>0})){var linkWithNoProducts=buttonOrLink.linkDetails.find(function(link){return!link.products||!link.products.length})||{};if(cartProducts.length){productCheck=true;var _linkData=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);buttonOrLinkData=_linkData.find(function(link){return checkCartProductsAndVariants(link,cartProducts,checkoutPage,shipCountryElement,shipStateElement)})||linkWithNoProducts}else if(Object.keys(linkWithNoProducts).length){buttonOrLinkData=linkWithNoProducts}else{buttonOrLinkData=buttonOrLink.linkDetails[0]}}else{buttonOrLinkData=buttonOrLink.linkDetails[0]||{}}if(checkoutOrUpsellPage&&productCheck){var _linkData2=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);if(buttonOrLinkData.countryStates&&buttonOrLinkData.countryStates!=="{}"){buttonOrLinkData=checkCountryAndState(buttonOrLinkData,shipCountryElement,shipStateElement)?buttonOrLinkData:{}}else{buttonOrLinkData=_linkData2.find(function(link){return link.countryStates&&link.countryStates!=="{}"&&checkCartProductsAndVariants(link,cartProducts,checkoutPage,shipCountryElement,shipStateElement)})||buttonOrLinkData}}if(!productCheck&&checkoutOrUpsellPage&&buttonOrLink.linkDetails.find(function(link){return link.countryStates})){buttonOrLinkData=buttonOrLink.linkDetails.find(function(link){return checkCountryAndState(link,shipCountryElement,shipStateElement)})||{};if(!buttonOrLinkData.countryStates||buttonOrLinkData.countryStates==="{}"){buttonOrLinkData=buttonOrLink.linkDetails.find(function(link){return link.countryStates&&link.countryStates!=="{}"&&checkCountryAndState(link,shipCountryElement,shipStateElement)})||buttonOrLinkData}}return buttonOrLinkData}catch(e){pageType===3&&sessionStorage.removeItem("upsalefkCart");throw e}}function checkRequiredInputs(){var paySource=sessionStorage.getItem("paySource");if(paySource==="SHOPPAY"){return true}var cardFields=["cardNumber","cardSecurityCode","cardMonth","cardYear","cardDate"];/*
    * TBD: "cardMonth", "cardYear" are of type 'select-one' -> Unselected value can include "select", "choose", "pick".  Need to find the proper filter/filter list and do validation.
    */var required=$("input, select").filter(function(index){return $(this).is(":visible")&&($(this).attr("required")||$(this).attr("requiredtype"))});var cardNumberDetails=$("input[name=\"cardNumber\"]");var cardSecurityCodeDetails=$("input[name=\"cardSecurityCode\"]");var ibanElement=document.getElementsByName("iban")[0];var cardNumberValue="";var cvvFlag=false;var paySources=["PAYPAL","GOOGLEPAY","AFFIRM","AMAZON","APPLEPAY","KLARNA","SEZZLE","AFTERPAY","BANCONTACT","IDEAL","GIROPAY","SOFORT","P24","BOLETO","PIX","SEPA_DEBIT","SQUAREV2","SHOPPAY","BITPAY","COD","WITHREACH_PAYPAL"];if(paySource&&paySources.includes(paySource.toUpperCase())&&!sessionStorage.getItem("multiPayRoute")){required=required.filter(function(index,field){return!cardFields.includes(field.name)})}if(paySource==="PAYPAL"){required=required.filter(function(index,field){return field.type==="checkbox"||field.type==="radio"});//do not allow a partial address with paypal
var shipAddress=document.getElementsByName("shipAddress1")[0]?document.getElementsByName("shipAddress1")[0].value:null;if(shipAddress){required.push(document.getElementsByName("shipCity")[0]);required.push(document.getElementsByName("shipPostalCode")[0]);var country=document.getElementsByName("shipCountry")[0]?document.getElementsByName("shipCountry")[0].value:defaultCountryCode;if(["US","CA"].includes(country)){//require ship state for US and Canada
required.push(document.getElementsByName("shipState")[0])}}else{var address=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;if(address){required.push(document.getElementsByName("city")[0]);required.push(document.getElementsByName("postalCode")[0]);var _country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;if(["US","CA"].includes(_country)){//require state for US and Canada
required.push(document.getElementsByName("state")[0])}}}}if(paySource==="SEPA_DEBIT"&&ibanElement){required.push(ibanElement)}if(paySource==="GOOGLEPAY"){var skipBillingFields=$("[name=address1]").length&&!$("[name=shipAddress1]").length;required=required.filter(function(index,field){var fieldName=field.name;if(fieldName==="emailAddress"||fieldName==="phoneNumber"||ship.includes(fieldName)||skipBillingFields&&ccBillingFields.includes(fieldName)){return false}return true})}if(paySource==="AMAZON"){var amazonRebill=sessionStorage.getItem("amazonRebillEnabled");if(amazonRebill){var amazonConsent=sessionStorage.getItem("amazonConsentReceived");if(!amazonConsent)return false}}if(paySource==="APPLEPAY"){var applePayToken=sessionStorage.getItem("applePayToken");if(!applePayToken)return false;required=required.filter(function(index,field){var fieldName=field.name;if(fieldName==="emailAddress"||fieldName==="phoneNumber"||ship.includes(fieldName)||ccBillingFields.includes(fieldName)){return false}return true})}if(paySource==="SQUAREV2"){var squareBtn=document.getElementById("square-card-button");var squareNonce=document.getElementById("formCardNonce");if(squareBtn&&squareNonce&&squareNonce.value==""){squareBtn.click();return}}cardNumberDetails.each(function(index){if(this.name=="cardNumber"){cardNumberValue=$(this).val()}});var inputValue=new Array;var inputWithNoVal=new Array;var checkboxValue=new Array;var phValidationFlag=true;if(phFormatByCountry==="true"){var _input3=document.querySelector(".intelPhoneInput");if(_input3){var errorDisplay=function errorDisplay(){_input3.focus();_input3.classList.add("error");errorMsg.classList.remove("hide");validPhoneNumberFlag="false";$(".intelPhoneInput").css("outline","1px solid red");phValidationFlag=false};var errorMsg=document.querySelector("#error-msg");var placeholder=_input3.getAttribute("placeholder").replace(/[\(\)\-\s]/g,"");placeholder=placeholder.replace(/\D/g,"");var phLength=placeholder.length;var valueLength=_input3.value.replace(/[\(\)\-\s]/g,"").length;if(validPhoneNumberFlag==="false"){_input3.focus();phValidationFlag=false}else if(valueLength&&phLength&&phLength>=4&&valueLength!==phLength){errorDisplay();errorMsg?errorMsg.innerHTML="Please correct the number":""}}}var shipEngine=getAddOnKeyValue(findAddOn("shipEngineEnabled"));var input=document.getElementsByName("shipProfileId")[0];if(shipEngine==="1"&&input&&input.type==="select-one"){var params=getShipProfileAddress();var requiredShipFields={};requiredShipFields.city=params.city;requiredShipFields.state=params.state;requiredShipFields.postalCode=params.postalCode;requiredShipFields.profileId=input.value;var _loop5=function _loop5(){//Modified key for finding shipping inputs
var shippingInput="ship"+field.charAt(0).toUpperCase()+field.slice(1);if(!required.filter(function(index,fieldName){return fieldName.name===shippingInput||fieldName.name!=="profileId"&&fieldName.name===field}).length){var requiredElement=document.getElementsByName(shippingInput)[0]||field!=="profileId"&&document.getElementsByName(field)[0];requiredElement&&required.push(requiredElement)}};for(field in requiredShipFields){_loop5()}}required.each(function(index){var _this=this;var requiredElement=false;var recurring="recurring";var recurringUpperCase="RECURRING";var trial="trial";if(this.type=="checkbox"||this.type=="radio"){if(this.checked==false){if(this.type==="checkbox"){(function(){var requiredType=_this.getAttribute("requiredtype");if(requiredType&&(requiredType===recurring||requiredType===trial)){var _fkCart2=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;var _products2=pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products;if(_fkCart2&&Object.keys(_fkCart2).length>0){var _loop6=function _loop6(sessionItemCpId){_products2.forEach(function(product){if(product.campaignProductId==sessionItemCpId.split(".")[0]){if(requiredType===recurring&&product.billingCycleType===recurringUpperCase||requiredType===trial&&product.trialEnabled){requiredElement=true}}})};for(var sessionItemCpId in _fkCart2){_loop6(sessionItemCpId)}}}else{requiredElement=true}})()}else{requiredElement=true}if(requiredElement){$(this).css("outline","1px solid red");inputWithNoVal.push(this);checkboxValue.push(this.checked);var nextElement=$(this).parent().next()[0];if(!nextElement||!nextElement.innerHTML.includes("Checkbox is required")){$("<div style='color: red;'>Checkbox is required</div>").insertAfter($(this).parent())}}}else{$(this).css("outline","1px solid green");var _nextElement=$(this).parent().next()[0];if(_nextElement&&_nextElement.innerHTML.includes("Checkbox is required")){_nextElement.remove()}}}else{inputValue.push($(this).val()||$(this)[0].value);var fieldName=$(this).attr("placeholder")?$(this).attr("placeholder"):$(this).attr("name");var _nextElement2=$(this).next()[0];if($(this).val()==""||$(this)[0].value==""){$(this).css("outline","1px solid red");inputWithNoVal.push(this);if(!_nextElement2||!_nextElement2.innerHTML.includes(fieldName)){if($(this).attr("name")==="phoneNumber"&&phFormatByCountry==="true"){fieldName="Phone Number";$("<span style='color: red;'>"+fieldName+" is required</span>").insertAfter(this.parentElement)}else{$("<div style='color: red;'>"+fieldName+" is required</div>").insertAfter(this);$(this).attr("fieldValue",fieldName)}}}else{$(this).css("outline","1px solid green");if(_nextElement2&&$(this).attr("fieldValue")&&_nextElement2.innerHTML.includes($(this).attr("fieldValue"))){_nextElement2.remove();$(this).removeAttr("fieldValue")}}}});cardSecurityCodeDetails.each(function(index){var _this2=this;if(cardNumberValue!==""&&this.name=="cardSecurityCode"&&$(this).val()!=""&&$(this).val().length<3){alert("Card Security Code must be at least 3 characters");cvvFlag=true;setTimeout(function(){$(_this2).focus();$(_this2).css("outline","1px solid red")},0)}});var firstReqInput=$(inputWithNoVal[0]);if(firstReqInput.val()==""||firstReqInput.is("[type=checkbox], [type=radio]")&&firstReqInput.prop("checked")===false){firstReqInput.focus()}if(!inputValue.includes("")&&!checkboxValue.includes(false)&&cvvFlag===false&&phValidationFlag===true){return true}else{return false}}function getLoginPageButtonData(funnelData,pageType,buttonItem){if(funnelData&&pageType===7)return buttonItem&&buttonItem.status==="Active"&&getButtonOrLinkData(buttonItem)}function addFFLPopUp(){try{if(document.getElementById("fflWrapper")){return}$("head").append("\n<style>\n.ffl-btn-styles {\n    background-color: #0d6efd;\n    color: white;\n    margin: 15px 0;\n}\n.ffl-btn-styles:focus {\n    background-color: #0d6efd;\n    color: white;\n}\n.ffl-modal-overlay {\n    position: fixed;\n    background-color: #afacaca6;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 10001;\n    display: none;\n}\n.ffl-modal-wrapper {\n    width: 400px;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    -webkit-transform: translate(-50%, -50%);\n    -ms-transform: translate(-50%, -50%);\n    transform: translate(-50%, -50%);\n    z-index: 10002;\n}\n.ffl-modal-container {\n    height: auto;\n    background-color: white;\n    border-radius: 10px;\n    padding: 20px;\n    -webkit-box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;\n    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;\n}\n.ffl-modal-header {\n    font-size: 20px;\n    text-align: center;\n    line-height: 1.2;\n}\n.ffl-modal-field-label {\n    font-size: 16px;\n    margin: 5px 0;\n}\n.ffl-fields-spacing {\n    margin: 15px 0;\n}\n.ffl-modal-close {\n    position: absolute;\n    top: -10px;\n    right: -10px;\n    padding: 8px 10px;\n    cursor: pointer;\n    background-color: #0d6efd;\n    color: white;\n    border-radius: 50%;\n    margin: 0;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n}\n.ffl-margin-botton-30 {\n    margin-bottom: 30px;\n}\n.ffl-input-field-side-spacing {\n    margin-left: 5px;\n    margin-right: 5px;\n}\n.ffl-input-field-side-spacing:first-child {\n    margin-left: 0;\n}\n.ffl-input-field-side-spacing:last-child {\n    margin-right: 0;\n}\n.ffl-icon-container {\n    position: absolute;\n    right: 50%;\n    top: calc(50% - 10px);\n    display: none;\n    -webkit-transform: translateX(+50%);\n    -ms-transform: translateX(+50%);\n    transform: translateX(+50%);\n}\n.ffl-container {\n    display: none;\n}\n.loader {\n    position: relative;\n    height: 20px;\n    width: 20px;\n    display: inline-block;\n    -webkit-animation: around 5.4s infinite;\n    animation: around 5.4s infinite;\n}\n@-webkit-keyframes around {\n    0% {\n        -webkit-transform: rotate(0deg);\n        -ms-transform: rotate(0deg);\n        transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n        -ms-transform: rotate(360deg);\n        transform: rotate(360deg);\n    }\n}\n@keyframes around {\n    0% {\n        -webkit-transform: rotate(0deg);\n        -ms-transform: rotate(0deg);\n        transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n        -ms-transform: rotate(360deg);\n        transform: rotate(360deg);\n    }\n}\n.loader::after, .loader::before {\n    content: \"\";\n    background: transparent;\n    position: absolute;\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    border-width: 2px;\n    border-color: #333 #333 transparent transparent;\n    border-style: solid;\n    border-radius: 20px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    top: 0;\n    left: 0;\n    -webkit-animation: around 0.7s ease-in-out infinite;\n    animation: around 0.7s ease-in-out infinite;\n}\n.loader::after {\n    webkit-animation: around 0.7s ease-in-out 0.1s infinite;\n    animation: around 0.7s ease-in-out 0.1s infinite;\n    background: transparent;\n}\n@media screen and (max-width: 500px) {\n    .ffl-modal-wrapper {\n        width: 90%;\n    }\n}\n</style>\n");$("body").append("\n<div id=\"fflWrapper\" class=\"ffl-modal-overlay\">\n    <div class=\"ffl-modal-wrapper\">\n        <div class=\"ffl-modal-container\">\n            <div class=\"ffl-modal-header ffl-fields-spacing\">Products on this order must ship to a licensed firearm dealer</div>\n            <div class=\"ffl-fields-spacing\">\n                <div class=\"ffl-modal-field-label\">Search By</div>\n                <div>\n                    <select class=\"form-control\" id=\"fflOptions\" name=\"fflFieldOptions\" onchange=\"handleFFLSearchTypeChange()\">\n                        <option value=\"fflZipCode\">Zip Code</option>\n                        <option value=\"fflNumber\">FFL Number</option>\n                        <option value=\"fflName\">FFL Name</option>\n                    <select>\n                </div>\n            </div>\n            <div class=\"ffl-fields-spacing\" id=\"fflSearchFieldBlock\">\n                <div class=\"ffl-fields-spacing\" style=\"display: flex;\">\n                    <div class=\"ffl-input-field-side-spacing\">\n                        <div class=\"ffl-modal-field-label\">Zip Code</div>\n                        <div><input type=\"text\" class=\"form-control\" name=\"fflZipCode\"/></div>\n                    </div>\n                    <div class=\"ffl-input-field-side-spacing\">\n                        <div class=\"ffl-modal-field-label\">Radius (Miles) <span style=\"font-size:12px;\">Optional</span></div>\n                        <div><input type=\"text\" class=\"form-control\" oninput=\"fflRadiusChange()\" name=\"fflRadius\"/></div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"ffl-fields-spacing ffl-margin-botton-30\" style=\"position: relative;\">\n                <button id=\"ffl-search-btn\" class=\"form-control ffl-btn-styles\" onclick=\"searchFFL()\">SEARCH</button>\n                <div class=\"ffl-icon-container\" id=\"fflSelectLoader\">\n                    <i class=\"loader\"></i>\n                </div>\n            </div>\n            <div class=\"ffl-container\" id=\"fflContainer\">\n                <div class=\"ffl-fields-spacing\">\n                    <div class=\"ffl-modal-field-label\">Select a licensed firearm dealer</div>\n                    <div>\n                        <select class=\"form-control\" id=\"fflOptions\" name=\"fflOptions\" required>\n                            <option value=\"\">Select FFL</option>\n                        <select>\n                    </div>\n                </div>\n                <div class=\"ffl-fields-spacing\">\n                    <button class=\"form-control ffl-btn-styles\" onclick=\"addFFL()\">Done</button>\n                </div>\n            </div>\n        </div>\n        <div class=\"ffl-btn-styles ffl-modal-close\" onclick=\"hideFFLPopUp()\">\n            <i class=\"fa fa-times\"></i>\n        </div>\n    </div>\n</div>\n")}catch(err){console.log("Error: Unable to add FFL popup")}}function defaultFFLZipCodeSearch(){var shipPostalCode=pageData&&pageData.pageTypeId===3?globalOrderData&&globalOrderData.shipPostalCode:$("[name=shipPostalCode]").val();var fflZipCodeElement=$("[name=fflZipCode]");if(shipPostalCode&&fflZipCodeElement&&fflZipCodeElement.length){var defaultRadius=$("[name=fflRadius]").val()||10;$("[name=fflZipCode]").val(shipPostalCode);$("[name=fflRadius]").val(defaultRadius);$(".ffl-btn-styles").prop("disabled",true);$(".ffl-icon-container").css("display","block");updateFFLSelectOptions({"zipcode":shipPostalCode,"radius":defaultRadius}).then(function(){$(".ffl-btn-styles").prop("disabled",false);$(".ffl-icon-container").css("display","none")})}}function showFFLPopUp(){$("#fflWrapper").css("display","block");defaultFFLZipCodeSearch()}function hideFFLPopUp(){$(".ffl-btn-styles").prop("disabled",false);$(".ffl-icon-container").css("display","none");$("#fflWrapper").css("display","none")}function evaluateFFLSectionDisplay(){var pageTypeId=pageData&&pageData.pageTypeId;if([4,3].includes(pageTypeId)&&checkFFLProductsInCart(pageTypeId===3?ccUpsellPageFFLProducts:null)){$(".ffl-number").show()}else{$(".ffl-number").hide();pageTypeId!==5&&!(globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber)&&removeFFLInfoFromPage()}}function checkFFLProductsInCart(fflProductsObj){var campaign=pageData&&pageData.selectedCampaign;var campaignFFL=campaign&&campaign.ffl||[];var campaignFFLSize=campaignFFL.length;if(!campaignFFLSize){return false}var upsellPage=pageData&&pageData.pageTypeId===3;var orderItems=upsellPage?fflProductsObj?fflProductsObj:getUpsaleItems():getOrderItems(true);var orderItemsWithoutVariants={};for(var key in orderItems){var id=key.split(".")[0];orderItemsWithoutVariants[id]=orderItems[key]}var products=campaign&&campaign.products.filter(function(item){return orderItemsWithoutVariants[item.campaignProductId]});var orderData=sessionStorage.getItem("orderData");orderData=orderData&&upsellPage?JSON.parse(orderData):{};var shipCountry=upsellPage?orderData.shipCountry:$("[name=shipCountry]").val();var shipState=upsellPage?orderData.shipState:$("[name=shipState]").val();var productCollectionLength=products.length;for(var _i50=0;_i50<productCollectionLength;_i50++){var _item7=products[_i50];var tags=_item7&&_item7.productTags&&_item7.productTags.split(",")||[];if(!tags.length){continue}for(var j=0;j<campaignFFLSize;j++){var _item8=campaignFFL[j];var stateCode=_item8.stateCode;if(tags.indexOf(_item8.productTag)!==-1&&_item8.countryCode===shipCountry&&(stateCode==="*"||stateCode===shipState)){return true}}}}function updateFFLSelectOptions(_x11){return _updateFFLSelectOptions.apply(this,arguments)}function _updateFFLSelectOptions(){_updateFFLSelectOptions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(params){var _data8,res,fflSelect,fflCollection,selectOptionString,message;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.prev=0;_data8=JSON.stringify(params);_context13.next=4;return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Plugin/FFLSearch",_data8);case 4:res=_context13.sent;if(res.result==="SUCCESS"){$("#fflContainer").css("display","block");fflSelect=$("[name=fflOptions]");fflSelect.empty();fflCollection=res.message||[];selectOptionString="<option value=''>"+"Select FFL"+"</option>";fflCollection.forEach(function(item){var licenseName=item.licenseName||item.businessName;if(licenseName){selectOptionString=selectOptionString+"<option value='"+item.fflNumber+"'>"+(licenseName+", "+item.premiseStreet+", "+item.premiseCity+" ("+item.premiseZipCode+")")+"</option>"}});fflSelect.append(selectOptionString)}else{message=res.message;showExceptionInPopupValue()?alert(message):console.log(message)}_context13.next=11;break;case 8:_context13.prev=8;_context13.t0=_context13["catch"](0);console.log(_context13.t0);case 11:case"end":return _context13.stop();}}},_callee13,null,[[0,8]])}));return _updateFFLSelectOptions.apply(this,arguments)}function searchFFL(){return _searchFFL.apply(this,arguments)}function _searchFFL(){_searchFFL=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(){var fflFieldOptions,params,fflNumber,fflZipCode,fflRadius,withDecimalRegEx,withOutDecimalRegEx,radiusData,radius,fflName;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:$(".ffl-btn-styles").prop("disabled",true);$(".ffl-icon-container").css("display","block");fflFieldOptions=document.getElementsByName("fflFieldOptions")[0].value;params={};if(fflFieldOptions==="fflNumber"){fflNumber=document.getElementsByName("fflNumber")[0]&&document.getElementsByName("fflNumber")[0].value;params["fflNumber"]=fflNumber||""}else if(fflFieldOptions==="fflZipCode"){fflZipCode=document.getElementsByName("fflZipCode")[0]&&document.getElementsByName("fflZipCode")[0].value;fflRadius=document.getElementsByName("fflRadius")[0]&&document.getElementsByName("fflRadius")[0].value;withDecimalRegEx=/^[0-9]+.{1}[0-9]+$/;withOutDecimalRegEx=/^[0-9]+$/;params["zipcode"]=fflZipCode||"";if(fflRadius&&(withDecimalRegEx.test(fflRadius)||withOutDecimalRegEx.test(fflRadius))){radiusData=fflRadius.split(".");radius=radiusData[0]+(radiusData[1]?"."+radiusData[1].slice(0,2):"");params["radius"]=parseFloat(radius)}}else if(fflFieldOptions==="fflName"){fflName=document.getElementsByName("fflName")[0]&&document.getElementsByName("fflName")[0].value;params["name"]=fflName||""}_context14.next=7;return updateFFLSelectOptions(params);case 7:$(".ffl-btn-styles").prop("disabled",false);$(".ffl-icon-container").css("display","none");case 9:case"end":return _context14.stop();}}},_callee14)}));return _searchFFL.apply(this,arguments)}function addFFLInfoOnPage(){var fflNumber=sessionStorage.getItem("fflNumber");var pageTypeId=pageData&&pageData.pageTypeId;var fflOptionText=sessionStorage.getItem("fflAddress");var popUpButtonDataId=sessionStorage.getItem("popUpButtonDataId");if([3,4].includes(pageTypeId)&&fflNumber&&fflOptionText&&popUpButtonDataId){var targetButton=$("[data-id='"+popUpButtonDataId+"']");$(".selected-ffl-text").remove();if(targetButton&&targetButton.length){var fflLabel=document.createElement("p");fflLabel.classList.add("selected-ffl-text");fflLabel.innerHTML="FFL: "+fflOptionText+" "+"<i class='fa fa-edit' style='cursor: pointer;' onclick='showFFLPopUp()'></i>"+" <i class='fa fa-times' style='cursor: pointer;' onclick='removeFFLInfoFromPage()'></i>";fflLabel.style.cssText="color:#008000;";$(fflLabel).insertAfter(targetButton)}}}function removeFFLInfoFromPage(){$(".selected-ffl-text").remove();sessionStorage.removeItem("popUpButtonDataId");sessionStorage.removeItem("fflAddress");sessionStorage.removeItem("fflNumber")}function addFFL(){var fflNumber=$("[name=\"fflOptions\"]").val();if(fflNumber){var fflOptionText=$("[name=\"fflOptions\"]").find(":selected").text();sessionStorage.setItem("fflNumber",fflNumber);sessionStorage.setItem("fflAddress",fflOptionText)}addFFLInfoOnPage();hideFFLPopUp()}function handleFFLSearchTypeChange(){var searchByFieldValue=$("[name=fflFieldOptions]").val();var searchFieldBlockObj=$("#fflSearchFieldBlock");$(searchFieldBlockObj).empty();$("[name=fflOptions]").empty();$("[name=fflOptions]").append("<option value=''> Select FFL </option>");var elementString="";switch(searchByFieldValue){case"fflNumber":elementString="<div class='ffl-fields-spacing'><div class='ffl-modal-field-label'>FFL Number</div><div><input type='text' class='form-control' name='fflNumber'/></div></div>";$(searchFieldBlockObj).append(elementString);break;case"fflName":elementString="<div class='ffl-fields-spacing'><div class='ffl-modal-field-label'>FFL Name</div><div><input type='text' class='form-control' name='fflName'/></div><div>";$(searchFieldBlockObj).append(elementString);break;default:elementString="<div class='ffl-fields-spacing' style='display: flex;'><div class='ffl-input-field-side-spacing'><div class='ffl-modal-field-label'>Zip Code</div><div><input type='text' class='form-control' oninput='fflRadiusChange()' name='fflZipCode'/></div></div><div class='ffl-input-field-side-spacing'><div class='ffl-modal-field-label'>Radius (Miles) <span style='font-size:12px;'>Optional</span></div><div><input type='text' class='form-control' name='fflRadius'/></div></div></div>";$(searchFieldBlockObj).append(elementString);defaultFFLZipCodeSearch();}}function fflRadiusChange(){var regex=/^[0-9]*[.]{0,1}[0-9]*$/;var fflRadius=$("[name=fflRadius]").val();if(regex.test(fflRadius)){var radiusData=fflRadius.split(".");var radius=radiusData[0]+(typeof radiusData[1]==="string"?"."+radiusData[1].slice(0,2):"");$("[name=fflRadius]").val(radius);return}var len=fflRadius.length;len&&$("[name=fflRadius]").val(fflRadius.slice(0,len-1))}function fflPopUpRequired(buttonId){var pageType=pageData&&pageData.pageTypeId;if(![4,3].includes(pageType))return false;var fflNumber=sessionStorage.getItem("fflNumber");if(!fflNumber&&checkFFLProductsInCart()){buttonId&&sessionStorage.setItem("popUpButtonDataId",buttonId);sessionStorage.removeItem("paySource");return true}return false}function updateFFLModalButtonCSS(dataSetId){if(!dataSetId){return}var targetBtn=$("[data-id="+dataSetId+"]");if(targetBtn&&targetBtn.length){var bgColor=targetBtn.css("background-color");var color=targetBtn.css("color");if(targetBtn.find(".paypal-buttons").length){bgColor="#0d6efd";color="#ffffff"}else{var btnClasses=["btnPayPal","btnPayPal2","klarnaButton","affirmButton","sezzleButton","afterpayButton","bancontactButton","idealButton","giropayButton","sofortButton","p24Button","boletoButton","pixButton","sepaButton","shopPayButton","bitPayButton","btnGoogle1","btnGoogle2","gpay-button","btnAmazonLight","btnAmazonDark","btnAmazonGold","cod-button","btnApplePay"];var btnClassesLength=btnClasses.length;for(var _i51=0;_i51<btnClassesLength;_i51++){if(targetBtn.hasClass(btnClasses[_i51])){bgColor="#0d6efd";color="#ffffff";break}}}$(".ffl-btn-styles").css({"background-color":bgColor,"color":color})}}function callFFLPopUp(event){if(pageData&&pageData.pageTypeId===3&&globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber)return;event.preventDefault();event.stopPropagation();var datasetId=event.target.dataset.id;updateFFLModalButtonCSS(datasetId);datasetId&&sessionStorage.setItem("popUpButtonDataId",datasetId);showFFLPopUp()}function setPaySourceFromPaymentRadios(buttonTitle){var btnTitle=buttonTitle&&buttonTitle.toUpperCase();var paymentButtonTitles=["PAYPAL","GOOGLEPAY","AFFIRM","AMAZON","APPLE PAY","KLARNA","SEZZLE","AFTERPAY","BANCONTACT","IDEAL","GIROPAY","SOFORT","P24","BOLETO","PIX","SEPA","SQUAREV2","SHOPPAY","BITPAY","COD"];var paymentButtonClicked=paymentButtonTitles.find(function(item){return btnTitle&&btnTitle.includes(item)});if(paymentButtonClicked){return}var paySourceRadios=[].concat(_toConsumableArray(stripeAlternateGateways),_toConsumableArray(multiPayRebillGateways),_toConsumableArray(pagBrasilGateways),["PAYPAL"]);var paymentRadios=$("[name=payment_method], [name=fk-payment-option-toggler]");var paymentRadiosLength=paymentRadios.length;if(paymentRadiosLength){for(var _i52=0;_i52<paymentRadiosLength;_i52++){var radio=$(paymentRadios[_i52]);if(radio.is(":checked")){var paySource=radio.attr("value")||radio.prop("value");paySource=paySource&&paySource.toUpperCase();if(paySource==="CREDITCARD"){sessionStorage.removeItem("paySource")}else if(paySourceRadios.includes(paySource)){if(paySource==="PAYPAL"&&getAddOnKeyValue(findAddOn("PayPal_WithReach"))==="true"){paySource="WITHREACH_PAYPAL"}sessionStorage.setItem("paySource",paySource)}break}}}}function callMethod(e){e.preventDefault();if(e.detail!==1){return}var dataSetId=e.currentTarget.dataset.id;e.currentTarget.disabled=true;var title=e.currentTarget.title;title=title&&title.toUpperCase();if(title&&prepaidGateways.includes(title)){sessionStorage.setItem("paySource",title)}else{title==="AMAZONPAY"&&sessionStorage.setItem("paySource","AMAZON")}var squareBtn=document.getElementById("square-card-button");if(squareBtn){sessionStorage.setItem("paySource","SQUAREV2");localStorage.setItem("squareSubmitBtnId",dataSetId)}callMethodApply(dataSetId)}function callMethodApply(_x12,_x13){return _callMethodApply.apply(this,arguments)}function _callMethodApply(){_callMethodApply=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(buttonId,paypalSdkPrePaidType){var targetButton,targetBtnTitle,clubId,BreakException,route,pageType,buttonItem,buttonData,isBuildOrTemplate,loginButtonData,_response10,pageReferenceId,targetData,targetUrl,isMemberPageType,splitReferenceId,funnelReferenceId,targetPageType,_orderId6,actionBtn,popup,popupRequiredInputs,id;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:targetButton=$("[data-id="+buttonId+"]");targetBtnTitle=targetButton.attr("title")||targetButton.prop("title");setPaySourceFromPaymentRadios(targetBtnTitle);if(!(pageData.pageTypeId===4&&fflPopUpRequired(buttonId))){_context15.next=8;break}updateFFLModalButtonCSS(buttonId);showFFLPopUp();$("[data-id="+buttonId+"]").attr("disabled",false);return _context15.abrupt("return");case 8:clubId=cookieData["clubId"]?parseInt(cookieData["clubId"]):[];BreakException={};_context15.prev=10;if(_typeof(clubId)=="object"){pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){if(product.clubPluginId&&!clubId.includes(product.clubPluginId)){clubId.push(product.clubPluginId)}})}_context15.next=19;break;case 14:_context15.prev=14;_context15.t0=_context15["catch"](10);enableInteractions();if(!(_context15.t0!==BreakException)){_context15.next=19;break}throw _context15.t0;case 19:route=null;pageType=pageData.pageTypeId;buttonItem=getNavigationItemFromPageData(buttonId);_context15.prev=22;buttonData=getButtonOrLinkData(buttonItem,pageType);_context15.next=31;break;case 26:_context15.prev=26;_context15.t1=_context15["catch"](22);if(pageType===8&&buttonData===undefined){updateMember(route=null,clubId,function(){alert(_context15.t1)})}else{alert(_context15.t1)}enableInteractions();return _context15.abrupt("return");case 31:isBuildOrTemplate=checkBuildOrTemplate();if(isBuildOrTemplate){loginButtonData=getLoginPageButtonData(pageData.funnelData,pageType,buttonItem);if(loginButtonData)buttonData=loginButtonData}if(!checkRequiredInputs()){_context15.next=99;break}disableInteractions(buttonId,true,false);if(!isBuildOrTemplate){_context15.next=51;break}route=redirectPath(buttonData,true);_context15.t2=pageType;_context15.next=_context15.t2===2?40:_context15.t2==="leadPage"?40:_context15.t2===15?40:_context15.t2===4?42:_context15.t2==="checkoutPage"?42:_context15.t2===3?44:_context15.t2==="upsellPage"?44:_context15.t2===7?46:_context15.t2==="login"?46:_context15.t2===8?46:_context15.t2==="Profile"?46:_context15.t2===9?46:_context15.t2==="memberAreaPage"?46:_context15.t2===10?46:_context15.t2==="cancelMembership"?46:_context15.t2===11?46:_context15.t2==="restartMembership"?46:_context15.t2===12?46:_context15.t2==="updateCard"?46:_context15.t2===13?46:_context15.t2==="changeProduct"?46:48;break;case 40:importLead(buttonId,route);return _context15.abrupt("break",49);case 42:importOrder(buttonId,route);return _context15.abrupt("break",49);case 44:importUpsale(buttonId,route);return _context15.abrupt("break",49);case 46:membershipRouteForPreview(route);return _context15.abrupt("break",49);case 48:setCurrentWindowLocation(route);case 49:_context15.next=97;break;case 51:pageReferenceId=pageData.currentPage.referenceId;targetData=pageData.funnelData.pages.find(function(item){return item.pageView[0].referenceId===buttonData.targetPageViewReferenceId});//element.targetPageViewReferenceId or targetPage
isMemberPageType=isMembershipPage(pageType);if(isMemberPageType){productData=buttonItem;targetUrl=redirectPath(buttonData,true)}else{splitReferenceId=targetData&&targetData.splitReferenceId||"";funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;if(targetData&&targetData.splitEnabled){targetUrl="https://live-api.checkoutchamp.com/api/V1/SplitTest/funnel/"+funnelReferenceId+"/split/"+splitReferenceId+"/redirect/true/funnelEnvironment/"+getEnvironment()}else{targetUrl=redirectPath(buttonData)}}// let route = pageData[buttonId].NEXT_PAGE.value.pageView[0].url;
route=targetUrl;targetPageType=targetData.pageView[0].pageType;if(targetPageType===32||targetPageType===27){route=targetData.externalURL;_orderId6=sessionStorage.getItem("orderId");if(_orderId6){route=addOrderIdInExternalURL(route,_orderId6)}else if(pageType==15||pageType==4){route=addOrderIdInExternalURL(route,"__ORDERID__")}}if(!(targetPageType===23)){_context15.next=63;break}openPopupIFrame(route);enableInteractions();_context15.next=96;break;case 63:_context15.t3=pageType;_context15.next=_context15.t3===1?66:_context15.t3===21?66:_context15.t3===2?68:_context15.t3==="leadPage"?68:_context15.t3===15?68:_context15.t3===4?70:_context15.t3==="checkoutPage"?70:_context15.t3===3?74:_context15.t3==="upsellPage"?74:_context15.t3===7?78:_context15.t3==="login"?78:_context15.t3===8?80:_context15.t3==="Profile"?80:_context15.t3===9?82:_context15.t3==="memberAreaPage"?82:_context15.t3===10?84:_context15.t3==="cancelMembership"?84:_context15.t3===11?86:_context15.t3==="restartMembership"?86:_context15.t3===12?88:_context15.t3==="updateCard"?88:_context15.t3===13?90:_context15.t3==="changeProduct"?90:_context15.t3===31?92:_context15.t3==="pauseMembership"?92:94;break;case 66:navigationFromPresell(targetPageType,route);return _context15.abrupt("break",96);case 68:importLead(buttonId,route);return _context15.abrupt("break",96);case 70:_context15.next=72;return importOrder(buttonId,route,paypalSdkPrePaidType);case 72:_response10=_context15.sent;return _context15.abrupt("break",96);case 74:_context15.next=76;return importUpsale(buttonId,route);case 76:_response10=_context15.sent;return _context15.abrupt("break",96);case 78:clubLogin(buttonId,clubId,productData);return _context15.abrupt("break",96);case 80:updateMember(route,clubId);return _context15.abrupt("break",96);case 82:memberRoute(productData);return _context15.abrupt("break",96);case 84:cancelMembership(route);return _context15.abrupt("break",96);case 86:restartMembership(route);return _context15.abrupt("break",96);case 88:updateCard(productData);return _context15.abrupt("break",96);case 90:changeProduct(route);return _context15.abrupt("break",96);case 92:pauseMembership(route);return _context15.abrupt("break",96);case 94:logPageAnalyticsOnNavigation(pageType,targetPageType);setCurrentWindowLocation(route);case 96:return _context15.abrupt("return",_response10);case 97:_context15.next=102;break;case 99:actionBtn=$("button[data-id='"+buttonId+"'], a[data-id='"+buttonId+"'], div[data-id='"+buttonId+"']");if(actionBtn&&actionBtn.length&&$(".fk-popup").find(actionBtn[0]).length){popup=$(actionBtn[0]).closest(".fk-popup");popupRequiredInputs=popup.find("input, select").filter(function(index){return $(this).is(":visible")&&($(this).attr("required")||$(this).attr("requiredtype"))&&$(this).val()===""});if(popupRequiredInputs&&popupRequiredInputs.length===0){id=popup.attr("id");hidePopUpBlock(id)}}enableInteractions();case 102:case"end":return _context15.stop();}}},_callee15,null,[[10,14],[22,26]])}));return _callMethodApply.apply(this,arguments)}function openPopupIFrame(route){// Open target as Popup
$("#dialogIframeDiv").html("<iframe class='dialogPopupIframe' src="+getAbsolutePathByUrl(getCurrentWindowLocation().href)+"/"+route+"></iframe>");$("#dialogIframeDiv").dialog&&$("#dialogIframeDiv").dialog("open");$(".dialogPopupIframe").css({"height":"100%","width":"100%","max-height":"90%","border-width":"0"})}function navigationFromPresell(targetPageType,route){// If Navigating to Lead page or Checkout page
if(targetPageType===2||targetPageType===4||targetPageType===15){registerClick(1,function(regClickData){setCurrentWindowLocation(route)})}else{setCurrentWindowLocation(route)}}function navigationFromLeadOrCheckout(targetPageType,route){// If Navigating to Lead page or Checkout page
if(targetPageType===2||targetPageType===4){registerClick(1,function(){setCurrentWindowLocation(route)})}else{setCurrentWindowLocation(route)}}function customItemCheck(customInputs,productId,section){customInputs.each(function(index,input){if(section&&document.getElementsByName("cardNumber").length){input.removeEventListener("change",getVariantsAndDisplay);input.addEventListener("change",getVariantsAndDisplay)}var checkThisInput=!$(input).closest(".fk-product-section")[0];if(section||input.value&&checkThisInput){var _customCart=addItemToCustomCart(productId,input);_customCart&&Object.keys(_customCart).length&&sessionStorage.setItem("customCart",JSON.stringify(_customCart))}})}function generateCustomItemData(buttonId,customInputs){if([4].includes(pageData.pageTypeId)){var currentItem=sessionStorage.getItem("currentItem");var orderItems=getOrderItems();for(var key in orderItems){currentItem=currentItem&&currentItem.split(".")[0];if(key.startsWith(currentItem+".")){currentItem=key}}var navProduct=getOfferFromNavigationItem(buttonId);var _productId4=currentItem?currentItem:navProduct?navProduct:"";customItemCheck(customInputs,_productId4)}}function route(e){e.preventDefault();e.stopPropagation();var elementTagName=e.target.tagName.toLowerCase();if(elementTagName==="button"&&e.detail!==1){return}var pageType=pageData.pageTypeId;var buttonDataID=e.currentTarget.dataset.id;var buttonString=e.currentTarget.textContent||"";var buttonText=buttonString.trimStart();if(elementTagName==="button"&&buttonDataID&&buttonDataID!==""){var button=$("button[data-id='"+buttonDataID+"']")[0];if(button.parentNode.nodeName==="SECTION"){var customName=button.parentNode.attributes.customName?button.parentNode.attributes.customName.value:"";if(customName!==""){customName=customName.replace(" ","_");var custom="custom_"+customName;sessionStorage.setItem(custom,button.innerHTML)}}}var buttonId=e.currentTarget.dataset.id;var buttonItem=getNavigationItemFromPageData(buttonId);var buttonData;try{buttonData=getButtonOrLinkData(buttonItem,pageType)}catch(e){alert(e);return}var targetData=pageData.funnelData.pages.find(function(item){return item.pageView[0].referenceId===buttonData.targetPageViewReferenceId});if(!targetData){routingNotFound();return}var targetPageType=targetData.pageView[0].pageType;if(targetPageType===4&&!checkRequiredInputs()){enableInteractions();return}if(pageType===17||pageType===18){sessionStorage.removeItem("currentItem");var offer=getOfferFromNavigationItem(buttonId);if(offer){var offerButtonElement=document.querySelector("[data-id="+buttonId+"]");var offerButtonVariantValue=offerButtonElement.getAttribute("variantvalue");if(targetPageType===33){var orderItems=getOrderItems();if(offerButtonVariantValue){var itemOfferKey=offer+"."+offerButtonVariantValue;orderItems[itemOfferKey]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(orderItems));callAddToCartEvent(itemOfferKey)}else{orderItems[offer]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(orderItems));callAddToCartEvent(offer)}}else{if(offerButtonVariantValue){var _itemOfferKey=offer+"."+offerButtonVariantValue;sessionStorage.setItem("currentItem",_itemOfferKey)}else{sessionStorage.setItem("currentItem",offer)}buttonId&&buttonId.indexOf("_prodCol")!==-1&&sessionStorage.removeItem("currentItem")}}}else if(pageType===3){if(!buttonText.toLowerCase().startsWith("no")){getVariants()}}else{getVariants()}if(pageType===3&&targetPageType===3){var upsell=getUpsellFromNavigationItem(buttonId);var upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");var upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");var _orderItems=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};if(upsell){if(upsellButtonVariantValue){var _itemOfferKey2=upsell+"."+upsellButtonVariantValue;_orderItems[_itemOfferKey2]=getQuantity()}else{_orderItems[upsell]=getQuantity()}sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems))}}if(targetPageType===4){[4,7].includes(pageType)&&captureLead(true);var offer=getOfferFromNavigationItem(buttonId);var _offerButtonElement=document.querySelector("[data-id="+buttonId+"]");var _offerButtonVariantValue=_offerButtonElement.getAttribute("variantvalue");var _orderItems2=getOrderItems();if(offer){if(_offerButtonVariantValue){var _itemOfferKey3=offer+"."+_offerButtonVariantValue;_orderItems2[_itemOfferKey3]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems2));callAddToCartEvent(_itemOfferKey3)}else{_orderItems2[offer]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems2));callAddToCartEvent(offer)}}else if(pageType===34&&buttonText.toLowerCase()!="proceed to checkout"){var _orderItems3=getOrderItems();offer=sessionStorage.getItem("currentItem");_orderItems3[offer]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems3));callAddToCartEvent(offer)}else if(pageType===4&&document.getElementsByName("cardNumber").length&&$(e.target).closest(".popup_content").length)sessionStorage.removeItem("fkCart")}var customInputs=$(document).find("input[name^='custom_item_']");customInputs.length&&generateCustomItemData(buttonId,customInputs);if(targetPageType===32||targetPageType===27){setCurrentWindowLocation(targetData.externalURL);return}var isBuildOrTemplate=checkBuildOrTemplate();if(isBuildOrTemplate){var loginButtonData=getLoginPageButtonData(pageData.funnelData,pageType,buttonItem);if(loginButtonData){buttonData=loginButtonData}var _route3=redirectPath(buttonData,true);setCurrentWindowLocation(_route3)}else{var funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;var pageReferenceId=pageData.currentPage.referenceId;var splitReferenceId=targetData&&targetData.splitReferenceId||"";var currentUrl=getCurrentWindowLocation().href;var splitUrl=targetData.splitEnabled?"https://live-api.checkoutchamp.com/api/V1/SplitTest/funnel/"+funnelReferenceId+"/split/"+splitReferenceId+"/redirect/true/funnelEnvironment/"+getEnvironment():redirectPath(buttonData);if(targetPageType===23){openPopupIFrame(splitUrl)}else{var _pageReferenceId=pageData.currentPage.referenceId;var _splitReferenceId=targetData.splitReferenceId;var _funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;var isMembershipPageType=isMembershipPage(pageType);if(isMembershipPageType){memberRoute(buttonItem)}else if(pageType===1){navigationFromPresell(targetPageType,splitUrl)}else if(pageType===2||pageType===4){navigationFromLeadOrCheckout(targetPageType,splitUrl)}else{logPageAnalyticsOnNavigation(pageType,targetPageType);setCurrentWindowLocation(splitUrl)}}}}function linkMethod(e,submit,loginRedirect){e.preventDefault();if(e.detail!==1||e.target.tagName==="IMG"&&e.target.getAttribute("href")||e.target.getAttribute("action")==="addToCart"){return}if(submit){e.target.style.pointerEvents="none";var title=e.target.title;setPaySourceFromPaymentRadios(title);if(title&&prepaidGateways.includes(title.toUpperCase())){sessionStorage.setItem("paySource",title.toUpperCase())}}var pageType=pageData.pageTypeId;var buttonId=e.currentTarget.dataset.id;var linkString=e.currentTarget.textContent||"";var linkText=linkString.trimStart();// let buttonData = pageData[buttonId].NEXT_PAGE;
// const linkId = e.target.dataset.id ? e.target.dataset.id : e.target.parentNode.getAttribute("data-id");
// let linkData = pageData[linkId].NEXT_PAGE;
var buttonItem=getNavigationItemFromPageData(buttonId);var buttonData,linkId,linkData,linkObj;try{buttonData=getButtonOrLinkData(buttonItem,pageType);linkId=buttonId?buttonId:$(e.target).closest("[data-id]")[0]?$($(e.target).closest("[data-id]")[0]).attr("data-id"):undefined;linkObj=getNavigationItemFromPageData(linkId);linkData=getButtonOrLinkData(linkObj,pageType)}catch(e){alert(e);return}if(submit&&pageData.pageTypeId===4&&fflPopUpRequired(linkId)){enableInteractions();updateFFLModalButtonCSS(linkId);showFFLPopUp();return}var linkTarget=linkObj?linkObj.target||$("[data-id="+linkObj.elementId+"]").attr("target"):null;if(linkObj&&linkObj.href&&loginRedirect){var loginLinkHref=linkObj.href+"?redirectToMe="+getCurrentWindowLocation().href;linkTarget==="_blank"?window.open(loginLinkHref,""):setCurrentWindowLocation(loginLinkHref);return}submit&&disableInteractions(linkId,false,true);if(pageData.funnelData&&pageData.funnelData.isFunnelTemplate){if(submit){if(checkRequiredInputs()){switch(pageType){// Lead page
case 2:case"leadPage":case 15:importLead(linkId,route);break;// Checkout Page
case 4:case"checkoutPage":importOrder(linkId,route);break;// Upsell Page
case 3:case"upsellPage":importUpsale(linkId,route);break;default:setCurrentWindowLocation(route);}}else{enableInteractions()}}else{if(linkObj.href){linkTarget==="_blank"?window.open(linkObj.href,""):setCurrentWindowLocation(linkObj.href)}else{var _route4=redirectPath(buttonData,true);linkTarget==="_blank"?window.open(_route4,""):setCurrentWindowLocation(_route4)}}}else{var currentUrl=getCurrentWindowLocation().href;var _pageType=pageData.pageTypeId;var pageReferenceId=pageData.currentPage.referenceId;var targetData=pageData.funnelData.pages.find(function(item){return item.pageView[0].referenceId===linkData.targetPageViewReferenceId});if(!targetData){routingNotFound();return}var splitReferenceId=targetData.splitReferenceId;var targetPageType=targetData.pageView[0].pageType;var funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;var _route5=targetData.splitEnabled?"https://live-api.checkoutchamp.com/api/V1/SplitTest/funnel/"+funnelReferenceId+"/split/"+splitReferenceId+"/redirect/true/funnelEnvironment/"+getEnvironment():redirectPath(linkData);if(targetPageType===32||targetPageType===27){_route5=targetData.externalURL;var _orderId3=sessionStorage.getItem("orderId");if(_orderId3){_route5=addOrderIdInExternalURL(_route5,_orderId3)}else if(_pageType==15||_pageType==4){_route5=addOrderIdInExternalURL(_route5,"__ORDERID__")}}if(submit){if(checkRequiredInputs()){//get the route before submitting
if(targetPageType===23){openPopupIFrame(_route5);enableInteractions()}else{switch(_pageType){// Presell and VSL page
case 1:case 21:navigationFromPresell(targetPageType,_route5);break;// Lead page
case 2:case"leadPage":case 15:importLead(linkId,_route5);break;// Checkout Page
case 4:case"checkoutPage":importOrder(linkId,_route5);break;// Upsell Page
case 3:case"upsellPage":importUpsale(linkId,_route5);break;// Change Product Page
case 13:case"changeProduct":changeProduct(_route5);break;default:setCurrentWindowLocation(_route5);}}}else{enableInteractions()}}else{var customInputs=$(document).find("input[name^='custom_item_']");customInputs.length&&generateCustomItemData(buttonId,customInputs);if(targetPageType===23){openPopupIFrame(_route5)}else{if(_pageType===3&&targetPageType===3){var upsell=getUpsellFromNavigationItem(buttonId);var upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");var upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");if(!linkText.toLowerCase().startsWith("no")){getVariants()}var orderItems=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};if(upsell){if(upsellButtonVariantValue){var itemOfferKey=upsell+"."+upsellButtonVariantValue;orderItems[itemOfferKey]=getQuantity()}else{orderItems[upsell]=getQuantity()}sessionStorage.setItem("upsalefkCart",JSON.stringify(orderItems))}}if(targetPageType===4){var offer=getOfferFromNavigationItem(buttonId);var offerButtonElement=document.querySelector("[data-id="+buttonId+"]");var _offerButtonVariantValue2=offerButtonElement.getAttribute("variantvalue");getVariants();var _orderItems4=getOrderItems();if(offer){if(_offerButtonVariantValue2){var _itemOfferKey4=offer+"."+_offerButtonVariantValue2;_orderItems4[_itemOfferKey4]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems4));callAddToCartEvent(_itemOfferKey4)}else{_orderItems4[offer]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems4));callAddToCartEvent(offer)}}else if(_pageType===4&&document.getElementsByName("cardNumber").length&&$(e.target).closest(".popup_content").length)sessionStorage.removeItem("fkCart")}if(_pageType===17||_pageType===18||_pageType===33){var offer="";var productCardContainerParent=$(e.target).closest(".fk-product-card-container").parent();if((_pageType===17||_pageType===18)&&(e.target.parentElement.tagName=="A"||productCardContainerParent.prop("tagName")==="A")){offer=productCardContainerParent.length?productCardContainerParent.attr("offer"):e.target.parentElement.attributes.offer.value}else{offer=e.target.attributes.offer&&e.target.attributes.offer.value||""}sessionStorage.removeItem("currentItem");if(offer!==""){var offerButtonVariantValue="";if((_pageType===17||_pageType===18)&&e.target.parentElement.tagName=="A"){offerButtonVariantValue=e.target.parentElement.attributes.variantvalue.value}else{offerButtonVariantValue=e.target.attributes.variantvalue&&e.target.attributes.variantvalue.value||""}if(offerButtonVariantValue!=""){var _itemOfferKey5=offer+"."+offerButtonVariantValue;sessionStorage.setItem("currentItem",_itemOfferKey5)}else{sessionStorage.setItem("currentItem",offer)}}}logPageAnalyticsOnNavigation(_pageType,targetPageType);var linkHref=linkObj&&linkObj.href;if(linkHref){linkHref=loginRedirect?linkHref+"?redirectToMe="+currentUrl:linkHref;linkTarget==="_blank"?window.open(linkHref,""):setCurrentWindowLocation(linkHref)}else{_route5=loginRedirect?_route5+"?redirectToMe="+currentUrl:_route5;var _funnelReferenceId2=pageData.funnelData?pageData.funnelData.referenceId:null;linkTarget==="_blank"?window.open(_route5,""):setCurrentWindowLocation(_route5)}}}}}function fetchLeadDetails(obj){if(obj.billShipSame===1&&obj.address1){if(document.getElementsByName("fullName")[0]){var fullName=document.getElementsByName("fullName")[0].value.trim();var pos=fullName.indexOf(" ");obj.shipFirstName=pos>-1?fullName.substring(0,pos):fullName;obj.shipLastName=pos>-1?fullName.substring(pos+1):null}else{obj.shipFirstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;obj.shipLastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}obj.shipAddress1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;obj.shipAddress2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;obj.shipCity=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;obj.shipState=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;obj.shipPostalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;obj.shipCountry=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:null}else{var _orderData4=JSON.parse(sessionStorage.getItem("orderData"));if(document.getElementsByName("shipFullName")[0]){var _fullName=document.getElementsByName("shipFullName")[0].value.trim();var _pos=_fullName.indexOf(" ");obj.shipFirstName=_pos>-1?_fullName.substring(0,_pos):_fullName;obj.shipLastName=_pos>-1?_fullName.substring(_pos+1):null}else{obj.shipFirstName=document.getElementsByName("shipFirstName")[0]?document.getElementsByName("shipFirstName")[0].value:_orderData4&&_orderData4.shipFirstName?_orderData4.shipFirstName:null;obj.shipLastName=document.getElementsByName("shipLastName")[0]?document.getElementsByName("shipLastName")[0].value:_orderData4&&_orderData4.shipLastName?_orderData4.shipLastName:null}obj.shipAddress1=document.getElementsByName("shipAddress1")[0]?document.getElementsByName("shipAddress1")[0].value:_orderData4&&_orderData4.shipAddress1?_orderData4.shipAddress1:null;obj.shipAddress2=document.getElementsByName("shipAddress2")[0]?document.getElementsByName("shipAddress2")[0].value:_orderData4&&_orderData4.shipAddress2?_orderData4.shipAddress2:null;obj.shipCity=document.getElementsByName("shipCity")[0]?document.getElementsByName("shipCity")[0].value:_orderData4&&_orderData4.shipCity?_orderData4.shipCity:null;obj.shipState=document.getElementsByName("shipState")[0]?document.getElementsByName("shipState")[0].value:_orderData4&&_orderData4.shipState?_orderData4.shipState:null;obj.shipPostalCode=document.getElementsByName("shipPostalCode")[0]?document.getElementsByName("shipPostalCode")[0].value:_orderData4&&_orderData4.shipPostalCode?_orderData4.shipPostalCode:null;obj.shipCountry=document.getElementsByName("shipCountry")[0]?document.getElementsByName("shipCountry")[0].value:_orderData4&&_orderData4.shipCountry?_orderData4.shipCountry:defaultCountryCode;if(obj.billShipSame===1){obj.country=obj.shipCountry;if(document.getElementsByName("state")[0])obj.state=obj.shipState;//override the geo-located state if no address is entered
}}}function handlePopUpOnScroll(popupBlock){var popupId=popupBlock.getAttribute("id");var minutesDelay=popupBlock.querySelector("[data-minutesdelay]")?Number(popupBlock.querySelector("[data-minutesdelay]").getAttribute("data-minutesdelay")):0;var secondsDelay=popupBlock.querySelector("[data-secondsdelay]")?popupBlock.querySelector("[data-secondsdelay]").getAttribute("data-secondsdelay"):0;var delay=minutesDelay>0?minutesDelay*60+secondsDelay+"000":secondsDelay+"000";document.getElementById(popupId).setAttribute("style","display:none");document.getElementsByTagName("html")[0].style="overflow-y: unset";setTimeout(function(delay){document.getElementById(popupId).setAttribute("style","display:block");document.getElementsByTagName("html")[0].style="overflow-y: hidden"},delay)}window.onscroll=function(){var stickyBar=document.getElementById("stickyBarCustom");var toShowOnScroll=stickyBar&&stickyBar.getAttribute("data-showonscroll")==="yes"?true:false;if(toShowOnScroll){if(window.scrollY>100){document.getElementById("stickyBarCustom").setAttribute("style","display:block")}else{document.getElementById("stickyBarCustom").setAttribute("style","display:none")}}var popupBlock=$(".fk-popup").has("[trigger-on='trigger_on_scroll']")[0];if(popupBlock&&popupBlock.querySelector("[data-showonscroll]")&&popupBlock&&popupBlock.querySelector("[data-showonscroll]").getAttribute("data-showonscroll")==="true"){if(isVisitedOnScroll){handlePopUpOnScroll(popupBlock);isVisitedOnScroll=false}}if(ccIsVisitedOnScrollUp){var offset=window.pageYOffset||document.documentElement.scrollTop;if(offset<ccScrollOffset){var scrollUpPopupBlock=$(".fk-popup").has("[trigger-on='trigger_on_scroll_up']")[0];var scrollUpPopupBody=scrollUpPopupBlock&&scrollUpPopupBlock.querySelector("[data-showonscroll]");if(scrollUpPopupBody&&scrollUpPopupBody.getAttribute("data-showonscrollup")==="true"){handlePopUpOnScroll(scrollUpPopupBlock);ccIsVisitedOnScrollUp=false}}ccScrollOffset=offset<=0?0:offset}if($(".fk-product-row").first().attr("lazyload")==="1"&&fkCollectionSize&&scrolledCardsCount<fkCollectionSize&&!fkCollectionLoader){if(window.scrollY+window.innerHeight>=$(".fk-product-row").prop("scrollHeight")){fkCollectionLoader=true;$("<div id=\"infiniteCardLoader\" class=\"fk-product-loader-wrapper\">\n            <div class=\"fk-product-loader\"></div>\n        </div>\n").insertAfter($(".fk-product-row"));var nextIndex=scrolledCardsCount+scrollCardsSlotSize;sessionStorage.setItem("productRowCardsCount",nextIndex);setTimeout(function(){populateProductRow(fkProductCollection.slice(scrolledCardsCount,nextIndex));scrolledCardsCount=nextIndex;$("#infiniteCardLoader").remove();fkCollectionLoader=false},2000)}}};function calcTheProductInvoiceAmount(ele,key){$("input[name^=\"product\"]").each(function(){if($(this).is(":checked")){var id=$(this).val();var product=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==id});if(product.length===1&&product.length>0){price+=product[0][key]!=null?parseFloat(product[0][key]):0}else{$.each(product,function(i,product){price+=product[key]!=null?parseFloat(product[0][key]):0})}}});ele.innerText=parseFloat(price).toFixed(2)}function downloadURL(event,buttonObj){event.preventDefault();if(event.detail!==1){return}var URL=$(buttonObj).attr("data-downloadurl");if(URL){var linkElement=document.createElement("a");linkElement.href=URL;linkElement.download=true;linkElement.target="blank";document.body.appendChild(linkElement);linkElement.click();document.body.removeChild(linkElement)}else{alert("No URL found")}}function registerPageAnalytics(clickType,pageReferenceId){try{var _response=false;var analyticsReference=sessionStorage.getItem("analyticsReference");analyticsReference=analyticsReference?JSON.parse(analyticsReference):{};var pageRefData=analyticsReference[pageReferenceId];if(pageRefData){if(clickType===1&&pageRefData===1){analyticsReference[pageReferenceId]=2;_response=true}}else{analyticsReference[pageReferenceId]=1;_response=true}sessionStorage.setItem("analyticsReference",JSON.stringify(analyticsReference));return _response}catch(error){console.log(error)}}function registerClick(clickType,callback,pageInfo){var validCallback=callback&&typeof callback==="function";var pageId=pageInfo?pageInfo.pageTypeId:pageData&&pageData.pageTypeId;var pagesWithMissingOrderData=[3,5];var stringifyOrderData=sessionStorage.getItem("orderData");stringifyOrderData=stringifyOrderData!==null?stringifyOrderData:"";var orderDataOnUpsellAndThankYouPage=pagesWithMissingOrderData.includes(pageId)&&!stringifyOrderData;if(orderDataOnUpsellAndThankYouPage){validCallback&&callback();return}var stringifysessionId=sessionStorage.getItem("sessionId");stringifysessionId=stringifysessionId!==null?stringifysessionId:"";var parsedSessionMessage=stringifysessionId?JSON.parse(stringifysessionId):"";var sessionIdValue=parsedSessionMessage&&parsedSessionMessage.message&&parsedSessionMessage.message.sessionId||"";var funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;var pageReferenceId=pageInfo?pageInfo.referenceId:pageData.currentPage.referenceId;var logPageAnalytics=registerPageAnalytics(clickType,pageReferenceId+"-"+sessionIdValue);if(!document.URL.includes("funnels-build")&&logPageAnalytics){var pageTrackerData=JSON.stringify({"sessionStartDateTime":sessionStorage.getItem("sessionStartDateTime")!==null?sessionStorage.getItem("sessionStartDateTime"):"","sessionId":stringifysessionId,"requestUri":sessionStorage.getItem("requestUri")!==null?sessionStorage.getItem("requestUri"):"","httpReferer":sessionStorage.getItem("httpReferer")!==null?sessionStorage.getItem("httpReferer"):"","orderData":stringifyOrderData,"customerOrders":sessionStorage.getItem("customerOrders")!==null?sessionStorage.getItem("customerOrders"):"","products":sessionStorage.getItem("products")!==null?sessionStorage.getItem("products"):"","userDetails":sessionStorage.getItem("userDetails")!==null?sessionStorage.getItem("userDetails"):"","dateTimeNow":new Date().toJSON()});httpMethod("https://live-api.checkoutchamp.com/api/V1/SplitTest/clicks/"+funnelReferenceId+"/"+pageReferenceId+"/"+clickType,pageTrackerData).then(function(data){validCallback&&callback(data)})["catch"](function(err){validCallback&&callback(err)});return}validCallback&&callback()}function previewURL(event){var URL=$(event).attr("data-previewurl");window.open(URL,"_blank")}var prevProdSelectValue=null;function loadProductsToCart(orderItems){var productSelects=_toConsumableArray(document.getElementsByName("productSelect"));var productInputs=[].concat(_toConsumableArray(document.getElementsByName("product")),_toConsumableArray(productSelects));if(productInputs){var deletedItems=[];//set the unchecked boxes
productInputs.forEach(function(product){var productValue=product.getAttribute("value");var variantValue=product.getAttribute("variantvalue");var quantity=product.getAttribute("quantity");if(productValue&&product.tagName.toLowerCase()==="input"){if(variantValue){productValue=productValue+"."+variantValue}if(!product.checked){if(orderItems[productValue]&&(!quantity||orderItems[productValue]==quantity)){deletedItems[productValue]=orderItems[productValue];delete orderItems[productValue]}}}});//set the checked boxes
productInputs.forEach(function(product){var productSelectValue=product.value;var productValue=product.getAttribute("value");var variantValue=product.getAttribute("variantvalue");var quantity=product.getAttribute("quantity");if(product.name==="productSelect"){var productSection=$(product).closest(".fk-product-section")[0];var orderBump=productSection&&$(productSection).closest(".bump-div-class")[0];var isOrderBumpChecked=orderBump&&$(orderBump).find("input[type='checkbox']")[0].checked;var productVariants=productSection&&$(productSection).find("[name='variant1'], [name='variant2'], [name='variant3']").filter("select");if((!productSection&&!orderBump||isOrderBumpChecked&&!productVariants.length)&&productSelectValue!==""&&!orderItems[productSelectValue]){var _quantity=productSection&&productSection.querySelectorAll("input[name='quantity'], select[name='quantity']");orderItems[productSelectValue]=_quantity&&_quantity[0]?_quantity[0].value:1;prevProdSelectValue&&prevProdSelectValue!==productSelectValue&&delete orderItems[prevProdSelectValue];prevProdSelectValue=productSelectValue}}if(productValue&&product.tagName.toLowerCase()==="input"){if(variantValue){productValue=productValue+"."+variantValue}if(product.checked){var productVariantElement=product.closest(".fk-product-variant-select");if(productVariantElement&&(!checkedElement||checkedElement.id!==product.id)){constructProductVariantElement(product,productVariantElement);checkedElement=product;var productTile=$(product).closest("section")[0];productValue=productTile&&productTile.value+"."+productTile.variantvalue}if(!orderItems[productValue]||quantity&&orderItems[productValue]!=quantity){orderItems[productValue]=quantity?quantity:deletedItems[productValue]?deletedItems[productValue]:1}}}});updateReplacementProducts(orderItems)}return orderItems}function getOrderItems(){var loadProducts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var orderItems={};var fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(fkCart&&Object.keys(fkCart).length>0){for(var sessionItemCpId in fkCart){orderItems[sessionItemCpId]=fkCart[sessionItemCpId]}}if(loadProducts){orderItems=loadProductsToCart(orderItems)}sessionStorage.setItem("fkCart",JSON.stringify(orderItems));return orderItems}function getUpsaleItems(){var paySource=sessionStorage.getItem("paySource");var orderItems=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};orderItems=loadProductsToCart(orderItems);if(paySource==="PAYPAL"&&sessionStorage.getItem("paypalUpsaleCart")){if(sessionStorage.getItem("upsalePaypalToken")&&sessionStorage.getItem("upsalePaypalPayerId")){orderItems=JSON.parse(sessionStorage.getItem("paypalUpsaleCart"))}}sessionStorage.setItem("upsalefkCart",JSON.stringify(orderItems));return orderItems}function mergeOfferUpsale(upsaleItems){var orderItems={};var fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(fkCart&&Object.keys(fkCart).length){for(var sessionItemCpId in fkCart){orderItems[sessionItemCpId]=fkCart[sessionItemCpId]}}if(upsaleItems&&Object.keys(upsaleItems).length){for(var upsaleItem in upsaleItems){orderItems[upsaleItem]=upsaleItems[upsaleItem]}}sessionStorage.setItem("fkCart",JSON.stringify(orderItems));sessionStorage.removeItem("upsalefkCart")}var prevOrderItems;function getOrderItemDetails(){var loadProducts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var orderItems=getOrderItems(loadProducts);var products=pageData&&pageData.selectedCampaign?pageData.selectedCampaign.products:null;var detailedOrderItems={};if(products&&Object.keys(orderItems).length>0){var _loop7=function _loop7(campaignProductId){var sessionItemCpId=campaignProductId;var sessionItemVarId=0;if(sessionItemCpId.indexOf(".")>0){var _productData6=sessionItemCpId.split(".");sessionItemCpId=_productData6[0];sessionItemVarId=_productData6[1]}var productDetails=products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId)});if(Object.keys(productDetails).length>0){var obj=JSON.parse(JSON.stringify(productDetails[0]));//deep clone
obj=getMemberPrice(obj);detailedOrderItems[campaignProductId]=obj;detailedOrderItems[campaignProductId]["currentOrderQuantity"]=orderItems[campaignProductId];if(obj.variants&&sessionItemVarId>0){var variantDetails=obj.variants.filter(function(data){return data.variantDetailId===parseInt(sessionItemVarId)});if(Object.keys(variantDetails).length>0){variantDetails[0]=getMemberPrice(variantDetails[0]);detailedOrderItems[campaignProductId]["variant"]=variantDetails[0];if(obj.isEditable){detailedOrderItems[campaignProductId]["variant"]["price"]=obj.cycle1_price;detailedOrderItems[campaignProductId]["variant"]["shippingPrice"]=obj.cycle1_shipPrice}}}}else{delete orderItems[campaignProductId]}};for(var campaignProductId in orderItems){_loop7(campaignProductId)}var _orderData5=JSON.stringify(orderItems);sessionStorage.setItem("fkCart",_orderData5);var multiPayRebillsEnabled=getAddOnKeyValue(findAddOn("multiPayRebills"));if(!multiPayRebillsEnabled&&prevOrderItems!==_orderData5){prevOrderItems=_orderData5;var afterpayButton=document.querySelectorAll(".afterpayButton");var afterPayPara=document.querySelectorAll("afterpay-placement");var display="block";if((afterpayButton||afterPayPara)&&orderItems&&Object.keys(orderItems).length>0){for(var itemId in orderItems){for(var _i53=0;_i53<Object.keys(products).length;_i53++){if(products[_i53].campaignProductId==itemId.split(".")[0]){if(products[_i53].billingCycleType==="RECURRING"){display="none";break}}}if(display==="none")break}}afterpayButton&&afterpayButton.forEach(function(btn){btn.style.display=display==="block"?"inline-block":"none"});afterPayPara&&afterPayPara.forEach(function(ele){ele.style.display=display})}}return detailedOrderItems}function populateProductVariants(variants){if(variants.length>0){for(var key in variants){var productvariants=pageData.selectedCampaign.products.find(function(data){return data.productId===parseInt(variants[key].productId)});if(productvariants){if(!productvariants.variants){pageData.selectedCampaign.products.find(function(data){return data.productId===parseInt(variants[key].productId)}).variants=[]}pageData.selectedCampaign.products.find(function(data){return data.productId===parseInt(variants[key].productId)}).variants.push(variants[key])}}}}function setOrderItemDetails(){var variationIds=[];var orderItems=getOrderItems();var products=pageData&&pageData.selectedCampaign?pageData.selectedCampaign.products:null;if(products&&Object.keys(orderItems).length>0){var _loop8=function _loop8(campaignProductId){var sessionItemCpId=campaignProductId;var sessionItemVarId=0;if(sessionItemCpId.indexOf(".")>0){var _productData7=sessionItemCpId.split(".");sessionItemCpId=_productData7[0];sessionItemVarId=_productData7[1]}var productDetails=products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId)});if(Object.keys(productDetails).length>0){var obj=JSON.parse(JSON.stringify(productDetails[0]));//deep clone
if((!obj.variants||obj.variants.length===0)&&sessionItemVarId>0){variationIds.push(sessionItemVarId)}}};for(var campaignProductId in orderItems){_loop8(campaignProductId)}}return variationIds}function populateVariantAsync(variantDetailId){var params={};params.variantDetailId=variantDetailId;var variantParam=JSON.stringify(params);return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Product/Variant",variantParam)}function getMemberPrice(obj){//look through all the cart products. Do any of them have a club?
obj.isMemberShipping=false;if(obj.memberPricing&&obj.memberPricing.length>0){var clubId=cookieData["clubId"];var membershipInfo=JSON.parse(sessionStorage.getItem("clubMemberships"));var clubProductId=membershipInfo?membershipInfo.map(function(product){return product.actualProductId})[0]:null;if(!clubProductId){var purchases=sessionStorage.getItem("customerPurchases")?JSON.parse(sessionStorage.getItem("customerPurchases")):null;if(purchases&&Object.keys(purchases).length>0){var purchaseEntries=Object.entries(purchases);var purchaseEntriesLength=purchaseEntries.length;for(var _i54=0;_i54<purchaseEntriesLength;_i54++){var _purchase=purchaseEntries[_i54][1];if(["ACTIVE","TRIAL"].includes(_purchase.status)&&_purchase.clubPluginId==clubId){clubProductId=_purchase.actualProductId;break}}}}fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(!clubProductId&&fkCart&&Object.keys(fkCart).length>0){var _loop9=function _loop9(sessionItemCpId){var productDetails=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId.split(".")[0])});if(Object.keys(productDetails).length>0){if(productDetails[0].clubPluginId){clubId=productDetails[0].clubPluginId;clubProductId=productDetails[0].productId;return"break"}}};for(var sessionItemCpId in fkCart){var _ret2=_loop9(sessionItemCpId);if(_ret2==="break")break}}if(clubId&&clubProductId){var memberPrice=obj.memberPricing.find(function(data){return data.clubPluginId==clubId&&data.clubProductId==clubProductId});if(memberPrice){if(obj.variantDetailId){obj.compareAtPrice=obj.price;obj.price=memberPrice.price;obj.shippingPrice=memberPrice.shipPrice}else{obj.compareAtPrice=obj.cycle1_price;obj.cycle1_price=memberPrice.price;obj.cycle1_shipPrice=memberPrice.shipPrice}obj.isMemberShipping=memberPrice.isMemberShipping;if(memberPrice.isFreeShipping)obj.isFreeShipping=memberPrice.isFreeShipping}}}return obj}function getDiscounts(couponCode,orderItems,defaultCoupon,preventDefaultCouponRemoval,defaultCouponApplied){if(!couponCode||Object.keys(orderItems).length===0)return new Promise(function(resolve,reject){resolve(false)});var validCouponCodes=couponCode;if(defaultCouponApplied&&preventDefaultCouponRemoval){validCouponCodes=defaultCoupon+","+validCouponCodes.split(",").filter(function(item){return item!==defaultCoupon}).join(",")}var params={};var index=0;var orderItemEntries=Object.entries(orderItems);var orderItemEntriesLength=orderItemEntries.length;for(var _i55=0;_i55<orderItemEntriesLength;_i55++){var campaignProductId=orderItemEntries[_i55][0];var _item9=orderItemEntries[_i55][1];index++;if(campaignProductId.indexOf(".")>0){var _productData8=campaignProductId.split(".");params["product"+index+"_id"]=_productData8[0];params["variant"+index+"_id"]=_productData8[1]}else{params["product"+index+"_id"]=campaignProductId}params["product"+index+"_qty"]=_item9.currentOrderQuantity;if(altValues[campaignProductId+"|"+_item9.currentOrderQuantity])params["product"+index+"_alt"]=getItemAlt(campaignProductId,_item9.currentOrderQuantity)}params=getBundleVariants(params,index).params;params.campaignId=pageData.selectedCampaign.campaignId;params.couponCode=validCouponCodes;params.shipProfileId=getCurrentShipProfile();if(params.shipProfileId&&params.shipProfileId.indexOf(":")>0){var shipData=params.shipProfileId.split(":");params.shipProfileId=null;params.shipCarrier=shipData[1];params.shipMethod=shipData[3]}var shipAddress=getShipProfileAddress();params.shipState=shipAddress.state;params.shipCountry=shipAddress.country;if(cookieData["access_token"]&&cookieData["customerId"]){params.customerId=cookieData["customerId"]}params.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;params.cartId=pageData.pageTypeId===4?sessionStorage.getItem("cartId"):null;var couponParams=JSON.stringify(params);var existingParams=sessionStorage.getItem("couponParams");if(couponParams!==existingParams&&params.shipCountry){sessionStorage.setItem("couponParams",couponParams);var _response2=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Coupon",couponParams).then(function(data){if(data.result==="SUCCESS"){var couponCodes=validCouponCodes&&validCouponCodes.trim().split(",");var couponCodesLength=couponCodes.length;var ret={couponCode:"",priceDiscount:data.message.priceDiscount?data.message.priceDiscount:0,shipDiscount:data.message.shipDiscount?data.message.shipDiscount:0,coupMessage:"",coupons:[]};var responseCoupons=data.message.coupons;if(responseCoupons&&Object.keys(responseCoupons).length>0){var _i56=0;var _products3=pageData.selectedCampaign.products;var couponEntries=Object.entries(responseCoupons);var couponEntriesLength=couponEntries.length;for(var j=0;j<couponEntriesLength;j++){var code=couponEntries[j][0];var isDefaultCoupon=code===defaultCoupon&&preventDefaultCouponRemoval;var coupon=couponEntries[j][1];ret.coupMessage+="<span style='color:green;font-weight:bold;'>"+code+"</span> ";var coupProd=coupon.products==="whole order"?"Order":getCouponProductNames(_products3,coupon);ret.coupMessage+=coupon.discount+" off "+(coupon.appliesTo=="shipping"?"shipping ":"")+"on "+coupProd+(isDefaultCoupon?"<br>":" <span style='color:red;font-weight:bold;cursor:pointer;' onclick='removeCoupon("+_i56+")'>X</span><br>");ret.coupons.push(code);_i56++}}if(responseCoupons&&Object.keys(responseCoupons).length!==couponCodesLength||!responseCoupons){var validCoupons=Object.keys(responseCoupons||[]);var invalidCoupons=[];for(var _i57=0;_i57<pageData.selectedCampaign.couponMax;_i57++){if(couponCodes[_i57]&&!validCoupons.includes(couponCodes[_i57].trim().toUpperCase())){invalidCoupons.push(couponCodes[_i57])}}var invalidCouponsLength=invalidCoupons.length;if(invalidCouponsLength>0){for(var _j=0;_j<invalidCouponsLength;_j++){var _code=invalidCoupons[_j];if(!(_code===defaultCoupon)){ret.coupMessage+="<span style='color:red;font-weight:bold;'>"+_code+"</span><span>, please enter a valid coupon code.</span><br>"}}}}sessionStorage.setItem("discountsObj",JSON.stringify(ret));return ret}else{alert(data.message);return false}});return _response2}var discounts=sessionStorage.getItem("discountsObj")?JSON.parse(sessionStorage.getItem("discountsObj")):{couponCode:"",priceDiscount:0,shipDiscount:0,coupMessage:"",coupons:appliedCouponCode};return Promise.resolve(discounts)}function getCouponProductNames(products,coupon){var couponProducts=coupon.products.trim().split(",");var couponLabel="";var _loop10=function _loop10(key){var productName=products.find(function(row){return row.campaignProductId===parseInt(couponProducts[key])}).productName;if(productName)couponLabel+=productName+", "};for(var key in couponProducts){_loop10(key)}return couponLabel.slice(0,-2)}function applyCoupon(e){e.preventDefault();var existingCouponCodes=appliedCouponCode;var isEmptyCoupon=true;appliedCouponCode=[];var couponInputs=document.getElementsByName("couponCode");couponInputs.forEach(function(input){if(input.value){isEmptyCoupon=false;var couponCodes=input.value.trim().split(",");couponCodes=couponCodes.concat(existingCouponCodes);couponCodes=couponCodes.filter(function(couponCode){return couponCode.trim().length>0});couponCodes=couponCodes.map(function(couponCode){return couponCode.trim()});// remove whitespaces
couponCodes=couponCodes.filter(function(couponCode,index,coupons){return coupons.indexOf(couponCode)==index});// remove duplicates
if(couponCodes.length>0){appliedCouponCode=couponCodes}else{var coupMessage=document.getElementsByName("coupMessage");if(coupMessage.length){removeItems(coupMessage)}}input.value=""}});if(isEmptyCoupon)appliedCouponCode=existingCouponCodes;else displayPrices()}function removeCoupon(index){var revisedCouponCodes=[];var cCodes=appliedCouponCode?appliedCouponCode:[];for(var i in cCodes){if(i!=index)revisedCouponCodes.push(cCodes[i])}appliedCouponCode=revisedCouponCodes.length>0?revisedCouponCodes:[];document.getElementsByName("couponCode")[0].value=revisedCouponCodes.length>0?revisedCouponCodes.join():[];document.getElementsByName("coupMessage").forEach(function(messageArea){messageArea.innerHTML=""});displayPrices()}//returns shipping profile settings and rules based on selected shipProfileId or campaign's default shipping profile
//used in calculateTotals function as part of price display calculations
function getCurrentShipProfile(){//use shipProfileId input value if available
var profileInputs=document.getElementsByName("shipProfileId");var shipProfileId=profileInputs[0]&&(profileInputs[0].type!=="checkbox"||profileInputs[0].checked)?profileInputs[0].value:null;if(profileInputs.length>1){profileInputs.forEach(function(profile){if(profile.type==="radio"&&profile.checked){shipProfileId=profile.value}})}return shipProfileId}function getShipProfile(){var shipProfileId=getCurrentShipProfile();if(shipProfileId&&shipProfileId.indexOf(":")>0){return shipProfileId}//selectedCampaign shipProfiles property will be empty array when no shipping profiles configured in campaign
if(pageData.selectedCampaign.shipProfiles.length===0)return null;//use campaign's default shipping profile if configured when no shipping profile selected
if((shipProfileId===""||shipProfileId===null)&&pageData.selectedCampaign.defaultShipProfileId!==null){shipProfileId=pageData.selectedCampaign.defaultShipProfileId}if(shipProfileId){var profile=pageData.selectedCampaign.shipProfiles.find(function(data){return data.shipProfileId===parseInt(shipProfileId)});return profile?profile:null}else{return null}}//returns shipping address object with country, state, and continent properties
//used by applyShipProfileProductRules and getShipProfileOrderPrice functions to determine application of shipping profile regional price rules
function getShipProfileAddress(){var shipAddress={};var orderData=JSON.parse(sessionStorage.getItem("orderStatusInfo")||sessionStorage.getItem("orderData"));//use shipCountry input if available OR country input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipCountry")[0]){shipAddress.country=document.getElementsByName("shipCountry")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("country")[0]){shipAddress.country=document.getElementsByName("country")[0].value}else if(orderData&&orderData.shipCountry){shipAddress.country=orderData.shipCountry}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("country")[0]){shipAddress.country=document.getElementsByName("country")[0].value}else if(orderData&&orderData.country){shipAddress.country=orderData.country}else{shipAddress.country=defaultCountryCode}//use shipState input if available OR state input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipState")[0]){shipAddress.state=document.getElementsByName("shipState")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("state")[0]){shipAddress.state=document.getElementsByName("state")[0].value}else if(orderData&&orderData.shipState){shipAddress.state=orderData.shipState}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("state")[0]){shipAddress.state=document.getElementsByName("state")[0].value}else if(orderData&&orderData.state){shipAddress.state=orderData.state}else{shipAddress.state=""}//use shipCity input if available OR city input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipCity")[0]){shipAddress.city=document.getElementsByName("shipCity")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("city")[0]){shipAddress.city=document.getElementsByName("city")[0].value}else if(orderData&&orderData.shipCity){shipAddress.city=orderData.shipCity}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("city")[0]){shipAddress.city=document.getElementsByName("city")[0].value}else if(orderData&&orderData.city){shipAddress.city=orderData.city}else{shipAddress.city=""}//use shipAddress1 input if available OR address1 input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipAddress1")[0]){shipAddress.address1=document.getElementsByName("shipAddress1")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("address1")[0]){shipAddress.address1=document.getElementsByName("address1")[0].value}else if(orderData&&orderData.shipAddress1){shipAddress.address1=orderData.shipAddress1}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("address1")[0]){shipAddress.address1=document.getElementsByName("address1")[0].value}else if(orderData&&orderData.address1){shipAddress.address1=orderData.address1}else{shipAddress.address1=""}//use shipPostalCode input if available OR postalCode input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipPostalCode")[0]){shipAddress.postalCode=document.getElementsByName("shipPostalCode")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("postalCode")[0]){shipAddress.postalCode=document.getElementsByName("postalCode")[0].value}else if(orderData&&orderData.shipPostalCode){shipAddress.postalCode=orderData.shipPostalCode}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("postalCode")[0]){shipAddress.postalCode=document.getElementsByName("postalCode")[0].value}else if(orderData&&orderData.postalCode){shipAddress.postalCode=orderData.postalCode}else{shipAddress.postalCode=""}//use phoneNumber input if available OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){shipAddress.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";shipAddress.phoneNumber=shipAddress.phoneNumber?shipAddress.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{shipAddress.phoneNumber=document.getElementsByName("phoneNumber")[0].value}}else if(orderData&&orderData.phoneNumber){shipAddress.phoneNumber=orderData.phoneNumber}else{shipAddress.phoneNumber=""}//set the continent from selectedCampaign countries based on shipping address country
shipAddress.continent="";if(shipAddress.country){var selectedCampaignCountry=pageData.selectedCampaign.countries.find(function(data){return data.countryCode===shipAddress.country});if(selectedCampaignCountry)shipAddress.continent=selectedCampaignCountry.continent}if(orderData&&orderData.firstName){shipAddress.firstName=orderData.firstName}if(orderData&&orderData.lastName){shipAddress.lastName=orderData.lastName}return shipAddress}//returns orderItems array with updated shipping prices after applying ship profile rules
//used by calculateTotals function when a shipping profile is set and does not apply one shipping price to the entire order
function applyShipProfileProductRules(shipProfile,items){var shipProfileRules=shipProfile.rules;var update=false;//skip this block when ship profile has no regional or product price rules
if(shipProfileRules!==null){//get the shipping address state, country, and continent needed to determine application of regional price rules
var shipAddress=getShipProfileAddress();//loop through the order items and update cycle1_shipPrice based on any applicable price rules
var itemsEntries=Object.entries(items);var itemsEntriesLength=itemsEntries.length;for(var _i58=0;_i58<itemsEntriesLength;_i58++){var prod=itemsEntries[_i58][1];var appliedRule=null;//the ship profile with the most specific applicable price rule that will be applied to item's shipping price
var maxPStrength=0;//used to determine the most specific product price rule - Ex: campaign product specific rule has higher strength (5) than rule that applies to all products (1)
var maxRStrength=0;//used to determine the most specific regional rule - Ex: rule that applies only to state of Georgia has higher strength (3) than rule that applies to all of North America (1)
//loop through shipProfile rules and determine the most specific applicable rule if any
var shipProfileRulesLength=shipProfileRules.length;var _loop11=function _loop11(j){var rule=shipProfileRules[j];if(!verifyShipProfileThresholds(rule))return"continue";var tags=prod.productTags&&prod.productTags.split(",")||[];var ruleTags=rule.productTypeSelect==="TAGS"&&rule.productTags&&rule.productTags.split(",")||[];var tag=tags.filter(function(ele){return ruleTags.includes(ele)});if(ruleTags.length&&!tag.length)return"continue";var pStrength=0;//rule's product strength
var rStrength=0;//rule's region strength
//if rule matches shipping address continent OR country and/or state, assign that regional strength value
if(rule.region){//region value of rules that apply to entire continent all start with "REG_"
if(rule.region.substr(0,4)==="REG_"){if(rule.region.substr(4,2)!==shipAddress.continent)return"continue";rStrength=1}else if(rule.zoneId){var zone=pageData.selectedCampaign.zones.find(function(data){return data.zoneId==rule.zoneId});if(zone&&zone.countryCodes.indexOf(shipAddress.country)>-1){rStrength=2;if(zone.stateCodes){if(shipAddress.state&&zone.stateCodes.indexOf(shipAddress.state)>-1){rStrength=3}else{return"continue"}}}else{return"continue"}}else{if(rule.region===shipAddress.country){rStrength=2;if(rule.state){if(rule.state===shipAddress.state){rStrength=3}else{return"continue"}}}else{return"continue"}}}if(rStrength>=maxRStrength){maxRStrength=rStrength}else{return"continue"}if(rule.productTypeSelect==="SINGLE"&&prod.campaignProductId==rule.campaignProductId){pStrength=5}else if(rule.productTypeSelect==="TAGS"){pStrength=4}else if(rule.productTypeSelect==="CATEGORY"&&prod.productCategoryId==rule.productCategoryId){pStrength=4}else if(rule.productTypeSelect==="OFFERS"&&prod.productType==="OFFER"){pStrength=3}else if(rule.productTypeSelect==="UPSELLS"&&prod.productType==="UPSALE"){pStrength=2}else if(rule.productTypeSelect==="PRODUCTS"){pStrength=1}if(pStrength>maxPStrength){appliedRule=rule;maxPStrength=pStrength}else if(pStrength>0&&pStrength==maxPStrength&&evaluateShipThresholds(appliedRule,rule)){appliedRule=rule;maxPStrength=pStrength}};for(var j=0;j<shipProfileRulesLength;j++){var _ret3=_loop11(j);if(_ret3==="continue")continue}//apply any applicable price rule - if upcharge, rule price is added to current item shipping price - otherwise, rule price overrides current item shipping price
prod.isUpcharge=false;if(appliedRule&&prod.cycle1_isShippable){update=true;if(!prod.isMemberShipping){if(shipProfile.isUpcharge){prod.isUpcharge=true;prod.cycle1_shipPrice=parseFloat(prod.cycle1_shipPrice)+parseFloat(appliedRule.shipPrice);if(prod.variant&&parseFloat(prod.variant.shippingPrice)>0){prod.variant.shippingPrice=parseFloat(prod.variant.shippingPrice)+parseFloat(appliedRule.shipPrice)}}else{prod.cycle1_shipPrice=parseFloat(appliedRule.shipPrice);if(prod.variant&&parseFloat(prod.variant.shippingPrice)>0){prod.variant.shippingPrice=parseFloat(appliedRule.shipPrice)}}}}}}//shipProfiles that only bill the highest shipping price item
if(shipProfile.highestShipPriceOnly){var maxShipCampaignProductId=null;//campaign product ID of item with highest shipping price
var maxShipPrice=0;//highest item shipping price
//loop through order items and determine which item has the highest shipping price
for(var _i59 in items){var _prod=items[_i59];var shipPrice=_prod.variant&&parseFloat(_prod.variant.shippingPrice)>0&&!_prod.isVariantBundle?_prod.variant.shippingPrice:_prod.cycle1_shipPrice;shipPrice=parseFloat(shipPrice);if(shipPrice>maxShipPrice){maxShipCampaignProductId=_i59;maxShipPrice=shipPrice}}//set the shipping price of all other items to zero
for(var _i60 in items){if(_i60!==maxShipCampaignProductId){items[_i60].cycle1_shipPrice=0;if(items[_i60].variant){items[_i60].variant.shippingPrice=0}}}}return{update:update,items:items}}//returns shipping price for the entire order
//used by calculateTotals function when a shipping profile is set and applies one shipping price to the entire order
function getShipProfileOrderPrice(shipProfile){var shipProfileRules=shipProfile.rules;if(shipProfileRules===null)return 0;//get the shipping address state, country, and continent needed to determine application of regional price rules
var shipAddress=getShipProfileAddress();var appliedRule=null;//the ship profile with the most specific applicable price rule that will be applied to item's shipping price
var maxRStrength=0;//used to determine the most specific regional rule - Ex: rule that applies only to state of Georgia has higher strength (3) than rule that applies to all of North America (1)
//loop through shipProfile rules and determine the most specific applicable rule if any
var shipProfileRulesLength=shipProfileRules.length;var _loop12=function _loop12(_i61){var rule=shipProfileRules[_i61];if(!verifyShipProfileThresholds(rule))return"continue";var rStrength=0;//rule's region strength
//if rule matches shipping address continent OR country and/or state, assign that regional strength value
if(rule.region){//region value of rules that apply to entire continent all start with "REG_"
if(rule.region.substr(0,4)==="REG_"){if(rule.region.substr(4,2)!==shipAddress.continent){return"continue"}rStrength=1}else if(rule.zoneId){var zone=pageData.selectedCampaign.zones.find(function(data){return data.zoneId==rule.zoneId});if(zone&&zone.countryCodes.indexOf(shipAddress.country)>-1){rStrength=2;if(zone.stateCodes){if(shipAddress.state&&zone.stateCodes.indexOf(shipAddress.state)>-1){rStrength=3}else{return"continue"}}}else{return"continue"}}else{if(rule.region===shipAddress.country){rStrength=2;if(rule.state){if(rule.state===shipAddress.state){rStrength=3}else{return"continue"}}}else{return"continue"}}}if(rStrength>maxRStrength||rStrength==maxRStrength&&evaluateShipThresholds(appliedRule,rule)){maxRStrength=rStrength;appliedRule=rule}};for(var _i61=0;_i61<shipProfileRulesLength;_i61++){var _ret4=_loop12(_i61);if(_ret4==="continue")continue}return appliedRule?appliedRule.shipPrice:null}function evaluateShipThresholds(appliedRule,rule){//are the rule thresholds more applicable than the currently matched rule?
if(!appliedRule)return true;var valueThreshold=parseFloat(rule.valueThreshold);var weightThreshold=parseFloat(rule.weightThreshold);if(valueThreshold>0&&weightThreshold>0)return valueThreshold>parseFloat(appliedRule.valueThreshold)&&weightThreshold>parseFloat(appliedRule.weightThreshold);if(valueThreshold>0)return valueThreshold>parseFloat(appliedRule.valueThreshold);if(weightThreshold>0)return weightThreshold>parseFloat(appliedRule.weightThreshold);return false}function verifyShipProfileThresholds(rule){if(parseFloat(rule.valueThreshold)>0){var exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;var valueThreshold=parseFloat((parseFloat(rule.valueThreshold)*exchangeRate).toFixed(2));var subTotal=0;var cartProducts=getOrderItemDetails();if(Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i62=0;_i62<cartProductsEntriesLength;_i62++){var _item10=cartProductsEntries[_i62][1];var unitPrice=_item10.variant&&parseFloat(_item10.variant.price)>0&&!_item10.isVariantBundle&&!_item10.isEditable?_item10.variant.price:_item10.cycle1_price;subTotal+=parseFloat(getItemPrice(cartProductsEntries[_i62][0],unitPrice,_item10.currentOrderQuantity).toFixed(2))}}if(valueThreshold>subTotal)return false}if(parseFloat(rule.weightThreshold)>0){var _subTotal=0;var _cartProducts=getOrderItemDetails();if(Object.keys(_cartProducts).length>0){var _cartProductsEntries=Object.entries(_cartProducts);var _cartProductsEntriesLength=_cartProductsEntries.length;for(var _i63=0;_i63<_cartProductsEntriesLength;_i63++){var _item11=_cartProductsEntries[_i63][1];var weight=_item11.variant&&parseFloat(_item11.variant.weight)>0&&!_item11.isVariantBundle?_item11.variant.weight:_item11.weight;var qty=_item11.variant&&parseFloat(_item11.variant.productQty)>1&&!_item11.isVariantBundle?_item11.variant.productQty:_item11.productQty;_subTotal+=parseFloat((weight*_item11.currentOrderQuantity*qty).toFixed(3))}}if(rule.weightThreshold>_subTotal)return false}return true}function getTaxRate(){var taxRate=0;var stateTaxRate=null;var allStatesTaxRate=null;var isVat;var vatTaxRate=1;//selectedCampaign taxes property will be empty array when no tax rates configured in campaign
if(pageData.selectedCampaign.taxes.length===0)return{taxRate:taxRate,isVat:isVat,vatTaxRate:vatTaxRate};//get the shipping address needed to figure out which regional tax rules apply
var shipAddress=getShipProfileAddress();if(shipAddress.country!==""){//filter to only tax profiles for shipping address country
var countryTaxRates=pageData.selectedCampaign.taxes.filter(function(data){return data.countryCode===shipAddress.country});if(countryTaxRates.length!==0){if(shipAddress.state!=="")stateTaxRate=countryTaxRates.find(function(data){return data.stateCode===shipAddress.state});//use specific state if available - otherwise, look for tax profile that applies to all states
if(stateTaxRate){isVat=stateTaxRate.isVat;taxRate=parseFloat(stateTaxRate.taxRate)}else{allStatesTaxRate=countryTaxRates.find(function(data){return data.stateCode==="*"});if(allStatesTaxRate){isVat=allStatesTaxRate.isVat;taxRate=parseFloat(allStatesTaxRate.taxRate)}}}else{//look for tax profile that applies to all countries
var allCountryTaxRates=pageData.selectedCampaign.taxes.filter(function(data){return data.countryCode==="*"});if(allCountryTaxRates.length!==0){isVat=allCountryTaxRates.isVat;taxRate=parseFloat(allCountryTaxRates.taxRate)}}}if(isVat){vatTaxRate=1+taxRate;taxRate=0}var taxParams={taxRate:taxRate,isVat:isVat,vatTaxRate:vatTaxRate};return taxParams}function getExternalTax(orderItems){if(pageData.selectedCampaign&&pageData.selectedCampaign.taxServiceId&&pageData.pageTypeId===4&&Object.keys(orderItems).length>0){var params={};if(pageData.pageTypeId==3){params=getShipProfileAddress()}else{if(document.getElementsByName("fullName")[0]){var fullName=document.getElementsByName("fullName")[0].value.trim();var pos=fullName.indexOf(" ");params.firstName=pos>-1?fullName.substring(0,pos):fullName;params.lastName=pos>-1?fullName.substring(pos+1):null}else{params.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;params.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}params.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;params.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;params.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;params.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;params.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;params.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;if(document.getElementsByName("billShipSame")[0]){params.billShipSame=document.getElementsByName("billShipSame")[0].checked?1:0}else if(document.getElementsByName("address1")[0]&&!document.getElementsByName("shipAddress1")[0]){params.billShipSame=1}fetchLeadDetails(params)}if(!params.shipAddress1||!params.shipCity||!params.shipPostalCode||!params.shipState)return false;params.campaignId=pageData.selectedCampaign.campaignId;params.couponCode=appliedCouponCode.length>0?appliedCouponCode.toString():null;var shipProfile=pageData.selectedCampaign?getShipProfile():null;if(shipProfile&&shipProfile.applyEntireOrder){var _JSON$parse=JSON.parse(sessionStorage.getItem("totals")),shipTotal=_JSON$parse.shipTotal;params.profileShipPrice=shipTotal.toString()}var index=0;for(var sessionItemCpId in orderItems){index++;params["product"+index+"_id"]=orderItems[sessionItemCpId].campaignProductId;params["product"+index+"_qty"]=orderItems[sessionItemCpId].currentOrderQuantity;if(orderItems[sessionItemCpId].variant!==undefined)params["variant"+index+"_id"]=orderItems[sessionItemCpId].variant.variantDetailId;if(altValues[sessionItemCpId+"|"+orderItems[sessionItemCpId].currentOrderQuantity])params["product"+index+"_alt"]=getItemAlt(sessionItemCpId,orderItems[sessionItemCpId].currentOrderQuantity)}params=getBundleVariants(params,index).params;if(cookieData["access_token"]&&cookieData["customerId"]){params.customerId=cookieData["customerId"]}params.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;params.cartId=pageData.pageTypeId===4?sessionStorage.getItem("cartId"):null;var taxParams=JSON.stringify(params);var existingParams=sessionStorage.getItem("taxParams");if(taxParams!==existingParams){sessionStorage.setItem("taxParams",taxParams);var _response3=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/SalesTax/order",taxParams).then(function(data){if(data.result==="SUCCESS"){var salesTax=parseFloat(data.message);var totals=JSON.parse(sessionStorage.getItem("totals"));totals.grandTotal=(totals.grandTotal-totals.salesTax+salesTax).toFixed(2);totals.salesTax=salesTax.toFixed(2);sessionStorage.setItem("totals",JSON.stringify(totals));displayPricesApply()}})}return false}return false}function getExternalShipping(){return _getExternalShipping.apply(this,arguments)}function _getExternalShipping(){_getExternalShipping=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(){var input,shipEngine,params,ip,_orderItems14,_index2,sessionItemCpId,_productData18,symbol,shipParams,existingParams,_response11;return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:input=document.getElementsByName("shipProfileId")[0];if(!(!input||input.type!=="select-one")){_context16.next=3;break}return _context16.abrupt("return");case 3:shipEngine=getAddOnKeyValue(findAddOn("shipEngineEnabled"));if(!(shipEngine==="1")){_context16.next=31;break}params=getShipProfileAddress();params.shipAddress1=params.address1;params.shipCity=params.city;params.shipState=params.state;params.shipCountry=params.country;params.shipPostalCode=params.postalCode;params.shipFirstName="John";params.shipLastName="Smith";if(!(!params.shipCity&&!params.shipPostalCode&&!params.shipState)){_context16.next=18;break}_context16.next=16;return getIpPhysicalAddress();case 16:ip=_context16.sent;if(ip&&ip.zip_code){params.shipCity=ip.city;params.shipState=ip.region_code;params.shipCountry=ip.country_code;params.shipPostalCode=ip.zip_code}case 18:if(!(!params.shipCity||!params.shipPostalCode||!params.shipState)){_context16.next=20;break}return _context16.abrupt("return",false);case 20:_orderItems14=getOrderItems();_index2=0;for(sessionItemCpId in _orderItems14){_index2++;if(sessionItemCpId.indexOf(".")>0){_productData18=sessionItemCpId.split(".");params["product"+_index2+"_id"]=_productData18[0];params["variant"+_index2+"_id"]=_productData18[1]}else{params["product"+_index2+"_id"]=sessionItemCpId}params["product"+_index2+"_qty"]=_orderItems14[sessionItemCpId];if(altValues[sessionItemCpId+"|"+_orderItems14[sessionItemCpId]])params["product"+_index2+"_alt"]=getItemAlt(sessionItemCpId,_orderItems14[sessionItemCpId])}params=getBundleVariants(params,_index2).params;if(cookieData["access_token"]&&cookieData["customerId"]){params.customerId=cookieData["customerId"]}params.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;params.cartId=pageData.pageTypeId===4?sessionStorage.getItem("cartId"):null;symbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";shipParams=JSON.stringify(params);existingParams=sessionStorage.getItem("shipParams");if(shipParams!==existingParams){sessionStorage.setItem("shipParams",shipParams);_response11=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/SalesTax/Shiprate",shipParams).then(function(data){if(data.result==="SUCCESS"){$("[name=shipProfileId] option").each(function(){if($(this).val().includes(":")){$(this).remove()}});var dataMessage=data.message;if(!dataMessage||dataMessage.length===0)return;var dataMessageLength=dataMessage.length;for(var _i129=0;_i129<dataMessageLength;_i129++){var profile=dataMessage[_i129];var option=document.createElement("OPTION");option.value=profile.rateId+":"+profile.serviceType+":"+profile.shippingAmount+":"+profile.carrierName;option.innerHTML=profile.serviceType+" ("+ccFormatCurrency(parseFloat(profile.shippingAmount).toFixed(2),symbol)+")";input.add(option)}displayPrices();input.addEventListener("change",function(){displayPrices()})}})}case 31:return _context16.abrupt("return",false);case 32:case"end":return _context16.stop();}}},_callee16)}));return _getExternalShipping.apply(this,arguments)}function calculateTotals(){return _calculateTotals.apply(this,arguments)}function _calculateTotals(){_calculateTotals=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(){var subTotal,salesTax,shipTotal,discount,insurance,savings,compareAtTotal,_orderData7,skipConvert,totalShipping,freeShipping,shippableOrder,shipProfile,taxRate,currentOrderItems,shipData,currentOrderItemsEntries,currentOrderItemsEntriesLength,_i130,campaignProductId,_item24,unitPrice,shipPrice,qty,compareAtPrice,freeShipThreshold,entireOrderShipPrice,taxable,checkoutPage,defaultCoupon,preventDefaultCouponRemoval,defaultCouponApplied,discounts,coupMessage,exchangeRate,applyCouponButton,couponCodeInput,_defaultCoupon,totals,_totals;return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:subTotal=0;salesTax=0;shipTotal=0;discount=0;insurance=0;savings=0;compareAtTotal=0;if(document.getElementsByName("insureShipment")[0]&&document.getElementsByName("insureShipment")[0].checked===true){insurance=parseFloat(document.getElementById("shipmentInsurancePrice").value)}if(!(pageData.pageTypeId==5)){_context17.next=18;break}_orderData7=JSON.parse(sessionStorage.getItem("orderData"));if(!_orderData7){_context17.next=18;break}subTotal=parseFloat(_orderData7.subTotal)+parseFloat(_orderData7.discountPrice);salesTax=parseFloat(_orderData7.taxTotal);if(_orderData7.vatSubTotal){subTotal=parseFloat(_orderData7.vatSubTotal);salesTax=0}shipTotal=parseFloat(_orderData7.shipTotal);discount=parseFloat(_orderData7.totalDiscount);skipConvert=_orderData7.currencyCode===(returnCurrencyCode()||pageData.selectedCampaign.currency);return _context17.abrupt("return",prepareTotals(subTotal,salesTax,shipTotal,discount,0,0,0,skipConvert));case 18:getExternalShipping();loadShipProfiles();totalShipping=0;freeShipping=false;shippableOrder=false;shipProfile=pageData.selectedCampaign?getShipProfile():null;taxRate=pageData.selectedCampaign?getTaxRate().taxRate:0;currentOrderItems=getOrderItemDetails();if(shipProfile&&typeof shipProfile==="string"&&shipProfile.indexOf(":")>0){shipData=shipProfile.split(":");totalShipping=parseFloat(shipData[2]);shipProfile=null;if(pageData.selectedCampaign.defaultShipProfileId!==null){shipProfile=pageData.selectedCampaign.shipProfiles.find(function(data){return data.shipProfileId===parseInt(pageData.selectedCampaign.defaultShipProfileId)});if(shipProfile){shipProfile.applyEntireOrder=1}}}if(Object.keys(currentOrderItems).length>0){//when shipping profile is set and does not apply to entire order, get currentOrderItems with updated shipping prices after applying ship profile rules
if(shipProfile&&!shipProfile.applyEntireOrder)currentOrderItems=applyShipProfileProductRules(shipProfile,currentOrderItems).items;//total up subTotal (price) and shipTotal (shipping)
currentOrderItemsEntries=Object.entries(currentOrderItems);currentOrderItemsEntriesLength=currentOrderItemsEntries.length;for(_i130=0;_i130<currentOrderItemsEntriesLength;_i130++){campaignProductId=currentOrderItemsEntries[_i130][0];_item24=currentOrderItemsEntries[_i130][1];unitPrice=_item24.variant&&parseFloat(_item24.variant.price)>0&&!_item24.isVariantBundle&&!_item24.isEditable?_item24.variant.price:_item24.cycle1_price;shipPrice=_item24.variant&&parseFloat(_item24.variant.shippingPrice)>0&&!_item24.isVariantBundle?_item24.variant.shippingPrice:_item24.cycle1_shipPrice;subTotal+=parseFloat(getItemPrice(campaignProductId,unitPrice,_item24.currentOrderQuantity).toFixed(2));qty=shipProfile&&!shipProfile.applyEntireOrder&&_item24.isUpcharge?1:_item24.currentOrderQuantity;shipTotal+=parseFloat(getShipPrice(shipPrice,qty).toFixed(2));shippableOrder=_item24.cycle1_isShippable?true:shippableOrder;if(_item24.isFreeShipping)freeShipping=true;compareAtPrice=_item24.compareAtPrice&&parseFloat(_item24.compareAtPrice)>0?_item24.compareAtPrice:unitPrice;compareAtPrice=_item24.variant&&_item24.variant.compareAtPrice&&parseFloat(_item24.variant.compareAtPrice)>0&&!_item24.isVariantBundle?_item24.variant.compareAtPrice:compareAtPrice;compareAtTotal+=parseFloat(getItemPrice(campaignProductId,compareAtPrice,_item24.currentOrderQuantity).toFixed(2));savings=compareAtTotal>subTotal?compareAtTotal-subTotal:0}}if(shipProfile){//when shipping profile applies one shipping price to the entire order
freeShipThreshold=shipProfile.freeShipThreshold?parseFloat(shipProfile.freeShipThreshold):0;if(shipProfile.applyEntireOrder){entireOrderShipPrice=totalShipping>0?totalShipping:getShipProfileOrderPrice(shipProfile);//if upcharge, shipping profile price is added to current order shipping total
if(shipProfile.isUpcharge){shipTotal+=parseFloat(entireOrderShipPrice)}else if(entireOrderShipPrice&&(shipProfile.rules!==null||freeShipThreshold==0)){//otherwise, shipping profile price overrides current order shipping total
shipTotal=parseFloat(entireOrderShipPrice)}}//when shipping profile freeShipThreshold is set, if order subTotal is greater than or equal to freeShipThreshold, order's shipping is free - Ex: Free shipping for orders $50 and over
if(freeShipThreshold>0&&subTotal>=freeShipThreshold)shipTotal=0}else if(totalShipping>0){shipTotal=totalShipping}if($("input[type=checkbox][freeshipping=true]").is(":checked")||freeShipping||!shippableOrder)shipTotal=0;//total amount (price) without shipping or discounts is taxable
taxable=subTotal;checkoutPage=pageData.pageTypeId==4;defaultCoupon=pageData.selectedCampaign.defaultCouponCode;preventDefaultCouponRemoval=getAddOnKeyValue(findAddOn("PRE_COUPON_REMOVAL"))==="true";defaultCouponApplied=appliedCouponCode.includes(defaultCoupon);if(checkoutPage&&preventDefaultCouponRemoval&&defaultCoupon&&!defaultCouponApplied){appliedCouponCode.splice(0,0,defaultCoupon);defaultCouponApplied=true}if(!(appliedCouponCode&&appliedCouponCode.length>0&&checkoutPage)){_context17.next=50;break}prepareTotals(subTotal,salesTax,shipTotal,discount,insurance,savings,compareAtTotal);_context17.next=40;return getDiscounts(appliedCouponCode.toString(),currentOrderItems,defaultCoupon,preventDefaultCouponRemoval,defaultCouponApplied);case 40:discounts=_context17.sent;coupMessage=document.getElementsByName("coupMessage");if(discounts){discount+=discounts.priceDiscount+discounts.shipDiscount;//Reduce taxable by price discount
exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;taxable-=!pageData.selectedCampaign.ccCurrencySendToGateway?parseFloat((discounts.priceDiscount*exchangeRate).toFixed(2)):discounts.priceDiscount;if(discounts.coupMessage){if(coupMessage.length){removeItems(coupMessage)}applyCouponButton=$("button[action=applyCoupon]");couponCodeInput=$("[name=couponCode]");if(applyCouponButton.length&&couponCodeInput.length){applyCouponButton.after("<span name='coupMessage'><br>"+discounts.coupMessage+"</span>")}else if(couponCodeInput.length){couponCodeInput.after("<span name='coupMessage'><br>"+discounts.coupMessage+"</span>")}}else if(coupMessage.length){removeItems(coupMessage)}appliedCouponCode=discounts.coupons}else{if(coupMessage.length){removeItems(coupMessage)}_defaultCoupon=pageData.selectedCampaign.defaultCouponCode;appliedCouponCode=_defaultCoupon&&appliedCouponCode.includes(_defaultCoupon)?handleCouponSplit(_defaultCoupon):[]}if(pageData.selectedCampaign&&pageData.selectedCampaign.taxServiceId&&pageData.selectedCampaign.autoTax){getExternalTax(currentOrderItems);totals=JSON.parse(sessionStorage.getItem("totals"));salesTax=totals?parseFloat(totals.salesTax):salesTax}else{salesTax=taxRate*taxable}calculateShipInsurance(subTotal);prepareTotals(subTotal,salesTax,shipTotal,discount,insurance,savings,compareAtTotal);displayPricesApply();return _context17.abrupt("return",true);case 50:if(pageData.selectedCampaign&&pageData.selectedCampaign.taxServiceId&&pageData.selectedCampaign.autoTax){getExternalTax(currentOrderItems);_totals=JSON.parse(sessionStorage.getItem("totals"));salesTax=_totals?parseFloat(_totals.salesTax):salesTax}else{salesTax=taxRate*taxable}calculateShipInsurance(subTotal);return _context17.abrupt("return",prepareTotals(subTotal,salesTax,shipTotal,discount,insurance,savings,compareAtTotal));case 53:case"end":return _context17.stop();}}},_callee17)}));return _calculateTotals.apply(this,arguments)}function removeItems(items,limit,removeLabel){var index=limit?limit:0;for(var _i64=items.length-1;_i64>=index;_i64--){!removeLabel&&items[_i64].remove();removeLabel&&$(items[_i64]).closest(".fk-element-container").remove()}}function prepareTotals(subTotal,salesTax,shipTotal,discount,insurance,savings,compareAtTotal,skipConvert){subTotal=parseFloat(subTotal.toFixed(2));salesTax=parseFloat(salesTax.toFixed(2));shipTotal=parseFloat(shipTotal.toFixed(2));discount=parseFloat(discount.toFixed(2));insurance=parseFloat(insurance.toFixed(2));savings=parseFloat(savings.toFixed(2));compareAtTotal=parseFloat(compareAtTotal.toFixed(2));if(sessionStorage.getItem("exchangeRate")&&!skipConvert){var exchangeRate=sessionStorage.getItem("exchangeRate");subTotal=pageData.pageTypeId===5?parseFloat((subTotal*exchangeRate).toFixed(2)):subTotal;discount=!pageData.selectedCampaign.ccCurrencySendToGateway?parseFloat((discount*exchangeRate).toFixed(2)):discount;shipTotal=pageData.pageTypeId===5?parseFloat((shipTotal*exchangeRate).toFixed(2)):shipTotal;salesTax=pageData.pageTypeId===5?parseFloat((salesTax*exchangeRate).toFixed(2)):salesTax;insurance=parseFloat((insurance*exchangeRate).toFixed(2))}var grandTotal=(subTotal+shipTotal+salesTax+insurance-discount).toFixed(2);var totals={subTotal:subTotal,salesTax:salesTax,shipTotal:shipTotal,grandTotal:grandTotal,discount:discount,insurance:insurance,savings:savings,compareAtTotal:compareAtTotal};sessionStorage.setItem("totals",JSON.stringify(totals));return totals}function displayPrices(evaluateFFL){if(pageData.pageTypeId==3){if($(".dynamic-price-total, .dynamic-shipping-total, .salesTax, .grandTotal, .discount, .insurance, .savings, .compareAtTotal").length==0)return;//get upsell button or link product and display totals on page
var upsellProduct;var upsellVariant;var upsellQuantity=getQuantity();var buttonsAndLinks=document.querySelectorAll("button,a");buttonsAndLinks.forEach(function(element){var productButtonValue=element.getAttribute("upsell");if(productButtonValue&&parseInt(productButtonValue)>0){upsellProduct=productButtonValue;upsellVariant=parseInt(element.getAttribute("variant"));if(parseInt(element.getAttribute("quantity"))>0)upsellQuantity=parseInt(element.getAttribute("quantity"))}});if(upsellProduct){var orderItems={};upsellProduct+=upsellVariant?"."+upsellVariant:"";orderItems[upsellProduct]=upsellQuantity;sessionStorage.setItem("fkCartSave",sessionStorage.getItem("fkCart"));sessionStorage.setItem("fkCart",JSON.stringify(orderItems));calculateTotals();displayPricesApply();sessionStorage.setItem("fkCart",sessionStorage.getItem("fkCartSave"));sessionStorage.removeItem("fkCartSave")}}else{calculateTotals();if(!appliedCouponCode||appliedCouponCode.length===0||pageData.pageTypeId===9)displayPricesApply();if(window.ltk){callLisTrakConversion(window.ltk,"CaptureEmail");callLisTrakConversion(window.ltk,"UpdateCart")}}!evaluateFFL&&evaluateFFLSectionDisplay();renderPopupCartDetails()}function displayPricesApply(){var _JSON$parse2=JSON.parse(sessionStorage.getItem("totals")),subTotal=_JSON$parse2.subTotal,salesTax=_JSON$parse2.salesTax,shipTotal=_JSON$parse2.shipTotal,grandTotal=_JSON$parse2.grandTotal,discount=_JSON$parse2.discount,insurance=_JSON$parse2.insurance,savings=_JSON$parse2.savings,compareAtTotal=_JSON$parse2.compareAtTotal;var symbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";if(cellFormat.length>0){cartDisplay()}$(".cc-cart-container").length&&ccDisplayCustomCart();pageData.pageTypeId===9&&confirmation();if(document.getElementsByClassName("panelCartCircle")[0]){panelCartCircleUpdate()}var totalAmountElement=document.getElementById("totalAmountIs");if(totalAmountElement)totalAmountElement.innerHTML=ccFormatCurrency(parseFloat(subTotal).toFixed(2),symbol);var shippingChargesElement=document.getElementById("shippingCharges");if(shippingChargesElement)shippingChargesElement.innerHTML=ccFormatCurrency(parseFloat(shipTotal).toFixed(2),symbol);var priceElementClassMap=[["dynamic-price-total",subTotal],["dynamic-shipping-total",shipTotal],["salesTax",salesTax],["grandTotal",grandTotal],["discount",discount],["insurance",insurance],["savings",savings],["compareAtTotal",compareAtTotal]];var priceElementClassMapLength=priceElementClassMap.length;for(var _i65=0;_i65<priceElementClassMapLength;_i65++){var key=priceElementClassMap[_i65][0];var value=priceElementClassMap[_i65][1];var displayElements=document.getElementsByClassName(key);var displayElementsLength=displayElements.length;if(displayElementsLength>0){for(var j=0;j<displayElementsLength;j++){var element=displayElements[j];if(key==="discount"&&parseFloat(value)>0){element.innerHTML="-"+ccFormatCurrency(parseFloat(value).toFixed(2),symbol)}else{element.innerHTML=ccFormatCurrency(parseFloat(value).toFixed(2),symbol)}}}}pageData.pageTypeId===9&&getLoginOrderDetails();displayGatewayScripts()}function addProduct(event){displayPrices()}function addToCart(event){var campaignProductId=event.target.value;var orderItems=getOrderItems();orderItems[campaignProductId]=1;sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices()}function deselectVariantRadioTiles(campaignProductId){var productId=campaignProductId&&campaignProductId.split(".")[0];if(!productId){return}var section=$("section[name='product'][value='"+productId+"']");var tilesInputs=section&&section.length&&section.find("input[type='radio'][class='variant-radio']");var tilesInputLength=tilesInputs&&tilesInputs.length||0;for(var _i66=0;_i66<tilesInputLength;_i66++){var _item12=tilesInputs[_i66];_item12.checked=false;var styleObj={"box-shadow":"none"};var radioName=_item12.name.toLowerCase();radioName=radioName.split("-")[0];if(radioName==="color"){styleObj["border"]="2px solid rgb(197, 202, 205)"}else{styleObj["background-color"]="transparent"}$(_item12.parentElement).css(styleObj);_item12.parentElement.dataset.selected="false"};}function removeFromCart(campaignProductId){var orderItems=getOrderItems();delete orderItems[campaignProductId];sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices();deselectVariantRadioTiles(campaignProductId);openNav()}function plusQuantity(campaignProductId){var orderItems=getOrderItems();var currentQty=parseInt(orderItems[campaignProductId]);if(orderItems[campaignProductId]){if(orderItems[campaignProductId]<999){orderItems[campaignProductId]=(currentQty+1).toString()}}else orderItems[campaignProductId]=1;sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices()}function minusQuantity(campaignProductId,element){var orderItems=getOrderItems();if(parseInt(orderItems[campaignProductId])>1||$(element).closest(".fk-shopping-cart-quantity-wrapper-class").length===0){if(orderItems[campaignProductId]){var currentQty=parseInt(orderItems[campaignProductId]);orderItems[campaignProductId]=(currentQty-1).toString();if(orderItems[campaignProductId]<1)delete orderItems[campaignProductId]}sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices()}else{element.setAttribute("disabled","true")}}function panelCartCircleUpdate(){var cartProducts=getOrderItemDetails();var numberOfCartItems=0;if(cartProducts&&Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i67=0;_i67<cartProductsEntriesLength;_i67++){numberOfCartItems+=parseInt(cartProductsEntries[_i67][1].currentOrderQuantity)}document.getElementsByClassName("panelCartCircle")[0].innerHTML=numberOfCartItems}else{document.getElementsByClassName("panelCartCircle")[0].innerHTML=0}}function updateCSSForShoppingCartSections(element){$(element).css({"overflow-wrap":"normal","word-wrap":"normal","word-break":"normal"})}function createCustomProperties(customCartProperty,accordionDynamicCartRow,accordionEmptyDynamicCartData,accordionDynamicCartData,customProperties,firstProperty,rebillCartFrequency){if(customCartProperty){var quantity;var newDynamicHorizontalLine=document.createElement("hr");var productDetails=customCartProperty.split("|");productDetails.splice(0,1);var productDetailsLength=productDetails.length;for(var j=0;j<productDetailsLength;j++){if(j==0){quantity=document.createElement("p");quantity.innerHTML="<b>Quantity</b>"+": "+productDetails[j];customProperties.appendChild(quantity)}else{var customPropertiesData=document.createElement("p");var productDetailsCollection=productDetails[j].split(":");if(productDetailsCollection.length>2){productDetailsCollection=productDetailsCollection.slice(0,2)}var productDetailsString=productDetailsCollection.join(":");var highlightPropertyName="<b>"+productDetailsCollection[0]+"</b>";var formattedProperty=productDetailsString.replace(productDetailsCollection[0],highlightPropertyName);customPropertiesData.innerHTML=formattedProperty.replaceAll(":",": ");customProperties.appendChild(customPropertiesData)}!firstProperty&&j==0&&quantity.prepend(newDynamicHorizontalLine);accordionDynamicCartData.appendChild(customProperties);accordionDynamicCartRow.appendChild(accordionEmptyDynamicCartData);accordionDynamicCartRow.appendChild(accordionDynamicCartData)}}if(rebillCartFrequency){var _customPropertiesData=document.createElement("p");_customPropertiesData.innerHTML=rebillCartFrequency;customProperties.append(_customPropertiesData);accordionDynamicCartData.appendChild(customProperties);accordionDynamicCartRow.appendChild(accordionEmptyDynamicCartData);accordionDynamicCartRow.appendChild(accordionDynamicCartData)}}function ccDisplayCustomCart(){var pageId=pageData.pageTypeId;var memberAreaPage=pageId===9;var thankyouPage=pageId===5;var disableActions=[3,5,9].includes(pageId);var cartProducts=memberAreaPage?getLoginOrderDetails().items||{}:getOrderItemDetails();if(thankyouPage&&sessionStorage.getItem("orderData")&&!(cartProducts&&Object.keys(cartProducts).length)){var sessionOrderData=JSON.parse(sessionStorage.getItem("orderData"));cartProducts=sessionOrderData&&sessionOrderData.items||{};memberAreaPage=true}var cartProductsLength=Object.keys(cartProducts).length;var cartElement=$(".cc-cart-container");if(!cartProductsLength){cartElement.css("display","none")}else{cartElement.css("display","block")}var cartElementLength=cartElement.length;if(cartElementLength){var _customCart2=sessionStorage.getItem("customCart");_customCart2=_customCart2&&JSON.parse(_customCart2)||{};var upsaleComboProducts=sessionStorage.getItem("upsaleComboProducts");upsaleComboProducts=upsaleComboProducts&&JSON.parse(upsaleComboProducts);if(upsaleComboProducts&&upsaleComboProducts.length){var customCartCount=_customCart2?Object.keys(_customCart2).length:0;upsaleComboProducts.forEach(function(item,index){_customCart2[customCartCount+index]=item})}var processedCustomCart={};if(_customCart2){var _loop13=function _loop13(){var customCartValue=_customCart2[item];customCartValue=customCartValue.split("|");var productData={};customCartValue.forEach(function(item,index){if(index===1){productData[index]=["Quantity",item]}if(index>1){var variantData=item.split(":");if(variantData[0]){productData[index]=[variantData[0],variantData[1]||""]}}});processedCustomCart[customCartValue[0]]=productData};for(item in _customCart2){_loop13()}}var _rebillCart=sessionStorage.getItem("rebillCart");_rebillCart=_rebillCart&&JSON.parse(_rebillCart);var currencySymbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol||"";for(var _i68=0;_i68<cartElementLength;_i68++){var cartObj=$(cartElement[_i68]);cartObj.find(".cc-cart-items-count").html(cartProductsLength);var cartRow=cartObj.find(".cc-cart-row").first();var cartRowCloner=cartRow.clone(true);cartRow.css("display","none");cartObj.find(".cc-cart-row").slice(1).remove();var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;var _loop14=function _loop14(j){var cartRowClone=cartRowCloner.clone(true);var campaignProductId=cartProductsEntries[j][0];var product=cartProductsEntries[j][1];var customAttrs=product.customization;if(memberAreaPage&&customAttrs){var customAttrsObj=customAttrs&&customAttrs.length&&customAttrs[0];var _productData9={};if(customAttrsObj&&customAttrsObj.quantity){_productData9[0]=["Quantity",customAttrsObj.quantity]}var productAttributes=customAttrsObj&&customAttrsObj.attributes;productAttributes&&productAttributes.length&&productAttributes.forEach(function(item,index){_productData9[index+1]=[item.key,item.value]});processedCustomCart[campaignProductId]=_productData9}var currentOrderQuantity=memberAreaPage?product.qty:product.currentOrderQuantity;var image=cartRowClone.find(".cc-cart-row-img");var prodQtyBubble=cartRowClone.find(".cc-cart-prod-qty-bubble");if(image.length){var imageUrl=product.variant&&product.variant.imageUrl!==""?product.variant.imageUrl:product.imageUrl;image.attr("src",imageUrl);image.attr("data-src",imageUrl);prodQtyBubble.html(currentOrderQuantity);if(!imageUrl){cartRowClone.find(".cc-cart-row-img").remove();prodQtyBubble.remove()}}else{prodQtyBubble.remove()}var prodSavingPrice=cartRowClone.find(".cc-cart-row-prod-saving");var prodSavingPerc=cartRowClone.find(".cc-cart-row-prod-saving-perc");var savingElement=prodSavingPrice.length||prodSavingPerc.length;var tempProductPrice=0;var prodPrice=cartRowClone.find(".cc-cart-row-prod-price");if(prodPrice.length||savingElement){if(memberAreaPage){tempProductPrice=product.vatPrice||product.price;prodPrice.html(ccFormatCurrency(tempProductPrice,currencySymbol))}else{var unitPrice=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;tempProductPrice=getItemPrice(campaignProductId,unitPrice,1).toFixed(2);var _price4=ccFormatCurrency(tempProductPrice,currencySymbol);prodPrice.html(_price4)}}var prodTotalPrice=cartRowClone.find(".cc-cart-row-prod-total");if(prodTotalPrice.length&&!memberAreaPage){var _unitPrice=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var totalPrice=getItemPrice(campaignProductId,_unitPrice,product.currentOrderQuantity).toFixed(2);prodTotalPrice.html(ccFormatCurrency(totalPrice,currencySymbol))}var tempProductComparePrice=0;var prodComparePrice=cartRowClone.find(".cc-cart-row-prod-compare");if((prodComparePrice.length||savingElement)&&!memberAreaPage){var _unitPrice2=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var compareAtPrice=product.compareAtPrice&&parseFloat(product.compareAtPrice)>0?product.compareAtPrice:_unitPrice2;compareAtPrice=product.variant&&product.variant.compareAtPrice&&parseFloat(product.variant.compareAtPrice)>0&&!product.isVariantBundle?product.variant.compareAtPrice:compareAtPrice;tempProductComparePrice=getItemPrice(campaignProductId,compareAtPrice,1).toFixed(2);compareAtPrice=ccFormatCurrency(tempProductComparePrice,currencySymbol);prodComparePrice.html(compareAtPrice)}if(savingElement&&!disableActions){var savingPrice=parseFloat((parseFloat(tempProductComparePrice)-parseFloat(tempProductPrice)).toFixed(2));var savingPerc=parseFloat(savingPrice)/tempProductComparePrice*100;prodSavingPrice.html(ccFormatCurrency(savingPrice<0?"0.00":savingPrice),currencySymbol);prodSavingPerc.html((savingPerc<0?0:savingPerc.toFixed(0))+"%")}var prodQty=cartRowClone.find(".cc-cart-row-prod-qty");if(prodQty.length){prodQty.html(currentOrderQuantity)}var productVariant=product.variant;var maxVariantSupport=3;var variantContainer=cartRowClone.find(".cc-cart-row-variant");var outOfStock=false;if(productVariant){outOfStock=verifyStock&&product.cycle1_isShippable&&parseInt(productVariant.stockQuantity)<parseInt(currentOrderQuantity);for(var k=1;k<=maxVariantSupport;k++){if(!productVariant.hasOwnProperty("variantName"+k)){break}var variantName=productVariant["variantName"+k];if(variantName){var variantContainerClone=variantContainer.clone(true);variantContainerClone.find(".cc-cart-row-prod-variant").html(productVariant["variantOptionName"+k]);variantContainerClone.find(".cc-cart-row-prod-variant-label").html(variantName);variantContainerClone.insertBefore(variantContainer)}}}else{outOfStock=verifyStock&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(currentOrderQuantity)}var processedCustomCartProduct=processedCustomCart[campaignProductId];if(processedCustomCartProduct){for(var _item13 in processedCustomCartProduct){var _variantContainerClone=variantContainer.clone(true);_variantContainerClone.find(".cc-cart-row-prod-variant").html(processedCustomCartProduct[_item13][1]);_variantContainerClone.find(".cc-cart-row-prod-variant-label").html(processedCustomCartProduct[_item13][0]);_variantContainerClone.insertBefore(variantContainer)}}var rebillFrequency=_rebillCart&&_rebillCart[campaignProductId];if(variantContainer.find(".cc-cart-row-prod-variant").hasClass("cc-cart-row-frequency")&&!rebillFrequency&&product.billingCycleType==="RECURRING"&&!product.cycle2_billDelay&&product.cycle1_billDelay){var variantBillDelay=product.variant&&product.variant.billDelay;rebillFrequency=variantBillDelay?variantBillDelay:product.cycle1_billDelay;rebillFrequency=rebillFrequency===1?rebillFrequency+" day":rebillFrequency+" days";rebillFrequency=(product.cycle1_isShippable?"Delivery every":"Billing every")+" "+rebillFrequency}if(rebillFrequency){var _variantContainerClone2=variantContainer.clone(true);_variantContainerClone2.find(".cc-cart-row-prod-variant").html(rebillFrequency);_variantContainerClone2.find(".cc-cart-row-prod-variant-label").remove();_variantContainerClone2.insertBefore(variantContainer)}variantContainer.remove();var productTitle=cartRowClone.find(".cc-cart-row-prod-title");if(productTitle.length){var productVariantName=product.variantName||product.title;var productName=memberAreaPage?product.name+(productVariantName?"<br>"+productVariantName:""):product.productName;productTitle.html(productName+(!memberAreaPage&&outOfStock?"  - OUT-OF-STOCK":""))}var plusIcon=cartRowClone.find(".cc-cart-row-prod-qty-plus");if(plusIcon.length){disableActions?plusIcon.css({"pointer-events":"none","filter":"opacity(0.5)"}):plusIcon[0].setAttribute("onclick","plusQuantity('"+campaignProductId+"');")}var minusIcon=cartRowClone.find(".cc-cart-row-prod-qty-minus");if(minusIcon.length){if(parseInt(product.currentOrderQuantity)===1||disableActions){minusIcon.css({"pointer-events":"none","filter":"opacity(0.5)"})}else{minusIcon[0].onclick=function(e){e.target.style.pointerEvents="none";minusQuantity(campaignProductId,e.target)}}}var productId=campaignProductId&&campaignProductId.split(".")[0];var trashIcon=cartRowClone.find(".cc-cart-row-trash-icon");if(productId&&fkCheckboxAndRadioProductIdHashMap[productId]||disableActions){trashIcon.remove()}else if(trashIcon.length){trashIcon[0].setAttribute("onclick","removeFromCart('"+campaignProductId+"');")}var toggleIcon=cartRowClone.find(".cc-toggle-row-details");if(toggleIcon.length){var variantElements=cartRowClone.find(".cc-cart-row-variant");if(variantElements.length){variantElements.css("display","none");toggleIcon[0].onclick=function(){if(toggleIcon.hasClass("cc-rotate-row-icon")){variantElements.first().css("display")==="none"?toggleIcon.css("transform","rotate(90deg)"):toggleIcon.css("transform","rotate(0deg)")}variantElements.toggle()}}else{toggleIcon.remove()}}cartRowClone.css("display","block");cartObj.append(cartRowClone)};for(var j=0;j<cartProductsEntriesLength;j++){_loop14(j)}}}}function cartDisplay(){var cartTable=document.getElementById("fk-dynamic-cart-table");if(cartTable&&(sessionStorage.getItem("customCart")!==null||sessionStorage.getItem("rebillCart")!==null))!cartTable.classList.contains("fold-table")&&cartTable.classList.add("fold-table");var dynamicCartBody=document.querySelector("tbody[id='fk-dynamic-cart-body']");var cartHeader=document.querySelector("thead[id='fk-dynamic-cart-head']");if(!cartTable)return;var memberAreaPage=pageData.pageTypeId===9;var cartProducts=memberAreaPage?getLoginOrderDetails().items||{}:getOrderItemDetails();dynamicCartBody.innerHTML="";if(pageData&&pageData.pageTypeId===33){cartHeader.style.borderBottom="1px solid #808080"}if(cartProducts&&Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;var productCombo=JSON.parse(sessionStorage.getItem("upsaleComboProducts")||"{}");var isCombo=productCombo&&productCombo.length>0;isCombo&&$("head").append("\n<style>\n.combo {\n    padding: 5px 15px;\n    background-color: rgb(244 245 249);\n    border-radius: 5px;\n    text-wrap: wrap;\n    text-align:left;\n}\n.combo-caret {\n    cursor: pointer;\n}\n.rotateComboCaret {\n    rotate: 90deg;\n}\n.combo hr{\n    margin: 0;\n}\n</style>");var collapseIndex=1;var listOfItem="";var comboResult,matchUpsale;var _loop15=function _loop15(_i69){var product=cartProductsEntries[_i69][1];var campaignProductId=memberAreaPage&&product&&product.variantDetailId?cartProductsEntries[_i69][0]+"."+product.variantDetailId:cartProductsEntries[_i69][0];var combosList=[];if(isCombo){comboResult=comboDisplay(false,productCombo,campaignProductId,product.currentOrderQuantity,product,collapseIndex,matchUpsale);listOfItem=comboResult.listOfItem;matchUpsale=comboResult.matchUpsale;if(matchUpsale){combosList.push(campaignProductId);collapseIndex++}}var newDynamicCartRow=document.createElement("TR");newDynamicCartRow.classList.add("fk-custom-cart-view");var accordionDynamicCartRow=document.createElement("TR");accordionDynamicCartRow.classList.add("fk-custom-cart-fold");var accordionEmptyDynamicCartData=document.createElement("TD");accordionEmptyDynamicCartData.style.visibility="hidden";var accordionDynamicCartData=document.createElement("TD");accordionDynamicCartData.colSpan="3";var customProperties=document.createElement("div");customProperties.classList.add("fold-content");var customCartData=sessionStorage.getItem("customCart")!==null?JSON.parse(sessionStorage.getItem("customCart")):{};var customAttrString=ccProductAttrToString(product);if(memberAreaPage&&customAttrString){customCartData[0]=customAttrString}var customProductIds=[];var isCustomProperty=false;for(var _productData10 in customCartData){customProductIds.push(customCartData[_productData10].split("|")[0])}var rebilCartData=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):{};var rebilCartDetails=rebilCartData[campaignProductId];if(customProductIds.includes(campaignProductId)){isCustomProperty=true;for(var _productData11 in customCartData){var firstProperty=_productData11==0&&_i69==0?true:false;if(customCartData[_productData11].split("|")[0]==campaignProductId){createCustomProperties(customCartData[_productData11],accordionDynamicCartRow,accordionEmptyDynamicCartData,accordionDynamicCartData,customProperties,firstProperty,rebilCartDetails)}}}else if(rebilCartDetails){isCustomProperty=true;var _firstProperty=_i69==0?true:false;createCustomProperties(null,accordionDynamicCartRow,accordionEmptyDynamicCartData,accordionDynamicCartData,customProperties,_firstProperty,rebilCartDetails)}var caretIcon=document.createElement("i");caretIcon.innerHTML="&nbsp;";caretIcon.style.cssText="cursor:pointer;transition:all .3s ease";caretIcon.id="caretIcon";caretIcon.classList="fa fa-caret-right";if(pageData&&pageData.pageTypeId===33){newDynamicCartRow.style.borderBottom="1px solid #808080"}var cellFormatLength=cellFormat.length;for(var j=0;j<cellFormatLength;j++){var cell=cellFormat[j];var isQuantityCirclePresent=cell.getElementsByClassName("quantity-circle");if(cell.title.toLowerCase()==="image"){var newDynamicImage=document.createElement("TD");cell.id!==""&&newDynamicImage.setAttribute("id",cell.id);newDynamicImage.className="table-cell image-quantity";var imageUrl=product.variant&&product.variant.imageUrl!==""?product.variant.imageUrl:product.imageUrl;if(imageUrl!==""&&!memberAreaPage){//put the image here
var productImage=document.createElement("img");productImage.src=imageUrl;productImage.className="product-cart-image";if(cell.firstChild!==null&&cell.firstChild.tagName==="IMG"){productImage.className=cell.firstChild.className;if(cell.firstChild.id!=="")productImage.setAttribute("id",cell.firstChild.id)}if(isQuantityCirclePresent&&isQuantityCirclePresent.length>0){var imageQuantityContainer=document.createElement("div");imageQuantityContainer.className="image-quantity-container";var quantityText=document.createElement("div");quantityText.innerText=product.currentOrderQuantity;quantityText.className="quantity-circle";imageQuantityContainer.appendChild(productImage);if(cell.childNodes&&cell.childNodes[0]&&cell.childNodes[0].childElementCount>1){if(cell.childNodes[0].lastChild&&cell.childNodes[0].lastChild.id!==""){quantityText.setAttribute("id",cell.childNodes[0].lastChild.id)}imageQuantityContainer.appendChild(quantityText)}newDynamicImage.appendChild(imageQuantityContainer)}else{newDynamicImage.appendChild(productImage)}}newDynamicCartRow.appendChild(newDynamicImage)}if(cell.title.toLowerCase()==="item"){var newDynamicItem=document.createElement("TD");var newDynamicItemNewLine=document.createElement("BR");newDynamicItem.innerHTML=cell.innerHTML;cell.id!==""&&newDynamicItem.setAttribute("id",cell.id);newDynamicItem.className="table-cell";var currentOrderQuantity=product.currentOrderQuantity;var productStockStatus="";if(!product.variant){productStockStatus=verifyStock&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":""}if(combosList.includes((product.campaignProductId||campaignProductId).toString())){newDynamicItem.innerHTML=listOfItem+productStockStatus}else{newDynamicItem.innerHTML=memberAreaPage?product.name+(product.variantName?"<br>"+product.variantName:""):product.productName+productStockStatus}isCustomProperty&&newDynamicItem.prepend(caretIcon);if(product.variant&&product.variant.title){var variantStockStatus=verifyStock&&product.cycle1_isShippable&&parseInt(product.variant.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":"";var newDynamicTitle=document.createElement("span");newDynamicTitle.innerText=product.variant.title+variantStockStatus;newDynamicItem.appendChild(document.createElement("BR"));newDynamicItem.appendChild(newDynamicTitle)}newDynamicItem.appendChild(newDynamicItemNewLine);if(cell.classList.contains("fk-shopping-cart-item")&&cell.getElementsByTagName("I")[0]){var _productId5=campaignProductId&&campaignProductId.split(".")[0];if(_productId5&&!fkCheckboxAndRadioProductIdHashMap[_productId5]&&!memberAreaPage){var trashElement=document.createElement("I");trashElement.className=cell.getElementsByTagName("I")[0].classList.toString();trashElement.style.cursor="pointer";newDynamicItem.appendChild(trashElement);trashElement.setAttribute("onclick","removeFromCart('"+campaignProductId+"');")}}newDynamicCartRow.appendChild(newDynamicItem)}if(cell.title.toLowerCase()==="quantity"){var newDynamicQuantity=document.createElement("TD");updateCSSForShoppingCartSections(newDynamicQuantity);newDynamicQuantity.innerHTML=cell.innerHTML;newShoppingCart=$(newDynamicQuantity).find(".fk-shopping-cart-quantity-wrapper-class")[0];childElement=newShoppingCart?newShoppingCart.childNodes:newDynamicQuantity.childNodes;newDynamicQuantity.setAttribute("id",cell.id);newDynamicQuantity.className="table-cell";newDynamicQuantity.style.textAlign="center";if(childElement){childElement.forEach(function(ele){if($(ele).text().length>0&&ele.tagName!=="I"){if(ele.tagName==="DIV"){ele.textContent=null;var newQuantitySpan=document.createElement("SPAN");$(newQuantitySpan).css({"margin":"0 auto"});newQuantitySpan.textContent=memberAreaPage?product.qty:product.currentOrderQuantity;ele.appendChild(newQuantitySpan)}else{ele.textContent=memberAreaPage?product.qty:product.currentOrderQuantity}}if(ele&&ele.classList&&(ele.classList.contains("fk-shopping-cart-minus")||ele.classList.contains("minus-style"))){ele.textContent=!ele.classList.contains("minus-style")?"-":"";if(ele.classList.contains("fk-shopping-cart-minus")){var orderItems=getOrderItems();if(parseInt(orderItems[campaignProductId])>1){ele.setAttribute("onclick","minusQuantity('"+campaignProductId+"',this);")}else{ele.setAttribute("disabled","true")}}else{ele.setAttribute("onclick","minusQuantity('"+campaignProductId+"',this);")}if(memberAreaPage){ele.setAttribute("onclick","");ele.setAttribute("disabled","true")}}if(ele&&ele.classList&&(ele.classList.contains("fk-shopping-cart-plus")||ele.classList.contains("plus-style"))){ele.textContent=!ele.classList.contains("plus-style")?"+":"";if(memberAreaPage){ele.setAttribute("onclick","");ele.setAttribute("disabled","true")}else{ele.setAttribute("onclick","plusQuantity('"+campaignProductId+"');")}}})}newDynamicCartRow.appendChild(newDynamicQuantity)}var currencySymbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol||"";if(cell.title.toLowerCase()==="price"){var newDynamicPrice=document.createElement("TD");updateCSSForShoppingCartSections(newDynamicPrice);cell.id!==""&&newDynamicPrice.setAttribute("id",cell.id);newDynamicPrice.className="table-cell";if(memberAreaPage){newDynamicPrice.innerHTML=ccFormatCurrency(product.vatPrice||product.price,currencySymbol);newDynamicCartRow.appendChild(newDynamicPrice)}else{var unitPrice=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;newDynamicPrice.innerHTML=ccFormatCurrency(getItemPrice(campaignProductId,unitPrice,1).toFixed(2),currencySymbol);newDynamicCartRow.appendChild(newDynamicPrice)}}if(cell.title.toLowerCase()==="total"&&!memberAreaPage){var _newDynamicPrice=document.createElement("TD");updateCSSForShoppingCartSections(_newDynamicPrice);cell.id!==""&&_newDynamicPrice.setAttribute("id",cell.id);_newDynamicPrice.className="table-cell";var _unitPrice3=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;_newDynamicPrice.innerHTML=ccFormatCurrency(getItemPrice(campaignProductId,_unitPrice3,product.currentOrderQuantity).toFixed(2),currencySymbol);newDynamicCartRow.appendChild(_newDynamicPrice)}if(cell.title.toLowerCase()==="compare"&&!memberAreaPage){var _newDynamicPrice2=document.createElement("TD");updateCSSForShoppingCartSections(_newDynamicPrice2);cell.id!==""&&_newDynamicPrice2.setAttribute("id",cell.id);_newDynamicPrice2.className="table-cell";var _unitPrice4=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var compareAtPrice=product.compareAtPrice&&parseFloat(product.compareAtPrice)>0?product.compareAtPrice:_unitPrice4;compareAtPrice=product.variant&&product.variant.compareAtPrice&&parseFloat(product.variant.compareAtPrice)>0&&!product.isVariantBundle?product.variant.compareAtPrice:compareAtPrice;_newDynamicPrice2.innerHTML=ccFormatCurrency(getItemPrice(campaignProductId,compareAtPrice,1).toFixed(2),currencySymbol);newDynamicCartRow.appendChild(_newDynamicPrice2)}if(cell.title.toLowerCase()==="action"){var newDynamicAction=document.createElement("TD");cell.id!==""&&newDynamicAction.setAttribute("id",cell.id);newDynamicAction.className="table-cell";newDynamicAction.style.textAlign="center";newDynamicAction.innerHTML=cell.innerHTML;var _trashElement=newDynamicAction.querySelectorAll("i");if(_trashElement&&_trashElement.length>0){_trashElement[0].setAttribute("onclick","removeFromCart('"+campaignProductId+"');")}memberAreaPage&&_trashElement[0]&&$(_trashElement[0]).remove();var linkElement=newDynamicAction.querySelectorAll("a");if(linkElement&&linkElement.length>0){linkElement[0].setAttribute("offer",product.campaignProductId);product.variant&&linkElement[0].setAttribute("variantvalue",product.variant.variantDetailId)}newDynamicCartRow.appendChild(newDynamicAction)}}dynamicCartBody.appendChild(newDynamicCartRow);dynamicCartBody.appendChild(accordionDynamicCartRow);$(".fold-content p:first-child > hr").remove()};for(var _i69=0;_i69<cartProductsEntriesLength;_i69++){var newShoppingCart;var childElement;_loop15(_i69)}}$(".fold-table tr.fk-custom-cart-view td:nth-child(2)").on("click",function(){$(this).find("i").toggleClass("fk-caret-rotate");$(this).parents(".fold-table tr.fk-custom-cart-view").toggleClass("fk-custom-open").next(".fk-custom-cart-fold").toggleClass("fk-custom-open")})}function initializeCountryStates(callback){//initialize array of campaign states indexed by countryCode - ex: ["US"] => [{stateCode:"AL",stateName:"Alabama"}]
pageData.selectedCampaign.states=[];//pageData.selectedCampaign.countries = array of campaign country objects - ex: {countryName:"United States", countryCode:"US"}
//loop through campaign countries array and add empty array at countryCode index
pageData.selectedCampaign.countries.forEach(function(country){pageData.selectedCampaign.states[country.countryCode]=[]});if(checkElementExist("country")||checkElementExist("shipCountry")){//get all possible countries/states data - then loop through and add the campaign country states to the campaignStates array
//countries array entry looks like this: {countryCode:"US",countryName:"United States",stateCode:"GA",stateName:"Georgia"}
$.getJSON("https://assets.checkoutchamp.com/countries.json",function(data){data.forEach(function(state){if(pageData.selectedCampaign.states[state.countryCode])pageData.selectedCampaign.states[state.countryCode].push({stateCode:state.stateCode,stateName:state.stateName})});loadCountries("country");loadCountries("shipCountry");if((pageData.pageTypeId===4||pageData.pageTypeId===2)&&urlParams.get("orderId")){orderQueryWithOrderId()}setGeoFromIP();callback&&callback()})}else{setGeoFromIP();callback&&callback()}}function checkElementExist(inputName){var input=document.getElementsByName(inputName)[0];if(!input||input.type!=="select-one"){return false}return true}function loadCountries(inputName){var input=document.getElementsByName(inputName)[0];if(!input||input.type!=="select-one")return;var chooseOptionText=input.options.length>0&&input.options[0].value===""?input.options[0].text:null;pageData.selectedCampaign.countries.sort(function(a,b){return a.countryName.localeCompare(b.countryName)});input.innerHTML="";var orderData=JSON.parse(sessionStorage.getItem("orderData"));//Set the default value to the saved session value if it exists
var sessionVal=orderData&&orderData.hasOwnProperty(inputName)&&orderData[inputName]!==null?orderData[inputName]:null;var defaultVal=sessionVal!==null?sessionVal:null;var countriesLength=pageData.selectedCampaign.countries.length;for(var _i70=0;_i70<countriesLength;_i70++){var country=pageData.selectedCampaign.countries[_i70];var option=document.createElement("OPTION");option.value=country.countryCode;option.innerHTML=country.countryName;//Make US the first option if in campaign, then Canada, then list campaign countries alphabetically
if(country.countryCode==="US"||country.countryCode==="CA")input.prepend(option);else input.add(option);//if Canada is in campaign, set Canada as default value - US will override as default value if US is in campaign
defaultVal=sessionVal===null&&(country.countryCode==="CA"||country.countryCode==="US")?country.countryCode:defaultVal}defaultVal=!defaultVal?input.options[0].value:defaultVal;var stateName=inputName==="country"?"state":"shipState";var stateInput=document.getElementsByName(stateName)[0];if(!stateInput||stateInput.type!=="select-one")return;input.addEventListener("change",function(){loadStates(stateName,this.value,true);displayPrices();var productVariantElement=document.getElementsByClassName("fk-product-variant-select")[0];productVariantElement&&variantSelectFlag===1&&changeTilePrices(productVariantElement)});if(defaultVal!==null){input.value=defaultVal;loadStates(stateName,defaultVal)}}function loadStates(inputName,countryCode,isCountryChanged){var input=document.getElementsByName(inputName)[0];if(!input||input.type!=="select-one")return;var chooseOptionText=input.options.length>0&&input.options[0].value===""?input.options[0].text:null;input.innerHTML="";if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption)}var statesArray=pageData.selectedCampaign.states[countryCode];var blackListedStates=pageData.selectedCampaign.blacklist;if(blackListedStates){var stateEntries=blackListedStates.split(",").filter(Boolean).reduce(function(acc,next){var _next$split=next.split(":"),_next$split2=_slicedToArray(_next$split,2),key=_next$split2[0],value=_next$split2[1];if(acc.hasOwnProperty(key)){acc[key].push(value)}else{acc[key]=new Array;acc[key].push(value)}return acc},{});if(stateEntries.hasOwnProperty(countryCode)){stateEntries[countryCode].forEach(function(ele){statesArray=statesArray.filter(function(state){return ele!==state.stateCode})})}}if(typeof statesArray==="undefined"||statesArray.length===0)return;var defaultVal=null;var orderData=JSON.parse(sessionStorage.getItem("orderData"));var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));//Set the default value to the saved session value if it exists
if(orderData&&orderData.hasOwnProperty(inputName)&&orderData[inputName]!==null)defaultVal=orderData[inputName];else if(customerOrders&&customerOrders[0].hasOwnProperty(inputName)&&customerOrders[0][inputName]!==null)defaultVal=customerOrders[0][inputName];var statesArrayLength=statesArray.length;for(var _i71=0;_i71<statesArrayLength;_i71++){var state=statesArray[_i71];var option=document.createElement("OPTION");option.value=state.stateCode;option.innerHTML=state.stateName;input.add(option)}if(defaultVal!==null&&!isCountryChanged){input.value=defaultVal}else if(isCountryChanged||chooseOptionText){input.value=""}input.addEventListener("change",function(){displayPrices();var productVariantElement=document.getElementsByClassName("fk-product-variant-select")[0];productVariantElement&&variantSelectFlag===1&&changeTilePrices(productVariantElement)})}function changeCountry(){return}function changeCountry2(){return}function loadMonth(){var input=document.getElementsByName("cardMonth")[0];if(!input||input.type!=="select-one")return;if(input.options.length<12){var chooseOptionText=input.options.length>0&&input.options[0].text.toLowerCase().indexOf("month")>-1?input.options[0].text:null;input.innerHTML="";var months=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var _i72=0;_i72<12;_i72++){var option=document.createElement("OPTION");option.value=(_i72+1).toString();option.innerHTML=months[_i72];input.add(option)}if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption);input.value=""}}}function loadYear(){var input=document.getElementsByName("cardYear")[0];if(!input||input.type!=="select-one")return;var chooseOptionText=input.options.length>0&&input.options[0].text.toLowerCase().indexOf("year")>-1?input.options[0].text:null;input.innerHTML="";var d=new Date;var year=d.getFullYear();for(var _i73=0;_i73<11;_i73++){var option=document.createElement("OPTION");option.value=(year+_i73).toString();option.innerHTML=(year+_i73).toString();input.add(option)}if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption);input.value=""}}function loadShipProfiles(){var input=document.getElementsByName("shipProfileId")[0];var disableShowShipProfilePrices=getAddOnKeyValue(findAddOn("DIS_SHOW_SHIP_PRICES"));if(!input)return;var validShipProfilesCollection=[];var shipProfile=pageData.selectedCampaign?getShipProfile():null;var pageDataShipProfiles=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.shipProfiles||[];var shipProfilesLength=pageDataShipProfiles.length;if(shipProfilesLength===0)return;var items=getOrderItemDetails();var itemSave=JSON.stringify(items);var totals=JSON.parse(sessionStorage.getItem("totals"));for(var _i74=0;_i74<shipProfilesLength;_i74++){var profile=pageDataShipProfiles[_i74];//determine all valid profiles
if(parseFloat(profile.freeShipThreshold)>0&&profile.rules===null&&totals&&parseFloat(totals.subTotal)>=parseFloat(profile.freeShipThreshold)){profile.sortedShipPrice=0;validShipProfilesCollection.push(profile)}else if(profile.applyEntireOrder){var shipPrice=getShipProfileOrderPrice(profile);if(shipPrice!=null){profile.sortedShipPrice=shipPrice;validShipProfilesCollection.push(profile)}}else if(Object.keys(items).length>0){var itemClone=JSON.parse(JSON.stringify(items));//deep clone
var shipItems=applyShipProfileProductRules(profile,itemClone);if(shipItems.update){profile.sortedShipPrice=0;validShipProfilesCollection.push(profile)}}}validShipProfilesCollection=validShipProfilesCollection.sort(function(a,b){var sp1=parseFloat(a.sortedShipPrice),sp2=parseFloat(b.sortedShipPrice);return sp1-sp2});if(input.type==="select-one"){$("[name=shipProfileId] option").each(function(){if($(this).val().includes(":")){validShipProfilesCollection.push({"shipProfileId":$(this).val(),"profileName":$(this).text()})}});var chooseOptionText=input.options.length>0&&input.options[0].value==""?input.options[0].text:null;input.innerHTML="";var validShipProfileLength=validShipProfilesCollection.length;for(var _i75=0;_i75<validShipProfileLength;_i75++){var shipProfileId=validShipProfilesCollection[_i75].shipProfileId;var option=document.createElement("OPTION");option.value=shipProfileId;var shipLabel="";if(disableShowShipProfilePrices==="true"){shipLabel=validShipProfilesCollection[_i75].profileName}else{shipLabel=addShippingDisplay(validShipProfilesCollection[_i75],shipLabel,totals)}option.innerHTML=shipLabel;input.add(option);if(shipProfile){if(typeof shipProfile==="string"){if(shipProfile==shipProfileId)input.value=shipProfileId}else if(shipProfile.shipProfileId==shipProfileId){input.value=shipProfileId}}}if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption);if(input.options.length==1)input.value=""}if(input.options.length>0&&input.value==""){//choose an external value if no profiles are valid
for(var i=0;i<input.options.length;i++){if(input.options[i].value.indexOf(":")>0){input.value=input.options[i].value;break}}}}else if(input.type==="radio"){var currentProfileId=shipProfile?shipProfile.shipProfileId:null;populateRadioShipProfiles(validShipProfilesCollection,currentProfileId)}input.removeEventListener("change",displayPrices);input.addEventListener("change",displayPrices)}function populateRadioShipProfiles(validProfiles,currentProfileId){var disableShowShipProfilePrices=getAddOnKeyValue(findAddOn("DIS_SHOW_SHIP_PRICES"));var totals=JSON.parse(sessionStorage.getItem("totals"));try{var shipRadioBtnContainers=$(".fk-form-radio-button-parent").has("input[name='shipProfileId'");if(!shipRadioBtnContainers.length){return}shipRadioBtnContainers.attr("shipradio",true);var shipProfileDiv=shipRadioBtnContainers.first();shipProfileDiv.find("[name='shipProfileId']").attr({"value":0});shipProfileDiv.find(".form-check-label").text("None");shipProfileDiv.attr("shipradio",false);$("[shipradio=true]").remove();var validProfilesLength=validProfiles.length;for(var _i76=0;_i76<validProfilesLength;_i76++){//add radio button for each valid profile
var cloned=shipProfileDiv.clone(true);cloned.find("[name='shipProfileId']").attr({"value":validProfiles[_i76].shipProfileId});var shipLabel="";if(disableShowShipProfilePrices==="true"){shipLabel=validProfiles[_i76].profileName}else{shipLabel=addShippingDisplay(validProfiles[_i76],shipLabel,totals)}cloned.find(".form-check-label").text(shipLabel);cloned.insertBefore(shipProfileDiv)}validProfilesLength&&shipProfileDiv.remove();if(currentProfileId)$("input[name=shipProfileId][value="+currentProfileId+"]").prop("checked",true);else shipRadioBtnContainers.first().prop("checked",true)}catch(error){console.log(error)}}function addShippingDisplay(shipProfile,label,totals){var shipDisplay="";var shipPrice="";if(shipProfile.applyEntireOrder){shipPrice=getShipProfileOrderPrice(shipProfile);shipDisplay=shipPrice=="0.00"?"FREE":ccFormatCurrency(shipPrice,pageData.selectedCampaign.currencySymbol)}if(shipProfile.freeShipThreshold){if(parseFloat(shipProfile.freeShipThreshold)>0&&totals&&parseFloat(totals.subTotal)>=parseFloat(shipProfile.freeShipThreshold)){shipDisplay="FREE"}else if(shipPrice=="0.00"){shipPrice=getShipProfileOrderPrice(shipProfile);shipDisplay=""}}label=shipDisplay?shipProfile.profileName+" - "+shipDisplay:shipProfile.profileName;return label}function navigate(attributes){var URL=attributes.href.value;var target=attributes.target.value;if(target!==null&&target!==""){window.open(URL,target)}else{getCurrentWindowLocation().replace(URL)}}function checkBoxChange(attributes){if(attributes&&attributes["name"]&&attributes["onclick"]){var name=attributes["name"].value.toLowerCase();var checked=attributes["onclick"].ownerElement.checked;var orderBumpParent=$(attributes["onclick"].ownerElement).closest(".bump-div-class");var bill=["firstName","lastName","address1","address2","city","country","state","postalCode","fullName"];var _ship=["shipFirstName","shipLastName","shipAddress1","shipAddress2","shipCity","shipCountry","shipState","shipPostalCode","shipFullName"];var setBillShipInputs=0;if(name==="billshipsame"&&attributes.openCheckBoxSection&&attributes.openCheckBoxSection.value!=""){//determine if checkbox opens bill or ship inputs
var shippingSectionID="#"+attributes.openCheckBoxSection.value;var shippingSectionIDElement=$(shippingSectionID);if(shippingSectionIDElement&&shippingSectionIDElement.length>0){var findShipAddress=$(shippingSectionID).find("[name=shipAddress1]");setBillShipInputs=findShipAddress&&findShipAddress.length>0?1:2}}if(name==="billshipsame"&&checked){var billLength=bill.length;for(var _i77=0;_i77<billLength;_i77++){var billInput=document.getElementsByName(bill[_i77])[0];var shipInput=document.getElementsByName(_ship[_i77])[0];if(billInput&&shipInput){if(setBillShipInputs!=2&&billInput.value!==undefined&&billInput.value!==""&&billInput.value!==shipInput.value){shipInput.value=billInput.value;if(_ship[_i77]==="shipCountry"){loadStates("shipState",shipInput.value);continue}}if(setBillShipInputs!=1&&shipInput.value!==undefined&&shipInput.value!==""&&shipInput.value!==billInput.value){billInput.value=shipInput.value;if(bill[_i77]==="country"){loadStates("state",billInput.value);continue}}}}}else if(name==="billshipsame"&&!checked){var parentForm=attributes["name"].ownerElement&&attributes["name"].ownerElement.form?_toConsumableArray(attributes["name"].ownerElement.form):null;var billIndex=-1;var shipIndex=-1;if(parentForm){parentForm.forEach(function(formElement,index){if(formElement.name==="address1"){billIndex=index}if(formElement.name==="shipAddress1"){shipIndex=index}});if(shipIndex==-1||billIndex<shipIndex&&billIndex>-1){clearAddressValues(_ship)}else{clearAddressValues(bill)}}if(!$("[name=\"country\"]").val()){$("[name=\"country\"] option:eq(0)").prop("selected",true);loadStates("state",$("[name=\"country\"]").val())}if(!$("[name=\"shipCountry\"]").val()){$("[name=\"shipCountry\"] option:eq(0)").prop("selected",true);loadStates("shipState",$("[name=\"shipCountry\"]").val())}}else if(name==="orderbump"){adjustVariantOrderBump(orderBumpParent,checked)}}displayShipSection(attributes);displayPrices()}function adjustVariantOrderBump(orderBumpParent,checked){if(orderBumpParent){var productSectionElement=$(orderBumpParent).find(".fk-product-section");var productVariants=$(productSectionElement).find("[name='variant1'], [name='variant2'], [name='variant3']").filter("select");var _product7=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==$(productSectionElement).attr("value")});var campaignProductId=_product7&&_product7[0]&&_product7[0].campaignProductId;var quantityInput=productSectionElement[0]&&productSectionElement[0].querySelectorAll("input[name='quantity'], select[name='quantity']")[0];if(!$(quantityInput).val()){$(quantityInput).val(1)}if(campaignProductId){var orderItems=getOrderItems();if(checked){getVariants(productSectionElement[0]&&productSectionElement[0].id)}else{if(orderItems&&Object.keys(orderItems).length>0){var orderItemsEntries=Object.entries(orderItems);var orderItemsEntriesLength=orderItemsEntries.length;for(var _i78=0;_i78<orderItemsEntriesLength;_i78++){var key=orderItemsEntries[_i78][0];if(key.includes(campaignProductId.toString())){delete orderItems[key]}}sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}}}}}// Method created for sliding inputs (JIRA Ticket #FUN2-1745)
function slideForm(attributes,e){e.preventDefault();var openID="";var dataType="";if(attributes.openid.value!==""){openID="#"+attributes.openid.value;dataType=attributes.openiddatatype?attributes.openiddatatype.value:""}var buttonHideID="#"+e.currentTarget.id;if(openID!==""&&$(openID).is(":hidden")){getCurrentWindowLocation().hash=openID;$(openID).slideDown("slow");if(dataType!=="form"){smoothScrolling(e)}}$(buttonHideID).hide()}//Method to slide button and link without hiding it
function slideWithoutHideForm(attributes,e){e.preventDefault();var openID="";var dataType="";var openSectionElements=$("button[action=\"openSectionWithoutHide\"], a[action=\"openSectionWithoutHide\"]");if(attributes.openid.value!==""){openID="#"+attributes.openid.value;dataType=attributes.openiddatatype?attributes.openiddatatype.value:""}if(openID!==""){var elementDisplayProp=$(openID).css("display");openSectionElements.each(function(){var elementOpenId="#"+$(this).attr("openid");if($("#"+attributes.id.value).closest(elementOpenId).length===0){$(elementOpenId).hide()}});if(elementDisplayProp!=="none"){return}getCurrentWindowLocation().hash=openID;$(openID).slideDown("slow");if(dataType!=="form"){smoothScrolling(e,hideCheckBoxSection)}}}// Method created for sliding inputs - calling import lead functionality on a sliding input (JIRA Ticket #FUN2-1745)
function slideMethod(_x14,_x15){return _slideMethod.apply(this,arguments)}function _slideMethod(){_slideMethod=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(attributes,e){var openID,dataType,buttonId,buttonHideID,windowLocation,route,errorID,tag;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:e.preventDefault();if(!(e.detail!==1)){_context18.next=3;break}return _context18.abrupt("return");case 3:openID="";dataType="";if(attributes.openid.value!==""){openID="#"+attributes.openid.value;dataType=attributes.openiddatatype?attributes.openiddatatype.value:""}buttonId=e.currentTarget.dataset.id;buttonHideID="#"+e.currentTarget.id;windowLocation=getCurrentWindowLocation().href;route=windowLocation+openID;if(!checkRequiredInputs()){_context18.next=20;break}disableInteractions(buttonId,true,true);_context18.next=14;return importLead(buttonId,route);case 14:errorID="error-"+buttonId;tag=document.getElementById(errorID);if(tag){tag.setAttribute("id","");tag.innerHTML=""}if(openID!==""&&$(openID).is(":hidden")){getCurrentWindowLocation().hash=openID;$(openID).slideDown("slow");if(dataType!=="form"){smoothScrolling(e)}autoLoadInputs()}$(buttonHideID).hide();enableInteractions();case 20:case"end":return _context18.stop();}}},_callee18)}));return _slideMethod.apply(this,arguments)}function smoothScrolling(e,callback){var target=$(getCurrentWindowLocation().hash);target=target.length?target:$("[name="+getCurrentWindowLocation().hash.slice(1)+"]");if(target.length){if(e){e.preventDefault()}$("html, body").animate({scrollTop:target.offset().top},1000,function(){var $target=$(target);$target.focus();if($target.is(":focus")){return false}else{$target.attr("tabindex","-1");callback&&callback();$target.focus()};})}}function initializePAAY(paayApiKey){var campaignData=pageData.selectedCampaign;if(!campaignData){$.ajax({url:"campaign.json?"+Date.now(),method:"get",success:function success(results){campaignData=results.selectedCampaign}})}//add PAAY attributes to required page inputs
var inputArray={"cardNumber":"pan","cardMonth":"month","cardYear":"year"};var cardInputDetails={"cardMonth":"month","cardYear":"year"};var cardMonth=document.getElementsByName("cardMonth");var cardYear=document.getElementsByName("cardYear");if(pageData.pageTypeId===4){for(var key in inputArray){var input=document.getElementsByName(key)[0];if(input){input.setAttribute("data-threeds",inputArray[key]);var parent=input.form;if(!parent){parent=document.createElement("form");document.body.append(parent)}}}if(cardMonth.length===0&&cardYear.length===0){for(var hiddenInput in cardInputDetails){var _input4=document.createElement("input");_input4.type="hidden";_input4.name=hiddenInput;_input4.value=sessionStorage.getItem("paay_"+cardInputDetails[hiddenInput]);_input4.setAttribute("data-threeds",cardInputDetails[hiddenInput]);parent&&parent.append(_input4)}}}else{var parent=document.forms.length!==0?document.forms[0]:null;if(!parent){parent=document.createElement("form");document.body.append(parent)}var _inputArray={"cardNumber":"pan","cardMonth":"month","cardYear":"year"};for(var _hiddenInput in _inputArray){var _input5=document.createElement("input");_input5.type="hidden";_input5.name=_hiddenInput;_input5.value=sessionStorage.getItem("paay_"+_inputArray[_hiddenInput]);_input5.setAttribute("data-threeds",_inputArray[_hiddenInput]);parent&&parent.append(_input5)}}if(parent&&campaignData&&campaignData.products){if(!parent.id){parent.id="kform"};var paayTransIdInput=document.createElement("input");paayTransIdInput.type="hidden";paayTransIdInput.name="x_transaction_id";paayTransIdInput.value="1234";paayTransIdInput.setAttribute("data-threeds","id");parent.append(paayTransIdInput);var url="https://cdn.3dsintegrator.com/threeds.2.2.20230608.min.js";var sandboxUrl="https://api-sandbox.3dsintegrator.com/v2.2";var paayRebill=getAddOnKeyValue(findAddOn("PAAY_fetch_rebill"));if(paayRebill==="1")sessionStorage.setItem("paayRebill",1);var showChallenges=getAddOnKeyValue(findAddOn("PAAY_show_challenge"));$.getScript(url,function(){var options="";if(document.URL.includes("dev-funnels"))options="endpoint:\""+sandboxUrl+"\", verbose:true, ";if(showChallenges){if(parseInt(showChallenges)>0)options+="showChallenge: true, timeout: \"40\", popup: true, ";if(showChallenges==="0")options+="challengeIndicator: \"02\", ";else if(showChallenges==="2")options+="challengeIndicator: \"04\", ";else options+="challengeIndicator: \"01\", "}options+="autoSubmit:false";if(options)options=",{"+options+"}";var innerText="var tds = new ThreeDS('kform','apikey',null,options);";innerText=innerText.replace("kform",parent.id);innerText=innerText.replace("apikey",paayApiKey);innerText=innerText.replace(",options",options);var paayScript=document.createElement("script");paayScript.innerHTML=innerText;document.body.append(paayScript);var paayScript2=document.createElement("script");paayScript2.setAttribute("type","application/javascript");paayScript2.innerHTML="var id = document.querySelector('[data-threeds=id]'); var uniqueId = function() { return 'id-' + Math.random().toString(36).substr(2, 16); }; id.value = uniqueId();";document.body.append(paayScript2)})}}function ccGetCurrencyNumber(){var campaign=pageData&&pageData.selectedCampaign;if(!campaign)return;var currencyCode=returnCurrencyCode();if(!currencyCode||currencyCode===campaign.currency){return campaign.currencyNumber}else{var currencyObj=campaign.currencies&&campaign.currencies.find(function(item){return item.currencyCode===currencyCode});return currencyObj&&currencyObj.currencyNumber}}function triggerPAAY(){if(typeof tds==="undefined")return;var currencyNumber=ccGetCurrencyNumber();if(currencyNumber)tds.options.currency=currencyNumber;var itemId=sessionStorage.getItem("paay_item");var items=null;var item=null;var initialAmount=null;var variant={};var productId=itemId&&itemId.split(".");if(pageData.pageTypeId===4){items=getOrderItemDetails();var cartItemsLength=Object.keys(items).length;item=items[itemId];if(!cartItemsLength||cartItemsLength===1&&!item)return;variant=item.variant||{};var itemPrice=!item.isVariantBundle&&!item.isEditable&&variant&&parseFloat(variant.price)>0?parseFloat(variant.price):parseFloat(item.cycle1_price);if(cartItemsLength>1||itemPrice>0){var _JSON$parse3=JSON.parse(sessionStorage.getItem("totals")),grandTotal=_JSON$parse3.grandTotal;initialAmount=grandTotal}else if(item.billingCycleType==="ONE_TIME"){var buttonId=sessionStorage.getItem("paay_buttonId");var _route6=sessionStorage.getItem("paay_route");sessionStorage.removeItem("paayEnabled");sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");importOrder(buttonId,_route6);return}else{var recurringPrice=!item.isVariantBundle&&!item.isEditable&&variant&&parseFloat(variant.price)>0?parseFloat(variant.price):parseFloat(item.cycle2_price);var recurringShipPrice=!item.isVariantBundle&&variant&&parseFloat(variant.shippingPrice)>0?parseFloat(variant.shippingPrice):parseFloat(item.cycle2_shipPrice);initialAmount=(getItemPrice(itemId,recurringPrice,item.currentOrderQuantity)+getShipPrice(recurringShipPrice,item.currentOrderQuantity)).toFixed(2);sessionStorage.removeItem("paayRebill");if(item.trialAuthType!=="HOLDTRIALCHARGE"){sessionStorage.setItem("paayInitialAsRebill","1")}}}else{//items = getOrderItemDetails();
item=productId&&pageData.selectedCampaign.products.find(function(data){return data.campaignProductId===parseInt(productId[0])});if(!item)return;variant=!item.isVariantBundle&&productId.length>1&&item.variants&&item.variants.find(function(data){return data.variantDetailId===parseInt(productId[1])})||{};var variantPrice=variant&&!item.isEditable&&parseFloat(variant.price)>0?parseFloat(variant.price):null;var variantShipPrice=variant&&parseFloat(variant.shippingPrice)>0?parseFloat(variant.shippingPrice):null;var productPrice=variant.price||parseFloat(item.cycle1_price);if(productPrice>0){initialAmount=(getItemPrice(itemId,productPrice,1)+getShipPrice(variantShipPrice||item.cycle1_shipPrice,1)).toFixed(2)}else if(item.billingCycleType==="ONE_TIME"){var _buttonId2=sessionStorage.getItem("paay_buttonId");var _route7=sessionStorage.getItem("paay_route");sessionStorage.removeItem("paayEnabled");sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");importUpsale(_buttonId2,_route7);return}else{initialAmount=(getItemPrice(itemId,variantPrice||item.cycle2_price,1)+getShipPrice(variantShipPrice||item.cycle2_shipPrice,1)).toFixed(2);sessionStorage.removeItem("paayRebill");if(item.trialAuthType!=="HOLDTRIALCHARGE"){sessionStorage.setItem("paayInitialAsRebill","1")}}}if(sessionStorage.getItem("paayRebill")==="1"){if(item.billingCycleType==="ONE_TIME")sessionStorage.setItem("paayRebill",0);else{var rebillCycle=item.cycle2_price===null&&item.cycle2_shipPrice===null?1:2;var rebillAmount=(getItemPrice(itemId,variant.price||item["cycle"+rebillCycle+"_price"],1)+getShipPrice(variant.shippingPrice||item["cycle"+rebillCycle+"_shipPrice"],1)).toFixed(2);tds.options.rebill=rebillAmount}}var paayCallback=function paayCallback(data,isRebill){if(isRebill){sessionStorage.setItem("paayRebillData",JSON.stringify(data))}else{sessionStorage.setItem("paayInitialData",JSON.stringify(data))}if((data.success===true||data.status==="Y")&&sessionStorage.getItem("paayRebill")==="1"&&sessionStorage.getItem("paayInitial")===null){sessionStorage.setItem("paayInitial",1);return}var buttonId=sessionStorage.getItem("paay_buttonId");var route=sessionStorage.getItem("paay_route");sessionStorage.setItem("paayCompleted",1);sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");sessionStorage.removeItem("paayInitial");if(pageData.pageTypeId===4){importOrder(buttonId,route)}else{importUpsale(buttonId,route)}};var paayInitialCallback=function paayInitialCallback(data){paayCallback(data,false)};var paayRebillCallback=function paayRebillCallback(data){paayCallback(data,true)};var showChallenges=getAddOnKeyValue(findAddOn("PAAY_show_challenge"));if(showChallenges&&parseInt(showChallenges)>0){tds.options.popupFail=function(){tds.options.popup=false;tds.options.showIframe=true;tds.verify(paayInitialCallback,paayInitialCallback,{amount:parseFloat(initialAmount)},null,null,paayRebillCallback,paayRebillCallback)}}else{tds.options.prompt=function(){var buttonId=sessionStorage.getItem("paay_buttonId");var route=sessionStorage.getItem("paay_route");sessionStorage.setItem("paayCompleted",1);sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");sessionStorage.removeItem("paayInitial");if(pageData.pageTypeId===4){importOrder(buttonId,route)}else{importUpsale(buttonId,route)}}}tds.verify(paayInitialCallback,paayInitialCallback,{amount:parseFloat(initialAmount)},null,null,paayRebillCallback,paayRebillCallback);if(tds.errors.length>0){var _buttonId3=sessionStorage.getItem("paay_buttonId");var tag=document.getElementById("error-"+_buttonId3);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+_buttonId3)}else{tag.innerHTML=""}tag.innerHTML="ERROR: "+tds.errors[0];var color=tag.style.color="red";var pageForm=$("button[data-id='"+_buttonId3+"']").length?$("button[data-id='"+_buttonId3+"']"):$("a[data-id='"+_buttonId3+"']");$(tag).insertAfter(pageForm);enableInteractions()}}function openSurveySection(attributes,e){e.preventDefault();var parentID="";var targetSurveyID="";var surveySectionElement=$(e.target).closest("section.fk-section");progressBar=document.getElementById("progressbar");if(e.currentTarget.localName==="button"){var buttonDataID=e.currentTarget.dataset.id;var button=$("button[data-id='"+buttonDataID+"']")[0];if(button.parentNode.nodeName==="SECTION"){var customName=button.parentNode.attributes.customName?button.parentNode.attributes.customName.value:"";if(customName!==""){customName=customName.replace(" ","_");var custom="custom_"+customName;sessionStorage.setItem(custom,button.innerHTML)}}parentID="#"+surveySectionElement[0].attributes.id.value}else{var radioDataID=e.currentTarget.dataset.id;var radioButton=$("input[data-id='"+radioDataID+"']")[0];var inputContainer=radioButton.parentNode;if(inputContainer.parentNode.nodeName==="SECTION"){var _customName=inputContainer.parentNode.attributes.customName?inputContainer.parentNode.attributes.customName.value:"";if(_customName!==""){_customName=_customName.replace(" ","_");var _custom="custom_"+_customName;sessionStorage.setItem(_custom,inputContainer.lastElementChild.innerHTML)}}parentID="#"+surveySectionElement[0].attributes.id.value}decrementSectionCount--;targetSurveyID+=attributes.opensurveysection?attributes.opensurveysection.value:"";if(targetSurveyID&&targetSurveyID!=="#"&&$(targetSurveyID).is(":hidden")){$(targetSurveyID).slideDown("fast");if(parentID&&parentID!==""){$(parentID).hide()}if(decrementSectionCount===0){$("#progressbar").hide();$("#progressbarcontainer").hide()}}else if(e.target.attributes.opensurveysection){var targetNonSurveyID="#"+e.target.attributes.opensurveysection.value;targetNonSurveyID.length>1&&$(targetNonSurveyID).slideDown("fast");if(parentID&&parentID!==""){$(parentID).hide()}if(decrementSectionCount===0){$("#progressbar").hide();$("#progressbarcontainer").hide()}}// Only takes place if progress bar is present
if(progressBar){var valueSet=100/surveySectionCount;var newWidth=parseInt(progressBar.style.width.replace("%",""))+valueSet;if(newWidth<=100){progressBar.style.width=newWidth+percentage;progressBar.innerHTML=Math.round(newWidth)+percentage}}return true}function displayShipSection(attributes){if(attributes.openCheckBoxSection&&attributes.openCheckBoxSection.value!=""){var shippingSectionID="#"+attributes.openCheckBoxSection.value;var shippingSectionIDElement=$(shippingSectionID);var nestedHTML=shippingSectionIDElement&&shippingSectionIDElement[0]&&shippingSectionIDElement[0].outerHTML;var openCheckBoxElement=$(nestedHTML).find("[opencheckboxsection]");$(openCheckBoxElement).each(function(){var openCheckBoxName=$(this).attr("name");var openCheckBoxNameElement=openCheckBoxName&&document.getElementsByName(openCheckBoxName);var checked=openCheckBoxNameElement&&openCheckBoxNameElement[0]&&openCheckBoxNameElement[0].checked;var openCheckBoxValue=$(this).attr("opencheckboxsection");if(openCheckBoxValue){var elementId="#"+openCheckBoxValue;if(openCheckBoxName=="billShipSame"){checked?$(elementId).hide():$(elementId).slideDown()}else{checked?$(elementId).slideDown():$(elementId).hide()}}});if(attributes.type&&attributes.type.nodeValue==="radio"){$("input:radio").each(function(){var openCheckBoxSectionValue=$(this).attr("openCheckBoxSection");if(openCheckBoxSectionValue){var checkedValue=$(this)[0]&&$(this)[0].checked;if(checkedValue){$("#"+openCheckBoxSectionValue).slideDown()}else{$("#"+openCheckBoxSectionValue).hide()}}})}else{$(shippingSectionID).is(":hidden")?$(shippingSectionID).slideDown():$(shippingSectionID).slideUp()}}}function disableButtons(disabled){var buttons=document.getElementsByTagName("button");var buttonsLength=buttons.length;if(buttonsLength!==0){for(var _i79=0;_i79<buttonsLength;_i79++){buttons[_i79].disabled=disabled}}}function disableLinks(pointerEvents){var links=document.getElementsByTagName("a");var linksLength=links.length;for(var _i80=0;_i80<linksLength;_i80++){links[_i80].style.pointerEvents=pointerEvents}}function turnOnSpinner(buttonOrLinkId){var buttonElement=$("button[data-id='"+buttonOrLinkId+"']").length?$("button[data-id='"+buttonOrLinkId+"']"):$("a[data-id='"+buttonOrLinkId+"']");var spinner=document.getElementById("fk-submit-spinner");if(spinner)spinner.style.display="block";else if(buttonElement.parents(".fk-popup")[0]){$(getParentSpinnerDiv()).insertAfter(buttonElement[0].parentNode)}else{$(getSpinnerDiv()).insertAfter(buttonElement)}}function getParentSpinnerDiv(){var parentSpinnerDiv=document.createElement("div");var spinnerDiv=document.createElement("div");parentSpinnerDiv.style.display="flex";parentSpinnerDiv.style.justifyContent="center";parentSpinnerDiv.id="fk-submit-spinner";spinnerDiv.className="fa fa-spinner fa-pulse fa-lg m-r-xs";spinnerDiv.style.display="inline-block";spinnerDiv.style.textAlign="center";parentSpinnerDiv.appendChild(spinnerDiv);return parentSpinnerDiv}function getSpinnerDiv(){var spinnerDiv=document.createElement("div");spinnerDiv.id="fk-submit-spinner";spinnerDiv.className="fa fa-spinner fa-pulse fa-lg m-r-xs";spinnerDiv.style.display="block";spinnerDiv.style.textAlign="center";return spinnerDiv}function turnOffSpinner(){var fkSpinner=document.getElementById("fk-submit-spinner");if(fkSpinner){fkSpinner.style.display="none";fkSpinner.remove()}}function disableInteractions(id,isButton,isLink){isButton&&disableButtons(true);isLink&&disableLinks("none");turnOnSpinner(id)}function enableInteractions(){var overlayEffectDiv=document.getElementById("overlayEffectDiv");if(overlayEffectDiv){overlayEffectDiv.style.display="none"}disableButtons(false);disableLinks("auto");turnOffSpinner()}function moveToNextTab(){$("#shipping").hide();$("#payment").show();$("#quantityTab").addClass("active");$("#shippingTab").removeClass("active")}function loadPlacesAutocomplete(){if(pageData.funnelData&&pageData.funnelData.addOns&&(pageData.pageTypeId===2||pageData.pageTypeId===4||pageData.pageTypeId===8)){var googlePlacesKey=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="Google_Places"});if(googlePlacesKey.length!==0&&googlePlacesKey[0].keyValue){googlePlacesKey&&loadScript("https://maps.googleapis.com/maps/api/js?key="+googlePlacesKey[0].keyValue+"&libraries=places",configureAutocomplete)}}}function initAddressFields(){loadPlacesAutocomplete()}function initSocialProof(){if(pageData.funnelData&&pageData.funnelData.addOns){var socialProofKey=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="Social_Proof"});if(socialProofKey.length!==0&&socialProofKey[0].keyValue){var newScript=document.createElement("script");newScript.type="text/javascript";newScript.src="https://cdn-kk.cappedoutsocial.com/widget/js/popup-"+socialProofKey[0].keyValue+".js";document.body.appendChild(newScript)}}}function assignProdQtyEventListeners(){var productSections=document.getElementsByClassName("fk-product-section");var productSectionsLength=productSections.length;var _loop16=function _loop16(_i81){var productSection=productSections[_i81];var product=pageData.selectedCampaign&&pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productSection.getAttribute("value")});if(product&&product[0]){if(product[0].maxOrderQty){var quantityInput=productSection.querySelectorAll("input[name='quantity']");quantityInput&&quantityInput[0]&&quantityInput[0].addEventListener("change",function(event){quantityProdSectionOnChange(event,product[0].maxOrderQty)})}var quantitySelect=productSection.querySelectorAll("select[name='quantity']");quantitySelect.length>0&&quantitySelect[0].addEventListener("change",function(event){if(pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length){getVariants(productSection.id);displayPrices()}})}};for(var _i81=0;_i81<productSectionsLength;_i81++){_loop16(_i81)}}function assignCardDetailsEventListeners(){var cardDate=document.querySelectorAll("input[name='cardDate']");var cardMonth=document.getElementsByName("cardMonth");var cardYear=document.getElementsByName("cardYear");cardDate&&cardDate[0]&&cardDate[0].addEventListener("change",function(event){var cardDateValueParsed=event.target.value.replace("/","");if(cardDateValueParsed){var month=cardDateValueParsed.substring(0,2);var year=cardDateValueParsed.substr(cardDateValueParsed.length-2);$(cardMonth[0]).attr("value",parseInt(month));$(cardYear[0]).attr("value",parseInt(year))}})}function quantityProdSectionOnChange(event,maxOrderQty){if(event.target.value>maxOrderQty){$("#alertTopAutoHideDiv")&&$("#alertTopAutoHideDiv").remove();$("body").prepend("<div id='alertTopAutoHideDiv' style='position:fixed; top:0; left:0; width:100%; z-index:999;'><div class='alert alert-danger alert-dismissible' role='alert' ><strong> Quantity cannot exceed "+maxOrderQty+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div></div>");event.target.value=maxOrderQty;setTimeout(function(){$("#alertTopAutoHideDiv").remove()},4000)}if(event.target.value<=0){event.target.value=""}}function fillInAddress(){// Get the place details from the autocomplete object.
var address_components=address1FieldAutComplete.getPlace().address_components;document.getElementsByName("address1")[0].value=getAddressField("street_number",address_components)+" "+getAddressField("route",address_components);document.getElementsByName("city")[0].value=getAddressField("locality",address_components);document.getElementsByName("country")[0].value=getAddressField("country",address_components);document.getElementsByName("postalCode")[0].value=getAddressField("postal_code",address_components);loadStates("state",document.getElementsByName("country")[0].value);document.getElementsByName("state")[0].value=getAddressField("administrative_area_level_1",address_components)}function fillInShipAddress(){// Get the place details from the autocomplete object.
var address_components=shipAddress1FieldAutComplete.getPlace().address_components;document.getElementsByName("shipAddress1")[0].value=getAddressField("street_number",address_components)+" "+getAddressField("route",address_components);document.getElementsByName("shipCity")[0].value=getAddressField("locality",address_components);document.getElementsByName("shipCountry")[0].value=getAddressField("country",address_components);document.getElementsByName("shipPostalCode")[0].value=getAddressField("postal_code",address_components);loadStates("shipState",document.getElementsByName("shipCountry")[0].value);document.getElementsByName("shipState")[0].value=getAddressField("administrative_area_level_1",address_components)}function fillInInputIfExists(field,value){if(document.getElementsByName(field).length){document.getElementsByName(field)[0].value=value}}function fillInShipAddressGPay(obj,shippingAddress){var addBillingFields=$("[name=address1]").length&&!$("[name=shipAddress1]").length;if(addBillingFields){var fullName=shippingAddress.name.trim();var pos=fullName.indexOf(" ");obj.firstName=pos>-1?fullName.substring(0,pos):fullName;obj.lastName=pos>-1?fullName.substring(pos+1):null;obj.address1=shippingAddress.address1;obj.city=shippingAddress.locality;obj.country=shippingAddress.countryCode;obj.postalCode=shippingAddress.postalCode;loadStates("state",shippingAddress.countryCode);obj.state=shippingAddress.administrativeArea;ccBillingFields.forEach(function(field){obj[field]&&fillInInputIfExists(field,obj[field])});return}var shipAddress1=document.getElementsByName("shipAddress1")[0];if(!shipAddress1||!shipAddress1.value){var _fullName2=shippingAddress.name.trim();var _pos2=_fullName2.indexOf(" ");obj.shipFirstName=_pos2>-1?_fullName2.substring(0,_pos2):_fullName2;obj.shipLastName=_pos2>-1?_fullName2.substring(_pos2+1):null;obj.shipAddress1=shippingAddress.address1;obj.shipCity=shippingAddress.locality;obj.shipCountry=shippingAddress.countryCode;obj.shipPostalCode=shippingAddress.postalCode;loadStates("shipState",shippingAddress.countryCode);obj.shipState=shippingAddress.administrativeArea;ship.forEach(function(field){obj[field]&&fillInInputIfExists(field,obj[field])})}}function setAppleAddress(address,type,obj){var addressMap={"givenName":{billing:"firstName",shipping:"shipFirstName"},"familyName":{billing:"lastName",shipping:"shipLastName"},"addressLines":{billing:"address1",shipping:"shipAddress1",billing2:"address2",shipping2:"shipAddress2"},"locality":{billing:"city",shipping:"shipCity"},"administrativeArea":{billing:"state",shipping:"shipState"},"countryCode":{billing:"country",shipping:"shipCountry"},"postalCode":{billing:"postalCode",shipping:"shipPostalCode"},"phoneNumber":{shipping:"phoneNumber"},"emailAddress":{shipping:"emailAddress"}};var addressMapEntries=Object.entries(addressMap);var addressMapEntriesLength=addressMapEntries.length;for(var _i82=0;_i82<addressMapEntriesLength;_i82++){var key=addressMapEntries[_i82][0];var value=addressMapEntries[_i82][1];if(address[key]&&value[type]){if(key==="addressLines"){fillInInputIfExists(value[type],address[key][0]);obj[value[type]]=address[key][0];if(address[key].length>1){var address2Key=type+"2";fillInInputIfExists(value[address2Key],address[key][1]);obj[value[address2Key]]=address[key][1]}}else{fillInInputIfExists(value[type],address[key]);obj[value[type]]=address[key]}}}}function getAddressField(field,address_components){var fieldObj=address_components.filter(function(e){return e.types.includes(field)});if(fieldObj.length){if(field==="administrative_area_level_1"||field==="country"){return fieldObj[0].short_name}else{return fieldObj[0].long_name}}else{return""}}function configureAutocomplete(){var addressField=document.getElementsByName("address1")[0];var campaignCountries=pageData.selectedCampaign.countries.map(function(e){return e.countryCode});var options={types:["address"]};if(campaignCountries.length&&campaignCountries.length<=5){options.componentRestrictions={country:campaignCountries}}if(addressField){address1FieldAutComplete=new google.maps.places.Autocomplete(addressField,options);address1FieldAutComplete.setFields(["address_component"]);google.maps.event.addListener(address1FieldAutComplete,"place_changed",fillInAddress)}var shipAddressField=document.getElementsByName("shipAddress1")[0];if(shipAddressField){shipAddress1FieldAutComplete=new google.maps.places.Autocomplete(shipAddressField,options);shipAddress1FieldAutComplete.setFields(["address_component"]);google.maps.event.addListener(shipAddress1FieldAutComplete,"place_changed",fillInShipAddress)}setTimeout(function(){// Resetting the default placeholder set by Google
if(addressField&&addressField.placeholder==="Enter a location"){addressField.placeholder=""}if(shipAddressField&&shipAddressField.placeholder==="Enter a location"){shipAddressField.placeholder=""}},1000)}function getCurrentWindowLocation(){if(window.location!==window.parent.location){//  Inside IFrame
return window.parent.location}else{return window.location}}function replaceCurrentWindow(route){if(route&&route.startsWith("https://")){window.location.replace(route);return}var reference="";if(checkDomainForRoute()){reference="/"+pageData.funnelData.referenceId}route=route.startsWith("/")?route:reference+"/"+route;// Its like a redirection, replace() does not keep the originating page in the session history
window.location.replace(route)}function getAbsolutePathByUrl(url){var parts=url.split("/");var size=3;if(checkDomainForRoute()){size=4}return parts.slice(0,size).join("/")}function setCurrentWindowLocation(route){window.onbeforeunload=null;var redirectRoute=route.startsWith("http")?route:getAbsolutePathByUrl(getCurrentWindowLocation().href)+"/"+route;if(window.location!==window.parent.location){//  Inside IFrame
window.parent.location.href=redirectRoute}else{window.location.href=redirectRoute}}function loadProfilePage(){var membership=sessionStorage.getItem("loginCustomer")?JSON.parse(sessionStorage.getItem("loginCustomer")):getMembershipDetails();memberFields.forEach(function(field){var fieldObj=document.getElementsByName(field)[0];if(fieldObj&&membership){fieldObj.value=membership[field]}});ship.forEach(function(field){var fieldObj=document.getElementsByName(field)[0];if(fieldObj&&membership){fieldObj.value=membership[field]}})}function loadScript(url,callback,appendTo,id,dataSetAttrs,attributes,scriptContent,onErrorCallback){// Adding the script tag to the head as suggested before
var appendElement=appendTo?document[appendTo]:document.head;var script=document.createElement("script");script.type="text/javascript";script.src=url;if(id){script.id=id}if(dataSetAttrs&&dataSetAttrs.length){dataSetAttrs.forEach(function(attrs){script.dataset[attrs.key]=attrs.value})}if(attributes&&attributes.length){attributes.forEach(function(attrs){script.setAttribute(attrs.key,attrs.value)})}// Then bind the event to the callback function.
// There are several events for cross browser compatibility.
script.onreadystatechange=callback;script.onload=callback;if(scriptContent){script.innerHTML=scriptContent}script.onerror=onErrorCallback;// Fire the loading
appendElement.appendChild(script)}function clearAddressValues(addressOrigin){var addressLength=addressOrigin.length;for(var _i83=0;_i83<addressLength;_i83++){if(document.getElementsByName(addressOrigin[_i83])[0]&&document.getElementsByName(addressOrigin[_i83])[0].value!=""){document.getElementsByName(addressOrigin[_i83])[0].value=""}}}function openPopUp(element){var popupId=element?element.getAttribute("openpopup"):"customizable_popup";var modal=document.getElementById(popupId);if(modal){var submitButtonInModal=$(modal).find("button[action=submit], a[action=submit], .gpay-button, div[title=AmazonPay], .paypal-buttons");if(pageData&&pageData.pageTypeId===4&&submitButtonInModal.length&&!checkRequiredInputs()){return}modal.style.display="block"}}function loadStaticCurrencyValues(){var regexString="([(?<={"+campaignBaseCurrencySymbol+"})]+\\d[0-9]{0,9})(,\\d{3})*(\\.\\d{1,})?";var updatedRegex=new RegExp(regexString,"g");staticCurrencyValues=[];$("body").find(":not(iframe):not(.fk-shopping-cart):not(.dynamic-shipping-total):not(.dynamic-price-total):not(.salesTax):not(.grandTotal):not(.discount):not(.insurance):not(.savings):not(.compareAtTotal)").addBack().contents().filter(function(){var _this3=this;if(this.nodeType==3&&this.textContent.indexOf(campaignBaseCurrencySymbol)>-1){var values=this.textContent.match(updatedRegex);values&&values.forEach(function(value){if(!staticCurrencyValues.includes(value.substring(campaignBaseCurrencySymbol.length))){staticCurrencyValues.push($($(_this3).parent()[0]).attr("id")+"~|~"+value.substring(campaignBaseCurrencySymbol.length))}})};})}function convertStaticCurrencyValues(){var previousSymbol=sessionStorage.getItem("previousCurrencySymbol")?sessionStorage.getItem("previousCurrencySymbol"):campaignBaseCurrencySymbol;var previousFxRate=sessionStorage.getItem("previousExchangeRate")?sessionStorage.getItem("previousExchangeRate"):"1";var newSymbol=sessionStorage.getItem("currencyCodeSymbol")?sessionStorage.getItem("currencyCodeSymbol"):campaignBaseCurrencySymbol;var newFxRate=sessionStorage.getItem("exchangeRate")?sessionStorage.getItem("exchangeRate"):"1";var checkoutWorkFlowPages=[2,3,4,5].includes(pageData.pageTypeId);if(newSymbol!=previousSymbol||!ccSkipStaticCurrencyConversion&&checkoutWorkFlowPages){ccSkipStaticCurrencyConversion=true;var skipElement=$("#items-list, .fk-dynamic-invoice-row");var staticCurrencyValuesLength=staticCurrencyValues.length;var _loop17=function _loop17(_i84){var value=staticCurrencyValues[_i84].split("~|~")[1];var dataCurrencyId=staticCurrencyValues[_i84].split("~|~")[0];var wrapperElement=document.getElementById(dataCurrencyId);if($(wrapperElement).closest(skipElement).length)return"break";var previousValue=previousSymbol!==campaignBaseCurrencySymbol?convertStaticValue(value,previousSymbol,previousFxRate):campaignBaseCurrencySymbol+value;var newValue=newSymbol!==campaignBaseCurrencySymbol?convertStaticValue(value,newSymbol,newFxRate):campaignBaseCurrencySymbol+value;if(checkoutWorkFlowPages){newValue="<span data-cc-check-decimal='true' data-cc-price='"+value+"'>"+newValue+"</span>"}if(wrapperElement){wrapperElement.innerHTML=wrapperElement.innerHTML.replaceAll(previousValue,function replacementCallBack(match,offset,string){if(!string.charAt(offset-1)){return newValue}else if(string.charAt(offset-1)===" "||string.charAt(offset+match+1)===" "){return newValue}else{return match}})}};for(var _i84=0;_i84<staticCurrencyValuesLength;_i84++){var _ret5=_loop17(_i84);if(_ret5==="break")break}}sessionStorage.setItem("previousCurrencySymbol",newSymbol);sessionStorage.setItem("previousExchangeRate",newFxRate)}function convertStaticValue(value,currencySymbol,exchangeRate){var newValue=value;if(value.includes(".")||exchangeRate.includes(".")){newValue=(parseFloat(value)*parseFloat(exchangeRate)).toFixed(2)}else{newValue=parseInt(value)*parseInt(exchangeRate)}return currencySymbol+newValue.toString()}var ccProdSectionProducts={};var ccActionPurchaseItem=null;function replaceTokens(){var headerAndLabelList=["H1","H2","H3","H4","H5","H6","P","LABEL","SPAN","B","I"];var textBoxesAndLabels=document.querySelectorAll("label, input[type='text'], div, h1, h2, h3, h4, h5, h6, p, span, a, b, .fk-product-image, i");var purchaseItem=sessionStorage.getItem("ccActionPurchaseItem");ccActionPurchaseItem=pageData.pageTypeId===13&&purchaseItem?JSON.parse(purchaseItem):null;textBoxesAndLabels.forEach(function(el){if(el.tagName=="INPUT"){assignTokenValues("input",el)}if(el.tagName=="IMG"&&el.classList&&el.classList.contains("fk-product-image")){assignTokenValues("prodImg",el)}if(headerAndLabelList.indexOf(el.tagName)>-1){assignTokenValues("label",el)}if(el.tagName=="DIV"){var childNodes=Object.assign([],el.childNodes);var childNodesLength=childNodes.length;for(var _i85=0;_i85<childNodesLength;_i85++){var node=childNodes[_i85];var tokenMatch=node.textContent.match(/{{(.*?)}}/g);if(node.nodeName=="#text"&&tokenMatch&&tokenMatch.length){assignTokenValues("label",el);break}}}if(el.tagName=="A"){if(el.childNodes[0]&&el.childNodes[0].nodeName=="#text"){assignTokenValues("label",el)}assignTokenValues("href",el)}});for(var _productId6 in ccProdSectionProducts){delete ccProdSectionProducts[_productId6]};}function assignTokenValues(inputType,el){var date=new Date;var orderData=JSON.parse(sessionStorage.getItem("orderData"));var requestUri=sessionStorage.getItem("requestUri");var uriParams=requestUri&&new URL(requestUri).searchParams;var loginOrder=sessionStorage.getItem("loginOrder");loginOrder=loginOrder&&loginOrder!=="undefined"&&JSON.parse(sessionStorage.getItem("loginOrder"))||{};var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var membershipInfo=getMembershipDetails();var membership=membershipInfo?membershipInfo:[];var currentItem=sessionStorage.getItem("currentItem");var orderStatusInfo=JSON.parse(sessionStorage.getItem("orderStatusInfo"));if(!currentItem&&[4,33].includes(pageData.pageTypeId)){fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(fkCart&&Object.keys(fkCart).length>0)currentItem=Object.keys(fkCart)[0]}var tokenItem;var productId=$(el).closest(".fk-product-section").attr("value");productId=productId&&productId.trim();if(Number(productId))currentItem=productId;if(orderStatusInfo){tokenItem=orderStatusInfo;updateMap(orderStatusInfo)}else if(currentItem){if(!ccProdSectionProducts[currentItem]){var _productData12=currentItem.split(".");tokenItem=pageData.selectedCampaign&&pageData.selectedCampaign.products.find(function(data){return data.campaignProductId==_productData12[0]});if(tokenItem){tokenItem=Object.assign({},tokenItem);tokenItem=getMemberPrice(tokenItem);if(tokenItem.variants&&!ccDynamicProductSection){var variantDetails=_productData12.length>1?tokenItem.variants.find(function(data){return data.variantDetailId===parseInt(_productData12[1])}):tokenItem.variants[0];if(variantDetails){//adjust a few items with variant details
variantDetails=getMemberPrice(variantDetails);tokenItem.productName+=" "+variantDetails.title;tokenItem.cycle1_price=parseFloat(variantDetails.price)>0&&!tokenItem.isVariantBundle&&!tokenItem.isEditable?variantDetails.price:tokenItem.cycle1_price;tokenItem.cycle1_shipPrice=parseFloat(variantDetails.shippingPrice)>0&&!tokenItem.isVariantBundle?variantDetails.shippingPrice:tokenItem.cycle1_shipPrice;tokenItem.imageUrl=variantDetails.imageUrl?variantDetails.imageUrl:tokenItem.imageUrl}}tokenItem.cycle1_price=parseFloat(tokenItem.cycle1_price).toFixed(2);tokenItem.cycle1_shipPrice=parseFloat(tokenItem.cycle1_shipPrice).toFixed(2)}ccProdSectionProducts[currentItem]=tokenItem}tokenItem=ccProdSectionProducts[currentItem]}else if(orderData&&orderData["items"]){tokenItem=orderData["items"][0]}else if(loginOrder&&loginOrder["items"]){tokenItem=loginOrder["items"][0]}else if(customerOrders&&customerOrders[0]["items"]){var key=Object.keys(customerOrders[0]["items"])[0];tokenItem=customerOrders[0]["items"][key]}var formattedValue="";var tokenValue="";var token="";if(inputType=="prodImg"&&tokenItem&&tokenItem.imageUrl){el.src=tokenItem.imageUrl}if(inputType=="input"){tokenValue=el.value}if(inputType=="label"){tokenValue=el.innerHTML}if(inputType=="href"){tokenValue=decodeURIComponent(el.href)}var remSubstring=tokenValue&&tokenValue.match(/{{(.*?)}}/g);if(remSubstring&&remSubstring.length>0){for(var _i86=0;_i86<remSubstring.length;_i86++){var trimmedString=remSubstring[_i86].trim().replace(/(?:^(?:&nbsp;)+)|(?:(?:&nbsp;)+$)/g,"");token=trimmedString;trimmedString=trimmedString.split("{{")[1].split("}}")[0];var isDate=trimmedString.indexOf("yy")>-1||trimmedString.indexOf("MM")>-1||trimmedString.indexOf("ddd")>-1;var orderOrUriValue=orderData&&orderData[trimmedString]||uriParams&&uriParams.has(trimmedString)&&uriParams.get(trimmedString);if(isDate){formattedValue=setDateFormat(date,trimmedString)}else if(ccActionPurchaseItem&&ccActionPurchaseItem[trimmedString]){var value=ccActionPurchaseItem[trimmedString];formattedValue=trimmedString.indexOf("date")>-1?setDateFormat(value,"yyyy-MM-dd"):value}else if(!orderStatusInfo&&orderOrUriValue){if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(orderOrUriValue,"yyyy-MM-dd")}else{formattedValue=orderOrUriValue}}else if(!orderStatusInfo&&loginOrder&&(loginOrder[trimmedString]||loginOrder.fulfillments&&loginOrder.fulfillments[0]&&loginOrder.fulfillments[0][trimmedString])){var _value=loginOrder[trimmedString]||loginOrder.fulfillments&&loginOrder.fulfillments[0]&&loginOrder.fulfillments[0][trimmedString];if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(_value,"yyyy-MM-dd")}else{formattedValue=_value}}else if(!orderStatusInfo&&customerOrders&&customerOrders[0][trimmedString]){if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(customerOrders[0][trimmedString],"yyyy-MM-dd")}else{formattedValue=customerOrders[0][trimmedString]}}else if(tokenItem&&tokenItem[trimmedString]||orderStatusInfo&&tokenItem&&tokenItem.fulfillments&&tokenItem.fulfillments[0]&&tokenItem.fulfillments[0][trimmedString]){var _value2=tokenItem[trimmedString]||tokenItem.fulfillments&&tokenItem.fulfillments[0]&&tokenItem.fulfillments[0][trimmedString];if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(_value2,"yyyy-MM-dd")}else{formattedValue=_value2}}else if(membership&&membership[trimmedString]){if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(membership[trimmedString],"yyyy-MM-dd")}else{formattedValue=membership[trimmedString]}}else{var isBuildOrTemplate=checkBuildOrTemplate();if(isBuildOrTemplate){formattedValue=token}else{formattedValue=""}}if(trimmedString==="stockQuantity"&&!formattedValue){formattedValue="0"}var priceValue=formattedValue;if(trimmedString.includes("cycle1_price")){formattedValue=(parseFloat(formattedValue)*vatTaxRate).toFixed(2)}if(trimmedString.match(/price/gi)){if([2,3,4].includes(pageData.pageTypeId)){var _productId7=pageData.cartData&&tokenItem&&tokenItem.campaignProductId;formattedValue="<span "+"data-cc-prod-id='"+_productId7+"' "+"data-cc-price-type='"+trimmedString+"' data-cc-price='"+priceValue+"'>"+ccFormatCurrency(formattedValue,pageData.selectedCampaign.currencySymbol)+"</span>"}else{formattedValue=pageData.selectedCampaign.currencySymbol+formattedValue}}if(inputType=="input"){el.value=tokenValue.replace(token,formattedValue);tokenValue=el.value}if(inputType=="label"){formattedValue=typeof formattedValue==="string"?formattedValue.replaceAll("\n","<br>"):formattedValue;if(trimmedString==="ffl_info"&&globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber){var fflNumber=sessionStorage.getItem("fflNumber");var fflAddress=sessionStorage.getItem("fflAddress");fflAddress=fflAddress?fflAddress.split(","):[];formattedValue=(fflNumber?fflNumber:"")+(fflAddress[0]?"<br>"+fflAddress[0]:"")+(fflAddress[1]?"<br>"+fflAddress[1]+", ":"")+(fflAddress[2]||"")}else if((pageData.pageTypeId===17||pageData.pageTypeId===18)&&trimmedString==="collectionName"){formattedValue="<span class='cc-collection-name-label'></span>"}else if(trimmedString==="trackingNumber"&&formattedValue){formattedValue=addTrackingNumberLink(formattedValue,false)}el.innerHTML=tokenValue.replace(token,formattedValue);tokenValue=el.innerHTML}if(inputType=="href"){el.href=tokenValue.replace(token,formattedValue);tokenValue=el.href}}}}function addTrackingNumberLink(trackingValue,returnElement){var trackingNumber=trackingValue+"";var trackingNumberLength=trackingNumber.length;if(trackingNumber[0]==="9"&&trackingNumberLength>=20&&trackingNumberLength<=26){trackingValue="<a target='_blank' href='https://tools.usps.com/go/TrackConfirmAction_input?strOrigTrackNum="+trackingNumber+"'>"+trackingNumber+"</a>"}else if(trackingNumber.substring(0,2).toLowerCase()==="1z"){trackingValue="<a target='_blank' href='https://wwwapps.ups.com/WebTracking/track?track=yes&trackNums="+trackingNumber+"'>"+trackingNumber+"</a>"}if(returnElement&&trackingValue&&trackingValue.length>trackingNumberLength){trackingValue=$(trackingValue)[0]}return trackingValue}function setDateFormat(date,dateFormat){var orderDate=typeof date==="string"?new Date(date):date;var formattedDate="";var monthShort=["Jan","Feb","$ar","Apr","$ay","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var monthLong=["January","February","$arch","April","$ay","June","July","August","September","October","November","December"];var dayShort=["Sun","Mon","Tue","We$","Thu","Fri","Sat"];var dayLong=["Sun$ay","Mon$ay","Tues$ay","We$nes$ay","Thurs$ay","Fri$ay","Satur$ay"];var year=orderDate.getFullYear().toString();formattedDate=dateFormat;formattedDate=formattedDate.replace("yyyy",year);formattedDate=formattedDate.replace("yy",year.substring(2,4));formattedDate=formattedDate.replace("MMMM",monthLong[orderDate.getMonth()]);formattedDate=formattedDate.replace("MMM",monthShort[orderDate.getMonth()]);formattedDate=formattedDate.replace("MM",appendLeadingZeroes(orderDate.getMonth()+1));formattedDate=formattedDate.replace("M",orderDate.getMonth()+1);formattedDate=formattedDate.replace(/\$/g,"M");//so the replace on line above this does not get "May"
formattedDate=formattedDate.replace("dddd",dayLong[orderDate.getDay()]);formattedDate=formattedDate.replace("ddd",dayShort[orderDate.getDay()]);formattedDate=formattedDate.replace("dd",appendLeadingZeroes(orderDate.getDate()));formattedDate=formattedDate.replace("d",orderDate.getDate());formattedDate=formattedDate.replace(/\$/g,"d");//so the replace on line above this does not get "day"
return formattedDate}function affixImports(type,url,onloadFunction){if(type==="js"){var newScript=document.createElement("script");var scriptData=document.getElementById("scriptData");if(onloadFunction){newScript.onload=onloadFunction}document.body.insertBefore(newScript,scriptData);newScript.src=url}else{// To move the links to head if anything is present other than it
var listItems=document.getElementsByTagName("link");Array.from(listItems,function(elem){if(elem.parentElement.nodeName!=="HEAD"){document.head.appendChild(elem)}});var newLink=document.createElement("link");document.head.insertBefore(newLink,listItems[listItems.length-1].nextSibling);newLink.rel="stylesheet";newLink.href=url}}function configurePopup(){$("<div/>",{"class":"dialogContainer","id":"dialogContainer"}).appendTo("body");$("#dialogContainer").position({my:"center",at:"center"});$("<div/>",{"class":"dialogIframeDiv","id":"dialogIframeDiv"}).appendTo("#dialogContainer");$("#dialogIframeDiv").dialog({resizable:false,autoOpen:false,height:$(window).height()*.75,width:$(window).width()*.75,show:"slideDown",modal:true,open:function open(){setTimeout(function(){$(".dialogPopupIframe").focus()},1000)}});$(".ui-dialog-titlebar").css({"background":"none","border":"0"});$(".dialogIframeDiv").css({"padding":"5px"});window.addEventListener("resize",function(){$("#dialogIframeDiv").dialog({height:$(window).height()*.75,width:$(window).width()*.75});var headerHeight=$(".cartPanelHeader").css("height");$("body").css({marginTop:headerHeight})})}function appendLeadingZeroes(n){if(n<=9){return"0"+n}return n}function selectRadioTiles(element,source){var variantTypeCheckedValue=element.getAttribute("varianttype");var productVariantElement=element.closest(".fk-product-variant-select");if(variantTypeCheckedValue&&variantTypeCheckedValue!==""&&variantTypeCheckedValue.toLowerCase()=="color"){var border=productVariantElement?"2px solid #000000":"2px solid #000000";var boxShadow=productVariantElement?"rgb(230 241 241) 0px 0px 1px 1px inset":"0 0 0 2px #f3f5f6 inset";$(element).css({"border":border,"box-shadow":boxShadow})}else{if(source==="from-on-load"){element.firstElementChild.checked=true}var selectedColor=$(element).closest(".fk-product-section").attr("selectedcolor");var _boxShadow=productVariantElement?"rgb(230 241 241) 0px 0px 1px 1px inset":"0 0 0 2px #000";$(element).css({"background-color":selectedColor?selectedColor:"","cursor":"pointer","box-shadow":_boxShadow});productVariantElement&&$(element).css({"border":"2px solid #000000"})}$(element).attr("data-selected","true")}function productVariantTileClick(element){var variantRadioTiles=element.closest("div");if(variantRadioTiles&&variantRadioTiles.children&&variantRadioTiles.children.length>0){var childElementLength=variantRadioTiles.children.length;var childElements=variantRadioTiles.children;for(var _i87=0;_i87<childElementLength;_i87++){var childElement=childElements[_i87];var variantTypeValue=childElement.getAttribute("varianttype");if(variantTypeValue&&variantTypeValue!==""&&variantTypeValue.toLowerCase()=="color"){$(childElement).css({"box-shadow":"unset","border":"2px solid #c5cacd"})}else{childElement.style.setProperty("background-color","unset","important");childElement.style.setProperty("box-shadow","unset","important");if($(element).closest(".fk-product-variant-select")[0]){childElement.style.setProperty("border","2px solid #c5cacd")}}$(childElement).attr("data-selected","false")}}if(element.checked==true){if(element&&element.parentElement){selectRadioTiles(element.parentElement)}}}$("input[type=radio][class=variant-radio]").on("click change",function(e){productVariantTileClick(this)});function showVariantImageOnProductSection(){var prodSection=document.querySelectorAll(".fk-product-section");if(prodSection&&prodSection.length>0){prodSection.forEach(function(prodSection){var prodImg=$(prodSection).find("img");var prodValue=prodSection&&prodSection.getAttribute("value");var prodPrice=$(prodSection).find(".fk-price")[0];var prodShipPrice=$(prodSection).find(".fk-ship-price")[0];if(prodImg&&prodImg[0]){showVariantImage(prodSection,prodImg[0],prodValue,prodPrice,prodShipPrice)}})}}function mapSelectVariant(product,productSection,productData,index,isChangeProdSection){try{var tileVariantValue={};for(var _i88=1;_i88<=3;_i88++){var key="variant"+_i88;tileVariantValue[key]=$(productSection).find("[data-selected=true][name="+key+"]").find("[type=radio]").attr("data-value")}$(productSection).find(".variant-parent-div").remove();var variantsLength=product&&product.variants&&product.variants.length;var variantTypeCount=variantsLength>0?getNumOfVariantTypes(product):0;var firstSelect=productSection.querySelector("select[name='variant"+1+"']");var firstSelectGroup=firstSelect&&firstSelect.closest(".fk-element-container");["1","2","3"].map(function(value){var currentValueSelect=productSection.querySelector("select[name='variant"+value+"']");if(isChangeProdSection&&value<=variantTypeCount&&!currentValueSelect&&firstSelectGroup){var newSelect=firstSelect.cloneNode();var newSelectGroup=firstSelectGroup.cloneNode();newSelectGroup.removeAttribute("id");newSelect.setAttribute("name","variant"+value);var label=$(firstSelect).siblings("label")[0];var newLabel=label&&label.cloneNode();newSelectGroup.append(newSelect);newLabel&&newSelect.before(newLabel);productSection.querySelector("select[name='variant"+(value-1)+"']").closest(".fk-element-container").after(newSelectGroup)}else if(value!=1&&value>variantTypeCount&&isChangeProdSection){var variantEle=productSection.querySelectorAll("select[name='variant"+value+"']");removeItems(variantEle,"",true)}var productVariants=productSection.querySelectorAll("select[name='variant"+value+"']");var productVariantsTile=productSection.querySelectorAll(".variant-label"+value);var variantTileLabel="";var usedValues=[];if(productVariants&&productVariants.length>0){populateVariantSelects(product,productSection,productVariants,"",value,productData,true,isChangeProdSection)}else if(productVariantsTile&&productVariantsTile.length>0){variantTileLabel=$(productVariantsTile).siblings("label");if(product.variants&&product.variants.length>0){product.variants.sort(function(a,b){return a["variantOptionSequence"+value]-b["variantOptionSequence"+value]});var variantTileParent=document.createElement("div");variantTileParent.className="variant-parent-div";variantTileParent.style.display="flex";variantTileParent.style.flexWrap="wrap";variantTileParent.style.alignSelf="flex-start";var variantImageClassExists=Array.from(productVariantsTile[0].classList).includes("fk-variant-image");var prodVariants=product.variants;var prodVariantsLength=prodVariants.length;for(var _i89=0;_i89<prodVariantsLength;_i89++){var variant=prodVariants[_i89];var optionName=variant["variantOptionName"+value];var variantTypeNameVar=variant["variantName"+value];var imageExists=variantImageClassExists?variant["imageUrl"]:true;if(optionName&&imageExists){var variantTypeName=variant["variantName"+value];var variantRadioInput=document.createElement("input");variantRadioInput.setAttribute("type","radio");variantRadioInput.setAttribute("data-value",variant["variantDetailId"]);variantRadioInput.style.display="none";variantRadioInput.className="variant-radio";variantRadioInput.name=variantTypeName+"-"+(index+1);var variantTile=document.createElement("label");var variantValue=optionName;variantTile.innerText=optionName;var VariantType=document.createAttribute("variantType");// Create a "class" attribute
var title=document.createAttribute("title");// Create a "class" attribute
VariantType.value=variantTypeName;// Set the value of the class attribute
variantTile.setAttributeNode(VariantType);var isColorVariant=variantTypeName.toLowerCase()=="color";if(variantTypeName&&variantTypeName!==""&&(isColorVariant||variantImageClassExists)){var borderRadius="50%",dimension="25px",bgColor=variantValue;if(variantImageClassExists){borderRadius="0%";dimension="50px";bgColor="transparent";variantTile.style.backgroundImage="url("+variant["imageUrl"]+")";variantTile.style.backgroundRepeat="no-repeat";variantTile.style.backgroundPosition="center";if(!productVariantsTile[0].closest(".fk-product-variant-select")){variantTile.style.backgroundSize="contain"}}if(!productVariantsTile[0].closest(".fk-product-variant-select")||isColorVariant&&!variantImageClassExists){variantTile.style.height=dimension;variantTile.style.width=dimension;variantTile.style.flex="unset"}variantTile.style.setProperty("background-color",bgColor,"important");variantTile.style.border="2px solid #c5cacd";variantTile.style.fontSize="0";variantTile.style.borderRadius=borderRadius;title.value=variantValue;variantTile.setAttributeNode(title)}variantTile.className="variant-label"+value;variantTile.setAttribute("name","variant"+value);variantTile.setAttribute("data-selected","false");variantTileLabel=$(productVariantsTile).siblings("label");productVariantsTile[0].innerText="";if(variantTileLabel&&variantTileLabel.length>0){variantTileLabel[0].parentElement.appendChild(variantTileParent);variantTileLabel[0].innerHTML=variant["variantName"+value]}else{productVariantsTile[0].parentElement.append(variantTileParent)}productVariantsTile[0].id!==""&&variantTile.setAttribute("id",productVariantsTile[0].id);$(productVariantsTile[0]).hide();if(!usedValues.includes(optionName)){usedValues.push(optionName);variantTile.appendChild(variantRadioInput);variantTileParent.appendChild(variantTile)}if(_i89===product.variants.length-1&&productData.length>1){(function(){//set current variant
var variant=product.variants.filter(function(data){return data.variantDetailId==productData[1]});$(variantTileParent).children().each(function(){var innerText=$(this).text();if(innerText===variant[0]["variantOptionName"+value]){selectRadioTiles(this)}})})()}}else{$(productVariantsTile[0]).hide();if(!variantImageClassExists&&variantTileLabel&&variantTileLabel.length>0){$(variantTileLabel[0]).hide()}}}}else{$(productVariantsTile[0]).hide();variantTileLabel&&variantTileLabel.length&&$(variantTileLabel[0]).hide()}}});for(var _i90=1;_i90<=3;_i90++){var _key2="variant"+_i90;var tileValue=tileVariantValue[_key2];tileValue&&$(productSection).find("[name="+_key2+"]").find("[data-value="+tileValue+"]").click()}}catch(error){console.log(error)}}function removeProductsFromCart(product,productSection){try{//remove products from cart
var orderItems=getOrderItems();for(var sessionItemCpId in orderItems){if(sessionItemCpId.indexOf(".")>0){(function(){var productData=sessionItemCpId.split(".");if(productData[0]==(product[0]&&product[0].campaignProductId)){if(pageData.pageTypeId!=34)delete orderItems[sessionItemCpId];var variant=product[0]&&product[0].variants.find(function(data){return data.variantDetailId==productData[1]});if(variant){["1","2","3"].map(function(value){var productVariants=productSection&&productSection.querySelectorAll("select[name='variant"+value+"']");if(productVariants&&productVariants.length>0){productVariants[0].value=variant["variantOptionName"+value]}})}}})()}else if(sessionItemCpId==(product[0]&&product[0].campaignProductId)){var button=productSection&&productSection.querySelectorAll("button");if(button&&button.length>0&&button[0].innerHTML==="Select"){button[0].innerHTML="Selected";button[0].className="btn btn-success"}}}sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}catch(error){console.log(error)}}function mapProductVariantNameSelect(product,productSection,isChangeProdSection){try{var productNameSelect=productSection.querySelectorAll("select[name='productVariant']")[0];var selectValue=$(productNameSelect).val();if(productNameSelect){var chooseOptionText=productNameSelect.options.length>0&&productNameSelect.options[0].value===""?productNameSelect.options[0].text:null;var usedValues=[];var firstVariant=product&&product[0]&&product[0].variants&&product[0].variants[0]&&product[0].variants[0].title&&product[0].variants[0].title.charAt(0);if(isNaN(+firstVariant)){product[0].variants.sort(function(a,b){return a.title[0].charCodeAt(0)-b.title[0].charCodeAt(0)})}isChangeProdSection&&$(productNameSelect).siblings("label").first().html("Variants");productNameSelect.innerHTML="";if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;productNameSelect.add(chooseOption)}var variantsLength=product[0].variants.length;var actionCurrentItem=sessionStorage.getItem("actionCurrentItem");var variantDetailId=pageData.pageTypeId===13&&isChangeProdSection&&actionCurrentItem?actionCurrentItem.split(".")[1]:"";var currentVariant=variantsLength&&variantDetailId&&product[0].variants.find(function(data){return data.variantDetailId==variantDetailId});for(var _i91=0;_i91<variantsLength;_i91++){var variant=product[0].variants[_i91];var option=document.createElement("OPTION");var optionName=variant.variantDetailId;var variantIdMatch=currentVariant&&currentVariant.variantDetailId==variant.variantDetailId;if(variantIdMatch||!currentVariant&&isChangeProdSection&&_i91===0){selectValue=optionName}option.value=optionName;option.innerHTML=variant.title;if(!usedValues.includes(optionName)){productNameSelect.add(option);usedValues.push(optionName)}}selectValue&&$(productNameSelect).val(selectValue).change()}}catch(error){console.log(error)}}function mapBundleVariant(product,productSection){try{if(product[0].isVariantBundle){var productVariants=productSection.querySelectorAll("div[name='variant-bundle-parent']");var variantBundleSelects=productSection.querySelectorAll("select[name='variantBundleSelect']");var productElement=productSection.getElementsByClassName("fk-product-name");var divSelectedValue={};if(productElement&&productElement.length>0){var stockStatus=verifyStock&&product[0].cycle1_isShippable&&product[0].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";productElement[0].innerHTML=product[0].baseProductName+stockStatus}var productVariantsCheck=productVariants&&productVariants.length>0;if(!productVariantsCheck&&variantBundleSelects.length===0){var variantBundleParentDiv=$(productSection).find(".fk-variant-bundle-parent-div");var variantBundleParentDivLength=variantBundleParentDiv.length;for(var _i92=0;_i92<variantBundleParentDivLength;_i92++){var _item14=variantBundleParentDiv[_i92];var value=$(_item14).attr("variantvalue");divSelectedValue[value]=$(_item14).find("[name=quantity]").val()}productVariants=variantBundleParentDiv;variantBundleParentDivLength>1&&$(productSection).find(".fk-variant-bundle-parent-div").slice(1).remove();productVariantsCheck=true}if(productVariantsCheck){product[0].variants.sort(function(a,b){return b["variantOptionSequence1"]-a["variantOptionSequence1"]});var usedValues=[];var cloneProductVariants=productVariants[0].cloneNode(true);var productVariantsParent=productVariants[0].parentNode;var variantsLength=product[0].variants.length;for(var _i93=0;_i93<variantsLength;_i93++){var variant=product[0].variants[_i93];if(!usedValues.includes(variant["title"])){var child=cloneProductVariants.cloneNode(true);child.classList.add("fk-variant-bundle-parent-div");child.setAttribute("name","variants");child.setAttribute("variantvalue",variant["variantDetailId"]);var _stockStatus=verifyStock&&variant["stockQuantity"].toString()==="0"?"  - OUT-OF-STOCK":"";child.childNodes[0].innerHTML=variant["title"]+_stockStatus;var _value3=divSelectedValue[variant["variantDetailId"]];$(child).find("[name=quantity]").val(_value3||"");productVariants[0].insertAdjacentElement("afterend",child);usedValues.push(variant["title"])}}productVariants[0].remove()}if(variantBundleSelects&&variantBundleSelects.length>0){var bundleProductQuantity=product[0].bundleProductQty;var selectedValues={};var identifier="fk-variant-bundle-select-identifier";for(var _i94=0;_i94<bundleProductQuantity;_i94++){var key=identifier+(_i94+1);selectedValues[key]=$(productSection).find("."+key).val()}var variantBundleSelectId=$(variantBundleSelects[0]).attr("id")?$(variantBundleSelects[0]).attr("id"):"";variantBundleSelects.length>1&&$(productSection).find("select[name='variantBundleSelect']").slice(1).remove();product[0].variants.sort(function(a,b){return a["variantDetailId"]-b["variantDetailId"]});var bundleVariantOptions=product[0].variants.map(function(variant){var stockStatus=verifyStock&&variant.stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";return"<option value='"+variant.variantDetailId+"'>"+variant.title+stockStatus+"</option>"}).join("");var dynamicBundleVariantSelects=Array.from(Array(bundleProductQuantity),function(item,index){return"<select class='form-control-custom fk-form-select mb-3 "+identifier+(index+1)+"' id='"+variantBundleSelectId+"' name='variantBundleSelect'>"+bundleVariantOptions+"</select>"}).join("");$(variantBundleSelects[0]).after(dynamicBundleVariantSelects);variantBundleSelects[0].remove();for(var _i95=0;_i95<bundleProductQuantity;_i95++){var _key3=identifier+(_i95+1);var _value4=selectedValues[_key3];_value4&&$(productSection).find("."+_key3).val(_value4).change()}}}}catch(error){console.log(error)}}function changeTilePrices(productVariantElement){var tileVariants=$(productVariantElement).find(".fk-product-tile-parent");var tileLength=tileVariants.length;var productId=productVariantElement.getAttribute("value");var product=pageData.selectedCampaign.products.find(function(product){return product.campaignProductId===parseInt(productId)});var _loop18=function _loop18(_i96){var variant=product.variants.find(function(variant){return variant.variantDetailId===parseInt(tileVariants[_i96].variantvalue)});populateDataClass(tileVariants[_i96],product,variant,productId,1)};for(var _i96=0;_i96<tileLength;_i96++){_loop18(_i96)}}function populateDataClass(parentArea,product,variant,productId,qty,j){try{var currenySymbol=pageData.selectedCampaign.currencySymbol;var unitPrice=variant&&parseFloat(variant.price)>0&&!product.isVariantBundle&&!product.isEditable?parseFloat(variant.price):parseFloat(product.cycle1_price);var vatPrice=unitPrice&&getItemPrice(productId,unitPrice,qty);var qtyPerOrder=variant&&parseInt(variant.productQty)||1;var compareAtPrice=product.compareAtPrice&&parseFloat(product.compareAtPrice)>0?getItemPrice(productId,parseFloat(product.compareAtPrice),qty):vatPrice;compareAtPrice=variant&&variant.compareAtPrice&&parseFloat(variant.compareAtPrice)>0&&!product.isVariantBundle?getItemPrice(productId,parseFloat(variant.compareAtPrice),qty):compareAtPrice;var exchangeRate=Number(sessionStorage.getItem("exchangeRate"))||1,prodTax=getTaxRate().vatTaxRate;var prodPrice=unitPrice*qty,prodCompareAtPrice=compareAtPrice/(exchangeRate*prodTax);var imagePath=variant&&variant.imageUrl!==""?variant.imageUrl:product.imageUrl;if(imagePath!==""){$(parentArea).find("img").first().attr({"src":imagePath,"data-src":imagePath})}$(parentArea).find(".tile-title").first().html(variant&&variant["variantOptionName"+j]);$(parentArea).find(".product-price").first().html("<span data-cc-price-type='true' data-cc-price='"+prodPrice+"'>"+ccFormatCurrency(vatPrice.toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".unit-price").first().html("<span data-cc-price-type='true' data-cc-price='"+unitPrice/qtyPerOrder+"'>"+ccFormatCurrency((vatPrice/qtyPerOrder).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".compare-at-price").first().html("<span data-cc-price-type='true' data-cc-price='"+prodCompareAtPrice+"'>"+ccFormatCurrency(compareAtPrice.toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".compare-at-unit-price").first().html("<span data-cc-price-type='true' data-cc-price='"+prodCompareAtPrice/qtyPerOrder+"'>"+ccFormatCurrency((compareAtPrice/qtyPerOrder).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".product-savings").first().html("<span data-cc-price-type='true' data-cc-price='"+(prodCompareAtPrice-prodPrice)+"'>"+ccFormatCurrency((compareAtPrice-vatPrice).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".savings-unit-price").first().html("<span data-cc-price-type='true' data-cc-price='"+(prodCompareAtPrice/qtyPerOrder-prodPrice).toFixed(2)+"'>"+ccFormatCurrency((compareAtPrice/qtyPerOrder-vatPrice).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".savings-percent").first().html(parseFloat((compareAtPrice-vatPrice)/compareAtPrice*100).toFixed(0)+"%");$(parentArea).find(".product-description").first().html(variant&&variant.title)}catch(e){e}}function getNumOfVariantTypes(product){var variantTypeCount=0;for(var _i97=1;_i97<=3;_i97++){var variantNameAttr="variantName"+_i97;var variantName=product.variants[0][variantNameAttr];if(variantName&&variantName!==""){variantTypeCount++}}return variantTypeCount}function constructProductVariantElement(selectedElement,parentSection,orderItems){try{(function(){var productTile=selectedElement?$(selectedElement).closest(".fk-product-tile-parent")[0]:$(parentSection).find(".fk-product-tile-parent")[0];var childElements=_toConsumableArray($(parentSection).find(".fk-product-variant-area")[0].childNodes);var productContainer=$(parentSection).find(".fk-product-display-container")[0];var variantsLength;var variantContainer=$(parentSection).find(".fk-variant-display-container")[0];var firstOptions=[],variantLabels;for(var _i98=1;_i98<=3;_i98++){var firstLabel=$(variantContainer).find(".variant-label"+_i98)[1];var opt=firstLabel&&firstLabel.innerText&&firstLabel.innerText.replace(/ /g,"");opt&&firstOptions.push(opt)}var product=null;if(productTile&&variantSelectFlag===0){(function(){var classList=_toConsumableArray(productTile.classList);var variantCategoryNum;var classListLength=classList.length;for(var _i99=0;_i99<classListLength;_i99++){if(["variant-tile1","variant-tile2","variant-tile3"].includes(classList[_i99])){var className=classList[_i99];variantCategoryNum=parseInt(className[className.length-1]);break}}variantLabels=$(parentSection).find(".fk-variant-label");var productId=parentSection.getAttribute("value");product=pageData.selectedCampaign.products.find(function(product){return product.campaignProductId===parseInt(productId)});if(variantLabels.length){var variantTypeCount=0;variantsLength=product&&product.variants&&product.variants.length;if(variantsLength){variantTypeCount=getNumOfVariantTypes(product);var _loop19=function _loop19(j){product.variants.sort(function(a,b){return a["variantOptionSequence"+j]-b["variantOptionSequence"+j]});var variantForTile=j===variantCategoryNum||j===variantTypeCount?true:false;if(variantForTile&&variantSelectFlag===0){(function(){var tempTile=productTile;var _loop20=function _loop20(_i100){createTile();function createTile(){var unitPrice=product.variants[_i100]&&parseFloat(product.variants[_i100].price)>0&&!product.isVariantBundle&&!product.isEditable?parseFloat(product.variants[_i100].price):parseFloat(product.cycle1_price);var newProdTile=productTile.cloneNode(true);populateDataClass(newProdTile,product,product.variants[_i100],productId,1,j);newProdTile.value=productId;newProdTile.variantvalue=product.variants[_i100].variantDetailId;$(newProdTile).attr({"price":unitPrice,"variantName":product.variants[_i100].title});var tileRadio=$(newProdTile).find(".fk-product-radio")[0];$(tileRadio).attr({"value":productId,"variantvalue":product.variants[_i100].variantDetailId,"quantity":1,"id":product.variants[_i100].variantDetailId});tileRadio.addEventListener("click",function(e){e.stopPropagation();displayPrices()});var section=$(newProdTile).closest("section")[0];var variantName=newProdTile.getAttribute("variantName").replace(/ /g,"");tempTile.after(newProdTile);$(section).attr("style","display: none !important");matched=variantName&&checkVariantMatch(product,variantName,firstOptions);if(matched===firstOptions.length){if(_i100===0&&parentSection.offsetHeight>0){checkedElement=tileRadio;tileRadio.checked=true;$(newProdTile).find("button").first().html("SELECTED")}$(section).attr("style","display: block")}tempTile=newProdTile}};for(var _i100=0;_i100<variantsLength;_i100++){_loop20(_i100)}productTile.remove()})()}};for(var j=1;j<=variantTypeCount;j++){_loop19(j)}}}})()}if(variantSelectFlag===0){$(".fk-product-variant-select").trigger("click")}variantSelectFlag=variantsLength?1:variantSelectFlag})()}catch(error){console.log(error)}}function checkVariantMatch(product,variantName,partialVariants){var matched=0;var variant=product.variants.find(function(variant){return variant.title.replace(/ /g,"")===variantName});var partialVariantLength=partialVariants.length;if(variant){for(var _i101=1;_i101<=3;_i101++){for(var j=0;j<partialVariantLength;j++){var variantOptionName=variant["variantOptionName"+_i101];if(variantOptionName&&variantOptionName.replace(/ /g,"")==partialVariants[j]){matched++}}}}return matched};function filterTiles(productVariantElement,product){try{var variantLabels=$(productVariantElement).find(".variant-label1, .variant-label2, .variant-label3").filter("[data-selected='true']");var tileVariants=$(productVariantElement).find(".fk-product-tile-parent");var tileLength=tileVariants.length,partialVariants=[],variantLabelLength=variantLabels.length;if(variantLabelLength){for(var _i102=0;_i102<variantLabelLength;_i102++){partialVariants.push(variantLabels[_i102].innerText.replace(/ /g,""))}}var count=0;for(var _i103=0;_i103<tileLength;_i103++){var _matched=0;var section=$(tileVariants[_i103]).closest("section").first().attr("style","display: none !important");var variantName=tileVariants[_i103].getAttribute("variantName")&&tileVariants[_i103].getAttribute("variantName").replace(/ /g,"");_matched=variantName&&checkVariantMatch(product,variantName,partialVariants);if(_matched===partialVariants.length){section&&section.attr("style","display: block");var defaultSelectRadio=count===0?$(tileVariants[_i103]).find(".fk-product-radio")[0]:"";if(defaultSelectRadio&&productVariantElement.offsetHeight>0){checkedElement=defaultSelectRadio;defaultSelectRadio.checked=true;count++;$(defaultSelectRadio).trigger("click")}}}}catch(err){err}}function showInitialElement(productSection){var variantEle=productSection.querySelector("select[name='variant1']")||productSection.querySelector("select[name='productVariant']");var elementContainer=variantEle&&variantEle.closest(".fk-element-container");elementContainer&&$(elementContainer).show()}function hideRemoveVariantSelects(productSection,noVariants){if(noVariants){var variantEle=productSection.querySelector("select[name='variant1']")||productSection.querySelector("select[name='productVariant']");var elementContainer=variantEle&&variantEle.closest(".fk-element-container");elementContainer&&$(elementContainer).hide()}["2","3"].map(function(value){var variantEle=productSection.querySelectorAll("select[name='variant"+value+"']");removeItems(variantEle,"",true)});var productVariantNameSelect=$(productSection).find("[name=productVariant]")[0]}function hideRemoveComboEle(productSection,noVariants){var comboEle=$(productSection).find("[name=comboEle]");removeItems(comboEle,1,true);noVariants&&$(comboEle[0]).hide()}function loadVariants(prodSelect,previousValue){var productSections=document.getElementsByClassName("fk-product-section");var currentItem=sessionStorage.getItem("currentItem");var newItem=sessionStorage.getItem("newProductItem");var currentProductQty=sessionStorage.getItem("currentProductQty");var productSectionsLength=productSections.length;var currentItemData=newItem?newItem.split("."):currentItem&&currentItem.split(".");var currentItemId=currentItemData&&currentItemData[0];var currentItemProduct=currentItemId&&pageData.selectedCampaign&&pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==currentItemId});if(productSectionsLength>0){var _loop21=function _loop21(_i104){var productSection=productSections[_i104];var sectionClassList=productSection.classList;var sectionValue=productSection.getAttribute("value");var isSectionDynamic=sectionClassList.contains("cc-dynamic-product-section");var pageTypeId=pageData.pageTypeId;var comboElement=sectionClassList.contains("fk-combo-product");var dynamicChangeProduct=sectionClassList.contains("cc-dynamic-change-product");var comboChangeProdSection=sectionClassList.contains("cc-change-product-section");var onlyComboOnChangeProd=comboElement&&pageTypeId===13&&productSections.length===1;var isComboChangeProdSection=comboChangeProdSection||onlyComboOnChangeProd&&sectionValue!=="choose";var isDyChangeProdSection=dynamicChangeProduct||onlyComboOnChangeProd&&sectionValue==="choose";var productValue=newItem&&!ccDynamicProductSection&&!isComboChangeProdSection?newItem:currentItem&&!ccDynamicProductSection&&!isComboChangeProdSection?currentItem:sectionValue;var productData=productValue.split(".");var sectionProductSelect=$(productSection).find("[name='productSelect']");if(productValue&&sectionProductSelect&&sectionProductSelect[0]){sectionProductSelect[0].value=productValue.split(".")[0]}!dynamicChangeProduct&&isDyChangeProdSection&&sectionClassList.add("cc-dynamic-change-product");!comboChangeProdSection&&isComboChangeProdSection&&sectionClassList.add("cc-change-product-section");var isVariantTileClassAdded=Array.from(sectionClassList).includes("fk-variant-tile");var productVariantNameSelect=$(productSection).find("[name=productVariant]")[0];var product=pageData.selectedCampaign&&pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productData[0]});var isComboExists=product.length&&product[0].combinations.length;var isComboProdSection=comboElement&&(!pageTypeId===13||sectionValue!=="choose"&&isComboExists);if(isDyChangeProdSection&&currentItem||isComboChangeProdSection){productSection.setAttribute("value",productData[0]);if(product[0].combinations.length>0){hideRemoveVariantSelects(productSection);showInitialElement(productSection);displayCombos(product,productSection,true,previousValue)}else if(product[0].variants&&!product[0].variants.length){hideRemoveVariantSelects(productSection,true);hideRemoveComboEle(productSection,true)}else if(productVariantNameSelect){hideRemoveComboEle(productSection);showInitialElement(productSection);mapProductVariantNameSelect(product,productSection,true)}else{hideRemoveComboEle(productSection);showInitialElement(productSection);mapSelectVariant(product[0],productSection,productData,_i104,true)}}else if(isSectionDynamic&&currentItem){[2,3,4].includes(pageTypeId)&&ccDynamicProductSection.setAttribute("value",currentItemId);mapSelectVariant(currentItemProduct[0],ccDynamicProductSection,currentItemData,_i104)}else if(currentItem&&!ccDynamicProductSection){if(productSectionsLength==1&&[13,34].includes(pageTypeId)){productSection.setAttribute("value",productData[0]);isComboProdSection&&displayCombos(product,productSection)}mapSelectVariant(product[0],productSection,productData,_i104)}else if(productValue&&!isSectionDynamic){if(product&&product.length>0){if(isComboProdSection){displayCombos(product,productSection)}else if(product[0].variants&&product[0].variants.length>0){isVariantTileClassAdded?mapSelectVariant(product[0],productSection,productData,_i104):iterateAndMapVariants(product,productSection,prodSelect);mapBundleVariant(product,productSection);mapProductVariantNameSelect(product,productSection)}removeProductsFromCart(product,productSection)}}};for(var _i104=0;_i104<productSectionsLength;_i104++){_loop21(_i104)}}}function createOptions(optionName,newSelect,usedValues){var option=document.createElement("OPTION");option.value=optionName&&optionName.replace("  - OUT-OF-STOCK","");option.innerHTML=optionName;if(!usedValues.includes(optionName)){newSelect.add(option);usedValues.push(optionName)}}function displayCombos(product,productSection,isChangeProdSection,previousValue){try{var combinations=product[0].combinations;var _productId8=product[0].campaignProductId;var comboEle=productSection.querySelector("div[name='comboEle']");var productSelect=productSection.querySelector("[name='productSelect']");var comboEleCollection=$(productSection).find("div[name='comboEle']");var combinationsLength=combinations.length;var combinationSelectValues={};for(var _i105=0;_i105<combinationsLength;_i105++){combinationSelectValues["productCombo"+_i105]=$(productSection).find("[name=productCombo"+_i105+"]").val()}comboEleCollection.length>1&&comboEleCollection.slice(1).remove();if(comboEle&&combinations&&combinations.length>0){var tempComboEle=comboEle;var customizations;if(isChangeProdSection){var actionPurchaseId=sessionStorage.getItem("actionPurchaseId");var customPurchases=JSON.parse(sessionStorage.getItem("customPurchases"));var purchaseOrder=customPurchases[actionPurchaseId];customizations=purchaseOrder&&purchaseOrder.customization}for(var value=0;value<combinations.length;value++){var newComboSection=tempComboEle.cloneNode(true);var newSelect=newComboSection.querySelector("select");newSelect.name="productCombo"+value;var stockStatus=verifyStock&&product[0].cycle1_isShippable&&combinations[value].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";newComboSection.firstElementChild.innerHTML=combinations[value].comboProductName;tempComboEle.after(newComboSection);newComboSection.style.display="block";combinations[value].variants.sort(function(a,b){return a["title"]-b["title"]});var usedValues=[];newSelect.innerHTML="";var variantsLength=combinations[value].variants.length;if(variantsLength>0){for(var _i106=0;_i106<variantsLength;_i106++){var _stockStatus2=verifyStock&&product[0].cycle1_isShippable&&combinations[value].variants[_i106].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";var optionName=combinations[value].variants[_i106]["title"];if(optionName){optionName=combinations[value].variants[_i106]["title"]+_stockStatus2}if(customizations){var customVariantsLength=customizations.length;for(var j=0;j<customVariantsLength;j++){if(customizations[j].variantDetailId==combinations[value].variants[_i106].variantDetailId){combinationSelectValues["productCombo"+value]=optionName}}}createOptions(optionName,newSelect,usedValues)}}else{var _optionName=combinations[value].comboProductName+stockStatus;createOptions(_optionName,newSelect,usedValues)}tempComboEle=newComboSection}}comboEle.style.display="none";for(var _i107=0;_i107<combinationsLength;_i107++){var _value5=combinationSelectValues["productCombo"+_i107];if(_value5&&(previousValue&&previousValue==_productId8||!previousValue))$(productSection).find("[name=productCombo"+_i107+"]").val(_value5).change()}}catch(error){error}}function populateVariantSelects(product,productSection,productVariants,prodSelect,value,productData,fromMapSelect,isChangeProdSection){var variantDetailId,currentVariant,usedValues=[];var variantLabel=$(productVariants).siblings("label");if(product.variants&&product.variants.length>0){var selectValue=prodSelect?"":$(productVariants[0]).val();product.variants.sort(function(a,b){return a["variantOptionSequence"+value]-b["variantOptionSequence"+value]});productVariants[0].innerHTML="";if(isChangeProdSection){var actionCurrentItem=sessionStorage.getItem("actionCurrentItem");variantDetailId=actionCurrentItem?actionCurrentItem.split(".")[1]:"";currentVariant=variantDetailId&&product.variants.find(function(data){return data.variantDetailId==variantDetailId})}var variantsLength=product.variants.length;for(var _i108=0;_i108<variantsLength;_i108++){var variant=product.variants[_i108];var stockStatus=verifyStock&&product.variants[_i108].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";var optionName=product.variants[_i108]["variantOptionName"+value];var variantIdMatch=currentVariant&&currentVariant.variantDetailId==variant.variantDetailId;if(optionName){optionName=optionName+stockStatus}createOptions(optionName,productVariants[0],usedValues,fromMapSelect,variant);if(variant["variantName"+value]===null){$(productVariants).hide();$(variantLabel).hide()}if(fromMapSelect){if(variantIdMatch||!currentVariant&&isChangeProdSection&&_i108===0){selectValue=optionName}if(variantLabel&&variantLabel.length>0){variantLabel[0].innerHTML=variant["variantName"+value]}var variantTypeName=variant["variantName"+value];var VariantType=document.createAttribute("variantType");VariantType.value=variantTypeName;productVariants[0].setAttributeNode(VariantType);if(productData.length>1){//set current variant
var _variant=product.variants.find(function(data){return data.variantDetailId==productData[1]});productVariants[0].value=_variant&&_variant["variantOptionName"+value]}}}selectValue&&$(productVariants[0]).val(selectValue).change()}else{$(productVariants).hide();$(variantLabel).hide()}}function iterateAndMapVariants(product,productSection,prodSelect){try{["1","2","3"].map(function(value){var productVariants=productSection.querySelectorAll("select[name='variant"+value+"']");if(productVariants&&productVariants.length>0){populateVariantSelects(product[0],productSection,productVariants,prodSelect,value)}})}catch(error){console.log(error)}}function getShopPayCheckoutUrl(orderItems){var validShopPayUrl=false;var shopPayUrl=pageData.selectedCampaign.shopPayUrl;var orderItemsCopy=JSON.parse(JSON.stringify(getOrderItems()));if(!shopPayUrl||Object.keys(orderItems).length===0){var errMsg=!shopPayUrl?"ShopPay payment is not enabled. Please try other payment method.":"No products exist in the order.";alert("Error: "+errMsg);return false}shopPayUrl+="/cart/";Object.keys(orderItemsCopy).forEach(function(key){var keys=key.split(".");var qty=parseInt(orderItemsCopy[key]);qty=qty>0?qty:1;var externalVariantId=getExternalVariantId(keys[0],keys[1]?keys[1]:"");if(externalVariantId){validShopPayUrl=true;shopPayUrl+=externalVariantId+":"+qty+","}});if(!validShopPayUrl){alert("Error: Unable to generate ShopPay checkout. Please try other payment method.");return false}shopPayUrl=shopPayUrl.substring(0,shopPayUrl.length-1);shopPayUrl+="?payment=shop_pay";return shopPayUrl}function getExternalVariantId(productId,variantId){var products=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productId});var product=products&&products[0]?products[0]:"";if(!product)return false;if(!variantId&&product.externalVariantDetailId)return product.externalVariantDetailId;if(variantId&&product.variants&&product.variants.length>0){var variant=product.variants.filter(function(data){return data.variantDetailId==variantId});if(variant&&variant[0]&&variant[0].externalVariantDetailId)return variant[0].externalVariantDetailId}return false}function getVariantsAndDisplay(event){var productSection=event.currentTarget.closest("section.fk-product-section");getVariants(productSection.id);displayPrices()}function getVariants(productSectionId){try{var productSections=document.getElementsByClassName("fk-product-section");var productSectionsLength=productSections.length;var comboCount=0,comboUpdate=false;if(productSectionsLength>0){var _loop22=function _loop22(_i109){var productSection=productSections[_i109];if(productSectionId&&productSection.getAttribute("id")!=productSectionId)return"continue";if($(productSection).closest(".bump-div-class").find("[name=orderBump]").prop("checked")===false){return"continue"}if($(productSection).find("input[name='product']").prop("checked")===false){return"continue"}var sectionValue=productSection.getAttribute("value");if(sectionValue&&$(productSection).find("[name='variants']").length==0){var _product8=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==sectionValue});var isComboExists=_product8.length&&_product8[0].combinations.length;var productVariants=$(productSection).find("[name='variant1'], [name='variant2'], [name='variant3']").filter("select");var productVariantsTiles=$(productSection).find(".variant-label1, .variant-label2, .variant-label3").filter("[data-selected='true']");productVariants=[].concat(_toConsumableArray(productVariantsTiles),_toConsumableArray(productVariants));productVariants.sort(function(a,b){return a.getAttribute("name")>b.getAttribute("name")?1:-1});var isProductNameSelectorExists=productSection.querySelectorAll("select[name='productVariant']")[0];var quantity=productSection.querySelectorAll("input[name='quantity'], select[name='quantity']");var sectionInputs=productSection.querySelectorAll("input[name='product']");var variantInputValue=sectionInputs.length?sectionInputs[0].getAttribute("variantvalue"):null;var comboElement=productSection.classList.contains("fk-combo-product");var isComboProdSection=comboElement&&(!pageData.pageTypeId===13||sectionValue!=="choose"&&isComboExists);var isProdSelectExists=$(productSection).find("[name='productSelect']")[0];var orderBump=$(productSection).closest(".bump-div-class")[0];var useCartQty=false;var filteredProductVariants;var qty=0;if(quantity&&quantity[0]){qty=quantity[0].value}else if(isProdSelectExists&&orderBump||isComboProdSection||isProductNameSelectorExists||productVariants&&productVariants.length>0){qty=1;useCartQty=true}if(qty>0&&_product8&&_product8[0]){_product8[0].variants.sort(function(a,b){return a["variantDetailId"]-b["variantDetailId"]});if(isComboProdSection){var selectedCombiItems={};var comboOpt=productSection.querySelectorAll("div[name='comboEle']");var comboOptLength=comboOpt.length;var comboString="";var comboProd=_product8[0].campaignProductId.toString()+"|"+qty.toString()+"|";for(var _i110=0;_i110<comboOptLength;_i110++){var comboProdName=productSection.querySelectorAll("div[name='comboEle']")[_i110].firstChild.innerHTML;var _item15=comboOpt[_i110].querySelector("select").value;selectedCombiItems[_i110]=_defineProperty({},comboProdName,_item15)}var selectedComboLength=Object.keys(selectedCombiItems).length;for(var _i111=0;_i111<selectedComboLength;_i111++){comboString+=JSON.stringify(selectedCombiItems[_i111])}comboString=comboString.replaceAll(",","|").replaceAll("{","").replaceAll("}","|").replaceAll("\"","");comboProd=comboProd.concat(comboString);if(pageData.pageTypeId===13){comboUpdate=true;sessionStorage.setItem("selectedCombo",comboProd)}if(pageData.pageTypeId===3){var orderItems=getUpsaleItems();orderItems["product_custom"+(comboCount+1)]=comboProd;comboCount++;sessionStorage.setItem("upsalefkCart",JSON.stringify(orderItems))}}//filter products[0].variants by variant1.value, variant2.value, and variant3.value to get the correct variantDetailId
//variant1 should always have a value.  variant2 and 3 may not
//set variantDetailId to the filter result (if more than 1 in result, take the first)
//this logic also supports products without variants, in a product section
else if(_product8[0].variants&&_product8[0].variants.length>0&&!isProductNameSelectorExists){var selectedVariantsMap={};productVariants&&productVariants.map(function(item,index){var elementTagName=$(item).prop("tagName");var elementNameAttr=$(item).prop("name");var itemValue=item.value?item.value.replace("  - OUT-OF-STOCK",""):item.value;var elementValue=elementTagName.toLowerCase()==="select"?itemValue:item.innerText;if(elementValue&&elementValue!=="null"&&elementValue!=="undefined"){selectedVariantsMap["variant"+(index+1)]=elementValue}});var selectedVariantsLength=Object.keys(selectedVariantsMap).length;filteredProductVariants=selectedVariantsLength>0&&_product8[0].variants.find(function(variantItem){var matchedVariants=0;for(var _i112=1;_i112<=selectedVariantsLength;_i112++){if(variantItem["variantOptionName"+_i112]===selectedVariantsMap["variant"+_i112]){matchedVariants=matchedVariants+1}else{break}}return matchedVariants===selectedVariantsLength})}if(isProductNameSelectorExists||variantInputValue){var productNameVariantVal=isProductNameSelectorExists?isProductNameSelectorExists.value:variantInputValue;filteredProductVariants=_product8[0].variants.find(function(item){return item.variantDetailId===parseInt(productNameVariantVal)})}var variantDetailId=filteredProductVariants?filteredProductVariants.variantDetailId:null;if(variantDetailId!=null||productVariants.length==0||comboUpdate){var itemKey=productSection.getAttribute("value");if(variantDetailId!=null)itemKey+="."+variantDetailId;if(pageData.pageTypeId===3){var _orderItems5=getUpsaleItems();_orderItems5[itemKey]=qty;sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems5))}else if(pageData.pageTypeId===34){var _orderItems6=getOrderItems();var currentItem=sessionStorage.getItem("currentItem");currentItem&&delete _orderItems6[currentItem];_orderItems6[itemKey]=qty;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems6));sessionStorage.setItem("currentItem",itemKey)}else if(pageData.pageTypeId===13){sessionStorage.setItem("newProductItem",itemKey);sessionStorage.setItem("currentItem",itemKey);sessionStorage.setItem("currentProductQty",qty);sessionStorage.setItem("newProductQty",qty)}else{var _orderItems7=getOrderItems();if(!_orderItems7[itemKey]||!useCartQty)_orderItems7[itemKey]=qty;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems7));var customInputs=$(productSection).find("input[name^='custom_item_']");if(pageData.pageTypeId===4&&customInputs.length){customItemCheck(customInputs,itemKey,productSection)}}}}else if(quantity&&quantity[0]&&productVariants.length==0){var _itemKey=productSection.getAttribute("value");if(pageData.pageTypeId===3){var _orderItems8=getUpsaleItems();delete _orderItems8[_itemKey];sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems8))}else{var _orderItems9=getOrderItems();delete _orderItems9[_itemKey];sessionStorage.setItem("fkCart",JSON.stringify(_orderItems9))}}}};for(var _i109=0;_i109<productSectionsLength;_i109++){var _ret6=_loop22(_i109);if(_ret6==="continue")continue}}}catch(error){error}}function getBundleVariants(params,index){var outOfStockBundleVariants=[];var outOfStockBundleProductIds=[];var productSections=document.getElementsByClassName("fk-product-section");var productSectionsLength=productSections.length;if(productSectionsLength>0){var _loop23=function _loop23(_i113){var productSection=productSections[_i113];var item=void 0;if(productSection.getAttribute("value")&&$(productSection).find("[name='variants']").length){var variantQty=0;var _product9=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productSection.getAttribute("value")});var productVariants=productSection.querySelectorAll("[name='variants']");var productVariantsLength=productVariants.length;for(var j=0;j<productVariantsLength;j++){var productVariant=productVariants[j];if(productVariant.children[1].value){variantQty+=parseInt(productVariant.children[1].value);if(variantQty>_product9[0].bundleProductQty){//alert('Quantity for ' + product[0].baseProductName + ' should be less than or equal to ' + product[0].bundleProductQty)
//return;
}index++;params["product"+index+"_id"]=productSection.getAttribute("value");params["variant"+index+"_id"]=productVariant.getAttribute("variantvalue");params["product"+index+"_qty"]=productVariant.children[1].value;var _productData13=[];_productData13[0]=productSection.getAttribute("value");_productData13[1]=productVariant.getAttribute("variantvalue");var _productId9=_productData13.join(".");item=verifyStock&&getOutStockedVariant(_productData13,"","","",productVariant.children[1].value);if(item&&item.length>0){outOfStockBundleVariants.push(item);outOfStockBundleProductIds.push(_productId9)}}}}if(productSection.getAttribute("value")&&$(productSection).find("[name='variantBundleSelect']").length){var _product10=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productSection.getAttribute("value")});var variantBundleSelects=productSection.querySelectorAll("[name='variantBundleSelect']");var variantBundleSelectsLength=variantBundleSelects.length;for(var _j2=0;_j2<variantBundleSelectsLength;_j2++){var variantBundleSelect=variantBundleSelects[_j2];index++;params["product"+index+"_id"]=productSection.getAttribute("value");params["variant"+index+"_id"]=variantBundleSelect.value;var _productData14=[];_productData14[0]=productSection.getAttribute("value");_productData14[1]=variantBundleSelect.value;var _productId10=_productData14.join(".");item=verifyStock&&getOutStockedVariant(_productData14,"","","",1);if(item&&item.length>0){outOfStockBundleVariants.push(item);outOfStockBundleProductIds.push(_productId10)}}}};for(var _i113=0;_i113<productSectionsLength;_i113++){_loop23(_i113)}}var bundleStockParams={params:params,outOfStockBundleVariants:outOfStockBundleVariants,outOfStockBundleProductIds:outOfStockBundleProductIds};return bundleStockParams}function ccAddAndOpenCart(event){event.preventDefault();event.stopImmediatePropagation();try{toggleProductSelection(event)}catch(err){}openNav()}function toggleProductSelection(e){var isReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var target=e.target,currentTarget=e.currentTarget;if(isReset){currentTarget=e;target=e}var clickableElementId=currentTarget.dataset.id;var product=null;var prodSection=null;if(clickableElementId&&clickableElementId!==""){var clickableElement=$("button[data-id='"+clickableElementId+"'],a[data-id='"+clickableElementId+"']")[0];prodSection=clickableElement.closest("section.fk-product-section");if(pageData.pageTypeId===34){getVariants();product=sessionStorage.getItem("currentItem")}else if([2,17,18].includes(pageData.pageTypeId)){product=clickableElement.getAttribute("offer");if(pageData.pageTypeId===2){product=product&&product.indexOf(".")===-1?product:product.split(".")[0];var productObj=product&&pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId===parseInt(product)});removeProductsFromCart(productObj,prodSection)}//get the variant within this particular product section
if(prodSection&&($(prodSection).find("[name='variant1']").filter("select").length!==0||$(prodSection).find(".variant-label1").filter("[data-selected='true']").length>0)){getVariants(prodSection.getAttribute("id"))}else{prodSection=null}}else if(pageData.pageTypeId===3)product=clickableElement.getAttribute("upsell");else product=clickableElement.getAttribute("offer");if(!product||isNaN(parseFloat(product))){if(clickableElement){product=findParentNode(clickableElement,"product");if(product)product=product.getAttribute("value")}}else{var variantValue=clickableElement.getAttribute("variantvalue");if(variantValue)product=product+"."+variantValue}}if(product&&!isNaN(parseFloat(product))){if(target.innerHTML==="Selected"){target.innerHTML="Select";target.className="btn btn-primary";if(pageData.pageTypeId===3){var orderItems=getUpsaleItems();delete orderItems[product];sessionStorage.setItem("upsalefkCart",JSON.stringify(orderItems))}else{var _orderItems10=getOrderItems();delete _orderItems10[product];sessionStorage.setItem("fkCart",JSON.stringify(_orderItems10))}}else if(!isReset){if(target.innerHTML==="Select"){target.innerHTML="Selected";target.className="btn btn-success"}// If this is an upsale page, add product to upsale cart
// Else add to cart
if(pageData.pageTypeId===3){var _orderItems11=getUpsaleItems();var quantity=prodSection&&prodSection.querySelectorAll("input[name='quantity'], select[name='quantity']");if(quantity&&quantity[0]){_orderItems11[product]=quantity[0].value>0?quantity[0].value:""}else{_orderItems11[product]=1}sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems11))}else if([2,17,18].includes(pageData.pageTypeId)&&prodSection){//catalog page cart was set above in getVariants
callAddToCartEvent(product)}else{var _orderItems12=getOrderItems();_orderItems12[product]=pageData.pageTypeId===34?getQuantity():1;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems12));callAddToCartEvent(product)}}displayPrices()}}function getProductDetails(product){var obj={productName:product,productValue:0};var currentOrderItems=getOrderItemDetails(false);if(currentOrderItems[product]){var _item16=currentOrderItems[product];var unitPrice=_item16.variant&&parseFloat(_item16.variant.price)>0&&!_item16.isVariantBundle&&!_item16.isEditable?_item16.variant.price:_item16.cycle1_price;var title=_item16.variant?" "+_item16.variant.title:"";obj.productName=_item16.productName+title;obj.productValue=parseFloat(getItemPrice(product,unitPrice,_item16.currentOrderQuantity).toFixed(2))}return obj}function findParentNode(el,parentName){while(el.parentNode){el=el.parentNode;if(el.getAttribute("name")===parentName){return el}}return null}//Auto-load inputs with order data submitted on previous pages - Ex: firstName input on checkout page automatically filled with firstName submitted on leadPage
function autoLoadInputs(orderDataParam){var urlParams=new URLSearchParams(getCurrentWindowLocation().search);var orderData=orderDataParam?orderDataParam:JSON.parse(sessionStorage.getItem("orderData"));var inputs=$("input, select");var updatePriceTotals=false;if(orderData){orderData.country&&loadStates("state",orderData.country);orderData.shipCountry&&loadStates("shipState",orderData.shipCountry)}var inputsLength=inputs.length;for(var _i114=0;_i114<inputsLength;_i114++){var input=inputs[_i114];var inputValue=orderData&&orderData[input.name]?orderData[input.name]:urlParams.has(input.name)?urlParams.get(input.name):"";if(inputValue){var formInputs=document.getElementsByName(input.name);var formInputsLength=formInputs.length;for(var j=0;j<formInputsLength;j++){var formInput=formInputs[j];if(formInput.type==="checkbox"){if(inputValue==="on"||inputValue===true||inputValue==="true"||inputValue==="1"||inputValue===1)formInput.checked=true;else formInput.checked=false}else if(formInput.type==="radio"){if(formInput.value===inputValue)formInput.checked=true}else formInput.value=inputValue}}else if(input.name==="product"&&(input.type==="checkbox"||input.type==="radio")){var changeProductItem=pageData.pageTypeId===13&&sessionStorage.getItem("currentItem")?sessionStorage.getItem("currentItem"):null;var quantity=input.getAttribute("quantity");if(fkCart[input.value]&&(!quantity||fkCart[input.value]==quantity)||changeProductItem&&(changeProductItem===input.value||input.getAttribute("variantvalue")&&changeProductItem==input.value+"."+input.getAttribute("variantvalue")||!input.getAttribute("variantvalue")&&changeProductItem.includes(input.value+"."))){input.checked=true;updatePriceTotals=true;var prodSection=$(input).closest("section.fk-product-section");if(prodSection&&prodSection.length&&changeProductItem){var button=prodSection[0].querySelectorAll("button");button&&button.length&&button[0].click()}}}else if(input.name==="fullName"){var firstName=orderData&&orderData["firstName"]?orderData["firstName"]:urlParams.has("firstName")?urlParams.get("firstName"):"";if(firstName){var lastName=orderData&&orderData["lastName"]?orderData["lastName"]:urlParams.has("lastName")?urlParams.get("lastName"):"";var _formInputs=document.getElementsByName(input.name);var _formInputsLength=_formInputs.length;for(var _j3=0;_j3<_formInputsLength;_j3++){_formInputs[_j3].value=firstName+" "+lastName}}}else if(input.name==="shipFullName"){var shipFirstName=orderData&&orderData["shipFirstName"]?orderData["shipFirstName"]:urlParams.has("shipFirstName")?urlParams.get("shipFirstName"):"";if(shipFirstName){var shipLastName=orderData&&orderData["shipLastName"]?orderData["shipLastName"]:urlParams.has("shipLastName")?urlParams.get("shipLastName"):"";var _formInputs2=document.getElementsByName(input.name);var _formInputsLength2=_formInputs2.length;for(var _j4=0;_j4<_formInputsLength2;_j4++){_formInputs2[_j4].value=shipFirstName+" "+shipLastName}}}}if(updatePriceTotals)displayPrices()}function ccSetCountryAndStateValues(countryInput,countryValue,stateInput,stateValue){if(countryInput){if(countryInput.value!=countryValue){countryInput.value=countryValue;var event=new Event("change");countryInput.dispatchEvent(event);var stateInputName=stateInput&&stateInput.getAttribute("name");stateInputName&&loadStates(stateInputName,countryValue)}if(stateInput&&stateValue){stateInput.value=stateValue;var event=new Event("change");stateInput.dispatchEvent(event)}}}//load state/country from IP address
function setGeoFromIP(){return _setGeoFromIP.apply(this,arguments)}//return currency from sessionStorage if present
function _setGeoFromIP(){_setGeoFromIP=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(){var address1,shipAddress1,country,state,shipCountry,shipState,ip,currencyElements,currencyCodeValue,pageDataCurrency,pageDataCurrencies,currency,countryCode,regionCode,orderData,customerOrders,customerOrderData,selectedCampaignCountry;return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;shipAddress1=document.getElementsByName("shipAddress1")[0]?document.getElementsByName("shipAddress1")[0].value:null;country=document.getElementsByName("country")[0];state=document.getElementsByName("state")[0];shipCountry=document.getElementsByName("shipCountry")[0];shipState=document.getElementsByName("shipState")[0];ip=null;currencyElements=document.getElementsByName("currency")[0]?document.getElementsByName("currency")[0]:null;currencyCodeValue=returnCurrencyCode();pageDataCurrency=pageData.selectedCampaign.currency;pageDataCurrencies=pageData.selectedCampaign.currencies;currency=pageData.cartData&&pageData.cartData.currency;if(currency){if(!fetchCurrentCurrencyObj(currency)){if(pageDataCurrencies&&pageDataCurrencies.length){pageData.selectedCampaign.currencies.push({currencySymbol:currency,currencyCode:currency})}else{pageData.selectedCampaign.currencies=[{currencySymbol:currency,currencyCode:currency}]}pageDataCurrencies=pageData.selectedCampaign.currencies}currencyCodeValue=currency}if(!(!address1&&!shipAddress1&&(country||shipCountry))){_context19.next=19;break}_context19.next=16;return getIpPhysicalAddress();case 16:ip=_context19.sent;countryCode=ip&&ip.country_code;if(countryCode){if(pageData.selectedCampaign.countries.find(function(data){return data.countryCode==countryCode})){regionCode=ip.region_code;ccSetCountryAndStateValues(country,countryCode,state,regionCode);ccSetCountryAndStateValues(shipCountry,countryCode,shipState,regionCode)}}case 19:orderData=sessionStorage.getItem("orderData");orderData=orderData?JSON.parse(orderData):{};if(!(orderData&&orderData.country)){_context19.next=25;break}defaultCountryCode=orderData.country;_context19.next=35;break;case 25:defaultCountryCode=pageData.selectedCampaign.countries.length&&!pageData.selectedCampaign.states["US"]?pageData.selectedCampaign.countries[0].countryCode:"US";if(ip){_context19.next=32;break}_context19.next=29;return getIpPhysicalAddress();case 29:_context19.t0=_context19.sent;_context19.next=33;break;case 32:_context19.t0=ip;case 33:ip=_context19.t0;if(ip&&ip.country_code&&pageData.selectedCampaign.countries.find(function(obj){return obj.countryCode===ip.country_code})){defaultCountryCode=ip.country_code;vatTaxRate=getTaxRate().vatTaxRate}case 35:if(cookieData["access_token"]){customerOrders=sessionStorage.getItem("customerOrders");customerOrders=customerOrders?JSON.parse(customerOrders):[];customerOrderData=customerOrders[0]||{};ccSetCountryAndStateValues(country,customerOrderData.country,state,customerOrderData.state);ccSetCountryAndStateValues(shipCountry,customerOrderData.shipCountry,shipState,customerOrderData.shipState)}if(!(pageDataCurrencies&&pageDataCurrencies.length)){_context19.next=48;break}loadStaticCurrencyValues();if(currencyCodeValue){_context19.next=46;break}sessionStorage.setItem("currencyCode",pageDataCurrency);if(ip){_context19.next=44;break}_context19.next=43;return getIpPhysicalAddress();case 43:ip=_context19.sent;case 44:if(ip&&ip.country_code){selectedCampaignCountry=pageData.selectedCampaign.countries.find(function(obj){return obj.countryCode===ip.country_code});if(selectedCampaignCountry&&pageDataCurrencies.find(function(obj){return obj.currencyCode===selectedCampaignCountry.currencyCode})){sessionStorage.setItem("currencyCode",selectedCampaignCountry.currencyCode)}}currencyCodeValue=returnCurrencyCode();case 46:if(currencyElements){$(currencyElements).find("option").remove().end().append("<option value="+pageDataCurrency+">"+pageDataCurrency+"</option>").attr("selected","selected");$(pageDataCurrencies).each(function(){var currencyObj=this;currencyObj.currencyCode!==pageDataCurrency&&$(currencyElements).append($("<option></option>").attr("value",currencyObj.currencyCode).text(currencyObj.currencyCode))});$(currencyElements).find("option[value=\""+currencyCodeValue+"\"]").attr("selected","selected");currency&&$(currencyElements).attr("disabled",currency!==pageData.selectedCampaign.currency)}setPriceAndCurrency(currencyCodeValue);case 48:case"end":return _context19.stop();}}},_callee19)}));return _setGeoFromIP.apply(this,arguments)}function returnCurrencyCode(){return sessionStorage.getItem("currencyCode")?sessionStorage.getItem("currencyCode"):null}//Fire pixels returned from Import Click (importClick or useSession function)
function firePixel(pixelHtml){var pixelDiv=document.createElement("DIV");pixelDiv.innerHTML=pixelHtml;document.body.appendChild(pixelDiv)}//CRM-4650
function fireSiftPixel(beaconKey){var _sift=window._sift=window._sift||[];_sift.push(["_setAccount",beaconKey]);_sift.push(["_setUserId",""]);_sift.push(["_setSessionId",sessionStorage.getItem("sessionId")]);_sift.push(["_trackPageview"]);(function(){var ta=document.createElement("script");ta.type="text/javascript";ta.async=true;ta.src="https://cdn.sift.com/s.js";document.body.appendChild(ta)})()}function getQuantity(){var qty=1;var qtyInput=document.getElementsByName("quantity")[0];if(qtyInput){qty=parseInt(qtyInput.value)||1;qty=qty>0?qty:1}return qty}function setShoppingCartSpinner(){var dynamicCartRow=document.querySelector("tr[id='fk-dynamic-cart-row']");if(dynamicCartRow){$(dynamicCartRow).find("button").attr("disabled",false);$(dynamicCartRow).find("a").css("pointer-events","auto");cellFormat=Array.prototype.slice.call(dynamicCartRow.cells);if(cellFormat.length>0){dynamicCartRow.innerHTML="<td colspan=4>"+getSpinnerDiv().outerHTML+"</td>";dynamicCartRow.style.display="contents"}}}function findAddOn(addOnKey){if(pageData&&pageData.funnelData&&pageData.funnelData.addOns){return pageData.funnelData.addOns.find(function(addOns){return addOns.keyName===addOnKey})}else{return null}}function getAddOnKeyValue(addOn){return addOn?addOn.keyValue:""}function getGooglePaymentDataRequest(){var merchantId=getAddOnKeyValue(findAddOn("GPay_MerchantId"));var merchantName=getAddOnKeyValue(findAddOn("GPay_MerchantName"));googlePaymentDataRequest=Object.assign({},baseRequest);googlePaymentDataRequest.allowedPaymentMethods=[cardPaymentMethod];googlePaymentDataRequest.transactionInfo=getGoogleTransactionInfo();googlePaymentDataRequest.merchantInfo={// merchantId: '12345678901234567890',
// merchantName: 'Example Merchant'
merchantId:merchantId,merchantName:merchantName};googlePaymentDataRequest.callbackIntents=["SHIPPING_ADDRESS"];googlePaymentDataRequest.emailRequired=true;googlePaymentDataRequest.shippingAddressRequired=true;return googlePaymentDataRequest}function generateDisplayItems(shipping,tax,discount,displayItemObj){var cartLabelValues=["Shipping","Sales Tax","Discount"];var cartValues=[shipping,tax,discount];var cartLength=cartValues.length;for(var _i115=0;_i115<cartLength;_i115++){var displayItemObject={};if(cartValues[_i115]){displayItemObject.label=cartLabelValues[_i115];displayItemObject.type="LINE_ITEM";displayItemObject.price=cartLabelValues[_i115]==="Discount"?"-"+cartValues[_i115]:cartValues[_i115].toString();displayItemObj.lineItems.push(displayItemObject)}}}function getGoogleTransactionInfo(pageType,buttonId){var priceTotal="0.00";var displayItemObj={lineItems:[]};var lineItems=displayItemObj.lineItems;if(pageType==="upsell"){var orderItems=getUpsaleItems();if(Object.keys(orderItems).length){(function(){var total=0;var shipTotal=0;var cpId=null;var variantId=null;var productData=null;var itemLabel="";var lineItemShipPrice,lineItemTotalShipPrice=0;for(var upsaleItemCpId in orderItems){var itemPrice=0;var shipPrice=0;cpId=upsaleItemCpId;if(upsaleItemCpId.indexOf(".")>0){productData=upsaleItemCpId.split(".");cpId=productData[0];variantId=productData[1]}var _item17=pageData.selectedCampaign.products.find(function(data){return data.campaignProductId===parseInt(cpId)});if(!_item17)continue;if(variantId&&_item17.variants&&productData&&productData.length>1){var variantDetails=_item17.variants.find(function(data){return data.variantDetailId===parseInt(variantId)});if(variantDetails){itemLabel=_item17.productName+" "+variantDetails.title;itemPrice=parseFloat(variantDetails.price)>0&&!_item17.isVariantBundle&&!_item17.isEditable?variantDetails.price:_item17.cycle1_price;shipPrice=parseFloat(variantDetails.shippingPrice)>0&&!_item17.isVariantBundle?variantDetails.shippingPrice:_item17.cycle1_shipPrice}}else{itemLabel=_item17.productName;itemPrice=_item17.cycle1_price;shipPrice=_item17.cycle1_shipPrice}var lineItemPrice=getItemPrice(upsaleItemCpId,itemPrice,orderItems[upsaleItemCpId]);lineItemShipPrice=getShipPrice(shipPrice,orderItems[upsaleItemCpId]);lineItemTotalShipPrice+=lineItemShipPrice;var itemTotal=(lineItemPrice+lineItemShipPrice).toFixed(2);total+=parseFloat(itemTotal)}shippingCostIncluded=lineItemTotalShipPrice>0?true:false;priceTotal=total.toString()})()}}else{var grandTotalElementExists=$(".grandTotal").length>0;displayPricesApply();var _JSON$parse4=JSON.parse(sessionStorage.getItem("totals")),grandTotal=_JSON$parse4.grandTotal,shipTotal=_JSON$parse4.shipTotal,salesTax=_JSON$parse4.salesTax,discount=_JSON$parse4.discount;shippingCostIncluded=shipTotal>0?true:false;priceTotal=grandTotal;if(grandTotalElementExists){var currentOrderItems=getOrderItemDetails();var currentOrderItemsEntries=Object.entries(currentOrderItems);var currentOrderItemsEntriesLength=currentOrderItemsEntries.length;for(var _i116=0;_i116<currentOrderItemsEntriesLength;_i116++){var campaignProductId=currentOrderItemsEntries[_i116][0];var _item18=currentOrderItemsEntries[_i116][1];var variantTitle=_item18.variant?" "+_item18.variant.title:"";var itemLabel=_item18.productName+variantTitle;var itemPrice=_item18.variant&&_item18.variant.price&&!_item18.isVariantBundle&&!_item18.isEditable?_item18.variant.price:_item18.cycle1_price;displayItemObj.lineItems.push({"label":itemLabel,"type":"LINE_ITEM","price":getItemPrice(campaignProductId,itemPrice,_item18.currentOrderQuantity).toString()})}generateDisplayItems(shipTotal,salesTax,discount,displayItemObj)}else{priceTotal=(grandTotal-salesTax).toFixed(2)}}return{countryCode:getAddOnKeyValue(findAddOn("GPay_CountryCode")),currencyCode:pageData.selectedCampaign.currency,totalPriceStatus:"ESTIMATED",totalPrice:priceTotal,totalPriceLabel:"Total",displayItems:lineItems}}function onGooglePaymentDataChanged(intermediatePaymentData){return new Promise(function(resolve,reject){resolve({})})}function getGooglePaymentsClient(){var params={paymentDataCallbacks:{onPaymentDataChanged:onGooglePaymentDataChanged}};if(true&&getAddOnKeyValue(findAddOn("GPay_TestMode"))!=="1"){params.environment="PRODUCTION"}else{params.environment="TEST"}if(googlePaymentsClient===null){googlePaymentsClient=new google.payments.api.PaymentsClient(params)}return googlePaymentsClient}function configureGooglePay(){var gateway=getAddOnKeyValue(findAddOn("GPay_Gateway")).toLowerCase();var gatewayMerchantId=getAddOnKeyValue(findAddOn("GPay_GatewayMerchId"));var parameters={// 'gateway': 'example',
// 'gatewayMerchantId': 'exampleGatewayMerchantId'
"gateway":gateway};if(gPayGatewayWithOtherFields.includes(gateway)){gPayGatewayFieldsForOthers[gateway].forEach(function(field){var addOnValueForField=getAddOnKeyValue(findAddOn(field.args.addOnName));parameters[field.args.paramName]=addOnValueForField});if(gateway==="stripe"){parameters["stripe:version"]="2020-08-27"}}else{parameters.gatewayMerchantId=gatewayMerchantId}var tokenizationSpecification={type:"PAYMENT_GATEWAY",parameters:parameters};cardPaymentMethod=Object.assign({},baseCardPaymentMethod,{tokenizationSpecification:tokenizationSpecification});function getGoogleIsReadyToPayRequest(){return Object.assign({},baseRequest,{allowedPaymentMethods:[baseCardPaymentMethod]})}function onGooglePayLoaded(){googlePaymentsClient=getGooglePaymentsClient();googlePaymentsClient.isReadyToPay(getGoogleIsReadyToPayRequest()).then(function(response){if(response.result){addGooglePayButton()}})["catch"](function(err){console.error(err)})}function createGooglePayButton(color,buttonId){function onGooglePaymentButtonClicked(event){sessionStorage.setItem("paySource","GOOGLEPAY");callMethodApply(buttonId)}return getGooglePaymentsClient().createButton({onClick:onGooglePaymentButtonClicked,buttonColor:color,buttonType:"plain",buttonSizeMode:"fill"})}function addGooglePayButton(){document.querySelectorAll(".btnGoogle1, .btnGoogle2").forEach(function(gPayButton){var button=createGooglePayButton(gPayButton.className.includes("btnGoogle1")?"white":"black",gPayButton.dataset.id);button.firstElementChild.dataset.id=gPayButton.dataset.id;button.firstElementChild.title=gPayButton.title;var offer=gPayButton.getAttribute("offer");var upsell=gPayButton.getAttribute("upsell");button.firstElementChild.setAttribute("offer",offer);button.firstElementChild.setAttribute("upsell",upsell);var parent=gPayButton.parentNode;var wrapper=document.createElement("div");var gPayReplacedButton=button.querySelectorAll("button")[0];var gPayBtnBgSize=parseInt($(gPayButton).css("height").split("px")[0])<=30?"auto":"contain";gPayReplacedButton?$(gPayReplacedButton).css({"min-height":$(gPayButton).css("height"),"background-size":gPayBtnBgSize,"max-width":$(parent).css("width")}):null;$(wrapper).css({"width":$(gPayButton).css("width"),"min-height":$(gPayButton).css("height")});parent.replaceChild(wrapper,gPayButton);wrapper.appendChild(gPayButton);gPayButton.insertAdjacentElement("beforebegin",button);gPayButton.remove()})}document.querySelectorAll(".btnGoogle1, .btnGoogle2, .cc-global-payment-btn").length>0&&loadScript("https://pay.google.com/gp/p/js/pay.js",onGooglePayLoaded)}function customerNotificationHandler(message,buttonId){enableInteractions();sessionStorage.removeItem("paySource");var tag=document.getElementById("paypal-notify");if(tag===null){tag=document.createElement("p");tag.setAttribute("id","paypal-notify")}tag.innerHTML=message;var color=tag.style.color="red";var paypalButton=document.getElementById(buttonId);paypalButton?$(tag).insertAfter(paypalButton):alert(message);clearCCPayPalSessionData()}function addOverlayEffectScripts(){try{if(document.getElementById("overlayEffectDiv")){return}$("head").append("\n    <style>\n    #overlayEffectDiv {\n        position: fixed;\n        display: none;\n        width: 100%;\n        height: 100%;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: rgba(0,0,0,0.5);\n        z-index: 100;\n        cursor: pointer;\n    }\n    #overlayEffectDiv div{\n        position: absolute;\n        top: 35%;\n        left: 50%;\n        font-size: 50px;\n        color: white;\n        transform: translate(-50%,-50%);\n        -ms-transform: translate(-50%,-50%);\n    }\n    #overlayEffectDiv div div{\n        top: 50%;\n    }\n    #importURLModalContent {\n        color: #ffffff;\n    }\n    </style>\n");$("body").append("<div id='overlayEffectDiv'>\n        <div>\n            Please wait.  Do not refresh your browser.\n            <br/><br/><br/>\n            <div class=\"fa fa-spinner fa-pulse fa-lg m-r-xs\" style=\"display: block; text-align: center;\"></div>\n        </div>\n    </div>\n")}catch(err){console.log("Error: Unable to add overlay scripts")}}function hideOverlayEffect(){try{document.getElementById("overlayEffectDiv").style.display="none"}catch(err){console.log("Error: Unable to hide overlay effect")}}function showOverlayEffect(){try{document.getElementById("overlayEffectDiv").style.display="block"}catch(err){console.log("Error: Unable to show overlay effect")}}function configurePayPalSmartButtons(){$("[data-partner-attribution-id=CheckoutChampLLC_PPFM_PPCP]").remove();var isBuildOrTemplate=checkBuildOrTemplate();var pageTypeId=pageData.pageTypeId;if(isBuildOrTemplate||![3,4].includes(pageTypeId)){return}var isUpsellPage=pageTypeId===3;var ispaypalSmartButtonUsed=sessionStorage.getItem("paypalSmartButton");var isReferencedTransaction=getAddOnKeyValue(findAddOn("PayPal_Reference"))==="1"?1:0;var isPayPalVaultEnabled=getAddOnKeyValue(findAddOn("PayPal_Vault"))==="1"?1:0;var singleTransaction=isReferencedTransaction&&parseInt(pageData.selectedCampaign.singleTransaction);var orderData=sessionStorage.getItem("orderData");orderData=orderData?JSON.parse(orderData):{};var orderPrepaidType=orderData.prepaidType;if(isUpsellPage&&(ispaypalSmartButtonUsed!=="true"||(isPayPalVaultEnabled?isReferencedTransaction&&orderPrepaidType!=="PAYPAL_PAYLATER":isReferencedTransaction))){return}var isPayPalGatewaySelected=getAddOnKeyValue(findAddOn("paypalPayLaterHide"))==="true"?true:false;var isVenmoSelected=parseInt(getAddOnKeyValue(findAddOn("PayPal_Venmo")));var isPayLaterSelected=parseInt(getAddOnKeyValue(findAddOn("PayPal_PayLater")));var enableFunding=[];var disableFunding="card,bancontact,blik,eps,giropay,ideal,mercadopago,mybank,p24,sepa,sofort";if(isVenmoSelected&&(!isUpsellPage||isUpsellPage&&orderPrepaidType==="PAYPAL_VENMO")){enableFunding.push("venmo")}else{disableFunding=disableFunding+",venmo"}var messageComponent="";if(isPayLaterSelected&&!singleTransaction&&(!isUpsellPage||isUpsellPage&&orderPrepaidType==="PAYPAL_PAYLATER")){messageComponent=",messages";enableFunding.push("paylater")}else{disableFunding=disableFunding+",credit,paylater"}enableFunding=enableFunding.join();var merchantId=getAddOnKeyValue(findAddOn("PayPal_Merchant"));if(isPayPalGatewaySelected||(isUpsellPage?false:!enableFunding)||!merchantId||!(!isReferencedTransaction||isPayPalVaultEnabled)){return}disableFunding="&disable-funding="+disableFunding;enableFunding=enableFunding?"&enable-funding="+enableFunding:"";addOverlayEffectScripts();var transactionParams="";if(parseInt(pageData.selectedCampaign.requireQA)||singleTransaction){transactionParams="&intent=authorize"}var payPalSandbox=document.URL.includes("dev-funnels")||getAddOnKeyValue(findAddOn("PayPal_Sandbox"))==="1";var datasetObj=[{key:"partnerAttributionId",value:"CheckoutChampLLC_PPFM_PPCP"}];var clientId=payPalSandbox?"AdATBZ6vUtyH5FQ3weG-63lWwkNioUYJ0b07KEdVwrw0z_DkctGqnz2Q7O-59Dh5nLAOo0LsQOw5GTqY":"AWGTxJ1AlWxI4ZyxZ8J-Mrc_gkVkPR-CFBcT4UnlYUFvEulP6ItFrm_DnLhpZ7dlB94KhqFGd3t7dMQs";var paypalUrl="https://www.paypal.com/sdk/js?client-id="+clientId+disableFunding+enableFunding+"&merchant-id="+merchantId+transactionParams+"&components=buttons"+messageComponent+"&currency="+(returnCurrencyCode()||pageData.selectedCampaign.currency);var scriptAttrs=[{key:"async",value:true}];$(".btnPayPal, .btnPayPal2").css("pointer-events","none");loadScript(paypalUrl,addPayPalSmartButton,false,false,datasetObj,scriptAttrs,null,handleScriptLoadError);function handleScriptLoadError(event){$(".paypalSdkLoadFailureError").remove();$(".btnPayPal, .btnPayPal2").css("pointer-events","none");$("<div style='color: red;' class='paypalSdkLoadFailureError'>PayPal transaction is not supported with selected currency.</div>").insertAfter($(".btnPayPal, .btnPayPal2"))}function addPayPalSmartButton(){$(".btnPayPal, .btnPayPal2").css("pointer-events","auto");var paypalSdkParams="";var pageType=pageData.pageTypeId;var paypalButtonCollection=document.querySelectorAll(".btnPayPal, .btnPayPal2");var buttonAndLinkCollection=[];if(isUpsellPage&&ispaypalSmartButtonUsed==="true"){var linkCollection=document.querySelectorAll("a");var buttonCollection=document.querySelectorAll("button");[].concat(_toConsumableArray(linkCollection),_toConsumableArray(buttonCollection)).forEach(function(element){if(element.getAttribute("action")==="submit"){buttonAndLinkCollection.push(element)}})}[].concat(_toConsumableArray(paypalButtonCollection),buttonAndLinkCollection).forEach(function(payPalButton){var divId=payPalButton.id;var payPalButtonDiv=document.createElement("div");payPalButtonDiv.classList=payPalButton.classList;payPalButtonDiv.dataset.id=payPalButton.dataset.id;payPalButtonDiv.attributes=payPalButton.attributes;payPalButtonDiv.title=payPalButton.title;payPalButtonDiv.style.backgroundImage="none";payPalButtonDiv.style.backgroundColor="transparent";payPalButtonDiv.style.padding="0px";payPalButtonDiv.style.height="auto";payPalButtonDiv.style.width="auto";payPalButtonDiv.style.display="inline-flex";payPalButtonDiv.style.border="none";payPalButton.insertAdjacentElement("beforebegin",payPalButtonDiv);payPalButton.remove();payPalButtonDiv.id=divId;var smartButtonReplacementId="#"+divId;var buttonId=payPalButton.dataset.id;var buttonItem=getNavigationItemFromPageData(buttonId);var buttonData=getButtonOrLinkData(buttonItem,pageType);var route=redirectPath(buttonData,true);var paypalPrePaidType=null;var smartButtonConfig={style:{layout:"vertical",shape:"rect",label:"paypal"},onClick:function onClick(data,actions){try{if(fflPopUpRequired(buttonId)){updateFFLModalButtonCSS(buttonId);showFFLPopUp();return actions.reject()}sessionStorage.setItem("paypalSdk",true);sessionStorage.setItem("paySource","PAYPAL");var fundingSource=data&&data.fundingSource&&data.fundingSource.toUpperCase();if(["VENMO","PAYLATER"].includes(fundingSource)){paypalPrePaidType="PAYPAL_"+fundingSource}if(isUpsellPage&&orderPrepaidType!==paypalPrePaidType){customerNotificationHandler("PayPal's payment method must match the method used on the checkout page.",divId);return actions.reject()}return callMethodApply(buttonId,paypalPrePaidType).then(function(res){if(res&&res.result==="SUCCESS"&&res.message&&res.message.paypalSdkParams){paypalSdkParams=res.message.paypalSdkParams;return actions.resolve()}else{return actions.reject()}})}catch(err){if(!(window.paypal&&window.paypal.Buttons)){throw new Error("Error: Unable to load PayPal script.")}else{throw new Error("Error: Please configure PayPal credentials properly.")}}},onApprove:function onApprove(data,actions){try{confirmPaypal(data.orderID,data.payerID,data.billingToken,paypalPrePaidType)}catch(err){throw new Error("Error: Unable to confirm order.")}},onCancel:function onCancel(data){customerNotificationHandler("Payment cancelled",divId)},onError:function onError(err){customerNotificationHandler(err,divId)}};smartButtonConfig.createOrder=function(data,actions){try{var _orderId4=paypalSdkParams&&paypalSdkParams.id;if(!_orderId4)throw new Error("Insufficient data to process PayPal checkout.");return _orderId4}catch(err){throw err.message}};paypal.Buttons(smartButtonConfig).render(smartButtonReplacementId)})}}function configureAmazonPay(){var amazonBillerId=getAddOnKeyValue(findAddOn("amazonBillerId"));var amazonClientId=getAddOnKeyValue(findAddOn("amazonClientId"));var amazonSellerId=getAddOnKeyValue(findAddOn("amazonSellerId"));var amazonAccessKey=getAddOnKeyValue(findAddOn("amazonAccessKey"));var amazonRecurring=getAddOnKeyValue(findAddOn("amazonRecurring"));if(!amazonBillerId||!amazonClientId||!amazonSellerId||!amazonAccessKey)return;sessionStorage.setItem("amazonBillerId",amazonBillerId);var useAmazonSandbox=document.URL.includes("dev-funnels");window.onAmazonLoginReady=function(){amazon.Login.setClientId(amazonClientId)};window.onAmazonPaymentsReady=function(){//get parameters from the URL query string
var urlParams=new URLSearchParams(getCurrentWindowLocation().search);if(urlParams.has("access_token")){var amazonAccessToken=urlParams.get("access_token");sessionStorage.setItem("amazonAccessToken",amazonAccessToken);addAmazonAddressBook();addAmazonWallet();//get Amazon profile details: username, email address, userID
var profileResponse;var amazonProfileUrl=useAmazonSandbox?"https://api.sandbox.amazon.com/user/profile":"https://api.amazon.com/user/profile";$.ajax({async:false,type:"GET",// cors: true,
headers:{"Authorization":"bearer "+amazonAccessToken},url:amazonProfileUrl,success:function success(result){profileResponse=result},error:function error(xhr){return xhr.status}});sessionStorage.setItem("amazonEmail",profileResponse.email);sessionStorage.setItem("amazonName",profileResponse.name);sessionStorage.setItem("amazonUserId",profileResponse.user_id)}else{addAmazonButton()}};var amazonScriptUrl=useAmazonSandbox?"https://static-na.payments-amazon.com/OffAmazonPayments/us/sandbox/js/Widgets.js":"https://static-na.payments-amazon.com/OffAmazonPayments/us/js/Widgets.js";loadScript(amazonScriptUrl);function addAmazonButton(){document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark").forEach(function(amazonButton){var buttonColor=amazonButton.className.includes("btnAmazonGold")?"Gold":amazonButton.className.includes("btnAmazonLight")?"LightGray":"DarkGray";var divId=amazonButton.id;var amazonButtonDiv=document.createElement("div");var datasetId=amazonButton.dataset.id;amazonButtonDiv.className=amazonButton.className;amazonButtonDiv.dataset.id=datasetId;amazonButtonDiv.title=amazonButton.title;amazonButtonDiv.attributes=amazonButton.attributes;amazonButtonDiv.style.backgroundImage="none";amazonButtonDiv.style.padding="0px";amazonButton.insertAdjacentElement("beforebegin",amazonButtonDiv);amazonButton.remove();amazonButtonDiv.id=divId;var authRequest;OffAmazonPayments.Button(divId,amazonSellerId,{type:"PwA",color:buttonColor,size:"x-large",authorization:function authorization(){loginOptions={scope:"profile payments:widget payments:shipping_address",popup:"true"};authRequest=amazon.Login.authorize(loginOptions,getCurrentWindowLocation().href)},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}});var amazonBtnImgTag=amazonButtonDiv.querySelectorAll("img")[0];amazonBtnImgTag?$(amazonBtnImgTag).css({"max-height":"fit-content","height":"auto","width":"100%"}):null})}function addAmazonAddressBook(){var addressBookDiv=document.createElement("div");addressBookDiv.id="amazonAddressBookDiv";addressBookDiv.style.width="500px";addressBookDiv.style.height="400px";var amazonBtn=document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark")[0];amazonBtn.insertAdjacentElement("beforebegin",addressBookDiv);if(amazonRecurring){sessionStorage.setItem("amazonRebillEnabled",1);new OffAmazonPayments.Widgets.AddressBook({sellerId:amazonSellerId,agreementType:"BillingAgreement",onReady:function onReady(billingAgreement){var amazonOrderId=billingAgreement.getAmazonBillingAgreementId();sessionStorage.setItem("paySource","AMAZON");sessionStorage.setItem("amazonOrderId",amazonOrderId);addConsentWidget(amazonOrderId)},design:{designMode:"responsive"},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonAddressBookDiv")}else{new OffAmazonPayments.Widgets.AddressBook({sellerId:amazonSellerId,onOrderReferenceCreate:function onOrderReferenceCreate(orderReference){var amazonOrderId=orderReference.getAmazonOrderReferenceId();sessionStorage.setItem("paySource","AMAZON");sessionStorage.setItem("amazonOrderId",amazonOrderId)},design:{designMode:"responsive"},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonAddressBookDiv")}}function addAmazonWallet(){var walletDiv=document.createElement("div");walletDiv.id="amazonWalletDiv";walletDiv.style.width="500px";walletDiv.style.height="400px";var amazonBtn=document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark")[0];amazonBtn.insertAdjacentElement("beforebegin",walletDiv);new OffAmazonPayments.Widgets.Wallet({sellerId:amazonSellerId,design:{designMode:"responsive"},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonWalletDiv")}function addConsentWidget(amazonBillingAgreementId){var consentDiv=document.createElement("div");consentDiv.id="amazonConsentDiv";consentDiv.style.width="500px";consentDiv.style.height="400px";var amazonBtn=document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark")[0];amazonBtn.insertAdjacentElement("beforebegin",consentDiv);new OffAmazonPayments.Widgets.Consent({sellerId:amazonSellerId,amazonBillingAgreementId:amazonBillingAgreementId,design:{designMode:"responsive"},onConsent:function onConsent(billingAgreementConsentStatus){var consentStatus=billingAgreementConsentStatus.getConsentStatus();if(consentStatus)sessionStorage.setItem("amazonConsentReceived",1);else sessionStorage.removeItem("amazonConsentReceived")},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonConsentDiv")}}function configureSquare(){var squareLabels=document.querySelectorAll(".squareCheckoutLabel");var squareAppId=getAddOnKeyValue(findAddOn("squareApplicationId"));var squareLocationId=getAddOnKeyValue(findAddOn("squareLocationId"));if(!squareLabels[0]||!squareAppId||!squareLocationId)return;var squareForm="<form id=\"payment-form\"><div id=\"square-card-container\"></div><input type=\"button\" value=\"\" id=\"square-card-button\" class=\"d-none\"></form><input type=\"hidden\" id=\"formCardNonce\" name=\"formCardNonce\" value=\"\" />";squareLabels[0].insertAdjacentHTML("beforebegin",squareForm);squareLabels[0].style.display="none";var squareUrl=document.URL.includes("dev-funnels")?"https://sandbox.web.squarecdn.com/v1/square.js":"https://web.squarecdn.com/v1/square.js";loadScript(squareUrl,initSquare)}function initSquare(){return _initSquare.apply(this,arguments)}function _initSquare(){_initSquare=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee24(){var squareAppId,squareLocationId,squareInitializeCard,_squareInitializeCard,squareTokenize,_squareTokenize,squarePayments,squareCard,handleSquarePaymentToken,_handleSquarePaymentToken,squareCardButton,handleSquareSuccess,handleSquareError;return _regeneratorRuntime().wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:handleSquareError=function _handleSquareError(error){alert(error);enableInteractions()};handleSquareSuccess=function _handleSquareSuccess(token){var nonce=document.getElementById("formCardNonce");if(nonce)nonce.value=token;var squareSubmitBtnId=localStorage.getItem("squareSubmitBtnId");callMethodApply(squareSubmitBtnId)};_handleSquarePaymentToken=function _handleSquarePaymentT2(){_handleSquarePaymentToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee23(event,paymentMethod){var nonce,_token3;return _regeneratorRuntime().wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:event.preventDefault();nonce=document.getElementById("formCardNonce");if(!(nonce&&nonce.value!="")){_context23.next=6;break}handleSquareSuccess(nonce.value);_context23.next=16;break;case 6:_context23.prev=6;_context23.next=9;return squareTokenize(paymentMethod);case 9:_token3=_context23.sent;handleSquareSuccess(_token3);_context23.next=16;break;case 13:_context23.prev=13;_context23.t0=_context23["catch"](6);handleSquareError(_context23.t0.message);case 16:case"end":return _context23.stop();}}},_callee23,null,[[6,13]])}));return _handleSquarePaymentToken.apply(this,arguments)};handleSquarePaymentToken=function _handleSquarePaymentT(_x19,_x20){return _handleSquarePaymentToken.apply(this,arguments)};_squareTokenize=function _squareTokenize3(){_squareTokenize=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee22(paymentMethod){var tokenResult,errorMessage;return _regeneratorRuntime().wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:_context22.next=2;return paymentMethod.tokenize();case 2:tokenResult=_context22.sent;if(!(tokenResult.status==="OK")){_context22.next=7;break}return _context22.abrupt("return",tokenResult.token);case 7:errorMessage="Tokenization failed with status:"+tokenResult.status;if(tokenResult.errors&&tokenResult.errors[0]&&tokenResult.errors[0].message)errorMessage+=" and error: "+tokenResult.errors[0].message;throw new Error(errorMessage);case 10:case"end":return _context22.stop();}}},_callee22)}));return _squareTokenize.apply(this,arguments)};squareTokenize=function _squareTokenize2(_x18){return _squareTokenize.apply(this,arguments)};_squareInitializeCard=function _squareInitializeCard3(){_squareInitializeCard=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(payments){var card;return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:_context21.next=2;return payments.card();case 2:card=_context21.sent;_context21.next=5;return card.attach("#square-card-container");case 5:return _context21.abrupt("return",card);case 6:case"end":return _context21.stop();}}},_callee21)}));return _squareInitializeCard.apply(this,arguments)};squareInitializeCard=function _squareInitializeCard2(_x17){return _squareInitializeCard.apply(this,arguments)};if(window.Square){_context24.next=11;break}handleSquareError("Square.js failed to load properly");return _context24.abrupt("return");case 11:squareAppId=getAddOnKeyValue(findAddOn("squareApplicationId"));squareLocationId=getAddOnKeyValue(findAddOn("squareLocationId"));_context24.prev=13;squarePayments=window.Square.payments(squareAppId,squareLocationId);_context24.next=21;break;case 17:_context24.prev=17;_context24.t0=_context24["catch"](13);handleSquareError("applicationId and/or locationId is incorrect");return _context24.abrupt("return");case 21:_context24.prev=21;_context24.next=24;return squareInitializeCard(squarePayments);case 24:squareCard=_context24.sent;_context24.next=31;break;case 27:_context24.prev=27;_context24.t1=_context24["catch"](21);handleSquareError("Initializing Card failed. Reason: "+_context24.t1.message);return _context24.abrupt("return");case 31:squareCardButton=document.getElementById("square-card-button");squareCardButton.addEventListener("click",/*#__PURE__*/function(){var _ref38=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(event){var squareSubmitBtnId;return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:squareSubmitBtnId=localStorage.getItem("squareSubmitBtnId");disableInteractions(squareSubmitBtnId,true,false);_context20.next=4;return handleSquarePaymentToken(event,squareCard);case 4:case"end":return _context20.stop();}}},_callee20)}));return function(_x21){return _ref38.apply(this,arguments)}}());case 33:case"end":return _context24.stop();}}},_callee24,null,[[13,17],[21,27]])}));return _initSquare.apply(this,arguments)}function configureApplePay(){var applePayPluginId=getAddOnKeyValue(findAddOn("applePayPluginId"));if(!applePayPluginId)return;var applePayBtns=document.querySelectorAll(".btnApplePay, .cc-global-payment-btn");if(!applePayBtns)return;var appleButtonLength=applePayBtns.length;var _loop24=function _loop24(_i117){var appleButton=applePayBtns[_i117];if(window.ApplePaySession&&window.ApplePaySession.canMakePayments()&&window.ApplePaySession.supportsVersion(1)){appleButton.removeAttribute("onclick");appleButton.onclick=function(){event.preventDefault();var datasetId=appleButton.dataset.id;sessionStorage.setItem("paySource","APPLEPAY");createPaymentRequest(datasetId)}}else{appleButton.style.display="none"}};for(var _i117=0;_i117<appleButtonLength;_i117++){_loop24(_i117)}function getShippingDetails(lineItems){var shipProfileData=getShipProfile();var shipProfileName=shipProfileData&&shipProfileData.profileName;var shipMethod=shipProfileData&&shipProfileData.shipMethod;var shipLabel=shipProfileName?shipProfileName:"Product shipping";var shipDetail=shipMethod?shipMethod:"Standard";var shipAmount="0.00";lineItems&&lineItems.forEach(function(item){if(item.label==="Shipping"){shipAmount=item.amount}});var shippingDetails=[{"label":shipLabel,"detail":shipDetail,"amount":shipAmount,"identifier":"shipping"}];return shippingDetails}function createPaymentRequest(buttonId){var request={};var offer=getOfferFromNavigationItem(buttonId);request.countryCode=getAddOnKeyValue(findAddOn("applePayCountryCode"));//required
request.currencyCode=pageData.selectedCampaign.currency;//required
request.merchantCapabilities=["supports3DS"];//required
request.supportedNetworks=["visa","masterCard","amex","discover"];//required
if(pageData.pageTypeId===4){var offerButtonElement=document.querySelector("[data-id="+buttonId+"]");var offerButtonVariantValue=offerButtonElement.getAttribute("variantvalue");getVariants();var orderItems=getOrderItems();if(offer){if(offerButtonVariantValue){var itemOfferKey=offer+"."+offerButtonVariantValue;orderItems[itemOfferKey]=getQuantity()}else{orderItems[offer]=getQuantity()}sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}}else if(pageData.pageTypeId===3){var upsell=getUpsellFromNavigationItem(buttonId);var upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");var upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");getVariants();var _orderItems13=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};if(upsell){if(upsellButtonVariantValue){var _itemOfferKey6=upsell+"."+upsellButtonVariantValue;_orderItems13[_itemOfferKey6]=getQuantity()}else{_orderItems13[upsell]=getQuantity()}sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems13))}}if(fflPopUpRequired(buttonId)){updateFFLModalButtonCSS(buttonId);showFFLPopUp();return}var _getAppleItems=getAppleItems(),appleTotal=_getAppleItems.appleTotal,appleItems=_getAppleItems.appleItems;request.total=appleTotal;//required
request.lineItems=appleItems;request.requiredBillingContactFields=["email","name","phone","postalAddress"];request.requiredShippingContactFields=["email","name","phone","postalAddress"];if(shippingCostApplePayIncluded){request.shippingMethods=getShippingDetails(request.lineItems)}var version;for(var _i118=4;_i118>0;_i118--){if(window.ApplePaySession.supportsVersion(_i118)){version=_i118;break}}var settings={};var session=new ApplePaySession(version,request);session.onshippingcontactselected=function onshippingcontactselected(event){//update totals and line items based on shipping address selection
var shippingContact=event.shippingContact;setAppleAddress(event.shippingContact,"shipping",{});var _getAppleItems2=getAppleItems(),appleTotal=_getAppleItems2.appleTotal,appleItems=_getAppleItems2.appleItems;var update={newTotal:appleTotal,//new transaction total amount
newLineItems:appleItems};session.completeShippingContactSelection(update)};session.onshippingmethodselected=function onshippingmethodselected(event){//update totals and line items based on shipping method selection
var shippingMethod=event.shippingMethod;var _getAppleItems3=getAppleItems(),appleTotal=_getAppleItems3.appleTotal,appleItems=_getAppleItems3.appleItems;var update={newTotal:appleTotal,//new transaction total amount
newLineItems:appleItems};session.completeShippingMethodSelection(update)};session.onpaymentauthorized=function onpaymentauthorized(event){var payment=event.payment;sessionStorage.setItem("applePayPayment",JSON.stringify(payment));sessionStorage.setItem("applePayToken",JSON.stringify(payment.token));//Call Import Order / Import Upsale here with applePayToken parameter
callMethodApply(buttonId)};session.onpaymentmethodselected=function onpaymentmethodselected(event){//update totals and line items based on payment method selection
var paymentMethod=event.paymentMethod;var _getAppleItems4=getAppleItems(),appleTotal=_getAppleItems4.appleTotal,appleItems=_getAppleItems4.appleItems;var update={newTotal:appleTotal,//new transaction total amount
newLineItems:appleItems};session.completePaymentMethodSelection(update)};session.oncancel=function oncancel(event){if(pageData.pageTypeId===4){offer&&rolebackSessionProducts(offer);sessionStorage.removeItem("paySource");displayPrices()}sessionStorage.removeItem("upsalefkCart");enableInteractions()};session.onvalidatemerchant=function onvalidatemerchant(event){//call API (via server to server - backend) using event.validationURL as endpoint to start Apple Pay Payment Session
var params={};params.applePayPluginId=applePayPluginId;params.displayName=getAddOnKeyValue(findAddOn("applePayMerchantName"));params.domainName=getCurrentWindowLocation().hostname;params.validationURL=event.validationURL;var data=JSON.stringify(params);var response=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Plugin/ApplePaySession",data).then(function(data){if(data.result==="SUCCESS"){var merchantSessionObj=typeof data.message==="string"?JSON.parse(data.message):data.message;session.completeMerchantValidation(merchantSessionObj)}else{session.abort()}})};window.session=session;session.begin()}function getAppleItems(){var retObj={};retObj.appleItems=[];var lineItemShipPrice,lineItemTotalShipPrice=0;var appleDisplayName=getAddOnKeyValue(findAddOn("applePayMerchantName"));if(pageData.pageTypeId===4){displayPrices();var _JSON$parse5=JSON.parse(sessionStorage.getItem("totals")),grandTotal=_JSON$parse5.grandTotal,shipTotal=_JSON$parse5.shipTotal,salesTax=_JSON$parse5.salesTax;shippingCostApplePayIncluded=shipTotal>0;retObj.appleTotal={"label":appleDisplayName,"type":"final","amount":grandTotal.toString()};var currentOrderItems=getOrderItemDetails();var currentOrderItemsEntries=Object.entries(currentOrderItems);var currentOrderItemsEntriesLength=currentOrderItemsEntries.length;for(var _i119=0;_i119<currentOrderItemsEntriesLength;_i119++){var campaignProductId=currentOrderItemsEntries[_i119][0];var _item19=currentOrderItemsEntries[_i119][1];var variantTitle=_item19.variant?" "+_item19.variant.title:"";var itemLabel=_item19.productName+variantTitle;var itemPrice=_item19.variant&&_item19.variant.price&&!_item19.isVariantBundle&&!_item19.isEditable?_item19.variant.price:_item19.cycle1_price;retObj.appleItems.push({"label":itemLabel,"type":"final","amount":getItemPrice(campaignProductId,itemPrice,_item19.currentOrderQuantity).toString()})}retObj.appleItems.push({"label":"Shipping","type":"final","amount":shipTotal.toString()});retObj.appleItems.push({"label":"Sales Tax","type":"final","amount":salesTax.toString()})}else{var orderItems=getUpsaleItems();if(Object.keys(orderItems).length){(function(){var total=0;var shipTotal=0;var cpId=null;var variantId=null;var itemLabel="";var productData=null;for(var upsaleItemCpId in orderItems){var _itemPrice=0;var shipPrice=0;if(upsaleItemCpId.indexOf(".")>0){productData=upsaleItemCpId.split(".");cpId=productData[0];variantId=productData[1]}else{cpId=upsaleItemCpId}var _item20=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId===parseInt(cpId)})[0];if(!_item20)continue;if(variantId&&_item20.variants&&productData&&productData.length>1){var variantDetails=_item20.variants.filter(function(data){return data.variantDetailId===parseInt(variantId)});if(variantDetails&&variantDetails.length>0){itemLabel=_item20.productName+" "+variantDetails[0].title;_itemPrice=parseFloat(variantDetails[0].price)>0&&!_item20.isVariantBundle&&!_item20.isEditable?variantDetails[0].price:_item20.cycle1_price;shipPrice=parseFloat(variantDetails[0].shippingPrice)>0&&!_item20.isVariantBundle?variantDetails[0].shippingPrice:_item20.cycle1_shipPrice}}else{itemLabel=_item20.productName;_itemPrice=_item20.cycle1_price;shipPrice=_item20.cycle1_shipPrice}lineItemShipPrice=getShipPrice(shipPrice,orderItems[upsaleItemCpId]);lineItemTotalShipPrice+=lineItemShipPrice;var itemTotal=(getItemPrice(upsaleItemCpId,_itemPrice,orderItems[upsaleItemCpId])+lineItemShipPrice).toFixed(2);total+=parseFloat(itemTotal);shippingCostApplePayIncluded=lineItemTotalShipPrice>0;retObj.appleItems.push({"label":itemLabel,"type":"final","amount":itemTotal.toString()})}retObj.appleTotal={"label":appleDisplayName,"type":"final","amount":total.toString()}})()}}return retObj}}function configureLoyaltyLion(){var loyaltyLionPluginId=getAddOnKeyValue(findAddOn("loyaltyLionPluginId"));var loyaltyLionToken=getAddOnKeyValue(findAddOn("loyaltyLionToken"));if(!loyaltyLionPluginId||!loyaltyLionToken)return;!function(t,n){function o(n){var o=t.getElementsByTagName("script")[0],i=t.createElement("script");i.src=n,i.crossOrigin="",o.parentNode.insertBefore(i,o)}if(!n.isLoyaltyLion){window.loyaltylion=n,void 0===window.lion&&(window.lion=n),n.version=2,n.isLoyaltyLion=!0;var i=new Date,e=i.getFullYear().toString()+i.getMonth().toString()+i.getDate().toString();o("https://sdk.loyaltylion.net/static/2/loader.js?t="+e);var r=!1;n.init=function(t){if(r)throw new Error("Cannot call loyaltylion.init more than once");r=!0;var a=n._token=t.token;if(!a)throw new Error("Token must be supplied to loyaltylion.init");for(var l=[],s="_push configure bootstrap shutdown on removeListener authenticateCustomer".split(" "),c=0;c<s.length;c+=1){!function(t,n){t[n]=function(){l.push([n,Array.prototype.slice.call(arguments,0)])}}(n,s[c])}o("https://sdk.loyaltylion.net/sdk/start/"+a+".js?t="+e+i.getHours().toString()),n._initData=t,n._buffer=l}}}(document,window.loyaltylion||[]);var membership=null;var loginCustomer=null;var loyaltyLionAuthToken=sessionStorage.getItem("loyaltyLionAuthToken")?sessionStorage.getItem("loyaltyLionAuthToken"):null;membership=sessionStorage.getItem("membership")?JSON.parse(sessionStorage.getItem("membership")):null;loginCustomer=sessionStorage.getItem("loginCustomer")?JSON.parse(sessionStorage.getItem("loginCustomer")):null;if(loyaltyLionAuthToken&&(membership||loginCustomer)){var customerId=membership?membership.customerId:loginCustomer.customerId;var customerEmail=membership?membership.emailAddress:loginCustomer.emailAddress;var tokenData=loyaltyLionAuthToken.split("||");loyaltylion.init({token:loyaltyLionToken,customer:{id:customerId,email:customerEmail},auth:{date:tokenData[1],token:tokenData[0]}})}else{loyaltylion.init({token:loyaltyLionToken})}loyaltylion.on("ready",function(){loyaltylion.registerHook("customers.rewards.claimed",/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref6){var claimedReward,obj,_data2,_response4,returnAction;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:claimedReward=_ref6.claimedReward;if(claimedReward.redeemable.code){obj={};obj.campaignId=parseInt(pageData.funnelData.campaign);obj.rewardsPluginId=loyaltyLionPluginId;obj.reward=JSON.stringify(claimedReward);_data2=JSON.stringify(obj);_response4=httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/Coupon",_data2).then(function(data){if(data.result==="SUCCESS"){if(pageData.pageTypeId===4){appliedCouponCode.push(claimedReward.redeemable.code);displayPrices()}}})}returnAction=pageData.pageTypeId===4?"hide_claim_modal":"show_claim_modal";return _context.abrupt("return",{action:returnAction});case 4:case"end":return _context.stop();}}},_callee)}));return function(_x16){return _ref7.apply(this,arguments)}}())})}function addOrderIdInExternalURL(route,orderId){if(orderId&&route&&!route.includes("orderId=")){route+=(route.includes("?")?"&":"?")+"orderId="+orderId.replace(/"/g,"")}return route}function handleMaskedInputChange(e){var name=e.target.getAttribute("name");switch(e.keyCode){// allows navigating thru input
case 20:// caplocks
case 17:// control
case 18:// option
case 16:// shift
case 37:// arrow keys
case 9:// tab (let blur handle tab)
return;}var placeholder=e.target.getAttribute("placeholder");if(e.keyCode==8&&(e.target.value.length==2||e.target.value.length==3)&&placeholder.toUpperCase().substr(0,3)=="MM/"){document.getElementsByName(name)[0].value=e.target.value.substr(0,2)}else{document.getElementsByName(name)[0].value=handleCurrentValue(e)}}function handleCurrentValue(e){var placeholder=e.target.getAttribute("placeholder");if(e.target.getAttribute("name")==="phoneNumber"){var phoneNumberFormat=e.target.getAttribute("format");placeholder=phoneNumberFormat||placeholder}if(e.target.getAttribute("name")==="cardDate"){var cardDateSplit=placeholder.split("/");if(cardDateSplit&&cardDateSplit.length>1){placeholder=cardDateSplit[1].length===2?"MM/YY":"MM/YYYY"}else{placeholder="MMYY"}}var value=e.target.value,l=placeholder.length;var i,j,isInt,newValue="",isLetter,strippedVal;var maskedNumber="dDmMyY0123456789";// strip special characters
strippedValue=value.replace(/\D/g,"");for(i=0,j=0;i<l;i++){isInt=!isNaN(parseInt(strippedValue[j]));isLetter=strippedValue[j]?strippedValue[j].match(/[A-Z]/i):false;matchesNumber=maskedNumber.indexOf(placeholder[i])>=0;if(matchesNumber&&isInt){newValue+=strippedValue[j++]}else if(matchesNumber&&!isInt){return newValue}else{newValue+=placeholder[i]}// break if no characters left and the pattern is non-special character
if(strippedValue[j]==undefined){break}}if(value==""){newValue=""}if(e.target.dataset.validDataExample){var retval=validateProgress(e,newValue);return retval}return newValue}function validateProgress(e,value){var validExample=e.target.dataset.validDataExample,pattern=new RegExp(e.target.dataset.pattern),placeholder=e.target.getAttribute("placeholder");var testValue="";//convert to months
if(value.length==1&&placeholder.toUpperCase().substr(0,2)=="MM"){if(value>1&&value<10){value="0"+value}return value}if(value.length==2&&placeholder.toUpperCase().substr(0,3)=="MM/"){return value+"/"}// test the value, removing the last character, until what you have is a submatch
for(i=value.length;i>=0;i--){testValue=value+validExample.substr(value.length);if(pattern.test(testValue)){return value}else{value=value.substr(0,value.length-1)}}return value}function isRouteAppReady(){var ready=true;try{routeapp}catch(e){ready=false}return ready}function calculateShipInsurance(subTotal){var routePluginKey=getAddOnKeyValue(findAddOn("routePluginKey"));if(subTotal===undefined){subTotal=0}var currencyCode=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currency||"";var updateInsuranceInTotal=function updateInsuranceInTotal(insurance){var _JSON$parse6=JSON.parse(sessionStorage.getItem("totals")),subTotal=_JSON$parse6.subTotal,salesTax=_JSON$parse6.salesTax,shipTotal=_JSON$parse6.shipTotal,discount=_JSON$parse6.discount;prepareTotals(parseFloat(subTotal),parseFloat(salesTax),parseFloat(shipTotal),parseFloat(discount),parseFloat(insurance));displayPricesApply()};if(routePluginKey&&subTotal>=0&&currencyCode.length===3&&isRouteAppReady()){routeapp.get_quote(routePluginKey,subTotal,currencyCode,function(insuranceDetails){document.getElementById("shipmentInsurancePrice").value=0;if(insuranceDetails.insurance_selected){document.getElementById("shipmentInsurancePrice").value=insuranceDetails.insurance_price;document.getElementsByName("insureShipment")[0].checked=true}updateInsuranceInTotal(document.getElementById("shipmentInsurancePrice").value)});routeapp.on_insured_change(function(insuranceDetails){document.getElementsByName("insureShipment")[0].checked=false;document.getElementById("shipmentInsurancePrice").value=0;if(insuranceDetails.insurance_selected){document.getElementById("shipmentInsurancePrice").value=insuranceDetails.insurance_price;document.getElementsByName("insureShipment")[0].checked=true}updateInsuranceInTotal(document.getElementById("shipmentInsurancePrice").value)})}}function hideInsureShipmentCheckbox(){// Hide checkbox from builder
document.getElementsByName("insureShipment")[0].style.display="none";document.getElementsByName("insureShipment")[0].nextElementSibling.style.display="none"}function facebookCustomerChat(){var facebookPageId=getAddOnKeyValue(findAddOn("FB_Page_Id"));var enableChatPlugin=getAddOnKeyValue(findAddOn("ENABLE_CHAT_PLUGIN"));if(facebookPageId&&enableChatPlugin==="1"){var fbRoot=document.createElement("div");fbRoot.id="fb-root";var chatbox=document.createElement("div");chatbox.id="fb-customer-chat";chatbox["class"]="fb-customerchat";fbRoot.appendChild(chatbox);$("body").append(fbRoot);chatbox=document.getElementById("fb-customer-chat");chatbox.setAttribute("class","fb-customerchat");chatbox.setAttribute("page_id",facebookPageId);chatbox.setAttribute("attribution","biz_inbox");window.fbAsyncInit=function(){FB.init({xfbml:true,version:"v10.0"})};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/en_US/sdk/xfbml.customerchat.js";https://connect.facebook.net/en_US/sdk.js#xfbml=1
fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk")}}function hideFBCheckboxPlugin(){// Hide checkbox from builder
document.getElementsByName("messenger")[0].style.display="none";document.getElementsByName("messenger")[0].nextElementSibling.style.display="none"}function configureFBMessengerCheckboxPlugin(){var fbCheckboxPlugin=document.getElementsByName("messenger")[0];var facebookAppId=getAddOnKeyValue(findAddOn("FB_App_Id"));var facebookPageId=getAddOnKeyValue(findAddOn("FB_Page_Id"));if(fbCheckboxPlugin&&facebookAppId&&facebookPageId){loadScript("https://connect.facebook.net/en_US/sdk.js");window.fbAsyncInit=function(){FB.init({appId:facebookAppId,autoLogAppEvents:true,xfbml:true,version:"v10.0"})};var input=document.createElement("input");input.type="hidden";input.id="fbMessengerCheckbox";document.forms[0].append(input);var div=document.createElement("div");div.setAttribute("class","fb-messenger-checkbox");div.setAttribute("origin",window.location.origin);div.setAttribute("page_id",facebookPageId);div.setAttribute("messenger_app_id",facebookAppId);div.setAttribute("user_ref",userRef);div.setAttribute("allow_login","true");div.setAttribute("size","small");div.setAttribute("skin","light");div.setAttribute("center_align","true");fbCheckboxPlugin.insertAdjacentElement("beforebegin",div);hideFBCheckboxPlugin()}else{var isBuildOrTemplate=checkBuildOrTemplate();!isBuildOrTemplate&&fbCheckboxPlugin&&hideFBCheckboxPlugin()}}function confirmOptIn(){return _confirmOptIn.apply(this,arguments)}function _confirmOptIn(){_confirmOptIn=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee25(){var facebookAppId,facebookPageId,fbCheckboxPlugin;return _regeneratorRuntime().wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:facebookAppId=getAddOnKeyValue(findAddOn("FB_App_Id"));facebookPageId=getAddOnKeyValue(findAddOn("FB_Page_Id"));fbCheckboxPlugin=document.getElementsByName("messenger")[0];if(!(fbCheckboxPlugin&&facebookAppId&&facebookPageId)){_context25.next=6;break}_context25.next=6;return FB.AppEvents.logEvent("MessengerCheckboxUserConfirmation",null,{"app_id":facebookAppId,"page_id":facebookPageId,"user_ref":userRef});case 6:case"end":return _context25.stop();}}},_callee25)}));return _confirmOptIn.apply(this,arguments)}function configureRoutePlugin(){var insureShipment=document.getElementsByName("insureShipment")[0];var routePluginKey=getAddOnKeyValue(findAddOn("routePluginKey"));if(insureShipment&&routePluginKey&&document.getElementsByName("cardNumber")[0]&&pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.insureShipId>0){var input=document.createElement("input");input.type="hidden";input.id="shipmentInsurancePrice";document.forms[0].append(input);// Append Route Checkbox Widget
var div=document.createElement("div");div.id="RouteWidget";insureShipment.checked&&div.setAttribute("data-default-checked",true);document.getElementsByName("insureShipment")[0].insertAdjacentElement("beforebegin",div);hideInsureShipmentCheckbox();loadScript("https://cdn.routeapp.io/route-widget/stable/route-widget-stable.min.js",displayPrices)}else{var isBuildOrTemplate=checkBuildOrTemplate();!isBuildOrTemplate&&insureShipment&&hideInsureShipmentCheckbox()}}function handleCouponSplit(){var couponCodes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";couponCodes=couponCodes.trim();return couponCodes!=""?couponCodes.split(","):[]}function setOrderDataForFinalizeTransaction(urlOrderData){sessionStorage.setItem("orderData",JSON.stringify(urlOrderData));sessionStorage.setItem("orderId",JSON.stringify(urlOrderData.orderId));window.history.replaceState(null,null,window.location.pathname);if(sessionStorage.getItem("multiPayRoute")&&sessionStorage.getItem("multiPayRebillProductId")){addOverlayEffectScripts();showOverlayEffect();processMultiPayRebill(urlOrderData)}}function ccUpdateProductPrices(){var items=pageData&&pageData.cartData&&pageData.cartData.items;items&&items.forEach(function(item){pageData.selectedCampaign.products.find(function(product){if(product.campaignProductId===item.campaignProductId){var _price5=parseFloat(item.unitPrice);if(item.variantId){product.variants&&product.variants.length&&product.variants.find(function(variant){if(variant.variantDetailId===item.variantId){variant.price=_price5;variant.compareAtPrice=_price5;return true}})}else{product.cycle1_price=_price5;product.cycle2_price=_price5;product.compareAtPrice=_price5}return true}})})}function swapCartProducts(){return _swapCartProducts.apply(this,arguments)}function _swapCartProducts(){_swapCartProducts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee26(){var pageProducts,campaignId,pageElements,sessionItemCpId,_productData19,currentItem,currentItemProductId,pageProductIds,cartId,productHashMap,searchProducts,searchExternal,importedProducts,params,_response12,_data9,rebillCartCleanup,rebillCartExists,_loop29,_sessionItemCpId2,pageProductIdCollection,_params,sessionCustomCart,customCartLength,_sessionItemCpId3,_productData21,itemKey,product,_i131,_cartKey,_itemKey2,_sessionItemCpId4,ckey,customCartData,_product12,_sessionItemCpId5,_productData22,_itemKey3,qty,merchantRedirectfkCart,merchantRedirectUpsalefkCart,cc3dsPageSubmitDetails,sessionKeys,errorMessage,_orderId7,payload,_data11;return _regeneratorRuntime().wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:pageProducts=[];campaignId=pageData.selectedCampaign.campaignId;pageElements=document.querySelectorAll("button, a, input[type='radio'], input[type='checkbox'], .fk-product-section, select[name='productSelect']");pageElements.forEach(function(element){if(element.name==="productSelect"){var options=_toConsumableArray(element.childNodes);var productIds=[];options.forEach(function(opt){opt.value&&opt.value!==""&&pageProducts.push(opt.value)})}else{var offer=element.getAttribute("offer"),upsell=element.getAttribute("upsell"),value=element.getAttribute("value");if(offer&&parseInt(offer)>0)pageProducts.push(offer);else if(upsell&&parseInt(upsell)>0)pageProducts.push(upsell);else if(value&&parseInt(value)>0)pageProducts.push(value)}});pageData&&pageData.pageTypeId===3&&pageProducts.forEach(function(item){if(Number(item))ccUpsellPageFFLProducts[item]=1});fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):{};if(fkCart&&Object.keys(fkCart).length>0){for(sessionItemCpId in fkCart){_productData19=sessionItemCpId.split("~");if(_productData19.length>1){pageProducts.push(_productData19[1].split(".")[0])}else{pageProducts.push(sessionItemCpId.split(".")[0])}}}currentItem=sessionStorage.getItem("currentItem");if(currentItem){currentItemProductId=currentItem.split(".")[0];pageProducts.push(currentItemProductId)}pageProductIds={};pageProducts=new Set(pageProducts);pageProducts=Array.from(pageProducts);cartId=pageData.pageTypeId===4&&sessionStorage.getItem("cartId");if(!(pageProducts.length>0||cartId)){_context26.next=45;break}productHashMap={};pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){productHashMap[product.campaignProductId]=product;var extProductId=product.externalProductId;extProductId?productHashMap[extProductId]=product:null});searchProducts=[];searchExternal=[];pageProducts.forEach(function(sessionItemCpId){if(sessionItemCpId.startsWith("EXT")){var extSessionItemCpId=sessionItemCpId.substring(3);if(!productHashMap[extSessionItemCpId]){searchExternal.push(extSessionItemCpId)}else{pageProductIds[productHashMap[extSessionItemCpId].campaignProductId]=extSessionItemCpId}}else{if(!productHashMap[sessionItemCpId]||currentItemProductId==sessionItemCpId){searchProducts.push(sessionItemCpId)}else{pageProductIds[sessionItemCpId]=sessionItemCpId}}});importedProducts=[];if(!(searchProducts.length>0||searchExternal.length>0)){_context26.next=35;break}//call campaign query API passing in the campaignId, list of products, and list of externals
params={};params.campaignId=campaignId;if(searchProducts.length>0)params.campaignProductId=searchProducts.join(",");if(searchExternal.length>0)params.externalProductId=searchExternal.join(",");_context26.prev=25;_context26.next=28;return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/CampaignQuery",JSON.stringify(params));case 28:_response12=_context26.sent;if(_response12&&_response12.result==="SUCCESS"){_data9=_response12.message&&_response12.message.data&&_response12.message.data[campaignId];if(_data9){importedProducts=_data9.products||[];//add the products returned to pageData.selectedCampaign.products
importedProducts.forEach(function(product){if(!productHashMap[product.campaignProductId]){pageData.selectedCampaign.products.push(product)}else{var currentItemIndex=pageData.selectedCampaign.products.findIndex(function(product){return product.campaignProductId==currentItemProductId});currentItemIndex!==-1?pageData.selectedCampaign.products[currentItemIndex]=product:null}productHashMap[product.campaignProductId]=product;var extProductId=product.externalProductId;extProductId?productHashMap[extProductId]=product:null;pageProductIds[product.campaignProductId]=product.campaignProductId})}}_context26.next=35;break;case 32:_context26.prev=32;_context26.t0=_context26["catch"](25);console.log(_context26.t0);case 35:rebillCartCleanup={};rebillCart=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):null;rebillCartExists=rebillCart&&Object.keys(rebillCart).length;if(rebillCartExists){_loop29=function _loop29(_sessionItemCpId2){var cartKey=_sessionItemCpId2.split("~");if(cartKey.length>1){var itemKey=cartKey[1];var _productData20=itemKey.split(".");//find the one time product (skip if product is recurring)
var product=productHashMap[_productData20[0]];var productForQuery=product.campaignProductId;if(product&&product.billingCycleType=="ONE_TIME"){//find the recurring product of same base product
var rebillProduct=pageData.selectedCampaign.products.find(function(item){return item.productId==product.productId&&item.billingCycleType=="RECURRING"&&item.productName.toLowerCase().includes(rebillCart[_sessionItemCpId2].toLowerCase())});if(!rebillProduct){rebillProduct=pageData.selectedCampaign.products.find(function(item){return item.productId==product.productId&&item.billingCycleType=="RECURRING"})}if(rebillProduct){//change cart to rebill product
itemKey=_productData20.length>1?rebillProduct.campaignProductId+"."+_productData20[1]:rebillProduct.campaignProductId;productForQuery=rebillProduct.campaignProductId}}pageProductIds[productForQuery]=productForQuery;rebillCartCleanup[itemKey]=_sessionItemCpId2}};for(_sessionItemCpId2 in rebillCart){_loop29(_sessionItemCpId2)}}pageData.selectedCampaign.products.forEach(function(item){var campaignProductId=item.campaignProductId;if(item.clubPluginId&&!pageProductIds[campaignProductId]){pageProductIds[campaignProductId]=campaignProductId}});pageProductIdCollection=Object.keys(pageProductIds);if(pageProductIdCollection.length||cartId){try{_params={campaignId:campaignId,campaignProductId:pageProductIdCollection.join(",")};if(cartId){_params.cartId=cartId}httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/Import/CampaignQuery",JSON.stringify(_params)).then(function(response){if(response&&response.result==="SUCCESS"){var _data10=response.message&&response.message.data&&response.message.data[campaignId];if(!_data10){return}var ccCartData=_data10.cartData;if(ccCartData){ccCartData.itemsInfo={};var items=ccCartData.items||[];items.forEach(function(item){var productId=item.campaignProductId.toString();if(item.variantId){productId=productId+"."+item.variantId}ccCartData.itemsInfo[productId]=true});ccCartData.cartId=cartId;pageData.cartData=ccCartData;var ccCartItems=getOrderItems();ccCartData.items.forEach(function(item){var productId=item.campaignProductId&&item.campaignProductId.toString();if(productId){if(item.variantId){productId=productId+"."+item.variantId}ccCartItems[productId]=Number(ccCartItems[productId])||item.qty}});sessionStorage.setItem("fkCart",JSON.stringify(ccCartItems))}var pageCrmProducts=_data10.products||[];var pageDataProducts=pageData.selectedCampaign.products.filter(function(product){if(!pageProductIds[product.campaignProductId]){return true}});pageData.selectedCampaign=_data10;var currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;ccSetCurrencyRules(currencyCode);var productsCollection=pageCrmProducts.concat(pageDataProducts);pageData.selectedCampaign.products=productsCollection;initializeCountryStates();replaceTokens();loadVariants();var productVariantElement=document.getElementsByClassName("fk-product-variant-select")[0];if(productVariantElement){productVariantElement.removeAttribute("name");constructProductVariantElement("",productVariantElement)}setUnselectedTiles();showVariantImageOnProductSection();if(pageData.pageTypeId===4&&document.getElementsByName("cardNumber").length){getVariants()}ccProductSectionsOnPage&&enableInteractions();pageData.cartData&&ccUpdateProductPrices();displayPrices()}else{ccProductSectionsOnPage&&enableInteractions()}})}catch(error){ccProductSectionsOnPage&&enableInteractions();console.log(error)}}else{ccProductSectionsOnPage&&enableInteractions()}if(fkCart&&Object.keys(fkCart).length>0){sessionCustomCart=sessionStorage.getItem("customCart");customCart=sessionCustomCart&&sessionCustomCart!=="undefined"&&sessionCustomCart!=="null"?JSON.parse(sessionStorage.getItem("customCart")):{};customCartLength=Object.keys(customCart).length;//replace cart external id with campaign product id
for(_sessionItemCpId3 in fkCart){_productData21=_sessionItemCpId3.split("~");itemKey=_productData21[0].startsWith("EXT")?_productData21[0].substring(3):null;itemKey=_productData21.length>1&&_productData21[1].startsWith("EXT")?_productData21[1].substring(3):itemKey;if(itemKey){product=productHashMap[itemKey];if(product){fkCart[product.campaignProductId]=fkCart[_sessionItemCpId3];delete fkCart[_sessionItemCpId3];if(customCartLength){for(_i131=0;_i131<customCartLength;_i131++){_cartKey=customCart[_i131].split("|");if(_cartKey[0]==_productData21[1]){_cartKey[0]=product.campaignProductId;customCart[_i131]=_cartKey.join("|")}}sessionStorage.setItem("customCart",JSON.stringify(customCart))}}}}//swap to recurring products
if(rebillCartExists){for(_itemKey2 in rebillCartCleanup){_sessionItemCpId4=rebillCartCleanup[_itemKey2];fkCart[_itemKey2]=fkCart[_sessionItemCpId4];rebillCart[_itemKey2]=rebillCart[_sessionItemCpId4];if(customCartLength){for(ckey in customCart){customCartData=customCart[ckey]&&customCart[ckey].split("|")||[];_product12=_sessionItemCpId4.split("~")[1];if(_product12&&customCartData[0]&&_product12===customCartData[0]){customCartData[0]=_itemKey2;customCart[ckey]=customCartData.join("|")}}sessionStorage.setItem("customCart",JSON.stringify(customCart))}delete fkCart[_sessionItemCpId4];delete rebillCart[_sessionItemCpId4]}sessionStorage.setItem("rebillCart",JSON.stringify(rebillCart))}//remove any remaining tilde in the cart
for(_sessionItemCpId5 in fkCart){_productData22=_sessionItemCpId5.split("~");if(_productData22.length>1){_itemKey3=_productData22[1];qty=fkCart[_itemKey3]?fkCart[_itemKey3]:0;fkCart[_itemKey3]=(parseInt(fkCart[_sessionItemCpId5])+parseInt(qty)).toString();delete fkCart[_sessionItemCpId5]}}sessionStorage.setItem("fkCart",JSON.stringify(fkCart))}_context26.next=46;break;case 45:ccProductSectionsOnPage&&enableInteractions();case 46:merchantRedirectfkCart=sessionStorage.getItem("merchantRedirectfkCart");sessionStorage.removeItem("merchantRedirectfkCart");merchantRedirectUpsalefkCart=sessionStorage.getItem("merchantRedirectUpsalefkCart");cc3dsPageSubmitDetails=sessionStorage.getItem("cc3dsPageSubmitDetails");cc3dsPageSubmitDetails=cc3dsPageSubmitDetails?JSON.parse(cc3dsPageSubmitDetails):null;sessionStorage.removeItem("cc3dsPageSubmitDetails");if(!(urlParams.has("finalizeTransaction")&&urlParams.get("finalizeTransaction")==="1"&&urlParams.has("orderId"))){_context26.next=71;break}sessionKeys=Object.keys(sessionStorage);sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)sessionStorage.removeItem(key)});if(merchantRedirectUpsalefkCart){mergeOfferUpsale(JSON.parse(merchantRedirectUpsalefkCart))}errorMessage="Error retrieving order details. Reason: ";_context26.prev=57;_orderId7=urlParams.get("orderId");_orderId7=_orderId7&&_orderId7.trim();if(!_orderId7){_context26.next=66;break}payload=JSON.stringify({"orderId":_orderId7,"finalizeTransaction":1});_context26.next=64;return httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/ClubMembership/OrderQueryByOrderId",payload);case 64:_data11=_context26.sent;if(_data11&&_data11.result==="SUCCESS"){sessionStorage.setItem("products",JSON.stringify(_data11.message.items));setOrderDataForFinalizeTransaction(_data11.message);registerClick(1,null,cc3dsPageSubmitDetails);if(merchantRedirectfkCart){sessionStorage.setItem("importOrderSuccess",true);getProvidersData(1)&&sessionStorage.setItem("importOrderSuccessGA",true);getProvidersData(3)&&sessionStorage.setItem("importOrderSuccessSC",true)}else if(merchantRedirectUpsalefkCart&&getAddOnKeyValue(findAddOn("Purchase_Event_FB"))==="3"){sessionStorage.setItem("importUpsellSuccess",true);getProvidersData(1)&&sessionStorage.setItem("importUpsellSuccessGA",true)}}else if(_data11&&_data11.result==="ERROR"){alert(errorMessage+_data11.message)}case 66:_context26.next=71;break;case 68:_context26.prev=68;_context26.t1=_context26["catch"](57);alert(errorMessage+_context26.t1.message);case 71:case"end":return _context26.stop();}}},_callee26,null,[[25,32],[57,68]])}));return _swapCartProducts.apply(this,arguments)}function setUnselectedTiles(){var productSections=$(".fk-variant-tile");var productSectionsLength=productSections.length;if(productSectionsLength){for(var _i120=0;_i120<productSectionsLength;_i120++){var section=productSections[_i120];for(var j=1;j<=3;j++){var variants=$(section).find("[data-selected=true][name=variant"+j+"]");if(!variants.length){var nonSelectedTitle=$(section).find("[data-selected=false][name=variant"+j+"]").first();if(nonSelectedTitle.length&&nonSelectedTitle[0].offsetHeight>0){nonSelectedTitle.click()}}}}}}function loadAltValues(){var productElements=$(".fk-product-radio, .fk-product-checkbox, button, a");$(productElements).each(function(){var element=$(this);var altValue=element.attr("altvalue");if(altValue){var productValue=element.attr("value");var offer=element.attr("offer");var upsell=element.attr("upsell");productValue=parseInt(offer)>0?offer:parseInt(upsell)>0?upsell:productValue;var variantValue=element.attr("variantvalue");if(variantValue)productValue=productValue+"."+variantValue;var quantity=element.attr("quantity");var unitPrice=element.attr("price");quantity=quantity?quantity:1;unitPrice=unitPrice?unitPrice:0;altValues[productValue+"|"+quantity]=quantity+"|"+unitPrice+"|"+altValue}})}function getItemPrice(productValue,unitPrice,quantity,skipTax){//convert unitPrice to current currency
var exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;var itemsInfo=pageData&&pageData.pageTypeId===4&&pageData.cartData&&pageData.cartData.itemsInfo&&pageData.cartData.itemsInfo[productValue];var shopifyCurrencyMatch=itemsInfo&&(returnCurrencyCode()||pageData.selectedCampaign.currency)===pageData.cartData.currency;if(itemsInfo&&shopifyCurrencyMatch)exchangeRate=1;unitPrice=(parseFloat(unitPrice)*parseFloat(exchangeRate)).toFixed(2);var itemTotalPrice=parseFloat(unitPrice);var key=productValue+"|"+quantity;if(altValues[key]){var altValue=altValues[key].split("|");if(parseFloat(altValue[1])>0)itemTotalPrice=parseFloat(altValue[1])}itemTotalPrice=itemsInfo?itemTotalPrice:ccRoundingPrice(itemTotalPrice);if(!skipTax){itemTotalPrice*=getTaxRate().vatTaxRate}itemTotalPrice=itemTotalPrice*quantity;return itemTotalPrice}function getShipPrice(unitPrice,quantity){var exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;unitPrice=(parseFloat(unitPrice)*parseFloat(exchangeRate)).toFixed(2);var shipTotalPrice=parseFloat(unitPrice)*quantity;return shipTotalPrice}function isFirstTime(){return window&&window.performance&&window.performance.navigation&&(window.performance.navigation.type===0||navigator.userAgent.indexOf("Firefox")!==-1&&window.performance.navigation.type===255)&&!urlParams.has("token")}function getItemAlt(productValue,quantity){itemAlt=false;var key=productValue+"|"+quantity;if(altValues[key]){var altValue=altValues[key].split("|");itemAlt=altValue[2]}return itemAlt}function displayGatewayScripts(){$("afterpay-placement, affirm-placement").each(function(){$(this).remove()});var totals=JSON.parse(sessionStorage.getItem("totals"));if(totals){var grandTotal=totals.grandTotal;var payLaterBannerTagExists=$("div[data-pp-placement=product]").length;var afterPayDisplay=$(".afterpayButton").css("display")==="inline-block"?true:false;afterPayDisplay&&$(".afterpayButton").each(function(){$(this).before("<afterpay-placement data-locale='en_US' data-currency='"+pageData.selectedCampaign.currency+"' data-amount='"+grandTotal+"'></afterpay-placement>")});var affirmButtons=$(".affirmButton");var affirmUpdatedPrice=grandTotal*100;// Covert $ to cents
var affirmElement="<affirm-placement class='affirm-as-low-as' style='display:block;' data-page-type='cart' data-amount='"+affirmUpdatedPrice+"'></affirm-placement>";var paypalPayLaterEnabled=parseInt(getAddOnKeyValue(findAddOn("PayPal_PayLater")));var paypalButtons=$(".btnPayPal2, .btnPayPal");var paypalPayLaterButtonExists=!payLaterBannerTagExists&&paypalButtons.length&&paypalPayLaterEnabled;var paypalPayLaterElement="<div data-pp-message data-pp-placement='product' data-pp-amount='"+grandTotal+"'></div>";var grandTotalElement=$(".grandTotal");if(grandTotalElement.length){var grandElementTotalParent=grandTotalElement.closest("div");paypalPayLaterButtonExists&&grandElementTotalParent.after(paypalPayLaterElement);affirmButtons.length&&grandElementTotalParent.after(affirmElement)}else{paypalPayLaterButtonExists&&paypalButtons.before(paypalPayLaterElement);affirmButtons.before(affirmElement)}if(payLaterBannerTagExists){$("div[data-pp-placement=product]").attr("data-pp-amount",grandTotal)}$("[data-pp-placement=product]").find("iframe").css({"opacity":1,"pointer-events":"auto"});if(window.hasOwnProperty("affirm")){affirm.ui.ready(function(){affirm.ui.refresh()})}}}function fetchNewProducts(eventType){var totalPrice=0;var contents=[];var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(orderData&&orderData.hasOwnProperty("items")){var _fkCart3=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):[];var fkCartSent=sessionStorage.getItem("fkCartSent")!==null&&(eventType.toLowerCase()!=="purchase"||!isFirstTime())?JSON.parse(sessionStorage.getItem("fkCartSent")):[];var newItems=Object.keys(_fkCart3).filter(function(x){return!Object.keys(fkCartSent).includes(x)});if(newItems.length>0){orderData.items.forEach(function(item){var key=item.variantDetailId?item.productId.toString()+"."+item.variantDetailId.toString():item.productId.toString();if(newItems.includes(key)){contents.push({id:key,name:item.title?item.name+" "+item.title:item.name,quantity:parseInt(item.qty),price:item.price,sku:item.variantSku?item.variantSku:item.productSku,category:""});totalPrice+=parseFloat(item.price)}})}}var params={};params.event=eventType;params.transactionId=orderData?orderData.orderId:"";params.priceTotal=totalPrice.toFixed(2);params.currencyCode=pageData.selectedCampaign.currency;params.products=contents;if(eventType.toLowerCase()=="purchase"&&orderData&&orderData.shipAddress1){params.shippingAddress=orderData.shipAddress1;params.shippingAddress+=orderData.shipAddress2?" "+orderData.shipAddress2:"";params.shippingAddress+=" "+orderData.shipCity+" "+orderData.shipState+" "+orderData.shipCountry+" "+orderData.shipPostalCode}sessionStorage.setItem("fkCartSent",sessionStorage.getItem("fkCart"));return params}function fetchCartProducts(eventType){var totalPrice=0;var contents=[];var cartProducts=getOrderItemDetails();if(cartProducts&&Object.keys(cartProducts).length>0){var fkCartSent=sessionStorage.getItem("fkCartSent")!==null?JSON.parse(sessionStorage.getItem("fkCartSent")):[];var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i121=0;_i121<cartProductsEntriesLength;_i121++){var campaignProductId=cartProductsEntries[_i121][0];var _product11=cartProductsEntries[_i121][1];if(!fkCartSent[campaignProductId]){var unitPrice=_product11.variant&&parseFloat(_product11.variant.price)>0&&!_product11.isVariantBundle&&!_product11.isEditable?_product11.variant.price:_product11.cycle1_price;var _price6=getItemPrice(campaignProductId,unitPrice,_product11.currentOrderQuantity).toFixed(2);contents.push({id:campaignProductId.toString(),name:_product11.variant?_product11.productName+" "+_product11.variant.title:_product11.productName,quantity:_product11.currentOrderQuantity,price:_price6,sku:_product11.variant&&_product11.variant.productSku!==""?_product11.variant.productSku:_product11.productSku,category:""});totalPrice+=parseFloat(_price6)}}}var orderData=JSON.parse(sessionStorage.getItem("orderData"));var params={};params.event=eventType;params.transactionId=orderData?orderData.orderId:"";params.priceTotal=totalPrice.toFixed(2);params.currencyCode=pageData.selectedCampaign.currency;params.items=contents;sessionStorage.setItem("fkCartSent",sessionStorage.getItem("fkCart"));return params}window.onbeforeunload=function(event){if(pageData.pageTypeId===3){// FUN2-3434 : HOTFIX Remove confirm order. User might click back which is triggering the below call
// let params = {};
// params.orderId = JSON.parse(sessionStorage.getItem("orderId"));
// httpMethod("https://live-api.checkoutchamp.com/providersApi/V1/import/order/confirm", JSON.stringify(params));
// FUN2-3384
var purchaseEventType=pageData.funnelData.addOns.find(function(_ref8){var keyName=_ref8.keyName;return keyName==="Purchase_Event_FB"}).keyValue;if(purchaseEventType!=2&&purchaseEventType!=3){if(window.ltk)callPurchaseEventForLisTrak(window.ltk)}}};